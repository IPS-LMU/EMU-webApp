{"version":3,"file":"emuwebApp.min.js","sources":["emuwebApp.min.js"],"names":["wavParserWorker","Worker","window","this","url","getWorkerURL","worker","espsParserWorker","textGridParserWorker","spectroDrawingWorker","ssffParserWorker","ArrayBuffer","prototype","subarray","offset","length","sub","subView","Int8Array","thisView","i","angular","module","config","$locationProvider","html5Mode","service","viewState","sServObj","vals","curDbConfig","embeddedVals","audioGetUrl","labelGetUrl","labelType","fromUrlParams","setVals","data","$","isEmptyObject","forEach","Object","keys","key1","isArray","itm","push","key2","undefined","console","error","getSsffTrackConfig","name","res","ssffTrackDefinitions","tr","getLimsOfTrack","trackName","perspectives","curPerspectiveIdx","signalCanvases","contourLims","cL","ssffTrackName","getContourColorsOfTrack","contourColors","cC","getAssignment","signalName","assign","a","signalCanvasName","getLevelDefinition","levelName","levelDefinitions","ld","controller","$scope","$rootScope","$modal","$log","$compile","$timeout","$q","$window","$document","$location","HistoryService","Iohandlerservice","Soundhandlerservice","ConfigProviderService","fontScaleService","Ssffdataservice","LevelService","dialogService","Textgridparserservice","Espsparserservice","Binarydatamaniphelper","Wavparserservice","Ssffparserservice","Drawhelperservice","Validationservice","Appcachehandler","loadedMetaDataService","dbObjLoadSaveService","appStateService","DataService","cps","hists","fontImage","levServ","dataServ","vs","dials","ssffds","shs","dhs","wps","io","ach","connectBtnLabel","tmp","dbLoaded","is2dCancasesHidden","windowWidth","outerWidth","checkForNewVersion","element","bind","deleteEditArea","setWindowWidth","$digest","e","keyCode","keyMappings","shift","alt","addCurChangeObjToUndoStack","onbeforeunload","getBundleList","main","autoConnect","$on","resetToInitState","loadDefaultConfig","searchObject","search","loadFilesForEmbeddedApp","httpGetPath","then","showDropZone","setCurBndlName","substr","lastIndexOf","getsubmenuOpen","togglesubmenuOpen","colors","transitionTime","somethingInProgressTxt","resp","EMUwebAppConfig","validRes","validateJSO","catchMouseForKeyBinding","somethingInProgress","parseWavArrBuf","messWavParser","wavJSO","curViewPort","sS","eS","Data","resetSelect","data2","parseLabelFile","parseMess","annot","setData","lNames","levelDefs","levels","l","type","attributeDefinitions","setCurLevelAttrDefs","levelCanvases","order","setState","errMess","open","status","message","JSON","stringify","loadSchemas","replies","setSchemas","httpGetDefaultConfig","success","handleDefaultConfigLoaded","header","wsH","initConnect","serverUrl","handleConnectedToWSserver","setspectroSettings","spectrogramSettings","windowSizeInSecs","rangeFrom","rangeTo","dynamicRange","drawHeatMapColors","preEmphasisFilterFactor","heatMapColorAnchors","setTransitionTime","comMode","getProtocol","protocol","version","getDoUserManagement","doUsrData","innerHandleConnectedToWSserver","getDBconfigFile","bdata","setBundleList","loadBundle","toggleCollapseSession","ses","alert","uniqSessionList","collapsed","log","sessionIsCollapsed","getCurBndlName","genUniqSessionList","bndlList","fistSes","sList","bndl","idx","session","getEnlarge","index","len","large","getenlarge","cursorInTextField","setcursorInTextField","cursorOutOfTextField","openSubmenu","addLevelSegBtnClick","getPermission","newName","level","items","id","getNewId","sampleStart","sampleDur","labels","value","labelCanvasConfig","newSegmentName","getCurAttrDef","leveldef","insertLevel","addObjToUndoStack","action","addLevelPointBtnClick","samplePoint","Math","round","newEventName","renameSelLevelBtnClick","getcurClickLevelName","downloadTextGridBtnClick","asyncToTextGrid","openExport","getCurBndl","downloadAnnotationBtnClick","toJson","getData","spectSettingsBtnClick","connectBtnClick","openDemoDBbtnClick","nameOfDB","setDemoDbName","err","aboutBtnClick","showHierarchyBtnClick","showHierarchy","clearBtnClick","modalText","movesAwayFromLastSave","cmdZoomAll","setViewPort","cmdZoomIn","zoomViewPort","cmdZoomOut","cmdZoomLeft","shiftViewPort","cmdZoomRight","cmdZoomSel","selectS","selectE","cmdPlayView","playFromTo","animatePlayHead","cmdPlaySel","cmdPlayAll","changePerspective","persp","newIdx","setRightsubmenuOpen","getRightsubmenuOpen","getPerspectiveColor","cl","browserDetector","newfiles","wav","grid","curBndl","dropText","dropDefault","handleLocalFiles","reader","FileReader","readAsArrayBuffer","onloadend","evt","target","readyState","DONE","isBrowser","Firefox","result","currentTarget","extension","readAsText","asyncParseTextGrid","$parent","directive","$animate","templateUrl","restrict","scope","link","attr","canvas","find","levelCanvasContainer","levelDef","backgroundCanvas","background","levelColor","drawLevelDetails","drawLevelMarkup","$watch","newValue","oldValue","getcurMouseLevelName","changeCurAttrDef","attrDefName","curAttrDef","setCurAttrDef","hasClass","setEditing","addClass","removeClass","getAttrDefBtnColor","curColor","background-color","updateView","setcurMouseItem","levelDetails","fontSize","font","fontPxSize","ctx","getContext","clearRect","width","height","sDist","posS","posE","horizontalText","getSampleDist","scaleY","offsetHeight","getTextImageTwoLines","fontType","labelColor","drawImage","curID","getcurMouseItem","getcurClickItems","mTxtImgWidth","getTextImage","getLastImageWidth","zeroTxtImgWidth","endBoundaryColor","fillStyle","startBoundaryColor","curEvt","curLabVal","lab","getPos","fillRect","tW","tX","labelCenter","hlY","strokeStyle","beginPath","moveTo","lineTo","stroke","toString","horizontalSubText1","horizontalSubText2","hst2","perc","selectedLevelColor","drawMovingBoundaryLine","drawCurViewPortSelected","xOffset","segMId","isFirst","getcurMouseisFirst","isLast","getcurMouseisLast","clickedSegs","levelId","cs","selectedSegmentColor","selectedBoundaryColor","getcurMouseLevelType","replace","changeAttrDef","attrs","drawPlayHead","markupCanvas","playHeadAnimationInfos","posCur","curS","selectedAreaColor","drawVpOsciMarkup","reset","drawViewPortTimes","canvasLength","redraw","allPeakVals","calculatePeaks","osciPeaks","freshRedrawDrawOsciOnCanvas","currentBundleName","initialized","border","newVal","oldVal","drawPreview","ctxMarkup","selectedBorderColor","closePath","isOpen","$observe","mathHelperService","canvas0","canvas1","context","markupCtx","alpha","devicePixelRatio","primeWorker","drawSpectMarkup","setupEvent","drawSpectro","buffer","killSpectroRenderingThread","startSpectroRenderingThread","calcSamplesPerPxl","drawMinMaxAndName","spectroSettings","kill","imageData","createImageData","says","event","samplesPerPxl","Uint8ClampedArray","img","set","putImageData","parseData","fftN","calcClosestPowerOf2Gt","SampleRate","Float32Array","tell","upperFreq","lowerFreq","imgWidth","imgHeight","dynRangeInDB","pixelRatio","sampleRate","transparency","audioBuffer","audioBufferChannels","NumChannels","exportData","exportName","firefox","navigator","userAgent","match","cancel","close","getBlob","blob","Blob","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","updateHistoryService","export","objURL","URL","webkitURL","createObjectURL","SaveToDisk","fileURL","fileName","save","document","createElement","setAttribute","href","innerHTML","style","display","body","appendChild","click","download","createEvent","initEvent","dispatchEvent","revokeObjectURL","factory","myWindow","BARTLETT","BARTLETTHANN","BLACKMAN","COSINE","GAUSS","HAMMING","HANN","LANCZOS","RECTANGULAR","TRIANGULAR","curLevelAttrDefs","initialize","dragBarActive","dragBarHeight","endFreezeSample","timelineSize","historyActionTxt","editing","saving","hierarchyRotated","hierarchyShown","submenuOpen","rightSubmenuOpen","curClickItems","curMousePosSample","curMouseLevelName","curMouseLevelType","curClickLevelName","curClickLevelType","lastPcm","curPreselColumnSample","curCorrectionToolNr","curClickLevelIndex","start","TransitionTime","movingBoundary","movingBoundarySample","focusInTextField","curTaskPercCompl","mouseInEmuWebApp","states","noDBorFilesloaded","permittedActions","loadingSaving","labeling","modalShowing","prevState","curState","actionName","indexOf","b","nameOrObj","updatePlayHead","timestamp","player","isPlaying","requestAnimationFrame","samplesPassed","floor","$apply","startS","endS","select","end","getViewPort","rfrom","rto","dyn","win","hm","preEmph","hmColorAnchors","parseInt","setWindowFunction","getSelect","selectDependent","selectLevel","next","Levelserv","curLev","now","getLevelDetails","setcurClickLevel","idxOfNow","selectBoundary","getWindowFunctions","getdragBarActive","setdragBarActive","getdragBarHeight","setdragBarHeight","w","s","time","$broadcast","setsubmenuOpen","setenlarge","getTransitionTime","levelID","levelType","levelIndex","setcurClickLevelName","setcurClickLevelType","getcurClickLevelType","getcurClickLevelIndex","getcurClickNeighbours","curClickNeighbours","setcurMouseLevelName","setcurMouseLevelType","item","neighbour","x","curMouseItem","curMouseX","curMouseNeighbours","curMouseisFirst","curMouseisLast","getcurMouseNeighbours","selectItemsInSelection","levelData","min","Infinity","max","itemInSel","getItemsInSelection","setcurClickItemMultiple","itemsInRange","rangeStart","rangeEnd","t","setcurClickItem","left","right","entry","empty","front","back","sort","sortbyid","getselectedRange","getselected","isEditing","n","getLasPcm","setLastPcm","isHierarchyRotated","rotateHierarchy","isHierarchyOpen","getcursorInTextField","isSavingAllowed","setSavingAllowed","countSelected","getCurrentSample","getCurrentPercent","sample","getSamplesPerPixelVal","parseFloat","originalEvent","pow","k","substring","getViewPortStartTime","getViewPortEndTime","getSelectedStartTime","getSelectedEndTime","sSample","eSample","oldStart","oldEnd","abs","zoomIn","newStartS","newEndS","curMouseMoveItemStart","seg","d","isLastSeg","getItemDetails","getLastItem","d1","d2","shiftRight","curAttrDefName","newAttrDefName","ad","curAttrDefIndex","getCurAttrIndex","getX","offsetX","layerX","clientWidth","getY","offsetY","layerY","clientHeight","lastEventClick","lastEventMove","lastNeighboursMove","lastPCM","curMouseSampleNrInView","preventDefault","setLastMove","setLastClick","setLastRightClick","restrictions","editItemName","setLastDblClick","moveLine","samplesPerPixel","moveBy","zoomEventMove","getClosestItem","ceil","lastItem","getItemFromLevelById","nearest","mbutton","buttons","which","editItemSize","shiftKey","moveBoundary","updateCurChangeObj","movedBy","moveEvent","altKey","moveSegment","current","setlasteditArea","setlasteditAreaElem","parent","$index","openEditArea","doChange","getItemNeighboursFromLevel","LinkService","AnagestService","applyKeyCodeUp","code","esc","createNewItemAtSelection","domElement","getlasteditArea","str","val","definitions","legalLabels","css","applyKeyCode","stopPropagation","editingElement","getlastID","attrIndex","renameLabel","showHierarhy","rotateHierarhy","zoomAll","zoomOut","zoomSel","shiftViewPortLeft","shiftViewPortRight","playEntireFile","playback","playAllInView","playSelected","selectFirstContourCorrectionTool","correctionTool","selectSecondContourCorrectionTool","selectThirdContourCorrectionTool","selectFourthContourCorrectionTool","selectNoContourCorrectionTool","levelUp","levelDown","snapBoundaryToNearestTopBoundary","mouseSeg","neighbor","minDist","snapBoundary","position","snapBoundaryToNearestBottomBoundary","snapBoundaryToNearestZeroCrossing","dist","calcDistanceToNearestZeroCrossing","levelname","expandSelSegmentsRight","changeTime","addTimeValue","addTimeMode","expandSegment","rightSide","expandSelSegmentsLeft","shrinkSelSegmentsLeft","shrinkSelSegmentsRight","toggleSideBarLeft","activeButtons","openMenu","toggleSideBarRight","selPrevItem","idLeft","idRight","selNextItem","selNextPrevItem","addItem","getlasteditAreaElem","insSeg","insertSegment","ret","ids","segName","anagestConfig","insPoint","insertEvent","alreadyExists","pointName","insertAnagestEvents","undo","redo","deletePreselBoundary","cseg","deleteItem","deletedSegment","deleteSegments","deletedLinks","deleteLinkSegment","segments","clickSeg","deleteItemBoundary","deleteBoundary","deleteLinkBoundary","neighbourId","deletedPoint","deleteEvent","metaKey","ctrlKey","safeApply","fn","phase","$root","$$phase","off","delete","elem","elemHeight","deleteButton","children","saveButton","deleteSingleLevel","hide","saveSingleLevel","show","enlarge","asyncParseJSO","startPCM","$http","Websockethandler","prom","get","path","respType","responseType","getProm","logOnUser","pwd","getBundle","saveBundle","bundleData","string","annotates","fileType","asyncParseEsps","setPlayerSrc","buf","base64String","arrayBufferToBase64","src","resetPlayerSrcFromTo","endSample","bytePerSample","BitsPerSample","origArrBuf","dv","DataView","setUint32","newData","Uint8Array","byteLength","pause","play","addEventListener","atts","ssffTrackname","assTrackName","lastDraw","Date","handleUpdate","ass","col","getColumnOfTrack","columnName","sRaSt","getSampleRateAndStartTimeOfTrack","minMaxLims","drawValues","startTime","sR","sT","minVal","maxVal","_minVal","_maxVal","startTimeVP","endTimeVP","colStartSampleNr","colEndSampleNr","nrOfSamples","curSampleArrs","values","slice","y","curSampleInCol","curSampleInColTime","contourVal","contourNr","minContourIdx","maxContourIdx","contColors","selectedContourColor","leftBorder","leftVal","curArr","curArrIdx","arc","PI","rightBorder","rightVal","txt","crossHairsColor","defer","resolve","reject","asyncParseSsffArr","ssffArray","cmd","ssffArr","promise","asyncJso2ssff","jso","switchMarkupContext","leave","drawCrossHairs","setSelectDrag","curMouseSample","dragStartSample","dragEndSample","bundleName","mouseX","curMouseTime","curMouseSampleTime","fill","copy","updateObj","sampleBlockIdx","sampleIdx","key","getScale","scale","measureText","getScaleWidth","str1","str2","scaleX","drawFrame","prevPeak","h","prevH","prevX","prevY","osciColor","relData","samplePerPx","numberOfChannels","peaks","minPeak","maxPeak","apply","Array","call","curPxIdx","avrVal","c","sum","p","peak","hDbS","sNr","drawSampleNrs","strokeText","fillText","drawZeroLine","zeroLineColor","vendor","setLineDash","zeroLineY","drawTimeAndSamples","space","offsetWidth","mouseEvt","unit","trackname","mouseY","mouseFreq","s1","s2","verticalText","smallFontSize","th","trackNameImg","labelTxtImg","sTime","eTime","applyChange","changeObj","applyOldVal","cur","renameLevel","newname","deleteLevel","deleteBoundaryInvers","deleteSegmentsInvers","insertLinksTo","deleteLinksTo","deleteLinkBoundaryInvers","deleteLinkSegmentInvers","insertSegmentInvers","parentID","childIDs","undoStack","redoStack","curChangeObj","dataObj","dataKey","String","info","obj","tmpObj","oldChangeObj","pop","getNrOfPossibleUndos","getCurrentStack","buffLength","textGrid","rand","random","new","newHash","isMobile","Android","BlackBerry","iOS","Opera","Windows","any","Chrome","InternetExplorer","PhantomJS","isMobileDevice","isDesktopDevice","lastTextWidth","spaceTop","ctxOriginal","text","color","restore","text2","alignLeft","esps","loginData","username","password","errorMsg","tryLogin","Columns","calculateSamplePosInVP","colSampleNr","sampleTime","audioSample","maxItemID","setLevelData","getLevelData","getLevelDataAt","insertLevelDataAt","newLevel","splice","deleteLevelDataAt","getLinkData","links","setLinkData","insertLinkData","newLink","deleteLinkDataAt","insertLinkDataAt","changeLinkDataAt","fromNewID","toNewID","fromID","toID","raiseId","amount","lowerId","getLabelIdx","labelIdx","lasteditArea","lasteditAreaElem","curLevel","num","getLevelsByType","types","getOrderById","eid","getIdByOrder","details","getNextItem","foundItm","getItemsFromLevelByIdAndLength","foundItms","lastID","j","segment","remove","clientOffset","offsetLeft","top","offsetTop","editText","zoom","createEditAreaElement","createSelection","field","createTextRange","selRange","collapse","moveStart","moveEnd","setSelectionRange","selectionStart","selectionEnd","focus","label","labelid","textid","prepend","class","ng-model","autofocus","padding-top","overflow-x","overflow-y","insertItemDetails","labelname","duration","newElement","attrdefs","updateSegItemInLevel","setPointDetails","firstid","lastid","sampleNr","maximum","spaceLower","spaceHigher","lvl","originalLevel","newLabelName","oldname","insertPoint","lastNeighbours","timeRight","timeLeft","firstSegment","firstOrder","lastSegment","neighbours","deleteOrder","diff2","startOrder","diff","newLabel","startID","newStart","endID","pos","last","toDelete","retOrder","retEvt","oldName","toTop","neighTd","absDist","sampleTarget","absMinDist","thisTd","tIdx","orig","ln","origRight","origLeft","isIntermediate","orderPoints","first","tempItem","allow","lastLength","distRight","distLeft","getAllLabelsOfLevel","insertLink","insertLinkAt","deleteLink","linkIdx","linkExists","hasParents","ID","hasChildren","toIDs","insertLinksFrom","fromIDs","deleteLinksFrom","getLinksTo","linkOrder","getLinksFrom","changeLinkTo","changeLinkFrom","linksTo","linksFrom","found","deleted","neighbourID","ord","uuid","wsonopen","connected","conPromise","wsonmessage","listener","fromJson","wsonerror","wsonclose","wasClean","sendRequest","request","callbackId","getCallbackId","callbacks","cb","callbackID","ws","send","tOutResp","serverTimeoutInterval","messageObj","hasOwnProperty","newUUID","WebSocket","onopen","onmessage","onerror","onclose","isConnected","closeConnect","userName","disconnectWarning","serverInfos","Url","connectionError","tryConnection","base64ToArrayBuffer","stringBase64","binaryString","atob","bytes","ascii","charCodeAt","binary","fromCharCode","btoa","modalInstance","templatefile","argCtrl","passedIn","backdrop","keyboard","passedInTxt","passedInOpts","handleUpdatereadyEvent","appCache","swapCache","location","reload","applicationCache","update","getStrRep","options","selWindowInfo","modalVals","_fftN","_windowSizeInSamples","getColorOfAnchor","anchorNr","curStyle","calcWindowSizeInSamples","calcFftN","calcWindowSizeVals","saveSpectroSettings","confirm","ArrayHelperService","myData","convertArrayToXYjsoArray","filter","input","regex","patt","RegExp","toLowerCase","out","test","patt1","patt2","passedOutTxt","var","saveChanges","discardChanges","showMenu","showTwod","animation","transclude","showTwoDimCans","template","panes","bottomRightResizePane","addPane","pane","setBottomRightResizePane","dragBottomRightResizePaneTopResizer","dragBottomRightResizePaneLeftResizer","dragBottomRightResizePaneCornerResizer","handler","pane1","pane2","pane3","bottomRightResizePaneTopResizer","bottomRightResizePaneLeftResizer","bottomRightResizePaneCornerResizer","pane1Min","minSize","pane2Min","dragSplitPaneResizer","drag","after","ev","bounds","getBoundingClientRect","bottom","clientY","clientX","require","bgSplitterCtrl","typeclass","drawSsffTrackMarkup","HierarchyLayoutService","vertical","playing","selectedItem","cLAD","debug","selectVisibleNodes","render","centerNode","node","_x","_y","svg","transition","getOrientatedTransform","zoomListener","translate","transform","getOrientatedNodeTransform","getNodeText","getLevelName","getOrientatedTextAnchor","getOrientatedTextX","getOrientatedTextY","getPath","controlX","_fromX","controlY","_toY","_fromY","_toX","nodeOnClick","isCollapsing","_collapsed","currentDescendant","descendants","findChildren","concat","_collapsedParents","_collapsePosition","nodeOnRightClick","nodeOnMouseOver","timeInfoLevel","currentItem","timeInfoType","firstTimeItem","lastTimeItem","itemList","startSample","rootLevelItems","_visible","d3","behavior","scaleExtent","on","nodes","calculateWeightsBottomUp","levelItems","ii","allLinks","parentElement","depthToX","depth","size","posInLevelToY","posInLevel","_depth","_posInLevel","_fromDepth","_fromPosInLevel","_toDepth","_toPosInLevel","dataSet","selectAll","newNodes","enter","oldNodes","exit","getOrientatedTextTransform","classed","linkSet","newLinks","oldLinks","insert","resizeHierarchy","drawEpgGrid","binValStrArr","gridWidth","gridHeight","sInterv","curFrame","el","elIdx","split","reverse","binStr","binStrIdx","globalMinX","globalMaxX","globalMinY","globalMaxY","drawDots","setGlobalMinMaxVals","dD","twoDimCanvases","twoDimDrawingDefinitions","dots","trConf","xSsffTrack","xCol","ySsffTrack","yCol","tw","xsRaSt","ysRaSt","curMousePosTime","degrees","rotate","allDots","xContourNr","yContourNr","startPoint","endPoint","f","connectLines","fromDot","toDot","dropTextDefault","dropTextErrorFileType","dropTextErrorAPI","dropAllowed","dropParsingStarted","dropParsingWaiting","dropHintDefault","dropHint","dropClass","traverseFileTreeChrome","isFile","file","toUpperCase","other","isDirectory","dirReader","createReader","readEntries","entries","traverseFileTreeFirefox","dragEnterLeave","handleDragOver","dropFiles","File","FileList","dt","dataTransfer","files","webkitGetAsEntry","acceptGrid","acceptWav","acceptBoth","acceptFile","handleFilesonChange","loadedFiles","fileDialog","schemasJsos","names","proms","all","schemaArr","schemaName","schema","tv4","validate","paths","possible","possibleAsStr","selected","findPaths","arr","arrIdx","join","getSelIdx","selIdx","getRotation","playSelection","getPlaying","isCurrentAttrDef","attrDef","setCurrentAttrDef","getAllAttrDefs","levDef","traverse","o","parentsFound","findParentLevels","childLevel","parents","linkDefinitions","sublevelName","superlevelName","layoutNonItemLevel","levelDepth","layoutItemLevel","selectedPath","firstChild","lastChild","findParents","_parents","_weight","itemWeight","startLevel","nodeID","currentLevel","li","it","foooooooo","sortTree","toggleChildren","_children","defaultPrevented","source","levelWidth","childCount","tree","root","newHeight","viewerWidth","maxLabelLength","svgGroup","nodeEnter","y0","x0","overCircle","outCircle","rotated","nodeUpdate","nodeExit","diagonal","_visited","layout","myLayout","viewerHeight","projection","baseSvg","convertToAbsValues","multiplyEachElement","interp2points","x1","y1","findMinMax","minOrMax","flattenArrayOfArray","arrOfArrs","merged","xyArray","verticalPosSsffTrackName","vTrackName","velocitySsffTrackName","vTr","vCol","flatColVals","flatVcolVals","gdat","NaN","vdat","ndat","cdat","startTimeSel","endTimeSel","selCol","selVCol","maxVerticalPos","maxVelBeforeMaxConstr","minVelBeforeMaxVel","interactiveFindThresholds","threshold","on20","minVelBetwMaxVel1maxConstr","minp","off20","maxVelAfterMaxConstr","minBetwMaxConstrMaxVelConstr","minVelAfterMaxVelAfterConstr","curLabel","gestureOnOffsetLabels","gdat0insPoint","gdat1insPoint","maxVelocityOnOffsetLabels","vdat0insPoint","vdat1insPoint","constrictionPlateauBeginEndLabels","ndat0insPoint","ndat1insPoint","maxConstrictionLabel","cdat0insPoint","linkLevelName","autoLinkLevelName","linkLevelDetails","linkLevelLabels","itemIdx","direction","description","thdat","thdir","xx","lx","xsh","loguk","higuk","vz","anavv","infos","thresholdIdx","thresholdValue","ap","margin","linear","range","xAxis","axis","tickSize","tickSubdivide","yAxis","orient","lineFunc","line","interpolate","domain","x2","y2","bundleList","demoDbName","bList","setCurBndl","getDemoDbName","updateCollapseSessionState","bundle","getSessionCollapseState","lmds","dolss","filterText","uttIsDisabled","getBndlColor","isSessionDefined","messModal","arrBuff","mediaFile","curClickSegments","ssffFiles","ssffJso","annotation","formants","getAnnotationAndSaveBndl","messParser","encoding","getWorkerScript","js","workerInit","global","ab2str","ab","unis","wav2jso","curBinIdx","curBuffer","curBufferView","wavRep","ChunkID","Uint32Array","ChunkSize","Format","Subchunk1ID","Subchunk1Size","Uint16Array","AudioFormat","ByteRate","BlockAlign","Subchunk2ID","Subchunk2Size","Int16Array","parserRes","postMessage","urlObj","terminate","msg","toJSO","labelJSO","headEndIdx","lines","prevLineArr","idCounter","curLineArr","toESPS","espsStr","retVal","l1","l2","localID","testForGapsInLabelJSO","counter","findTimeOfMinSample","findTimeOfMaxSample","myFile","myName","VU_STR","$0","$1","re","tT","tN","eT","inHeader","labs","eSt","eEt","toTextGrid","tG","nl","levelNr","curVal","evtNr","executed","TWO_PI","totalMax","N","wFunction","myFFT","pixelHeight","internalalpha","maxPsd","HzStep","paint","sin","cos","ceilingFreqFftIdx","floorFreqFftIdx","resultImgArr","toLinearLevel","dbLevel","log10","arg","magnitude","real","imag","sqrt","FFT","m","applyWindowFuncAndPreemph","applyPreEmph","wFunctionBartlett","wFunctionBartlettHann","wFunctionBlackman","wFunctionCosine","wFunctionGauss","wFunctionHamming","wFunctionHann","wFunctionLanczos","wFunctionRectangular","wFunctionTriangular","a0","a1","a2","E","curSample","prevSample","fft","n1","n2","t1","t2","convertToHeatmap","minval","maxval","maxIndex","v","i1","i2","rgb1","rgb2","r","g","drawVerticalLineOfSpectogram","xIdx","rgb","px","py","psd","psdLog","scaledVal","isNaN","hmVals","calcMagnitudeSpectrum","windowSizeInSamples","low","renderSpectrogram","renderError","ssffData","headID","machineID","sepString","origFreq","base64encode","c1","c2","c3","base64EncodeChars","charAt","base64decode","c4","base64DecodeChars","stringToUint","charList","uintArray","Uint8Concat","second","firstLength","ssff2jso","uIntBuffView","buffStr","newLsep","lSpl","ssffdatatype","curLen","curMin","curMax","Float64Array","jso2ssff","headerStr","bytePerTime","failed","byteSizeOfDataBuffer","dataBuff","dataBuffView","ssffBufView","byteOffSet","curArray","curArrayIDX","curCol","setInt16","parseArr","noError","resArr","parse","curExp"],"mappings":"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","sourcesContent":["'use strict';\n//expand ArrayBuffer with subarray function\nArrayBuffer.prototype.subarray = function (offset, length) {\n  var sub = new ArrayBuffer(length);\n  var subView = new Int8Array(sub);\n  var thisView = new Int8Array(this);\n  for (var i = 0; i < length; i++) {\n    subView[i] = thisView[offset + i];\n  }\n  return sub;\n};\n'use strict';\nangular.module('emuwebApp', [\n  'ui',\n  'ui.bootstrap',\n  'ngAnimate',\n  'angular.filter'\n]).config([\n  '$locationProvider',\n  function ($locationProvider) {\n    // $routeProvider\n    //   .when('/', {\n    //     templateUrl: 'views/main.html'\n    //   })\n    //   .otherwise({\n    //     redirectTo: '/'\n    //   });\n    $locationProvider.html5Mode(true);\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('ConfigProviderService', [\n  'viewState',\n  function (viewState) {\n    // shared service object\n    var sServObj = {};\n    sServObj.vals = {};\n    sServObj.curDbConfig = {};\n    // embedded values -> if these are set this overrides the normal config  \n    sServObj.embeddedVals = {\n      audioGetUrl: '',\n      labelGetUrl: '',\n      labelType: '',\n      fromUrlParams: false\n    };\n    /**\n\t\t * depth of 2 = max\n\t\t */\n    sServObj.setVals = function (data) {\n      if ($.isEmptyObject(sServObj.vals)) {\n        sServObj.vals = data;\n      } else {\n        angular.forEach(Object.keys(data), function (key1) {\n          // if array... overwrite entire thing!\n          if (angular.isArray(sServObj.vals[key1])) {\n            //empty array\n            sServObj.vals[key1] = [];\n            angular.forEach(data[key1], function (itm) {\n              sServObj.vals[key1].push(itm);\n            });\n          } else {\n            angular.forEach(Object.keys(data[key1]), function (key2) {\n              if (sServObj.vals[key1][key2] !== undefined) {\n                sServObj.vals[key1][key2] = data[key1][key2];\n              } else {\n                console.error('BAD ENTRY IN CONFIG! Key1: ' + key1 + ' key2: ' + key2);\n              }\n            });\n          }\n        });\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSsffTrackConfig = function (name) {\n      var res;\n      if (sServObj.curDbConfig.ssffTrackDefinitions !== undefined) {\n        angular.forEach(sServObj.curDbConfig.ssffTrackDefinitions, function (tr) {\n          if (tr.name === name) {\n            res = tr;\n          }\n        });\n      }\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getLimsOfTrack = function (trackName) {\n      var res = {};\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourLims, function (cL) {\n        if (cL.ssffTrackName === trackName) {\n          res = cL;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getContourColorsOfTrack = function (trackName) {\n      var res;\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors, function (cC) {\n        if (cC.ssffTrackName === trackName) {\n          res = cC;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getAssignment = function (signalName) {\n      var res = {};\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.assign, function (a) {\n        if (a.signalCanvasName === signalName) {\n          res = a;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getLevelDefinition = function (levelName) {\n      var res = {};\n      angular.forEach(sServObj.curDbConfig.levelDefinitions, function (ld) {\n        if (ld.name === levelName) {\n          res = ld;\n        }\n      });\n      return res;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('MainCtrl', [\n  '$scope',\n  '$rootScope',\n  '$modal',\n  '$log',\n  '$compile',\n  '$timeout',\n  '$q',\n  '$window',\n  '$document',\n  '$location',\n  'viewState',\n  'HistoryService',\n  'Iohandlerservice',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'fontScaleService',\n  'Ssffdataservice',\n  'LevelService',\n  'dialogService',\n  'Textgridparserservice',\n  'Espsparserservice',\n  'Binarydatamaniphelper',\n  'Wavparserservice',\n  'Ssffparserservice',\n  'Drawhelperservice',\n  'Validationservice',\n  'Appcachehandler',\n  'loadedMetaDataService',\n  'dbObjLoadSaveService',\n  'appStateService',\n  'DataService',\n  function ($scope, $rootScope, $modal, $log, $compile, $timeout, $q, $window, $document, $location, viewState, HistoryService, Iohandlerservice, Soundhandlerservice, ConfigProviderService, fontScaleService, Ssffdataservice, LevelService, dialogService, Textgridparserservice, Espsparserservice, Binarydatamaniphelper, Wavparserservice, Ssffparserservice, Drawhelperservice, Validationservice, Appcachehandler, loadedMetaDataService, dbObjLoadSaveService, appStateService, DataService) {\n    // hook up services to use abbreviated forms\n    $scope.cps = ConfigProviderService;\n    $scope.hists = HistoryService;\n    $scope.fontImage = fontScaleService;\n    $scope.levServ = LevelService;\n    $scope.dataServ = DataService;\n    $scope.vs = viewState;\n    $scope.dials = dialogService;\n    $scope.ssffds = Ssffdataservice;\n    $scope.shs = Soundhandlerservice;\n    $scope.dhs = Drawhelperservice;\n    $scope.wps = Wavparserservice;\n    $scope.io = Iohandlerservice;\n    $scope.ach = Appcachehandler;\n    // init vars\n    $scope.connectBtnLabel = 'connect';\n    $scope.tmp = {};\n    $scope.dbLoaded = false;\n    $scope.is2dCancasesHidden = true;\n    $scope.windowWidth = $window.outerWidth;\n    // check for new version\n    $scope.ach.checkForNewVersion();\n    //////////////\n    // bindings\n    // bind window resize event\n    angular.element($window).bind('resize', function () {\n      LevelService.deleteEditArea();\n      viewState.setWindowWidth($window.outerWidth);\n      $scope.$digest();\n    });\n    // bind shift/alt keyups for history\n    angular.element($window).bind('keyup', function (e) {\n      if (e.keyCode === ConfigProviderService.vals.keyMappings.shift || e.keyCode === ConfigProviderService.vals.keyMappings.alt) {\n        HistoryService.addCurChangeObjToUndoStack();\n        $scope.$digest();\n      }\n    });\n    // Take care of preventing navigation out of app (only if something is loaded, not in embedded mode and not developing (auto connecting))\n    window.onbeforeunload = function () {\n      if (ConfigProviderService.embeddedVals.audioGetUrl === '' && loadedMetaDataService.getBundleList().length > 0 && !ConfigProviderService.vals.main.autoConnect) {\n        return 'Do you really wish to leave/reload the EMU-webApp? All unsaved changes will be lost...';\n      }\n    };\n    //////////////\n    // watches\n    // watch if embedded override (if attributes are set on emuwebapp tag)\n    // $scope.$watch('cps.embeddedVals.audioGetUrl', function (val) {\n    // \tif (val !== undefined && val !== '') {\n    // \t\t// check if both are set\n    // \t\t$scope.loadFilesForEmbeddedApp();\n    // \t}\n    // }, true);\n    //\n    //////////////\n    /////////////\n    // listens\n    // listen for connectionDisrupted event -> I don't like listens but in this case it might me the way to go...\n    $scope.$on('connectionDisrupted', function (event, args) {\n      appStateService.resetToInitState();\n    });\n    // listen for resetToInitState\n    $scope.$on('resetToInitState', function () {\n      $scope.loadDefaultConfig();\n    });\n    //\n    ////////////\n    // check if URL parameters are set -> if so set embedded flags!\n    var searchObject = $location.search();\n    if (searchObject['audioGetUrl'] && searchObject['labelGetUrl'] && searchObject['labelType']) {\n      ConfigProviderService.embeddedVals.audioGetUrl = searchObject.audioGetUrl;\n      ConfigProviderService.embeddedVals.labelGetUrl = searchObject.labelGetUrl;\n      ConfigProviderService.embeddedVals.labelType = searchObject.labelType;\n      ConfigProviderService.embeddedVals.fromUrlParams = true;\n    }\n    ;\n    /**\n\t\t *\n\t\t */\n    $scope.loadFilesForEmbeddedApp = function () {\n      if (ConfigProviderService.embeddedVals.audioGetUrl) {\n        Iohandlerservice.httpGetPath(ConfigProviderService.embeddedVals.audioGetUrl, 'arraybuffer').then(function (data) {\n          viewState.showDropZone = false;\n          // set bundle name\n          var tmp = ConfigProviderService.embeddedVals.audioGetUrl;\n          loadedMetaDataService.setCurBndlName(tmp.substr(0, tmp.lastIndexOf('.')).substr(tmp.lastIndexOf('/') + 1, tmp.length));\n          //hide menu\n          if (viewState.getsubmenuOpen()) {\n            viewState.togglesubmenuOpen(ConfigProviderService.vals.colors.transitionTime);\n          }\n          viewState.somethingInProgressTxt = 'Loading DB config...';\n          // then get the DBconfigFile\n          Iohandlerservice.httpGetPath('configFiles/embedded_emuwebappConfig.json').then(function (resp) {\n            // first element of perspectives is default perspective\n            viewState.curPerspectiveIdx = 0;\n            ConfigProviderService.setVals(resp.data.EMUwebAppConfig);\n            // validate emuwebappConfigSchema\n            delete resp.data.EMUwebAppConfig;\n            // delete to avoid duplicate\n            var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n            if (validRes === true) {\n              // turn of keybinding only on mouseover\n              if (ConfigProviderService.embeddedVals.fromUrlParams) {\n                ConfigProviderService.vals.main.catchMouseForKeyBinding = false;\n              }\n              ConfigProviderService.curDbConfig = resp.data;\n              // validate DBconfigFileSchema!\n              validRes = Validationservice.validateJSO('DBconfigFileSchema', ConfigProviderService.curDbConfig);\n              if (validRes === true) {\n                // set wav file\n                viewState.somethingInProgress = true;\n                viewState.somethingInProgressTxt = 'Parsing WAV file...';\n                Wavparserservice.parseWavArrBuf(data.data).then(function (messWavParser) {\n                  var wavJSO = messWavParser;\n                  viewState.curViewPort.sS = 0;\n                  viewState.curViewPort.eS = wavJSO.Data.length;\n                  viewState.resetSelect();\n                  Soundhandlerservice.wavJSO = wavJSO;\n                  // get + parse file\n                  Iohandlerservice.httpGetPath(ConfigProviderService.embeddedVals.labelGetUrl, 'utf-8').then(function (data2) {\n                    viewState.somethingInProgressTxt = 'Parsing ' + ConfigProviderService.embeddedVals.labelType + ' file...';\n                    Iohandlerservice.parseLabelFile(data2.data, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedTextGrid', ConfigProviderService.embeddedVals.labelType).then(function (parseMess) {\n                      var annot = parseMess;\n                      DataService.setData(annot);\n                      var lNames = [];\n                      var levelDefs = [];\n                      annot.levels.forEach(function (l) {\n                        lNames.push(l.name);\n                        levelDefs.push({\n                          'name': l.name,\n                          'type': l.type,\n                          'attributeDefinitions': {\n                            'name': l.name,\n                            'type': 'string'\n                          }\n                        });\n                      });\n                      // set level defs\n                      ConfigProviderService.curDbConfig.levelDefinitions = levelDefs;\n                      viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n                      ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order = lNames;\n                      viewState.somethingInProgressTxt = 'Done!';\n                      viewState.somethingInProgress = false;\n                      viewState.setState('labeling');\n                    }, function (errMess) {\n                      dialogService.open('views/error.html', 'ModalCtrl', 'Error parsing wav file: ' + errMess.status.message);\n                    });\n                  }, function (errMess) {\n                    dialogService.open('views/error.html', 'ModalCtrl', 'Could not get label file: ' + ConfigProviderService.embeddedVals.labelGetUrl + ' ERROR ' + JSON.stringify(errMess, null, 4));\n                  });\n                }, function (errMess) {\n                  dialogService.open('views/error.html', 'ModalCtrl', 'Error parsing wav file: ' + errMess.status.message);\n                });\n              } else {\n                dialogService.open('views/error.html', 'ModalCtrl', 'Error validating DBconfig: ' + JSON.stringify(validRes, null, 4));\n              }\n            } else {\n              dialogService.open('views/error.html', 'ModalCtrl', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4));\n            }\n          }, function (errMess) {\n            dialogService.open('views/error.html', 'ModalCtrl', 'Could not get embedded_config.json: ' + errMess);\n          });\n        }, function (errMess) {\n          dialogService.open('views/error.html', 'ModalCtrl', 'Could not get audio file:' + ConfigProviderService.embeddedVals.audioGetUrl + ' ERROR: ' + JSON.stringify(errMess, null, 4));\n        });\n      }\n    };\n    /**\n\t\t * init load of config files\n\t\t */\n    $scope.loadDefaultConfig = function () {\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Loading schema files';\n      // load schemas first\n      Validationservice.loadSchemas().then(function (replies) {\n        Validationservice.setSchemas(replies);\n        Iohandlerservice.httpGetDefaultConfig().success(function (data) {\n          viewState.somethingInProgressTxt = 'Validating emuwebappConfig';\n          var validRes = Validationservice.validateJSO('emuwebappConfigSchema', data);\n          if (validRes === true) {\n            ConfigProviderService.setVals(data);\n            $scope.handleDefaultConfigLoaded();\n            // loadFilesForEmbeddedApp if these are set \n            $scope.loadFilesForEmbeddedApp();\n            viewState.somethingInProgress = false;\n          } else {\n            dialogService.open('views/error.html', 'ModalCtrl', 'Error validating emuwebappConfigSchema: ' + JSON.stringify(validRes, null, 4)).then(function () {\n              appStateService.resetToInitState();\n            });\n          }\n        }).error(function (data, status, header, config) {\n          dialogService.open('views/error.html', 'ModalCtrl', 'Could not get defaultConfig for EMU-webApp: ' + ' status: ' + status + ' header: ' + header + ' config ' + config).then(function () {\n            appStateService.resetToInitState();\n          });\n        });\n      }, function (errMess) {\n        dialogService.open('views/error.html', 'ModalCtrl', 'Error loading schema file: ' + JSON.stringify(errMess, null, 4)).then(function () {\n          appStateService.resetToInitState();\n        });\n      });\n    };\n    // call function on init\n    $scope.loadDefaultConfig();\n    /**\n\t\t * function called after default config was loaded\n\t\t */\n    $scope.handleDefaultConfigLoaded = function () {\n      if (!viewState.getsubmenuOpen()) {\n        viewState.togglesubmenuOpen(ConfigProviderService.vals.colors.transitionTime);\n      }\n      if (ConfigProviderService.vals.main.autoConnect) {\n        Iohandlerservice.wsH.initConnect(ConfigProviderService.vals.main.serverUrl).then(function (message) {\n          if (message.type === 'error') {\n            dialogService.open('views/error.html', 'ModalCtrl', 'Could not connect to websocket server: ' + ConfigProviderService.vals.main.serverUrl);\n          } else {\n            $scope.handleConnectedToWSserver();\n          }\n        });\n      }\n      // init loading of files for testing\n      viewState.setspectroSettings(ConfigProviderService.vals.spectrogramSettings.windowSizeInSecs, ConfigProviderService.vals.spectrogramSettings.rangeFrom, ConfigProviderService.vals.spectrogramSettings.rangeTo, ConfigProviderService.vals.spectrogramSettings.dynamicRange, ConfigProviderService.vals.spectrogramSettings.window, ConfigProviderService.vals.spectrogramSettings.drawHeatMapColors, ConfigProviderService.vals.spectrogramSettings.preEmphasisFilterFactor, ConfigProviderService.vals.spectrogramSettings.heatMapColorAnchors);\n      // setting transition values\n      viewState.setTransitionTime(ConfigProviderService.vals.colors.transitionTime / 1000);\n    };\n    /**\n\t\t * function is called after websocket connection\n\t\t * has been established. It executes the protocol\n\t\t * and loads the first bundle in the bundle list (= default behavior).\n\t\t */\n    $scope.handleConnectedToWSserver = function () {\n      // hide drop zone \n      viewState.showDropZone = false;\n      ConfigProviderService.vals.main.comMode = 'WS';\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Checking protocol...';\n      // Check if server speaks the same protocol\n      Iohandlerservice.getProtocol().then(function (res) {\n        if (res.protocol === 'EMU-webApp-websocket-protocol' && res.version === '0.0.1') {\n          viewState.somethingInProgressTxt = 'Checking user management...';\n          // then ask if server does user management\n          Iohandlerservice.getDoUserManagement().then(function (doUsrData) {\n            if (doUsrData === 'NO') {\n              $scope.innerHandleConnectedToWSserver();\n            } else {\n              // show user management error \n              dialogService.open('views/loginModal.html', 'LoginCtrl').then(function (res) {\n                if (res) {\n                  $scope.innerHandleConnectedToWSserver();\n                } else {\n                  appStateService.resetToInitState();\n                }\n              });\n            }\n          });\n        } else {\n          // show protocol error and disconnect from server\n          dialogService.open('views/error.html', 'ModalCtrl', 'Could not connect to websocket server: ' + ConfigProviderService.vals.main.serverUrl + '. It does not speak the same protocol as this client. Its protocol answer was: \"' + res.protocol + '\" with the version: \"' + res.version + '\"').then(function () {\n            appStateService.resetToInitState();\n          });\n        }\n      });\n    };\n    /**\n\t\t * to avoid redundant code...\n\t\t */\n    $scope.innerHandleConnectedToWSserver = function () {\n      viewState.somethingInProgressTxt = 'Loading DB config...';\n      // then get the DBconfigFile\n      Iohandlerservice.getDBconfigFile().then(function (data) {\n        // first element of perspectives is default perspective\n        viewState.curPerspectiveIdx = 0;\n        ConfigProviderService.setVals(data.EMUwebAppConfig);\n        delete data.EMUwebAppConfig;\n        // delete to avoid duplicate\n        var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n        if (validRes === true) {\n          ConfigProviderService.curDbConfig = data;\n          viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n          validRes = Validationservice.validateJSO('DBconfigFileSchema', data);\n          if (validRes === true) {\n            // then get the DBconfigFile\n            viewState.somethingInProgressTxt = 'Loading bundle list...';\n            Iohandlerservice.getBundleList().then(function (bdata) {\n              validRes = loadedMetaDataService.setBundleList(bdata);\n              if (validRes === true) {\n                // then load first bundle in list\n                dbObjLoadSaveService.loadBundle(loadedMetaDataService.getBundleList()[0]);\n              } else {\n                dialogService.open('views/error.html', 'ModalCtrl', 'Error validating bundleList: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                  appStateService.resetToInitState();\n                });\n              }\n            });\n          } else {\n            dialogService.open('views/error.html', 'ModalCtrl', 'Error validating DBconfig: ' + JSON.stringify(validRes, null, 4)).then(function () {\n              appStateService.resetToInitState();\n            });\n          }\n        } else {\n          dialogService.open('views/error.html', 'ModalCtrl', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4)).then(function () {\n            appStateService.resetToInitState();\n          });\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.toggleCollapseSession = function (ses) {\n      alert($scope.uniqSessionList[ses].collapsed);\n      $scope.uniqSessionList[ses].collapsed = !$scope.uniqSessionList[ses].collapsed;\n      console.log($scope.uniqSessionList[ses].collapsed);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.sessionIsCollapsed = function (ses) {\n      console.log(ses);\n      console.log($scope.uniqSessionList[ses].collapsed);\n      // return $scope.uniqSessionList[ses].collapsed;\n      return false;\n    };\n    $scope.getCurBndlName = function () {\n      return loadedMetaDataService.getCurBndlName();\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.genUniqSessionList = function (bndlList) {\n      var sList = [];\n      var fistSes;\n      bndlList.forEach(function (bndl, idx) {\n        sList[bndl.session] = { 'collapsed': true };\n        if (idx === 0) {\n          fistSes = bndl.session;\n        }\n      });\n      // open fist session up \n      sList[fistSes].collapsed = false;\n      console.log(sList['0001'].collapsed);\n      return sList;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getEnlarge = function (index) {\n      var len = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.order.length;\n      var large = 50;\n      if (viewState.getenlarge() == -1) {\n        return 'auto';\n      } else {\n        if (len === 1) {\n          return 'auto';\n        }\n        if (len === 2) {\n          if (viewState.getenlarge() == index) {\n            return '70%';\n          } else {\n            return '27%';\n          }\n        } else {\n          if (viewState.getenlarge() == index) {\n            return large + '%';\n          } else {\n            return (98 - large) / (len - 1) + '%';\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.openSubmenu = function () {\n      viewState.togglesubmenuOpen(ConfigProviderService.vals.colors.transitionTime);\n    };\n    /////////////////////////////////////////\n    // handle button clicks\n    // top menu:\n    /**\n\t\t *\n\t\t */\n    $scope.addLevelSegBtnClick = function () {\n      if (viewState.getPermission('addLevelSegBtnClick')) {\n        var length = 0;\n        if (DataService.data.levels !== undefined) {\n          length = DataService.data.levels.length;\n        }\n        var newName = 'levelNr' + length;\n        var level = {\n            items: [{\n                id: DataService.getNewId(),\n                sampleStart: 0,\n                sampleDur: Soundhandlerservice.wavJSO.Data.length,\n                labels: [{\n                    name: newName,\n                    value: ConfigProviderService.vals.labelCanvasConfig.newSegmentName\n                  }]\n              }],\n            name: newName,\n            type: 'SEGMENT'\n          };\n        if (viewState.getCurAttrDef(newName) === undefined) {\n          var leveldef = {\n              name: newName,\n              type: 'EVENT',\n              attributeDefinitions: {\n                name: newName,\n                type: 'string'\n              }\n            };\n          viewState.setCurLevelAttrDefs(leveldef);\n        }\n        LevelService.insertLevel(level, length, viewState.curPerspectiveIdx);\n        //  Add to history\n        HistoryService.addObjToUndoStack({\n          'type': 'ANNOT',\n          'action': 'INSERTLEVEL',\n          'level': level,\n          'id': length,\n          'curPerspectiveIdx': viewState.curPerspectiveIdx\n        });\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.addLevelPointBtnClick = function () {\n      if (viewState.getPermission('addLevelPointBtnClick')) {\n        var length = 0;\n        if (DataService.data.levels !== undefined) {\n          length = DataService.data.levels.length;\n        }\n        var newName = 'levelNr' + length;\n        var level = {\n            items: [{\n                id: DataService.getNewId(),\n                samplePoint: Math.round(Soundhandlerservice.wavJSO.Data.length / 2),\n                labels: []\n              }],\n            name: newName,\n            type: 'EVENT'\n          };\n        level.items[0].labels.push({\n          name: newName,\n          value: ConfigProviderService.vals.labelCanvasConfig.newEventName\n        });\n        if (viewState.getCurAttrDef(newName) === undefined) {\n          var leveldef = {\n              name: newName,\n              type: 'EVENT',\n              attributeDefinitions: {\n                name: newName,\n                type: 'string'\n              }\n            };\n          viewState.setCurLevelAttrDefs(leveldef);\n        }\n        LevelService.insertLevel(level, length, viewState.curPerspectiveIdx);\n        //  Add to history\n        HistoryService.addObjToUndoStack({\n          'type': 'ANNOT',\n          'action': 'INSERTLEVEL',\n          'level': level,\n          'id': length,\n          'curPerspectiveIdx': viewState.curPerspectiveIdx\n        });\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.renameSelLevelBtnClick = function () {\n      if (viewState.getPermission('renameSelLevelBtnClick')) {\n        if (viewState.getcurClickLevelName() !== undefined) {\n          dialogService.open('views/renameLevel.html', 'ModalCtrl', viewState.getcurClickLevelName());\n        } else {\n          dialogService.open('views/error.html', 'ModalCtrl', 'Rename Error : Please choose a Level first !');\n        }\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.downloadTextGridBtnClick = function () {\n      if (viewState.getPermission('downloadTextGridBtnClick')) {\n        Textgridparserservice.asyncToTextGrid().then(function (parseMess) {\n          dialogService.openExport('views/export.html', 'ExportCtrl', parseMess, loadedMetaDataService.getCurBndl().name + '.TextGrid');\n        });\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.downloadAnnotationBtnClick = function () {\n      if (viewState.getPermission('downloadAnnotationBtnClick')) {\n        dialogService.openExport('views/export.html', 'ExportCtrl', angular.toJson(DataService.getData(), true), loadedMetaDataService.getCurBndl().name + '_annot.json');\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.spectSettingsBtnClick = function () {\n      if (viewState.getPermission('spectSettingsChange')) {\n        dialogService.open('views/spectSettings.html', 'spectSettingsCtrl', '');\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.connectBtnClick = function () {\n      if (viewState.getPermission('connectBtnClick')) {\n        dialogService.open('views/connectModal.html', 'WsconnectionCtrl').then(function (url) {\n          if (url) {\n            Iohandlerservice.wsH.initConnect(url).then(function (message) {\n              if (message.type === 'error') {\n                dialogService.open('views/error.html', 'ModalCtrl', 'Could not connect to websocket server: ' + url);\n              } else {\n                $scope.handleConnectedToWSserver();\n              }\n            });\n          }\n        });\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.openDemoDBbtnClick = function (nameOfDB) {\n      if (viewState.getPermission('openDemoBtnDBclick')) {\n        loadedMetaDataService.setDemoDbName(nameOfDB);\n        // hide drop zone \n        viewState.showDropZone = false;\n        viewState.somethingInProgress = true;\n        // alert(nameOfDB);\n        viewState.setState('loadingSaving');\n        ConfigProviderService.vals.main.comMode = 'DEMO';\n        viewState.somethingInProgressTxt = 'Loading DB config...';\n        Iohandlerservice.getDBconfigFile(nameOfDB).then(function (res) {\n          var data = res.data;\n          // first element of perspectives is default perspective\n          viewState.curPerspectiveIdx = 0;\n          ConfigProviderService.setVals(data.EMUwebAppConfig);\n          delete data.EMUwebAppConfig;\n          // delete to avoid duplicate\n          var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n          if (validRes === true) {\n            ConfigProviderService.curDbConfig = data;\n            viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n            validRes = Validationservice.validateJSO('DBconfigFileSchema', ConfigProviderService.curDbConfig);\n            if (validRes === true) {\n              // then get the DBconfigFile\n              viewState.somethingInProgressTxt = 'Loading bundle list...';\n              Iohandlerservice.getBundleList(nameOfDB).then(function (res) {\n                var bdata = res.data;\n                // validRes = Validationservice.validateJSO('bundleListSchema', bdata);\n                // if (validRes === true) {\n                loadedMetaDataService.setBundleList(bdata);\n                // then load first bundle in list\n                dbObjLoadSaveService.loadBundle(loadedMetaDataService.getBundleList()[0]);  // } else {\n                                                                                            // \tdialogService.open('views/error.html', 'ModalCtrl', 'Error validating bundleList: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                                                                                            // \t\tappStateService.resetToInitState();\n                                                                                            // \t});\n                                                                                            // }\n              }, function (err) {\n                dialogService.open('views/error.html', 'ModalCtrl', 'Error loading bundle list of ' + nameOfDB + ': ' + err.data + ' STATUS: ' + err.status).then(function () {\n                  appStateService.resetToInitState();\n                });\n              });\n            } else {\n              dialogService.open('views/error.html', 'ModalCtrl', 'Error validating DBconfig: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          } else {\n            dialogService.open('views/error.html', 'ModalCtrl', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4)).then(function () {\n              appStateService.resetToInitState();\n            });\n          }\n        }, function (err) {\n          dialogService.open('views/error.html', 'ModalCtrl', 'Error loading DB config of ' + nameOfDB + ': ' + err.data + ' STATUS: ' + err.status).then(function () {\n            appStateService.resetToInitState();\n          });\n        });\n      }  //else {\n         // \tconsole.log('action currently not allowed');\n         // }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.aboutBtnClick = function () {\n      dialogService.open('views/about.html', 'AboutCtrl');\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.showHierarchyBtnClick = function () {\n      viewState.showHierarchy();\n      dialogService.open('views/showHierarchyModal.html', 'ShowhierarchyCtrl');\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.clearBtnClick = function () {\n      // viewState.setdragBarActive(false);\n      var modalText;\n      if (HistoryService.movesAwayFromLastSave !== 0 && ConfigProviderService.vals.main.comMode !== 'DEMO') {\n        modalText = 'Do you wish to clear all loaded data and if connected disconnect from the server? CAUTION: YOU HAVE UNSAVED CHANGES! These will be lost if you confirm.';\n      } else {\n        modalText = 'Do you wish to clear all loaded data and if connected disconnect from the server? You have NO unsaved changes so no changes will be lost.';\n      }\n      dialogService.open('views/confirmModal.html', 'ConfirmmodalCtrl', modalText).then(function (res) {\n        if (res) {\n          appStateService.resetToInitState();\n        }\n      });\n    };\n    // bottom menu:\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomAll = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.setViewPort(0, Soundhandlerservice.wavJSO.Data.length);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomIn = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.zoomViewPort(true);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomOut = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.zoomViewPort(false);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomLeft = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.shiftViewPort(false);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomRight = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.shiftViewPort(true);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomSel = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.setViewPort(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlayView = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(viewState.curViewPort.sS, viewState.curViewPort.eS);\n        viewState.animatePlayHead(viewState.curViewPort.sS, viewState.curViewPort.eS);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlaySel = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n        viewState.animatePlayHead(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlayAll = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(0, Soundhandlerservice.wavJSO.Data.length);\n        viewState.animatePlayHead(0, Soundhandlerservice.wavJSO.Data.length);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    ///////////////////////////\n    // other\n    /**\n\t\t * function used to change perspective\n\t\t * @param persp json object of current perspective containing name attribute\n\t\t */\n    $scope.changePerspective = function (persp) {\n      var newIdx;\n      for (var i = 0; i < ConfigProviderService.vals.perspectives.length; i++) {\n        if (persp.name === ConfigProviderService.vals.perspectives[i].name) {\n          newIdx = i;\n        }\n      }\n      viewState.curPerspectiveIdx = newIdx;\n      // close submenu\n      viewState.setRightsubmenuOpen(!viewState.getRightsubmenuOpen());\n    };\n    /**\n\t\t * function used by right side menu to get color of current perspecitve in ul\n\t\t * @param persp json object of current perspective containing name attribute\n\t\t */\n    $scope.getPerspectiveColor = function (persp) {\n      var cl;\n      if (viewState.curPerspectiveIdx === -1 || persp.name === ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].name) {\n        cl = 'emuwebapp-curSelPerspLi';\n      } else {\n        cl = 'emuwebapp-perspLi';\n      }\n      return cl;\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('FileCtrl', [\n  '$scope',\n  'viewState',\n  'browserDetector',\n  'appStateService',\n  'Binarydatamaniphelper',\n  'Textgridparserservice',\n  'ConfigProviderService',\n  'Validationservice',\n  'Iohandlerservice',\n  'Wavparserservice',\n  'Soundhandlerservice',\n  'DataService',\n  'loadedMetaDataService',\n  'dbObjLoadSaveService',\n  'dialogService',\n  function ($scope, viewState, browserDetector, appStateService, Binarydatamaniphelper, Textgridparserservice, ConfigProviderService, Validationservice, Iohandlerservice, Wavparserservice, Soundhandlerservice, DataService, loadedMetaDataService, dbObjLoadSaveService, dialogService) {\n    $scope.newfiles = [];\n    $scope.wav = {};\n    $scope.grid = {};\n    $scope.curBndl = {};\n    $scope.resetToInitState = function () {\n      $scope.newfiles = [];\n      $scope.wav = {};\n      $scope.grid = {};\n      $scope.curBndl = {};\n      $scope.dropText = $scope.dropDefault;\n      appStateService.resetToInitState();\n    };\n    $scope.handleLocalFiles = function () {\n      var validRes;\n      viewState.showDropZone = false;\n      viewState.setState('loadingSaving');\n      // reset history\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Loading local File: ' + $scope.wav.name;\n      var reader = new FileReader();\n      reader.readAsArrayBuffer($scope.wav);\n      reader.onloadend = function (evt) {\n        if (evt.target.readyState == FileReader.DONE) {\n          Iohandlerservice.httpGetPath('configFiles/standalone_emuwebappConfig.json').then(function (resp) {\n            // first element of perspectives is default perspective\n            viewState.curPerspectiveIdx = 0;\n            ConfigProviderService.setVals(resp.data.EMUwebAppConfig);\n            delete resp.data.EMUwebAppConfig;\n            // delete to avoid duplicate\n            validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n            if (validRes === true) {\n              ConfigProviderService.curDbConfig = resp.data;\n              if (browserDetector.isBrowser.Firefox()) {\n                validRes = evt.target.result;\n              } else {\n                validRes = evt.currentTarget.result;\n              }\n              viewState.somethingInProgressTxt = 'Parsing WAV file...';\n              Wavparserservice.parseWavArrBuf(validRes).then(function (wavJSO) {\n                var extension = $scope.wav.name.substr(0, $scope.wav.name.lastIndexOf('.'));\n                viewState.curViewPort.sS = 0;\n                viewState.curViewPort.eS = wavJSO.Data.length;\n                viewState.resetSelect();\n                viewState.curPerspectiveIdx = 0;\n                Soundhandlerservice.wavJSO = wavJSO;\n                loadedMetaDataService.setBundleList([{ name: extension }]);\n                loadedMetaDataService.setCurBndlName(extension);\n                // parsing of Textgrid Data\n                if (!$.isEmptyObject($scope.grid)) {\n                  var reader = new FileReader();\n                  reader.readAsText($scope.grid);\n                  reader.onloadend = function (evt) {\n                    if (evt.target.readyState == FileReader.DONE) {\n                      Textgridparserservice.asyncParseTextGrid(evt.currentTarget.result, $scope.wav.name, extension).then(function (parseMess) {\n                        var annot = parseMess;\n                        DataService.setData(annot);\n                        var lNames = [];\n                        var levelDefs = [];\n                        annot.levels.forEach(function (l) {\n                          lNames.push(l.name);\n                          levelDefs.push({\n                            'name': l.name,\n                            'type': l.type,\n                            'attributeDefinitions': {\n                              'name': l.name,\n                              'type': 'string'\n                            }\n                          });\n                        });\n                        // set level defs\n                        ConfigProviderService.curDbConfig.levelDefinitions = levelDefs;\n                        viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n                        ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order = lNames;\n                      });\n                    }\n                  }, function (errMess) {\n                    $scope.$parent.dials.open('views/error.html', 'ModalCtrl', 'Error parsing textgrid file: ' + errMess.status.message);\n                  };\n                  viewState.somethingInProgressTxt = 'Done!';\n                  viewState.setState('labeling');\n                } else {\n                  viewState.somethingInProgressTxt = 'Done!';\n                  viewState.setState('labeling');\n                }\n              });\n            } else {\n              $scope.$parent.dials.open('views/error.html', 'ModalCtrl', 'Error validating ConfigProviderService.vals (emuwebappConfig data) : ' + JSON.stringify(validRes, null, 4));\n            }\n          }, function (errMess) {\n            $scope.$parent.dials.open('views/error.html', 'ModalCtrl', 'Error parsing wav file: ' + errMess.status.message);\n          });\n        }\n      };\n      viewState.somethingInProgress = false;\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('level', [\n  '$animate',\n  'viewState',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  'HistoryService',\n  'fontScaleService',\n  'dialogService',\n  'LevelService',\n  function ($animate, viewState, ConfigProviderService, Drawhelperservice, HistoryService, fontScaleService, dialogService, LevelService) {\n    return {\n      templateUrl: 'views/level.html',\n      restrict: 'E',\n      scope: {\n        level: '=',\n        idx: '='\n      },\n      link: function postLink(scope, element, attr) {\n        // select the needed DOM items from the template\n        var canvas = element.find('canvas');\n        scope.open = attr.open;\n        scope.vs = viewState;\n        scope.hists = HistoryService;\n        scope.cps = ConfigProviderService;\n        scope.dials = dialogService;\n        var levelCanvasContainer = element.find('div');\n        scope.levelDef = ConfigProviderService.getLevelDefinition(scope.level.name);\n        scope.backgroundCanvas = { 'background': ConfigProviderService.vals.colors.levelColor };\n        // on broadcast msg from main ctrl openSubmenu refresh timeline\n        scope.$on('refreshTimeline', function () {\n          scope.drawLevelDetails(scope.level, viewState, ConfigProviderService);\n          scope.drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n        });\n        ///////////////\n        // watches\n        //\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS || oldValue.windowWidth !== newValue.windowWidth) {\n            scope.drawLevelDetails(scope.level, viewState, ConfigProviderService);\n            scope.drawLevelMarkup(scope.level, viewState, ConfigProviderService);  //console.log('leveldraw update A');\n          } else {\n            //console.log('leveldraw update B');\n            scope.drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n          }\n        }, true);\n        //\n        scope.$watch('vs.curMouseX', function (newValue, oldValue) {\n          // only repaint if mouse over current level\n          if (viewState.getcurMouseLevelName() === scope.level.name) {\n            //if (!oldValue || !newValue || newValue.id !== oldValue.id) {\n            //\tdrawLevelMarkup(scope.level, viewState, ConfigProviderService);\n            //} else {\n            scope.drawLevelDetails(scope.level, viewState, ConfigProviderService);\n            scope.drawLevelMarkup(scope.level, viewState, ConfigProviderService);  //}\n          }\n        }, true);\n        //\n        scope.$watch('vs.curClickLevelName', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            scope.drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n          }\n        }, true);\n        //\n        scope.$watch('vs.movingBoundarySample', function () {\n          scope.drawLevelDetails(scope.level, viewState, ConfigProviderService);\n          scope.drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n        }, true);\n        //\n        scope.$watch('vs.movingBoundary', function () {\n          scope.drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n        }, true);\n        //\n        scope.$watch('hists.movesAwayFromLastSave', function () {\n          scope.drawLevelDetails(scope.level, viewState, ConfigProviderService);\n          scope.drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n        }, true);\n        //\n        /////////////////\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.changeCurAttrDef = function (attrDefName, index) {\n          var curAttrDef = viewState.getCurAttrDef(scope.level.name);\n          if (curAttrDef !== attrDefName) {\n            // curAttrDef = attrDefName;\n            viewState.setCurAttrDef(scope.level.name, attrDefName, index);\n            if (!element.hasClass('emuwebapp-levelCanvasContainer-animate')) {\n              viewState.setEditing(false);\n              LevelService.deleteEditArea();\n              $animate.addClass(levelCanvasContainer, 'emuwebapp-levelCanvasContainer-animate').then(function () {\n                $animate.removeClass(levelCanvasContainer, 'emuwebapp-levelCanvasContainer-animate');\n                // redraw\n                scope.drawLevelDetails(scope.level, viewState, ConfigProviderService);\n                scope.drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n              });\n            }\n          }\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.getAttrDefBtnColor = function (attrDefName) {\n          var curColor;\n          var curAttrDef = viewState.getCurAttrDef(scope.level.name);\n          if (attrDefName === curAttrDef) {\n            curColor = { 'background': '-webkit-radial-gradient(50% 50%, closest-corner, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0) 60%)' };\n          } else {\n            curColor = { 'background-color': 'white' };\n          }\n          return curColor;\n        };\n        scope.updateView = function () {\n          if ($.isEmptyObject(scope.cps)) {\n            console.log('undef viewState');\n            return;\n          }\n          scope.drawLevelDetails(scope.level, scope.vs, scope.cps);\n        };\n        ///////////////\n        // bindings\n        // on mouse leave reset viewState.\n        element.bind('mouseleave', function () {\n          viewState.setcurMouseItem(undefined, undefined, undefined);\n          scope.drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n        });\n        /**\n\t\t\t\t * draw level details\n\t\t\t\t * @param levelDetails\n\t\t\t\t * @param viewState\n\t\t\t\t * @param cps\n\t\t\t\t */\n        scope.drawLevelDetails = function (levelDetails, viewState, config) {\n          var fontSize = config.vals.font.fontPxSize;\n          var curAttrDef = viewState.getCurAttrDef(scope.level.name);\n          if ($.isEmptyObject(levelDetails)) {\n            console.log('undef levelDetails');\n            return;\n          }\n          if ($.isEmptyObject(viewState)) {\n            console.log('undef viewState');\n            return;\n          }\n          if ($.isEmptyObject(config)) {\n            console.log('undef config');\n            return;\n          }\n          if (!scope.open) {\n            fontSize -= 1;\n          }\n          var ctx = canvas[0].getContext('2d');\n          ctx.clearRect(0, 0, canvas[0].width, canvas[0].height);\n          //predef vars\n          var sDist, posS, posE, horizontalText;\n          sDist = viewState.getSampleDist(canvas[0].width);\n          // draw name of level and type\n          var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n          if (levelDetails.name === curAttrDef) {\n            horizontalText = fontScaleService.getTextImageTwoLines(ctx, levelDetails.name, '(' + levelDetails.type + ')', fontSize, config.vals.font.fontType, config.vals.colors.labelColor, true);\n          } else {\n            horizontalText = fontScaleService.getTextImageTwoLines(ctx, levelDetails.name + ':' + curAttrDef, '(' + levelDetails.type + ')', fontSize, config.vals.font.fontType, config.vals.colors.labelColor, true);\n          }\n          ctx.drawImage(horizontalText, 0, ctx.canvas.height / 2 - fontSize * scaleY);\n          var segMId = viewState.getcurMouseItem();\n          var segCId = viewState.getcurClickItems();\n          var levelId = viewState.getcurClickLevelName();\n          var curID = -1;\n          // calculate generic max with of single char (m char used)\n          var mTxtImg = fontScaleService.getTextImage(ctx, 'm', fontSize - 2, config.vals.font.fontType, config.vals.colors.labelColor);\n          var mTxtImgWidth = fontScaleService.getLastImageWidth();\n          // calculate generic max with of single digit (0 digit used)\n          var zeroTxtImg = fontScaleService.getTextImage(ctx, '0', fontSize - 4, config.vals.font.fontType, config.vals.colors.endBoundaryColor);\n          var zeroTxtImgWidth = fontScaleService.getLastImageWidth();\n          if (levelDetails.type === 'SEGMENT') {\n            ctx.fillStyle = config.vals.colors.startBoundaryColor;\n            // draw segments\n            var e = levelDetails.items;\n            e.forEach(function (curEvt) {\n              ++curID;\n              if (curEvt.sampleStart >= viewState.curViewPort.sS && curEvt.sampleStart <= viewState.curViewPort.eS || curEvt.sampleStart + curEvt.sampleDur > viewState.curViewPort.sS && curEvt.sampleStart + curEvt.sampleDur < viewState.curViewPort.eS || curEvt.sampleStart < viewState.curViewPort.sS && curEvt.sampleStart + curEvt.sampleDur > viewState.curViewPort.eS) {\n                // get label\n                var curLabVal;\n                curEvt.labels.forEach(function (lab) {\n                  if (lab.name === curAttrDef) {\n                    curLabVal = lab.value;\n                  }\n                });\n                // draw segment start\n                posS = viewState.getPos(canvas[0].width, curEvt.sampleStart);\n                posE = viewState.getPos(canvas[0].width, curEvt.sampleStart + curEvt.sampleDur + 1);\n                ctx.fillStyle = config.vals.colors.startBoundaryColor;\n                ctx.fillRect(posS, 0, 2, canvas[0].height / 2);\n                //draw segment end\n                ctx.fillStyle = config.vals.colors.endBoundaryColor;\n                ctx.fillRect(posE, canvas[0].height / 2, 2, canvas[0].height);\n                //check for enough space to stroke text\n                if (curLabVal !== undefined && posE - posS > mTxtImgWidth * curLabVal.length) {\n                  horizontalText = fontScaleService.getTextImage(ctx, curLabVal, fontSize - 2, config.vals.font.fontType, config.vals.colors.labelColor);\n                  var tW = fontScaleService.getLastImageWidth();\n                  var tX = posS + (posE - posS) / 2 - tW / 2;\n                  if (scope.open) {\n                    ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, tX, canvas[0].height / 2 - (fontSize - 2), horizontalText.width, horizontalText.height);\n                  } else {\n                    ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, tX, 0, horizontalText.width, horizontalText.height);\n                  }\n                }\n                //draw helper lines\n                if (scope.open && curLabVal.length !== 0) {\n                  // only draw if label is not empty\n                  var labelCenter = posS + (posE - posS) / 2;\n                  var hlY = canvas[0].height / 4;\n                  // start helper line\n                  ctx.strokeStyle = config.vals.colors.startBoundaryColor;\n                  ctx.beginPath();\n                  ctx.moveTo(posS, hlY);\n                  ctx.lineTo(labelCenter, hlY);\n                  ctx.lineTo(labelCenter, hlY + 5);\n                  ctx.stroke();\n                  hlY = canvas[0].height / 4 * 3;\n                  // end helper line\n                  ctx.strokeStyle = config.vals.colors.endBoundaryColor;\n                  ctx.beginPath();\n                  ctx.moveTo(posE, hlY);\n                  ctx.lineTo(labelCenter, hlY);\n                  ctx.lineTo(labelCenter, hlY - 5);\n                  ctx.stroke();\n                }\n                // draw sampleStart numbers\n                //check for enough space to stroke text\n                if (posE - posS > zeroTxtImgWidth * curEvt.sampleStart.toString().length) {\n                  var horizontalSubText1 = fontScaleService.getTextImage(ctx, curEvt.sampleStart, fontSize - 4, config.vals.font.fontType, config.vals.colors.endBoundaryColor);\n                  ctx.drawImage(horizontalSubText1, 0, 0, horizontalText.width, horizontalText.height, posS + 3, 0, horizontalText.width, horizontalText.height);\n                }\n                // draw sampleDur numbers.\n                //check for enough space to stroke text\n                if (posE - posS > zeroTxtImgWidth * (5 + curEvt.sampleDur.toString().length)) {\n                  var horizontalSubText2 = fontScaleService.getTextImage(ctx, 'dur: ' + curEvt.sampleDur, fontSize - 4, config.vals.font.fontType, config.vals.colors.endBoundaryColor);\n                  var hst2 = fontScaleService.getLastImageWidth();\n                  ctx.drawImage(horizontalSubText2, 0, 0, horizontalText.width, horizontalText.height, posE - hst2, canvas[0].height / 4 * 3, horizontalText.width, horizontalText.height);\n                }\n              }\n            });\n          } else if (levelDetails.type === 'EVENT') {\n            ctx.fillStyle = config.vals.colors.startBoundaryColor;\n            // predef. vars\n            var perc;\n            levelDetails.items.forEach(function (curEvt) {\n              if (curEvt.samplePoint > viewState.curViewPort.sS && curEvt.samplePoint < viewState.curViewPort.eS) {\n                perc = Math.round(viewState.getPos(canvas[0].width, curEvt.samplePoint) + sDist / 2);\n                // get label\n                var curLabVal;\n                curEvt.labels.forEach(function (lab) {\n                  if (lab.name === curAttrDef) {\n                    curLabVal = lab.value;\n                  }\n                });\n                ctx.fillStyle = config.vals.colors.startBoundaryColor;\n                ctx.fillRect(perc, 0, 1, canvas[0].height / 2 - canvas[0].height / 10);\n                ctx.fillRect(perc, canvas[0].height / 2 + canvas[0].height / 10, 1, canvas[0].height / 2 - canvas[0].height / 10);\n                horizontalText = fontScaleService.getTextImage(ctx, curLabVal, fontSize - 2, config.vals.font.fontType, config.vals.colors.labelColor);\n                ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, perc - 5, canvas[0].height / 3, horizontalText.width, horizontalText.height);\n                horizontalText = fontScaleService.getTextImage(ctx, curEvt.samplePoint, fontSize - 4, config.vals.font.fontType, config.vals.colors.endBoundaryColor);\n                ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, perc + 5, 0, horizontalText.width, horizontalText.height);\n              }\n            });\n          }  // draw cursor/selected area\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.drawLevelMarkup = function (levelDetails, viewState, config) {\n          var ctx = canvas[1].getContext('2d');\n          ctx.clearRect(0, 0, canvas[1].width, canvas[1].height);\n          if (levelDetails.name === viewState.getcurClickLevelName()) {\n            ctx.fillStyle = config.vals.colors.selectedLevelColor;\n            ctx.fillRect(0, 0, canvas[0].width, canvas[0].height);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n          // draw current viewport selected\n          Drawhelperservice.drawCurViewPortSelected(ctx);\n          var posS, posE, sDist, xOffset, curEvt;\n          posS = viewState.getPos(canvas[1].width, viewState.curViewPort.selectS);\n          posE = viewState.getPos(canvas[1].width, viewState.curViewPort.selectE);\n          sDist = viewState.getSampleDist(canvas[1].width);\n          var segMId = viewState.getcurMouseItem();\n          var isFirst = viewState.getcurMouseisFirst();\n          var isLast = viewState.getcurMouseisLast();\n          var clickedSegs = viewState.getcurClickItems();\n          var levelId = viewState.getcurClickLevelName();\n          if (clickedSegs !== undefined) {\n            // draw clicked on selected areas\n            if (levelDetails.name === levelId && clickedSegs.length > 0) {\n              clickedSegs.forEach(function (cs) {\n                if (cs !== undefined) {\n                  // check if segment or event level\n                  if (cs.sampleStart !== undefined) {\n                    posS = Math.round(viewState.getPos(canvas[0].width, cs.sampleStart));\n                    posE = Math.round(viewState.getPos(canvas[0].width, cs.sampleStart + cs.sampleDur + 1));\n                  } else {\n                    posS = Math.round(viewState.getPos(canvas[0].width, cs.samplePoint) + sDist / 2);\n                    posS = posS - 5;\n                    posE = posS + 10;\n                  }\n                  ctx.fillStyle = config.vals.colors.selectedSegmentColor;\n                  ctx.fillRect(posS, 0, posE - posS, canvas[0].height);\n                  ctx.fillStyle = config.vals.colors.startBoundaryColor;\n                }\n              });\n            }\n          }\n          // draw preselected boundary\n          curEvt = viewState.getcurMouseItem();\n          if (curEvt !== undefined && segMId !== undefined && levelDetails.name === viewState.getcurMouseLevelName()) {\n            ctx.fillStyle = config.vals.colors.selectedBoundaryColor;\n            if (isFirst === true) {\n              // before first segment\n              if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n                curEvt = levelDetails.items[0];\n                posS = Math.round(viewState.getPos(canvas[1].width, curEvt.sampleStart));\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              }\n            } else if (isLast === true) {\n              // after last segment\n              if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n                curEvt = levelDetails.items[levelDetails.items.length - 1];\n                posS = Math.round(viewState.getPos(canvas[1].width, curEvt.sampleStart + curEvt.sampleDur + 1));\n                // +1 because boundaries are drawn on sampleStart\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              }\n            } else {\n              // in the middle\n              if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n                posS = Math.round(viewState.getPos(canvas[1].width, curEvt.sampleStart));\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              } else {\n                posS = Math.round(viewState.getPos(canvas[1].width, curEvt.samplePoint));\n                xOffset = sDist / 2;\n                ctx.fillRect(posS + xOffset, 0, 3, canvas[1].height);\n              }\n            }\n            ctx.fillStyle = config.vals.colors.startBoundaryColor;\n          }\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('osci', [\n  '$timeout',\n  'viewState',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  function ($timeout, viewState, Soundhandlerservice, ConfigProviderService, Drawhelperservice) {\n    return {\n      templateUrl: 'views/osci.html',\n      replace: true,\n      restrict: 'E',\n      scope: {},\n      controller: [\n        '$scope',\n        function ($scope) {\n          $scope.changeAttrDef = function () {\n            alert('sadf');\n          };\n        }\n      ],\n      link: function postLink(scope, element, attrs) {\n        // select the needed DOM elements from the template\n        var canvasLength = element.find('canvas').length;\n        var canvas = element.find('canvas')[0];\n        var markupCanvas = element.find('canvas')[canvasLength - 1];\n        // assign attributes to scope\n        scope.order = attrs.order;\n        scope.trackName = attrs.trackName;\n        scope.cps = ConfigProviderService;\n        scope.viewState = viewState;\n        ///////////////\n        // watches\n        // on broadcast msg from main ctrl openSubmenu refresh timeline\n        scope.$on('refreshTimeline', function () {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        });\n        //\n        scope.$watch('viewState.timelineSize', function () {\n          $timeout(scope.redraw, 10);\n        });\n        //\n        scope.$watch('viewState.curPerspectiveIdx', function () {\n          drawVpOsciMarkup(scope, ConfigProviderService, true);\n        }, true);\n        //\n        scope.$watch('viewState.playHeadAnimationInfos', function () {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              drawPlayHead(scope, ConfigProviderService);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.movingBoundarySample', function (newValue) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.movingBoundary', function () {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              // check for changed zoom\n              if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                var allPeakVals = Drawhelperservice.calculatePeaks(viewState, canvas, Soundhandlerservice.wavJSO.Data);\n                Drawhelperservice.osciPeaks = allPeakVals;\n                Drawhelperservice.freshRedrawDrawOsciOnCanvas(viewState, canvas, Drawhelperservice.osciPeaks, Soundhandlerservice.wavJSO.Data, ConfigProviderService);\n              }\n              drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        /////////////////////////\n        scope.redraw = function () {\n          drawVpOsciMarkup(scope, ConfigProviderService, true);\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        function drawPlayHead(scope, config) {\n          var ctx = markupCanvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          var posS = viewState.getPos(markupCanvas.width, viewState.playHeadAnimationInfos.sS);\n          var posCur = viewState.getPos(markupCanvas.width, viewState.playHeadAnimationInfos.curS);\n          // console.log(viewState.playHeadAnimationInfos.curS)\n          ctx.fillStyle = ConfigProviderService.vals.colors.selectedAreaColor;\n          ctx.fillRect(posS, 0, posCur - posS, canvas.height);\n          //console.log(posS,posCur);\n          drawVpOsciMarkup(scope, config, false);\n        }\n        /**\n\t\t\t\t * draws markup of osci according to\n\t\t\t\t * the information that is specified in\n\t\t\t\t * the viewport\n\t\t\t\t */\n        function drawVpOsciMarkup(scope, config, reset) {\n          var ctx = markupCanvas.getContext('2d');\n          if (reset) {\n            ctx.clearRect(0, 0, markupCanvas.width, markupCanvas.height);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n          Drawhelperservice.drawViewPortTimes(ctx, true);\n          // draw current viewport selected\n          Drawhelperservice.drawCurViewPortSelected(ctx, true);\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('preview', [\n  'viewState',\n  'Soundhandlerservice',\n  'Drawhelperservice',\n  'ConfigProviderService',\n  function (viewState, Soundhandlerservice, Drawhelperservice, ConfigProviderService) {\n    return {\n      templateUrl: 'views/preview.html',\n      restrict: 'E',\n      scope: { currentBundleName: '@' },\n      link: function postLink(scope, element) {\n        // select the needed DOM elements from the template and init vals\n        var canvas = element.find('canvas')[0];\n        var markupCanvas = element.find('canvas')[1];\n        var initialized = false;\n        // hook up scope vars for watches\n        scope.vs = viewState;\n        scope.shs = Soundhandlerservice;\n        scope.backgroundCanvas = {\n          'background': '#eee',\n          'border': '1px solid gray',\n          'width': '100%',\n          'height': '100%'\n        };\n        /////////////////////\n        // watches\n        //\n        scope.$watch('vs.curViewPort', function (newVal, oldVal) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            if (oldVal.sS !== newVal.sS || oldVal.eS !== newVal.eS) {\n              scope.drawPreview();\n            }\n          }\n        }, true);\n        //\n        scope.$watch('currentBundleName', function () {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            initialized = false;\n            scope.backgroundCanvas = {\n              'background': ConfigProviderService.vals.colors.levelColor,\n              'border': '1px solid gray',\n              'width': '100%',\n              'height': '100%'\n            };\n            scope.drawPreview();\n          }\n          //clear on empty bundle name\n          if (scope.currentBundleName === '') {\n            var ctx = canvas.getContext('2d');\n            var ctxMarkup = markupCanvas.getContext('2d');\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            ctxMarkup.clearRect(0, 0, canvas.width, canvas.height);\n          }\n        }, true);\n        //\n        /////////////////////\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.drawPreview = function () {\n          if (!initialized) {\n            var allPeakVals = Drawhelperservice.calculatePeaks(viewState, canvas, Soundhandlerservice.wavJSO.Data);\n            Drawhelperservice.osciPeaks = allPeakVals;\n            Drawhelperservice.freshRedrawDrawOsciOnCanvas(viewState, canvas, Drawhelperservice.osciPeaks, Soundhandlerservice.wavJSO.Data, ConfigProviderService);\n            initialized = true;\n            scope.drawVpOsciMarkup(viewState, canvas, ConfigProviderService);\n          } else {\n            scope.drawVpOsciMarkup(viewState, canvas, ConfigProviderService);\n          }\n        };\n        /**\n\t\t\t\t * draws markup of osci according to\n\t\t\t\t * the information that is specified in\n\t\t\t\t * the viewport\n\t\t\t\t */\n        scope.drawVpOsciMarkup = function (vs, canvas, config) {\n          var ctx = markupCanvas.getContext('2d');\n          var posS = markupCanvas.width / Soundhandlerservice.wavJSO.Data.length * vs.curViewPort.sS;\n          var posE = markupCanvas.width / Soundhandlerservice.wavJSO.Data.length * vs.curViewPort.eS;\n          ctx.clearRect(0, 0, markupCanvas.width, markupCanvas.height);\n          ctx.fillStyle = config.vals.colors.selectedAreaColor;\n          ctx.fillRect(posS, 0, posE - posS, markupCanvas.height);\n          ctx.strokeStyle = config.vals.colors.selectedBorderColor;\n          ctx.beginPath();\n          ctx.moveTo(posS, 0);\n          ctx.lineTo(posS, markupCanvas.height);\n          ctx.moveTo(posE, 0);\n          ctx.lineTo(posE, markupCanvas.height);\n          ctx.closePath();\n          ctx.stroke();\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('bundleListSideBar', [\n  '$animate',\n  function ($animate) {\n    return {\n      templateUrl: 'views/bundleListSideBar.html',\n      restrict: 'E',\n      replace: true,\n      scope: { isOpen: '@' },\n      link: function postLink(scope, element, attr) {\n        ////////////////\n        // observes\n        attr.$observe('isOpen', function (value) {\n          if (value === 'true') {\n            $animate.removeClass(element, 'emuwebapp-shrinkWidthTo0px');\n            $animate.addClass(element, 'emuwebapp-expandWidthTo240px');\n          } else {\n            $animate.addClass(element, 'emuwebapp-shrinkWidthTo0px');\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('spectro', [\n  '$timeout',\n  'viewState',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  'fontScaleService',\n  'Soundhandlerservice',\n  'mathHelperService',\n  function ($timeout, viewState, ConfigProviderService, Drawhelperservice, fontScaleService, Soundhandlerservice, mathHelperService) {\n    return {\n      templateUrl: 'views/spectro.html',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      link: function postLink(scope, element, attrs) {\n        scope.shs = Soundhandlerservice;\n        scope.order = attrs.order;\n        scope.vs = viewState;\n        scope.cps = ConfigProviderService;\n        scope.dhs = Drawhelperservice;\n        scope.trackName = attrs.trackName;\n        // select the needed DOM elements from the template\n        scope.canvas0 = element.find('canvas')[0];\n        scope.canvas1 = element.find('canvas')[element.find('canvas').length - 1];\n        scope.context = scope.canvas0.getContext('2d');\n        scope.markupCtx = scope.canvas1.getContext('2d');\n        // FFT default vars\n        // default alpha for Window Function\n        scope.alpha = 0.16;\n        scope.devicePixelRatio = window.devicePixelRatio || 1;\n        // Spectro Worker \n        scope.primeWorker = new spectroDrawingWorker();\n        ///////////////\n        // watches\n        //\n        scope.$watch('vs.timelineSize', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              $timeout(scope.redraw, 5);\n            }\n          }\n        });\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              // check for changed zoom\n              if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                scope.redraw();\n              }\n              scope.drawSpectMarkup(true);\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundarySample', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.markupCtx.clearRect(0, 0, scope.canvas1.width, scope.canvas1.height);\n              scope.drawSpectMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundary', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              // scope.redraw();\n              scope.drawSpectMarkup(true);\n            }\n          }\n        }, true);\n        scope.$watch('vs.spectroSettings', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.setupEvent();\n              scope.redraw();\n            }\n          }\n        }, true);\n        ///////////////\n        // bindings\n        scope.redraw = function () {\n          scope.markupCtx.clearRect(0, 0, scope.canvas1.width, scope.canvas1.height);\n          scope.drawSpectro(scope.shs.wavJSO.Data);\n        };\n        scope.drawSpectro = function (buffer) {\n          scope.killSpectroRenderingThread();\n          scope.startSpectroRenderingThread(buffer);\n        };\n        scope.calcSamplesPerPxl = function () {\n          return (scope.vs.curViewPort.eS + 1 - scope.vs.curViewPort.sS) / scope.canvas0.width;\n        };\n        scope.drawSpectMarkup = function (reset) {\n          if (reset) {\n            scope.markupCtx.clearRect(0, 0, scope.canvas1.width, scope.canvas1.height);\n          }\n          // draw moving boundary line if moving\n          scope.dhs.drawMovingBoundaryLine(scope.markupCtx);\n          // draw current viewport selected\n          scope.dhs.drawCurViewPortSelected(scope.markupCtx, false);\n          // draw min max vals and name of track\n          scope.dhs.drawMinMaxAndName(scope.markupCtx, '', scope.vs.spectroSettings.rangeFrom, scope.vs.spectroSettings.rangeTo, 2);\n        };\n        scope.killSpectroRenderingThread = function () {\n          scope.context.fillStyle = scope.cps.vals.colors.levelColor;\n          scope.context.fillRect(0, 0, scope.canvas0.width, scope.canvas0.height);\n          // draw current viewport selected\n          scope.dhs.drawCurViewPortSelected(scope.markupCtx, false);\n          var horizontalText = fontScaleService.getTextImage(scope.context, 'rendering...', scope.cps.vals.font.fontPxSize * 0.75, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor, true);\n          scope.context.drawImage(horizontalText, 10, 50);\n          if (scope.primeWorker !== null) {\n            scope.primeWorker.kill();\n            scope.primeWorker = null;\n          }\n        };\n        scope.setupEvent = function () {\n          var imageData = scope.context.createImageData(scope.canvas0.width, scope.canvas0.height);\n          scope.primeWorker.says(function (event) {\n            if (event.status === undefined) {\n              if (scope.calcSamplesPerPxl() === event.samplesPerPxl) {\n                var tmp = new Uint8ClampedArray(event.img);\n                imageData.data.set(tmp);\n                scope.context.putImageData(imageData, 0, 0);\n                scope.drawSpectMarkup();\n              }\n            } else {\n              console.error('Error rendering spectrogram:', event.status.message);\n            }\n          });\n        };\n        scope.startSpectroRenderingThread = function (buffer) {\n          if (buffer.length > 0) {\n            scope.primeWorker = new spectroDrawingWorker();\n            var parseData;\n            var fftN = mathHelperService.calcClosestPowerOf2Gt(scope.shs.wavJSO.SampleRate * scope.vs.spectroSettings.windowSizeInSecs);\n            // fftN must be greater than 512 (leads to better resolution of spectrogram)\n            if (fftN < 512) {\n              fftN = 512;\n            }\n            if (scope.vs.curViewPort.sS >= fftN / 2) {\n              // pass in half a window extra at the front and a full window extra at the back so everything can be drawn/calculated this also fixes alignment issue\n              parseData = new Float32Array(buffer.subarray(scope.vs.curViewPort.sS - fftN / 2, scope.vs.curViewPort.eS + fftN));\n            } else {\n              // tolerate window/2 alignment issue if at beginning of file\n              parseData = new Float32Array(buffer.subarray(scope.vs.curViewPort.sS, scope.vs.curViewPort.eS + fftN));\n            }\n            scope.setupEvent();\n            scope.primeWorker.tell({\n              'windowSizeInSecs': scope.vs.spectroSettings.windowSizeInSecs,\n              'fftN': fftN,\n              'alpha': scope.alpha,\n              'upperFreq': scope.vs.spectroSettings.rangeTo,\n              'lowerFreq': scope.vs.spectroSettings.rangeFrom,\n              'samplesPerPxl': scope.calcSamplesPerPxl(),\n              'window': scope.vs.spectroSettings.window,\n              'imgWidth': scope.canvas0.width,\n              'imgHeight': scope.canvas0.height,\n              'dynRangeInDB': scope.vs.spectroSettings.dynamicRange,\n              'pixelRatio': scope.devicePixelRatio,\n              'sampleRate': scope.shs.wavJSO.SampleRate,\n              'transparency': scope.cps.vals.spectrogramSettings.transparency,\n              'audioBuffer': parseData.buffer,\n              'audioBufferChannels': scope.shs.wavJSO.NumChannels,\n              'drawHeatMapColors': scope.vs.spectroSettings.drawHeatMapColors,\n              'preEmphasisFilterFactor': scope.vs.spectroSettings.preEmphasisFilterFactor,\n              'heatMapColorAnchors': scope.vs.spectroSettings.heatMapColorAnchors\n            }, [parseData.buffer]);\n          }\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ExportCtrl', [\n  '$scope',\n  'dialogService',\n  'exportData',\n  'exportName',\n  'viewState',\n  'HistoryService',\n  function ($scope, dialogService, exportData, exportName, viewState, HistoryService) {\n    $scope.exportData = exportData;\n    $scope.exportName = exportName;\n    $scope.firefox = navigator.userAgent.match(/Firefox/i) ? true : false;\n    /**\n\t\t *\n\t\t */\n    $scope.cancel = function () {\n      dialogService.close();\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getBlob = function () {\n      var blob;\n      try {\n        blob = new Blob([$scope.exportData], { type: 'text/plain' });\n      } catch (e) {\n        // Backwards-compatibility\n        window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n        blob = new BlobBuilder();\n        blob.append($scope.exportData);\n        blob = blob.getBlob();\n      }\n      return blob;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.updateHistoryService = function () {\n      HistoryService.movesAwayFromLastSave = 0;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.export = function () {\n      var objURL;\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        objURL = webkitURL.createObjectURL($scope.getBlob());\n      } else {\n        objURL = URL.createObjectURL($scope.getBlob());\n      }\n      $scope.SaveToDisk(objURL, $scope.exportName);\n      dialogService.close();\n    };\n    /**\n\t\t *  Save file to disk // Non-IE ONLY !!\n\t\t */\n    $scope.SaveToDisk = function (fileURL, fileName) {\n      var save = document.createElement('a');\n      if ($scope.firefox) {\n        save.setAttribute('download', fileName);\n        save.href = fileURL;\n        save.innerHTML = '';\n        save.style.display = 'none';\n        document.body.appendChild(save);\n        save.click();\n      } else {\n        save.href = fileURL;\n        save.target = '_blank';\n        save.download = fileName || 'unknown';\n        var event = document.createEvent('Event');\n        event.initEvent('click', true, true);\n        save.dispatchEvent(event);\n        (window.URL || window.webkitURL).revokeObjectURL(save.href);\n      }\n      $scope.updateHistoryService();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').factory('viewState', [\n  '$rootScope',\n  '$timeout',\n  '$window',\n  'Soundhandlerservice',\n  function ($rootScope, $timeout, $window, Soundhandlerservice) {\n    //shared service object to be returned\n    var sServObj = {};\n    // window functions enum for spectro\n    var myWindow = {\n        BARTLETT: 1,\n        BARTLETTHANN: 2,\n        BLACKMAN: 3,\n        COSINE: 4,\n        GAUSS: 5,\n        HAMMING: 6,\n        HANN: 7,\n        LANCZOS: 8,\n        RECTANGULAR: 9,\n        TRIANGULAR: 10\n      };\n    // hold the current attribute definitions that are in view \n    sServObj.curLevelAttrDefs = [];\n    /**\n     * initialize all needed vars in viewState\n     */\n    sServObj.initialize = function () {\n      sServObj.curViewPort = {\n        sS: 0,\n        eS: 0,\n        selectS: -1,\n        selectE: -1,\n        dragBarActive: false,\n        dragBarHeight: -1,\n        windowWidth: undefined\n      };\n      sServObj.spectroSettings = {\n        windowSizeInSecs: -1,\n        rangeFrom: -1,\n        rangeTo: -1,\n        dynamicRange: -1,\n        window: -1,\n        drawHeatMapColors: -1,\n        preEmphasisFilterFactor: -1\n      };\n      sServObj.playHeadAnimationInfos = {\n        sS: -1,\n        eS: -1,\n        curS: null,\n        endFreezeSample: -1\n      };\n      sServObj.timelineSize = -1;\n      sServObj.somethingInProgress = false;\n      sServObj.somethingInProgressTxt = '';\n      sServObj.historyActionTxt = '';\n      sServObj.editing = false;\n      sServObj.cursorInTextField = false;\n      sServObj.saving = true;\n      sServObj.hierarchyRotated = false;\n      sServObj.hierarchyShown = false;\n      sServObj.submenuOpen = false;\n      sServObj.rightSubmenuOpen = false;\n      sServObj.curClickItems = [];\n      sServObj.curMousePosSample = 0;\n      sServObj.curMouseLevelName = undefined;\n      sServObj.curMouseLevelType = undefined;\n      sServObj.curClickLevelName = undefined;\n      sServObj.curClickLevelType = undefined;\n      sServObj.lastPcm = undefined;\n      sServObj.curPreselColumnSample = 2;\n      sServObj.curCorrectionToolNr = undefined;\n      sServObj.curClickLevelIndex = undefined;\n      sServObj.start = null;\n      sServObj.TransitionTime = undefined;\n      sServObj.showDropZone = true;\n      sServObj.movingBoundary = false;\n      sServObj.movingBoundarySample = undefined;\n      sServObj.focusInTextField = false;\n      sServObj.curTaskPercCompl = 0;\n      sServObj.curPerspectiveIdx = -1;\n      sServObj.mouseInEmuWebApp = false;\n      // possible general states of state machine\n      sServObj.states = [];\n      sServObj.states.noDBorFilesloaded = {\n        'permittedActions': [\n          'connectBtnClick',\n          'openDemoBtnDBclick'\n        ]\n      };\n      sServObj.states.loadingSaving = { 'permittedActions': [] };\n      sServObj.states.labeling = {\n        'permittedActions': [\n          'zoom',\n          'playaudio',\n          'spectSettingsChange',\n          'addLevelSegBtnClick',\n          'addLevelPointBtnClick',\n          'renameSelLevelBtnClick',\n          'downloadTextGridBtnClick',\n          'downloadAnnotationBtnClick',\n          'spectSettingsChange',\n          'clearBtnClick',\n          'labelAction',\n          'toggleSideBars',\n          'saveBndlBtnClick',\n          'showHierarchyBtnClick'\n        ]\n      };\n      sServObj.states.modalShowing = sServObj.states.loadingSaving;\n      sServObj.prevState = sServObj.states.noDBorFilesloaded;\n      sServObj.curState = sServObj.states.noDBorFilesloaded;\n      sServObj.curLevelAttrDefs = [];\n    };\n    // initialize on init\n    sServObj.initialize();\n    /**\n     * function to ask permission in current labeler state\n     */\n    sServObj.getPermission = function (actionName) {\n      return sServObj.curState.permittedActions.indexOf(actionName) > -1;\n    };\n    /**\n     *\n     */\n    sServObj.setWindowWidth = function (b) {\n      this.curViewPort.windowWidth = b;\n    };\n    /**\n     * set state\n     */\n    sServObj.setState = function (nameOrObj) {\n      sServObj.prevState = sServObj.curState;\n      if (typeof nameOrObj === 'string') {\n        sServObj.curState = sServObj.states[nameOrObj];\n      } else {\n        sServObj.curState = nameOrObj;\n      }\n    };\n    /**\n     *\n     */\n    sServObj.updatePlayHead = function (timestamp) {\n      // at first push animation !!!\n      if (Soundhandlerservice.player.isPlaying) {\n        $window.requestAnimationFrame(sServObj.updatePlayHead);\n      }\n      // do work in this animation round now\n      if (sServObj.start === null) {\n        sServObj.start = timestamp;\n      }\n      var samplesPassed = Math.floor(timestamp - sServObj.start) / 1000 * Soundhandlerservice.wavJSO.SampleRate;\n      sServObj.playHeadAnimationInfos.curS = Math.floor(sServObj.playHeadAnimationInfos.sS + samplesPassed);\n      if (Soundhandlerservice.player.isPlaying && sServObj.playHeadAnimationInfos.curS <= sServObj.playHeadAnimationInfos.eS) {\n        if (sServObj.playHeadAnimationInfos.curS !== -1) {\n          sServObj.curMousePosSample = sServObj.playHeadAnimationInfos.curS;\n        }\n        $rootScope.$apply();\n      } else {\n        sServObj.curMousePosSample = sServObj.playHeadAnimationInfos.endFreezeSample;\n        sServObj.playHeadAnimationInfos.sS = -1;\n        sServObj.playHeadAnimationInfos.eS = -1;\n        sServObj.playHeadAnimationInfos.curS = 0;\n        sServObj.start = null;\n      }\n    };\n    /**\n     *\n     */\n    sServObj.animatePlayHead = function (startS, endS) {\n      sServObj.playHeadAnimationInfos.sS = startS;\n      sServObj.playHeadAnimationInfos.eS = endS;\n      sServObj.playHeadAnimationInfos.endFreezeSample = endS;\n      sServObj.playHeadAnimationInfos.curS = startS;\n      $window.requestAnimationFrame(sServObj.updatePlayHead);\n    };\n    /**\n     * set selected Area\n     * @param start of selected Area\n     * @param end of selected Area\n     */\n    sServObj.select = function (start, end) {\n      sServObj.curViewPort.selectS = start;\n      sServObj.curViewPort.selectE = end;  //$rootScope.$digest();\n    };\n    /**\n     * reset selected Area to default\n     * @param length of current pcm stream\n     */\n    sServObj.resetSelect = function () {\n      sServObj.curViewPort.selectS = -1;\n      sServObj.curViewPort.selectE = -1;\n    };\n    /**\n     * gets the current Viewport\n     */\n    sServObj.getViewPort = function () {\n      return sServObj.curViewPort;\n    };\n    /**\n     * setspectroSettings\n     */\n    sServObj.setspectroSettings = function (len, rfrom, rto, dyn, win, hm, preEmph, hmColorAnchors) {\n      sServObj.spectroSettings.windowSizeInSecs = len;\n      sServObj.spectroSettings.rangeFrom = parseInt(rfrom, 10);\n      sServObj.spectroSettings.rangeTo = parseInt(rto, 10);\n      sServObj.spectroSettings.dynamicRange = parseInt(dyn, 10);\n      sServObj.setWindowFunction(win);\n      sServObj.spectroSettings.drawHeatMapColors = hm;\n      sServObj.spectroSettings.preEmphasisFilterFactor = preEmph;\n      sServObj.spectroSettings.heatMapColorAnchors = hmColorAnchors;\n    };\n    /**\n     * returns current selection as array\n     */\n    sServObj.getSelect = function () {\n      return [\n        sServObj.curViewPort.selectS,\n        sServObj.curViewPort.selectE\n      ];\n    };\n    /**\n     * set selected Area if new\n     * start value is smaler than actual and\n     * end value is greater than actual\n     * @param start of selected Area\n     * @param end of seleected Area\n     */\n    sServObj.selectDependent = function (start, end) {\n      if (start < this.curViewPort.selectS) {\n        this.curViewPort.selectS = start;\n      }\n      if (end > this.curViewPort.selectE) {\n        this.curViewPort.selectE = end;\n      }\n    };\n    /**\n     *\n     */\n    sServObj.selectLevel = function (next, order, Levelserv) {\n      var curLev;\n      var now = sServObj.getcurClickLevelName();\n      if (now === undefined && !next) {\n        // select first if none prev. defined (up)\n        // viewState.setcurClickLevel(levelID, levelType, scope.$index, scope.this.level.items.length);\n        curLev = Levelserv.getLevelDetails(order[0]);\n        sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, 0);\n        return;\n      } else if (now === undefined && next) {\n        // select last if none prev. defined (down)\n        curLev = Levelserv.getLevelDetails(order[order.length - 1]);\n        sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, order.length - 1);\n        return;\n      }\n      var idxOfNow;\n      order.forEach(function (name, idx) {\n        if (name === now) {\n          idxOfNow = idx;\n        }\n      });\n      if (next) {\n        if (idxOfNow + 1 < order.length) {\n          curLev = Levelserv.getLevelDetails(order[idxOfNow + 1]);\n          // sServObj.setcurClickLevelName(order[idxOfNow + 1]);\n          sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, order.idxOfNow + 1);\n          sServObj.curClickItems = [];\n          sServObj.selectBoundary();  //sServObj.resetSelect();\n        }\n      } else {\n        if (idxOfNow - 1 >= 0) {\n          curLev = Levelserv.getLevelDetails(order[idxOfNow - 1]);\n          // sServObj.setcurClickLevelName(order[idxOfNow - 1]);\n          sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, order.idxOfNow - 1);\n          sServObj.curClickItems = [];\n          sServObj.selectBoundary();  //sServObj.resetSelect();\n        }\n      }\n    };\n    /**\n     * set the window Function for the Spectrogram\n     * @param name of Window Function\n     */\n    sServObj.setWindowFunction = function (name) {\n      switch (name) {\n      case 'BARTLETT':\n        sServObj.spectroSettings.window = myWindow.BARTLETT;\n        break;\n      case 'BARTLETTHANN':\n        sServObj.spectroSettings.window = myWindow.BARTLETTHANN;\n        break;\n      case 'BLACKMAN':\n        sServObj.spectroSettings.window = myWindow.BLACKMAN;\n        break;\n      case 'COSINE':\n        sServObj.spectroSettings.window = myWindow.COSINE;\n        break;\n      case 'GAUSS':\n        sServObj.spectroSettings.window = myWindow.GAUSS;\n        break;\n      case 'HAMMING':\n        sServObj.spectroSettings.window = myWindow.HAMMING;\n        break;\n      case 'HANN':\n        sServObj.spectroSettings.window = myWindow.HANN;\n        break;\n      case 'LANCZOS':\n        sServObj.spectroSettings.window = myWindow.LANCZOS;\n        break;\n      case 'RECTANGULAR':\n        sServObj.spectroSettings.window = myWindow.RECTANGULAR;\n        break;\n      case 'TRIANGULAR':\n        sServObj.spectroSettings.window = myWindow.TRIANGULAR;\n        break;\n      default:\n        sServObj.spectroSettings.window = myWindow.BARTLETTHANN;\n        break;\n      }\n    };\n    /**\n     * @returns myWindow object\n     */\n    sServObj.getWindowFunctions = function () {\n      return myWindow;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.getdragBarActive = function () {\n      return this.curViewPort.dragBarActive;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.setdragBarActive = function (b) {\n      this.curViewPort.dragBarActive = b;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.getdragBarHeight = function () {\n      return this.curViewPort.dragBarHeight;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.setdragBarHeight = function (b) {\n      this.curViewPort.dragBarHeight = b;\n    };\n    /**\n     * get pixel position in current viewport given the canvas width\n     * @param w is width of canvas\n     * @param s is current sample to convert to pixel value\n     */\n    sServObj.getPos = function (w, s) {\n      return w * (s - this.curViewPort.sS) / (this.curViewPort.eS - this.curViewPort.sS + 1);  // + 1 because of view (displays all samples in view)\n    };\n    /**\n     * calculate the pixel distance between two samples\n     * @param w is width of canvas\n     */\n    sServObj.getSampleDist = function (w) {\n      return this.getPos(w, this.curViewPort.sS + 1) - this.getPos(w, this.curViewPort.sS);\n    };\n    /**\n     * toggle boolean if left submenu is open\n     */\n    sServObj.togglesubmenuOpen = function (time) {\n      this.submenuOpen = !this.submenuOpen;\n      $timeout(function () {\n        $rootScope.$broadcast('refreshTimeline');\n      }, time, false);\n    };\n    /**\n     * get boolean if left submenu is open\n     */\n    sServObj.getsubmenuOpen = function () {\n      return this.submenuOpen;\n    };\n    /**\n     * set boolean if left submenu is open\n     */\n    sServObj.setsubmenuOpen = function (s) {\n      this.submenuOpen = s;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.setenlarge = function (s) {\n      this.timelineSize = s;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.getenlarge = function () {\n      return this.timelineSize;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.getTransitionTime = function () {\n      return this.TransitionTime;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.setTransitionTime = function (s) {\n      this.TransitionTime = s;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.getRightsubmenuOpen = function () {\n      return this.rightSubmenuOpen;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.setRightsubmenuOpen = function (s) {\n      this.rightSubmenuOpen = s;\n    };\n    /**\n     *\n     */\n    sServObj.setcurClickLevel = function (levelID, levelType, levelIndex) {\n      this.setcurClickLevelName(levelID, levelIndex);\n      this.setcurClickLevelType(levelType);\n    };\n    /**\n     * sets the current (clicked) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurClickLevelType = function (name) {\n      this.curClickLevelType = name;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickLevelType = function () {\n      return this.curClickLevelType;\n    };\n    /**\n     * sets the current (clicked) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurClickLevelName = function (name, index) {\n      this.curClickLevelName = name;\n      this.curClickLevelIndex = index;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickLevelName = function () {\n      return this.curClickLevelName;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickLevelIndex = function () {\n      return this.curClickLevelIndex;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickNeighbours = function () {\n      return this.curClickNeighbours;\n    };\n    /**\n     * sets the current (mousemove) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurMouseLevelName = function (name) {\n      this.curMouseLevelName = name;\n    };\n    /**\n     * gets the current (mousemove) Level Name\n     */\n    sServObj.getcurMouseLevelName = function () {\n      return this.curMouseLevelName;\n    };\n    /**\n     * sets the current (mousemove) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurMouseLevelType = function (name) {\n      this.curMouseLevelType = name;\n    };\n    /**\n     * gets the current (mousemove) Level Name\n     */\n    sServObj.getcurMouseLevelType = function () {\n      return this.curMouseLevelType;\n    };\n    /**\n     * sets the current (mousemove) Item\n     * @param item Object representing the current mouse item\n     * @param neighbour Objects of left and right neighbours of the current mouse item\n     * @param x current horizontal mouse pointer position\n     * @param isFirst true if item is the first item on current level\n     * @param isLast true if item is last item on current level\n     */\n    sServObj.setcurMouseItem = function (item, neighbour, x, isFirst, isLast) {\n      this.curMouseItem = item;\n      this.curMouseX = x;\n      this.curMouseNeighbours = neighbour;\n      this.curMouseisFirst = isFirst;\n      this.curMouseisLast = isLast;\n    };\n    /**\n     * Getter for current Mouse Item\n     * @return Object representing the current mouse item\n     */\n    sServObj.getcurMouseItem = function () {\n      return this.curMouseItem;\n    };\n    /**\n     * Getter for isFirst\n     * @return true if item is first item on level\n     */\n    sServObj.getcurMouseisFirst = function () {\n      return this.curMouseisFirst;\n    };\n    /**\n     * Getter for isLast\n     * @return true if item is last item on level\n     */\n    sServObj.getcurMouseisLast = function () {\n      return this.curMouseisLast;\n    };\n    /**\n     * Getter for current Mouse Item Neighbours (left and right)\n     * @return Object representing the current mouse item neighbours\n     */\n    sServObj.getcurMouseNeighbours = function () {\n      return this.curMouseNeighbours;\n    };\n    /**\n     * selects all Segements on current level which are inside the selected viewport\n     * @param levelData current level Object\n     */\n    sServObj.selectItemsInSelection = function (levelData) {\n      sServObj.curClickItems = [];\n      var min = Infinity;\n      var max = -Infinity;\n      var itemInSel = this.getItemsInSelection(levelData);\n      angular.forEach(itemInSel, function (item) {\n        if (item.sampleStart < min) {\n          min = item.sampleStart;\n        }\n        if (item.sampleStart + item.sampleDur + 1 > max) {\n          max = item.sampleStart + item.sampleDur + 1;\n        }\n        sServObj.setcurClickItemMultiple(item);\n      });\n      sServObj.curViewPort.selectS = min;\n      sServObj.curViewPort.selectE = max;\n    };\n    /**\n     * get all items of current level which are inside the selected viewport\n     */\n    sServObj.getItemsInSelection = function (levelData) {\n      var itemsInRange = [];\n      var rangeStart = sServObj.curViewPort.selectS;\n      var rangeEnd = sServObj.curViewPort.selectE;\n      angular.forEach(levelData, function (t) {\n        if (t.name === sServObj.getcurClickLevelName()) {\n          angular.forEach(t.items, function (item) {\n            if (item.sampleStart >= rangeStart && item.sampleStart + item.sampleDur <= rangeEnd) {\n              itemsInRange.push(item);\n            }\n            if (item.samplePoint >= rangeStart && item.samplePoint <= rangeEnd) {\n              itemsInRange.push(item);\n            }\n          });\n        }\n      });\n      return itemsInRange;\n    };\n    /**\n     * Setter for the current (click) Item\n     * @param item Object representing the currently clicked item\n     */\n    sServObj.setcurClickItem = function (item) {\n      if (item !== null && item !== undefined) {\n        sServObj.curClickItems = [];\n        sServObj.curClickItems.push(item);\n        sServObj.selectBoundary();\n      } else {\n        sServObj.curClickItems = [];\n      }\n    };\n    /**\n     * Selects the current Boundary\n     */\n    sServObj.selectBoundary = function () {\n      if (sServObj.curClickItems.length > 0) {\n        var left, right;\n        if (sServObj.curClickItems[0].sampleStart !== undefined) {\n          left = sServObj.curClickItems[0].sampleStart;\n        } else {\n          left = sServObj.curClickItems[0].samplePoint;\n        }\n        right = sServObj.curClickItems[sServObj.curClickItems.length - 1].sampleStart + sServObj.curClickItems[sServObj.curClickItems.length - 1].sampleDur || sServObj.curClickItems[0].samplePoint;\n        sServObj.curClickItems.forEach(function (entry) {\n          if (entry.sampleStart <= left) {\n            left = entry.sampleStart;\n          }\n          if (entry.sampleStart + entry.sampleDur >= right) {\n            right = entry.sampleStart + entry.sampleDur;\n          }\n        });\n        sServObj.select(left, right + 1);\n      }\n    };\n    /**\n     * adds a item the currently selected items if left or right of current selected items\n     * @param item representing the Object to be added to selection\n     */\n    sServObj.setcurClickItemMultiple = function (item) {\n      var empty = true;\n      var start = item.sampleStart;\n      var end = start + item.sampleDur + 1;\n      sServObj.curClickItems.forEach(function (entry) {\n        var front = entry.sampleStart === end ? true : false;\n        var back = entry.sampleStart + entry.sampleDur + 1 === start ? true : false;\n        if ((front || back) && sServObj.curClickItems.indexOf(item) === -1) {\n          sServObj.curClickItems.push(item);\n          empty = false;\n        }\n      });\n      if (empty) {\n        sServObj.curClickItems = [];\n        sServObj.curClickItems.push(item);\n      } else {\n        sServObj.curClickItems.sort(sServObj.sortbyid);\n      }\n    };\n    /**\n     *\n     */\n    sServObj.sortbyid = function (a, b) {\n      //Compare \"a\" and \"b\" in some fashion, and return -1, 0, or 1\n      if (a.sampleStart > b.sampleStart) {\n        return 1;\n      }\n      if (a.sampleStart < b.sampleStart) {\n        return -1;\n      }\n      return 0;\n    };\n    /**\n     * Getter for the current selected range in samples\n     * if nothing is selected returns -1\n     * @return Object with Start and End values in samples\n     */\n    sServObj.getselectedRange = function () {\n      if (this.curClickItems.length > 1) {\n        return {\n          start: this.curClickItems[0].sampleStart,\n          end: this.curClickItems[this.curClickItems.length - 1].sampleStart + this.curClickItems[this.curClickItems.length - 1].sampleDur\n        };\n      } else if (this.curClickItems.length === 1) {\n        if (this.curClickItems[0].sampleStart !== undefined) {\n          return {\n            start: this.curClickItems[0].sampleStart,\n            end: this.curClickItems[0].sampleStart + this.curClickItems[0].sampleDur\n          };\n        } else {\n          return {\n            start: this.curClickItems[0].samplePoint,\n            end: this.curClickItems[0].samplePoint\n          };\n        }\n      } else {\n        return {\n          start: -1,\n          end: -1\n        };\n      }\n    };\n    /**\n     * Getter for the currently (clicked) items\n     */\n    sServObj.getcurClickItems = function () {\n      return this.curClickItems;\n    };\n    /**\n     *\n     */\n    sServObj.getselected = function () {\n      return this.curClickItems;\n    };\n    /**\n     *\n     */\n    sServObj.isEditing = function () {\n      return this.editing;\n    };\n    /**\n     *\n     */\n    sServObj.setEditing = function (n) {\n      this.editing = n;\n    };\n    /**\n     *\n     */\n    sServObj.getLasPcm = function () {\n      return this.lastPcm;\n    };\n    /**\n     *\n     */\n    sServObj.setLastPcm = function (n) {\n      this.lastPcm = n;\n    };\n    /**\n     *\n     */\n    sServObj.isHierarchyRotated = function () {\n      return sServObj.hierarchyRotated;\n    };\n    /**\n     *\n     */\n    sServObj.rotateHierarchy = function () {\n      sServObj.hierarchyRotated = !sServObj.hierarchyRotated;\n    };\n    /**\n     *\n     */\n    sServObj.isHierarchyOpen = function () {\n      return sServObj.hierarchyShown;\n    };\n    /**\n     *\n     */\n    sServObj.showHierarchy = function () {\n      sServObj.hierarchyShown = !sServObj.hierarchyShown;\n    };\n    /**\n     *\n     */\n    sServObj.getcursorInTextField = function () {\n      return this.cursorInTextField;\n    };\n    /**\n     *\n     */\n    sServObj.setcursorInTextField = function (n) {\n      console.log(n);\n      this.cursorInTextField = n;\n    };\n    /**\n     *\n     */\n    sServObj.isSavingAllowed = function () {\n      return this.saving;\n    };\n    /**\n     *\n     */\n    sServObj.setSavingAllowed = function (n) {\n      this.saving = n;\n    };\n    /**\n     *\n     */\n    sServObj.countSelected = function () {\n      return this.curClickItems.length;\n    };\n    /**\n     *\n     */\n    sServObj.getCurrentSample = function (perc) {\n      return this.curViewPort.sS + (this.curViewPort.eS - this.curViewPort.sS) * perc;\n    };\n    /**\n     *\n     */\n    sServObj.getCurrentPercent = function (sample) {\n      return sample * (100 / (this.curViewPort.eS - this.curViewPort.sS) / 100);\n    };\n    /**\n     *\n     */\n    sServObj.getSamplesPerPixelVal = function (event) {\n      var start = parseFloat(this.curViewPort.sS);\n      var end = parseFloat(this.curViewPort.eS);\n      return (end - start) / event.originalEvent.target.width;\n    };\n    /**\n     * round to n decimal digits after the comma\n     * used to help display numbers with a given\n     * precision\n     */\n    sServObj.round = function (x, n) {\n      if (n < 1 || n > 14) {\n        console.error('error in call of round function!!');\n      }\n      var e = Math.pow(10, n);\n      var k = (Math.round(x * e) / e).toString();\n      if (k.indexOf('.') === -1) {\n        k += '.';\n      }\n      k += e.toString().substring(1);\n      return parseFloat(k.substring(0, k.indexOf('.') + n + 1));\n    };\n    /**\n     * calcs and returns start in secs\n     */\n    sServObj.getViewPortStartTime = function () {\n      return this.curViewPort.sS * 1 / Soundhandlerservice.wavJSO.SampleRate - 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * calcs and returns end time in secs\n     */\n    sServObj.getViewPortEndTime = function () {\n      return this.curViewPort.eS * 1 / Soundhandlerservice.wavJSO.SampleRate + 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * calcs and returns start in secs\n     */\n    sServObj.getSelectedStartTime = function () {\n      return this.curViewPort.selectS * 1 / Soundhandlerservice.wavJSO.SampleRate - 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * calcs and returns end time in secs\n     */\n    sServObj.getSelectedEndTime = function () {\n      return this.curViewPort.selectE * 1 / Soundhandlerservice.wavJSO.SampleRate + 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * set view port to start and end sample\n     * (with several out-of-bounds like checks)\n     *\n     * @param sSample start sample of view\n     * @param sSample end sample of view\n     */\n    sServObj.setViewPort = function (sSample, eSample) {\n      var oldStart = this.curViewPort.sS;\n      var oldEnd = this.curViewPort.eS;\n      if (sSample !== undefined) {\n        this.curViewPort.sS = Math.round(sSample);\n      }\n      if (eSample !== undefined) {\n        this.curViewPort.eS = Math.round(eSample);\n      }\n      // check if moving left or right is not out of bounds -> prevent zooming on edge when moving left/right\n      if (oldStart > this.curViewPort.sS && oldEnd > this.curViewPort.eS) {\n        //moved left\n        if (this.curViewPort.sS < 0) {\n          this.curViewPort.sS = 0;\n          this.curViewPort.eS = oldEnd + Math.abs(this.curViewPort.sS);\n        }\n      }\n      if (oldStart < this.curViewPort.sS && oldEnd < this.curViewPort.eS) {\n        //moved right\n        if (this.curViewPort.eS > Soundhandlerservice.wavJSO.Data.length) {\n          this.curViewPort.sS = oldStart;\n          this.curViewPort.eS = Soundhandlerservice.wavJSO.Data.length;\n        }\n      }\n      // check if in range\n      if (this.curViewPort.sS < 0) {\n        this.curViewPort.sS = 0;\n      }\n      if (this.curViewPort.eS > Soundhandlerservice.wavJSO.Data.length) {\n        this.curViewPort.eS = Soundhandlerservice.wavJSO.Data.length;\n      }\n      // check if at least 4 samples are showing (fixed max zoom size)\n      if (this.curViewPort.eS - this.curViewPort.sS < 4) {\n        this.curViewPort.sS = oldStart;\n        this.curViewPort.eS = oldEnd;\n      }\n    };\n    /**\n     * set view port to start and end sample\n     * (with several out-of-bounds like checks)\n     *\n     * @param zoomIn bool to specify zooming direction\n     * if set to true -> zoom in\n     * if set to false -> zoom out\n     */\n    sServObj.zoomViewPort = function (zoomIn, LevelService) {\n      var newStartS, newEndS, curMouseMoveItemStart;\n      var seg = this.getcurMouseItem();\n      var d = this.curViewPort.eS - this.curViewPort.sS;\n      var isLastSeg = false;\n      if (seg !== undefined) {\n        if (this.getcurMouseisFirst()) {\n          // before first element\n          seg = LevelService.getItemDetails(sServObj.getcurMouseLevelName(), 0);\n        } else if (this.getcurMouseisLast()) {\n          seg = LevelService.getLastItem(sServObj.getcurMouseLevelName());\n          isLastSeg = true;\n        }\n        if (this.getcurMouseLevelType() === 'SEGMENT') {\n          if (isLastSeg) {\n            curMouseMoveItemStart = seg.sampleStart + seg.sampleDur;\n          } else {\n            curMouseMoveItemStart = seg.sampleStart;\n          }\n        } else {\n          curMouseMoveItemStart = seg.samplePoint;\n        }\n        var d1 = curMouseMoveItemStart - this.curViewPort.sS;\n        var d2 = this.curViewPort.eS - curMouseMoveItemStart;\n        if (zoomIn) {\n          newStartS = this.curViewPort.sS + d1 * 0.5;\n          newEndS = this.curViewPort.eS - d2 * 0.5;\n        } else {\n          newStartS = this.curViewPort.sS - d1 * 0.5;\n          newEndS = this.curViewPort.eS + d2 * 0.5;\n        }\n      } else {\n        if (zoomIn) {\n          newStartS = this.curViewPort.sS + ~~(d / 4);\n          newEndS = this.curViewPort.eS - ~~(d / 4);\n        } else {\n          newStartS = this.curViewPort.sS - ~~(d / 4);\n          newEndS = this.curViewPort.eS + ~~(d / 4);\n        }\n      }\n      this.setViewPort(newStartS, newEndS);\n    };\n    /**\n     * moves view port to the right or to the left\n     * without changing the zoom\n     *\n     * @param shiftRight bool to specify direction\n     * if set to true -> shift right\n     * if set to false -> shift left\n     */\n    sServObj.shiftViewPort = function (shiftRight) {\n      // my.removeLabelDoubleClick();\n      var newStartS, newEndS;\n      if (shiftRight) {\n        newStartS = this.curViewPort.sS + ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n        newEndS = this.curViewPort.eS + ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n      } else {\n        newStartS = this.curViewPort.sS - ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n        newEndS = this.curViewPort.eS - ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n      }\n      this.setViewPort(newStartS, newEndS);\n    };\n    /**\n     * sets all the curLevelAttrDefs array\n     * to hold the default attr. definitions\n     * which are the same as the level names\n     *\n     * @param levelDefs level definitions from the DBconfig\n     */\n    sServObj.setCurLevelAttrDefs = function (levelDefs) {\n      angular.forEach(levelDefs, function (ld) {\n        sServObj.curLevelAttrDefs.push({\n          'levelName': ld.name,\n          'curAttrDefName': ld.name\n        });\n      });\n    };\n    /**\n     * set the current attribute definition name of the\n     * given levelName\n     *\n     * @param levelName name of level\n     * @param newAttrDefName\n     */\n    sServObj.setCurAttrDef = function (levelName, newAttrDefName, index) {\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          ad.curAttrDefName = newAttrDefName;\n          ad.curAttrDefIndex = index;\n        }\n      });\n    };\n    /**\n     * get the current attribute definition name of the\n     * given levelName\n     *\n     * @param levelName name of level\n     * @returns attrDefName\n     */\n    sServObj.getCurAttrDef = function (levelName) {\n      var curAttrDef;\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          curAttrDef = ad.curAttrDefName;\n        }\n      });\n      return curAttrDef;\n    };\n    /**\n     * get the current attribute definition index of the\n     * given levelName\n     *\n     * @param levelName name of level\n     * @returns attrDefName\n     */\n    sServObj.getCurAttrIndex = function (levelName) {\n      var curAttrDef;\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          if (ad.curAttrDefIndex === undefined) {\n            curAttrDef = 0;\n          } else {\n            curAttrDef = ad.curAttrDefIndex;\n          }\n        }\n      });\n      return curAttrDef;\n    };\n    /**\n\t*\n\t*/\n    sServObj.getX = function (e) {\n      return (e.offsetX || e.originalEvent.layerX) * (e.originalEvent.target.width / e.originalEvent.target.clientWidth);\n    };\n    /**\n\t*\n\t*/\n    sServObj.getY = function (e) {\n      return (e.offsetY || e.originalEvent.layerY) * (e.originalEvent.target.height / e.originalEvent.target.clientHeight);\n    };\n    /**\n     *\n     */\n    sServObj.resetToInitState = function () {\n      sServObj.initialize();\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('trackMouseInLevel', [\n  'viewState',\n  'LevelService',\n  'ConfigProviderService',\n  'HistoryService',\n  'Soundhandlerservice',\n  function (viewState, LevelService, ConfigProviderService, HistoryService, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      scope: {\n        levelName: '=',\n        levelType: '='\n      },\n      link: function (scope, element, attr) {\n        scope.lastEventClick = undefined;\n        scope.lastEventMove = undefined;\n        scope.lastNeighboursMove = undefined;\n        scope.lastPCM = undefined;\n        scope.curMouseSampleNrInView = undefined;\n        /////////////////////////////\n        // Bindings\n        //\n        element.bind('click', function (event) {\n          event.preventDefault();\n          scope.setLastMove(event, true);\n          scope.setLastClick(event);\n        });\n        //\n        element.bind('contextmenu', function (event) {\n          event.preventDefault();\n          scope.setLastMove(event, true);\n          scope.setLastRightClick(event);\n        });\n        //\n        element.bind('dblclick', function (event) {\n          scope.setLastMove(event, true);\n          if (ConfigProviderService.vals.restrictions.editItemName) {\n            scope.setLastDblClick(event);\n          } else {\n            scope.setLastClick(event);\n          }\n        });\n        //\n        element.bind('mousemove', function (event) {\n          if (!viewState.getdragBarActive()) {\n            var moveLine = true;\n            var samplesPerPixel = viewState.getSamplesPerPixelVal(event);\n            scope.curMouseSampleNrInView = viewState.getX(event) * samplesPerPixel;\n            var moveBy = scope.curMouseSampleNrInView - scope.lastPCM;\n            if (samplesPerPixel <= 1 && scope.level.items.length > 0) {\n              var zoomEventMove = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n              // absolute movement in pcm below 1 pcm per pixel\n              if (scope.levelType === 'SEGMENT') {\n                if (zoomEventMove.isFirst === true && zoomEventMove.isLast === false) {\n                  // before first elem\n                  moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemDetails(scope.levelName, 0).sampleStart);\n                } else if (zoomEventMove.isFirst === false && zoomEventMove.isLast === true) {\n                  // after last elem\n                  var lastItem = LevelService.getLastItem(scope.levelName);\n                  moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - lastItem.sampleStart - lastItem.sampleDur);\n                } else {\n                  moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemFromLevelById(scope.levelName, zoomEventMove.nearest.id).sampleStart);\n                }\n              } else {\n                moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemFromLevelById(scope.levelName, zoomEventMove.nearest.id).samplePoint - 0.5);  // 0.5 to break between samples not on\n              }\n            } else {\n              // relative movement in pcm above 1 pcm per pixel\n              moveBy = Math.round(scope.curMouseSampleNrInView - scope.lastPCM);\n            }\n          }\n          var mbutton = 0;\n          if (event.buttons === undefined) {\n            mbutton = event.which;\n          } else {\n            mbutton = event.buttons;\n          }\n          switch (mbutton) {\n          case 1:\n            //console.log('Left mouse button pressed');\n            break;\n          case 2:\n            //console.log('Middle mouse button pressed');\n            break;\n          case 3:\n            //console.log('Right mouse button pressed');\n            break;\n          default:\n            if (!viewState.getdragBarActive()) {\n              if (ConfigProviderService.vals.restrictions.editItemSize && event.shiftKey) {\n                LevelService.deleteEditArea();\n                if (viewState.getcurMouseItem() !== undefined) {\n                  viewState.movingBoundary = true;\n                  if (scope.levelType === 'SEGMENT') {\n                    if (viewState.getcurMouseisFirst() || viewState.getcurMouseisLast()) {\n                      var seg, leftMost, rightB;\n                      // before first segment\n                      if (viewState.getcurMouseisFirst()) {\n                        seg = LevelService.getItemDetails(scope.levelName, 0);\n                        viewState.movingBoundarySample = seg.sampleStart + moveBy;\n                      } else if (viewState.getcurMouseisLast()) {\n                        seg = LevelService.getLastItem(scope.levelName);\n                        viewState.movingBoundarySample = seg.sampleStart + seg.sampleDur + moveBy;\n                      }\n                    } else {\n                      viewState.movingBoundarySample = viewState.getcurMouseItem().sampleStart + moveBy;\n                      seg = viewState.getcurMouseItem();\n                    }\n                    LevelService.moveBoundary(scope.levelName, seg.id, moveBy, viewState.getcurMouseisFirst(), viewState.getcurMouseisLast());\n                    HistoryService.updateCurChangeObj({\n                      'type': 'ANNOT',\n                      'action': 'MOVEBOUNDARY',\n                      'name': scope.levelName,\n                      'id': seg.id,\n                      'movedBy': moveBy,\n                      'isFirst': viewState.getcurMouseisFirst(),\n                      'isLast': viewState.getcurMouseisLast()\n                    });\n                  } else {\n                    seg = viewState.getcurMouseItem();\n                    viewState.movingBoundarySample = viewState.getcurMouseItem().samplePoint + moveBy;\n                    LevelService.moveEvent(scope.levelName, seg.id, moveBy);\n                    HistoryService.updateCurChangeObj({\n                      'type': 'ANNOT',\n                      'action': 'MOVEEVENT',\n                      'name': scope.levelName,\n                      'id': seg.id,\n                      'movedBy': moveBy\n                    });\n                  }\n                  scope.lastPCM = scope.curMouseSampleNrInView;\n                  viewState.setLastPcm(scope.lastPCM);\n                  viewState.selectBoundary();\n                  moveLine = false;\n                }\n              } else if (ConfigProviderService.vals.restrictions.editItemSize && event.altKey) {\n                LevelService.deleteEditArea();\n                if (scope.levelType == 'SEGMENT') {\n                  seg = viewState.getcurClickItems();\n                  LevelService.moveSegment(scope.levelName, seg[0].id, seg.length, moveBy);\n                  HistoryService.updateCurChangeObj({\n                    'type': 'ANNOT',\n                    'action': 'MOVESEGMENT',\n                    'name': scope.levelName,\n                    'id': seg[0].id,\n                    'length': seg.length,\n                    'movedBy': moveBy\n                  });\n                  scope.lastPCM = scope.curMouseSampleNrInView;\n                  viewState.setLastPcm(scope.lastPCM);\n                  viewState.selectBoundary();\n                }\n              } else {\n                viewState.movingBoundary = false;\n              }\n            }\n            break;\n          }\n          if (!viewState.getdragBarActive()) {\n            scope.setLastMove(event, moveLine);\n          }\n        });\n        //\n        element.bind('mousedown', function (event) {\n          viewState.movingBoundary = true;\n          scope.setLastMove(event, true);\n        });\n        //\n        element.bind('mouseup', function (event) {\n          viewState.movingBoundary = false;\n          scope.setLastMove(event, true);\n        });\n        //\n        element.bind('mouseout', function (event) {\n          viewState.movingBoundary = false;\n          scope.setLastMove(event, true);\n        });\n        //\n        /////////////////////////\n        /**\n         *\n         */\n        scope.setLastClick = function (x) {\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          LevelService.deleteEditArea();\n          viewState.setEditing(false);\n          scope.lastEventClick = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          if (scope.lastEventClick.current !== undefined && scope.lastEventClick.nearest !== undefined) {\n            LevelService.setlasteditArea('_' + scope.lastEventClick.current.id);\n            LevelService.setlasteditAreaElem(element.parent());\n            viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n            viewState.setcurClickItem(scope.lastEventClick.current);\n          }\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n        /**\n         *\n         */\n        scope.setLastRightClick = function (x) {\n          if (viewState.getcurClickLevelName() !== scope.levelName) {\n            scope.setLastClick(x);\n          }\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          LevelService.deleteEditArea();\n          scope.lastEventClick = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          if (scope.lastEventClick.current !== undefined && scope.lastEventClick.nearest !== undefined) {\n            viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n            viewState.setcurClickItemMultiple(scope.lastEventClick.current);\n            viewState.selectBoundary();\n          }\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n        /**\n         *\n         */\n        scope.setLastDblClick = function (x) {\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          scope.lastEventClick = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          if (scope.lastEventClick.current !== undefined && scope.lastEventClick.nearest !== undefined) {\n            if (scope.levelType === 'SEGMENT') {\n              if (scope.lastEventClick.current.sampleStart >= viewState.curViewPort.sS) {\n                if (scope.lastEventClick.current.sampleStart + scope.lastEventClick.current.sampleDur <= viewState.curViewPort.eS) {\n                  viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n                  viewState.setcurClickItem(scope.lastEventClick.current);\n                  LevelService.setlasteditArea('_' + scope.lastEventClick.current.id);\n                  LevelService.setlasteditAreaElem(element.parent());\n                  viewState.setEditing(true);\n                  LevelService.openEditArea(scope.lastEventClick.current, element.parent(), scope.levelType);\n                } else {\n                  console.log('Editing out of right bound !');\n                }\n              } else {\n                console.log('Editing out of left bound !');\n              }\n            } else {\n              viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n              viewState.setcurClickItem(scope.lastEventClick.current);\n              LevelService.setlasteditArea('_' + scope.lastEventClick.current.id);\n              LevelService.setlasteditAreaElem(element.parent());\n              viewState.setEditing(true);\n              LevelService.openEditArea(scope.lastEventClick.current, element.parent(), scope.levelType);\n              viewState.setEditing(true);\n            }\n          }\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n        /**\n         *\n         */\n        scope.setLastMove = function (x, doChange) {\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          scope.lastEventMove = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          if (doChange) {\n            if (scope.lastEventMove.current !== undefined && scope.lastEventMove.nearest !== undefined) {\n              scope.lastNeighboursMove = LevelService.getItemNeighboursFromLevel(scope.levelName, scope.lastEventMove.nearest.id, scope.lastEventMove.nearest.id);\n              viewState.setcurMouseItem(scope.lastEventMove.nearest, scope.lastNeighboursMove, scope.lastPCM, scope.lastEventMove.isFirst, scope.lastEventMove.isLast);\n            }\n          }\n          viewState.setcurMouseLevelName(scope.levelName);\n          viewState.setcurMouseLevelType(scope.levelType);\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('handleglobalkeystrokes', [\n  '$timeout',\n  'viewState',\n  'dialogService',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'HistoryService',\n  'LevelService',\n  'DataService',\n  'LinkService',\n  'AnagestService',\n  function ($timeout, viewState, dialogService, Soundhandlerservice, ConfigProviderService, HistoryService, LevelService, DataService, LinkService, AnagestService) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope) {\n        $(document).bind('keyup', function (e) {\n          var code = e.keyCode ? e.keyCode : e.which;\n          if (viewState.isEditing() && !viewState.getcursorInTextField()) {\n            applyKeyCodeUp(code, e);\n          }\n        });\n        $(document).bind('keydown', function (e) {\n          if (!scope.firefox) {\n            var code = e.keyCode ? e.keyCode : e.which;\n            if (code == 8 || code == 9 || code == 27 || code == 37 || code == 38 || code == 39 || code == 40 || code == 32) {\n              applyKeyCode(code, e);\n            }\n          }\n        });\n        $(document).bind('keypress', function (e) {\n          var code = e.keyCode ? e.keyCode : e.which;\n          applyKeyCode(code, e);\n        });\n        function applyKeyCodeUp(code, e) {\n          scope.$apply(function () {\n            if (code !== ConfigProviderService.vals.keyMappings.esc && code !== ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n              var domElement = $('.' + LevelService.getlasteditArea());\n              var str = domElement.val();\n              viewState.setSavingAllowed(true);\n              var definitions = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).attributeDefinitions[viewState.getCurAttrIndex(viewState.getcurClickLevelName())];\n              // if it is defined then check if characters are ok\n              if (definitions.legalLabels !== undefined && str.length > 0) {\n                if (definitions.legalLabels.indexOf(str) < 0) {\n                  viewState.setSavingAllowed(false);\n                }\n              }\n              if (viewState.isSavingAllowed()) {\n                domElement.css({ 'background-color': 'rgba(255,255,0,1)' });\n              } else {\n                domElement.css({ 'background-color': 'rgba(255,0,0,1)' });\n              }\n            }\n          });\n        }\n        function applyKeyCode(code, e) {\n          scope.$apply(function () {\n            // check if mouse has to be in labeler for key mappings\n            if (ConfigProviderService.vals.main.catchMouseForKeyBinding) {\n              if (!viewState.mouseInEmuWebApp) {\n                return;\n              }\n            }\n            if (viewState.isEditing()) {\n              var domElement = $('.' + LevelService.getlasteditArea());\n              // preventing new line if saving not allowed\n              if (!viewState.isSavingAllowed() && code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                var definitions = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).attributeDefinitions[viewState.getCurAttrIndex(viewState.getcurClickLevelName())].legalLabels;\n                e.preventDefault();\n                e.stopPropagation();\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n                scope.dials.open('views/error.html', 'ModalCtrl', 'Editing Error: Sorry, characters allowed on this Level are \"' + JSON.stringify(definitions) + '\"');\n              }\n              // save text on enter if saving is allowed\n              if (viewState.isSavingAllowed() && code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                var editingElement = LevelService.getItemFromLevelById(viewState.getcurClickLevelName(), LevelService.getlastID());\n                var attrIndex = viewState.getCurAttrIndex(viewState.getcurClickLevelName());\n                var oldValue = editingElement.labels[attrIndex].value;\n                LevelService.renameLabel(viewState.getcurClickLevelName(), LevelService.getlastID(), viewState.getCurAttrIndex(viewState.getcurClickLevelName()), domElement.val());\n                HistoryService.addObjToUndoStack({\n                  'type': 'ANNOT',\n                  'action': 'RENAMELABEL',\n                  'name': viewState.getcurClickLevelName(),\n                  'id': LevelService.getlastID(),\n                  'attrIndex': attrIndex,\n                  'oldValue': oldValue,\n                  'newValue': domElement.val()\n                });\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n                viewState.setcurClickItem(LevelService.getItemFromLevelById(viewState.getcurClickLevelName(), LevelService.getlastID()));\n              }\n              // escape from text if esc\n              if (code === ConfigProviderService.vals.keyMappings.esc) {\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n              }\n            } else if (viewState.getcursorInTextField() === false) {\n              LevelService.deleteEditArea();\n              // escape from open modal dialog\n              if (viewState.curState.permittedActions.length === 0 && code === ConfigProviderService.vals.keyMappings.esc) {\n                scope.dials.close();\n                if (viewState.isHierarchyOpen()) {\n                  viewState.showHierarchy();\n                }\n              }\n              // delegate keyboard keyMappings according to keyMappings of scope\n              // showHierarhy\n              if (code === ConfigProviderService.vals.keyMappings.showHierarhy) {\n                if (viewState.curState !== viewState.states.noDBorFilesloaded) {\n                  if (!viewState.isHierarchyOpen()) {\n                    dialogService.open('views/showHierarchyModal.html', 'ShowhierarchyCtrl');\n                  } else {\n                    dialogService.close();\n                  }\n                  viewState.showHierarchy();\n                }\n              }\n              // rotateHierarhy\n              if (code === ConfigProviderService.vals.keyMappings.rotateHierarhy) {\n                viewState.rotateHierarchy();\n              }\n              // zoomAll\n              if (code === ConfigProviderService.vals.keyMappings.zoomAll) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.setViewPort(0, Soundhandlerservice.wavJSO.Data.length);\n                } else {\n                }\n              }\n              // zoomIn\n              if (code === ConfigProviderService.vals.keyMappings.zoomIn) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.zoomViewPort(true, LevelService);\n                } else {\n                }\n              }\n              // zoomOut\n              if (code === ConfigProviderService.vals.keyMappings.zoomOut) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.zoomViewPort(false, LevelService);\n                } else {\n                }\n              }\n              // zoomSel\n              if (code === ConfigProviderService.vals.keyMappings.zoomSel) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.setViewPort(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                } else {\n                }\n              }\n              // shiftViewPortLeft\n              if (code === ConfigProviderService.vals.keyMappings.shiftViewPortLeft) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.shiftViewPort(false);\n                } else {\n                }\n              }\n              // shiftViewPortRight\n              if (code === ConfigProviderService.vals.keyMappings.shiftViewPortRight) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.shiftViewPort(true);\n                } else {\n                }\n              }\n              // playEntireFile\n              if (code === ConfigProviderService.vals.keyMappings.playEntireFile) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(0, Soundhandlerservice.wavJSO.Data.length);\n                    viewState.animatePlayHead(0, Soundhandlerservice.wavJSO.Data.length);\n                  }\n                } else {\n                }\n              }\n              // playAllInView\n              if (code === ConfigProviderService.vals.keyMappings.playAllInView) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(viewState.curViewPort.sS, viewState.curViewPort.eS);\n                    viewState.animatePlayHead(viewState.curViewPort.sS, viewState.curViewPort.eS);\n                  }\n                } else {\n                }\n              }\n              // playSelected\n              if (code === ConfigProviderService.vals.keyMappings.playSelected) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                    viewState.animatePlayHead(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                  }\n                } else {\n                }\n              }\n              // selectFirstContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectFirstContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 1;\n                  }\n                }\n              }\n              // selectSecondContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectSecondContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 2;\n                  }\n                }\n              }\n              // selectThirdContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectThirdContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 3;\n                  }\n                }\n              }\n              // selectFourthContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectFourthContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 4;\n                  }\n                }\n              }\n              // selectNOContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectNoContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = undefined;\n                  }\n                }\n              }\n              // levelUp\n              if (code === ConfigProviderService.vals.keyMappings.levelUp) {\n                if (viewState.getPermission('labelAction')) {\n                  viewState.selectLevel(false, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);  // pass in LevelService to prevent circular deps\n                }\n              }\n              // levelDown\n              if (code === ConfigProviderService.vals.keyMappings.levelDown) {\n                if (viewState.getPermission('labelAction')) {\n                  viewState.selectLevel(true, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);  // pass LevelService to prevent circular deps\n                }\n              }\n              // preselected boundary snap to top\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestTopBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var mouseSeg = viewState.getcurMouseItem();\n                    var levelName = viewState.getcurMouseLevelName();\n                    var levelType = viewState.getcurMouseLevelType();\n                    var neighbor = viewState.getcurMouseNeighbours();\n                    var minDist = LevelService.snapBoundary(true, levelName, mouseSeg, neighbor, levelType);\n                    if (minDist === false) {\n                    } else {\n                      if (levelType === 'EVENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEEVENT',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist\n                        });\n                      } else if (levelType === 'SEGMENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEBOUNDARY',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist,\n                          'position': 0\n                        });\n                      }\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // preselected boundary snap to bottom\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestBottomBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var mouseSeg = viewState.getcurMouseItem();\n                    var levelName = viewState.getcurMouseLevelName();\n                    var levelType = viewState.getcurMouseLevelType();\n                    var neighbor = viewState.getcurMouseNeighbours();\n                    var minDist = LevelService.snapBoundary(false, levelName, mouseSeg, neighbor, levelType);\n                    if (minDist == false) {\n                    } else {\n                      if (levelType === 'EVENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEEVENT',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist\n                        });\n                      } else if (levelType === 'SEGMENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEBOUNDARY',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist,\n                          'position': 0\n                        });\n                      }\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // preselected boundary to nearest zero crossing\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestZeroCrossing) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var dist;\n                    if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n                      dist = LevelService.calcDistanceToNearestZeroCrossing(viewState.getcurMouseItem().sampleStart);\n                    } else {\n                      dist = LevelService.calcDistanceToNearestZeroCrossing(viewState.getcurMouseItem().samplePoint);\n                    }\n                    if (dist !== 0) {\n                      var seg = viewState.getcurMouseItem();\n                      var neigh = viewState.getcurMouseNeighbours();\n                      var levelname = viewState.getcurMouseLevelName();\n                      LevelService.moveBoundary(levelname, seg.id, dist, 0);\n                      HistoryService.updateCurChangeObj({\n                        'type': 'ANNOT',\n                        'action': 'MOVEBOUNDARY',\n                        'name': levelname,\n                        'id': seg.id,\n                        'movedBy': dist,\n                        'position': 0\n                      });\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // expand Segments\n              if (code === ConfigProviderService.vals.keyMappings.expandSelSegmentsRight) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        }\n                        LevelService.expandSegment(true, viewState.getcurClickItems(), viewState.getcurClickLevelName(), changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': true,\n                          'changeTime': changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // expand Segment left\n              if (code === ConfigProviderService.vals.keyMappings.expandSelSegmentsLeft) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(false, viewState.getcurClickItems(), viewState.getcurClickLevelName(), changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': false,\n                          'changeTime': changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // shrink Segments Left\n              if (code === ConfigProviderService.vals.keyMappings.shrinkSelSegmentsLeft) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(true, viewState.getcurClickItems(), viewState.getcurClickLevelName(), -changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': true,\n                          'changeTime': -changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // shrink Segments Right\n              if (code === ConfigProviderService.vals.keyMappings.shrinkSelSegmentsRight) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(false, viewState.getcurClickItems(), viewState.getcurClickLevelName(), -changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': false,\n                          'changeTime': -changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // toggleSideBars\n              if (code === ConfigProviderService.vals.keyMappings.toggleSideBarLeft) {\n                if (viewState.getPermission('toggleSideBars')) {\n                  // check if menu button in showing -> if not -> no submenu open\n                  if (ConfigProviderService.vals.activeButtons.openMenu) {\n                    viewState.togglesubmenuOpen(ConfigProviderService.vals.colors.transitionTime);\n                  }\n                }\n              }\n              // toggleSideBars\n              if (code === ConfigProviderService.vals.keyMappings.toggleSideBarRight) {\n                if (viewState.getPermission('toggleSideBars')) {\n                  // check if menu button in showing -> if not -> no submenu open\n                  if (ConfigProviderService.vals.activeButtons.openMenu) {\n                    viewState.setRightsubmenuOpen(!viewState.getRightsubmenuOpen());\n                  }\n                }\n              }\n              // select Segments in viewport selection\n              if (code === ConfigProviderService.vals.keyMappings.selectItemsInSelection) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickLevelName() === undefined) {\n                    scope.dials.open('views/error.html', 'ModalCtrl', 'Selection Error : Please select a Level first');\n                  } else {\n                    viewState.selectItemsInSelection(DataService.data.levels);\n                  }\n                }\n              }\n              // selPrevItem (arrow key left)\n              if (code === ConfigProviderService.vals.keyMappings.selPrevItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickItems().length > 0) {\n                    var idLeft = viewState.getcurClickItems()[0].id;\n                    var idRight = viewState.getcurClickItems()[viewState.getcurClickItems().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (lastNeighboursMove.left !== undefined) {\n                      if (lastNeighboursMove.left.sampleStart !== undefined) {\n                        // check if in view\n                        if (lastNeighboursMove.left.sampleStart > viewState.curViewPort.sS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickItemMultiple(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                            viewState.selectBoundary();\n                          } else {\n                            viewState.setcurClickItem(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      } else {\n                        // check if in view\n                        if (lastNeighboursMove.left.samplePoint > viewState.curViewPort.sS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickItemMultiple(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                            viewState.selectBoundary();\n                          } else {\n                            viewState.setcurClickItem(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              // selNextItem (arrow key right)\n              if (code === ConfigProviderService.vals.keyMappings.selNextItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickItems().length > 0) {\n                    var idLeft = viewState.getcurClickItems()[0].id;\n                    var idRight = viewState.getcurClickItems()[viewState.getcurClickItems().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (lastNeighboursMove.right !== undefined) {\n                      // check if in view\n                      if (lastNeighboursMove.right.sampleStart + lastNeighboursMove.right.sampleDur < viewState.curViewPort.eS) {\n                        if (e.shiftKey) {\n                          // select multiple while shift\n                          viewState.setcurClickItemMultiple(lastNeighboursMove.right);\n                          LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          viewState.selectBoundary();\n                        } else {\n                          viewState.setcurClickItem(lastNeighboursMove.right);\n                          LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                        }\n                      }\n                    } else {\n                    }\n                  }\n                }\n              }\n              // selNextPrevItem (tab key and tab+shift key)\n              if (code === ConfigProviderService.vals.keyMappings.selNextPrevItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickItems().length > 0) {\n                    var idLeft = viewState.getcurClickItems()[0].id;\n                    var idRight = viewState.getcurClickItems()[viewState.getcurClickItems().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (e.shiftKey) {\n                      if (lastNeighboursMove.left !== undefined) {\n                        if (lastNeighboursMove.left.sampleStart !== undefined) {\n                          // check if in view\n                          if (lastNeighboursMove.left.sampleStart + lastNeighboursMove.left.sampleDur > viewState.curViewPort.sS) {\n                            viewState.setcurClickItem(lastNeighboursMove.left, lastNeighboursMove.left.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        } else {\n                          // check if in view\n                          if (lastNeighboursMove.left.samplePoint > viewState.curViewPort.sS) {\n                            viewState.setcurClickItem(lastNeighboursMove.left, lastNeighboursMove.left.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      }\n                    } else {\n                      if (lastNeighboursMove.right !== undefined) {\n                        if (lastNeighboursMove.right.sampleStart !== undefined) {\n                          // check if in view\n                          if (lastNeighboursMove.right.sampleStart < viewState.curViewPort.eS) {\n                            viewState.setcurClickItem(lastNeighboursMove.right, lastNeighboursMove.right.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                        } else {\n                          // check if in view\n                          if (lastNeighboursMove.right.samplePoint < viewState.curViewPort.eS) {\n                            viewState.setcurClickItem(lastNeighboursMove.right, lastNeighboursMove.right.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              // createNewItemAtSelection\n              if (code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.addItem) {\n                    if (viewState.getselectedRange().start === viewState.curViewPort.selectS && viewState.getselectedRange().end === viewState.curViewPort.selectE) {\n                      if (viewState.getcurClickItems().length === 1) {\n                        // check if in view\n                        if (viewState.getselectedRange().start >= viewState.curViewPort.sS && viewState.getselectedRange().end <= viewState.curViewPort.eS) {\n                          viewState.setEditing(true);\n                          LevelService.openEditArea(viewState.getcurClickItems()[0], LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                          scope.cursorInTextField();\n                        }\n                      } else {\n                        scope.dials.open('views/error.html', 'ModalCtrl', 'Modify Error: Please select a single Segment.');\n                      }\n                    } else {\n                      if (viewState.curViewPort.selectE == -1 && viewState.curViewPort.selectS == -1) {\n                        scope.dials.open('views/error.html', 'ModalCtrl', 'Error : Please select a Segment or Point to modify it\\'s name. Or select a level plus a range in the viewport in order to insert a new Segment.');\n                      } else {\n                        if (viewState.getcurClickLevelType() === 'SEGMENT') {\n                          var seg = LevelService.getClosestItem(viewState.curViewPort.selectS, viewState.getcurClickLevelName(), Soundhandlerservice.wavJSO.Data.length).current;\n                          if (seg.sampleStart === viewState.curViewPort.selectS && seg.sampleStart + seg.sampleDur + 1 === viewState.curViewPort.selectE) {\n                            viewState.setcurClickLevel(viewState.getcurClickLevelName(), viewState.getcurClickLevelType(), scope.$index);\n                            viewState.setcurClickItem(seg.current);\n                            LevelService.setlasteditArea('_' + seg.id);\n                            viewState.setEditing(true);\n                            LevelService.openEditArea(seg, LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                            viewState.setEditing(true);\n                          } else {\n                            var insSeg = LevelService.insertSegment(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, viewState.curViewPort.selectE, ConfigProviderService.vals.labelCanvasConfig.newSegmentName);\n                            if (!insSeg.ret) {\n                              scope.dials.open('views/error.html', 'ModalCtrl', 'Error : You are not allowed to insert a Segment here.');\n                            } else {\n                              HistoryService.addObjToUndoStack({\n                                'type': 'ANNOT',\n                                'action': 'INSERTSEGMENTS',\n                                'name': viewState.getcurClickLevelName(),\n                                'start': viewState.curViewPort.selectS,\n                                'end': viewState.curViewPort.selectE,\n                                'ids': insSeg.ids,\n                                'segName': ConfigProviderService.vals.labelCanvasConfig.newSegmentName\n                              });\n                            }\n                          }\n                        } else {\n                          var levelDef = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName());\n                          if (typeof levelDef.anagestConfig === 'undefined') {\n                            var insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, ConfigProviderService.vals.labelCanvasConfig.newEventName);\n                            if (insPoint.alreadyExists) {\n                              scope.dials.open('views/error.html', 'ModalCtrl', 'Error: You are not allowed to insert a Point here.');\n                            } else {\n                              HistoryService.addObjToUndoStack({\n                                'type': 'ANNOT',\n                                'action': 'INSERTEVENT',\n                                'name': viewState.getcurClickLevelName(),\n                                'start': viewState.curViewPort.selectS,\n                                'id': insPoint.id,\n                                'pointName': ConfigProviderService.vals.labelCanvasConfig.newEventName\n                              });\n                            }\n                          } else {\n                            AnagestService.insertAnagestEvents();\n                          }\n                        }\n                      }\n                    }\n                  } else {\n                  }\n                }\n              }\n              // undo\n              if (code === ConfigProviderService.vals.keyMappings.undo) {\n                if (viewState.getPermission('labelAction')) {\n                  HistoryService.undo();\n                }\n              }\n              // redo\n              if (code === ConfigProviderService.vals.keyMappings.redo) {\n                if (viewState.getPermission('labelAction')) {\n                  HistoryService.redo();\n                }\n              }\n              // deletePreselBoundary\n              if (code === ConfigProviderService.vals.keyMappings.deletePreselBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  e.preventDefault();\n                  var seg = viewState.getcurMouseItem();\n                  var cseg = viewState.getcurClickItems();\n                  var isFirst = viewState.getcurMouseisFirst();\n                  var isLast = viewState.getcurMouseisLast();\n                  var levelname = viewState.getcurMouseLevelName();\n                  var type = viewState.getcurMouseLevelType();\n                  if (!e.shiftKey) {\n                    if (ConfigProviderService.vals.restrictions.deleteItemBoundary) {\n                      if (seg !== undefined) {\n                        var neighbour = LevelService.getItemNeighboursFromLevel(levelname, seg.id, seg.id);\n                        if (type === 'SEGMENT') {\n                          var deletedSegment = LevelService.deleteBoundary(levelname, seg.id, isFirst, isLast);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETEBOUNDARY',\n                            'name': levelname,\n                            'id': seg.id,\n                            'isFirst': isFirst,\n                            'isLast': isLast,\n                            'deletedSegment': deletedSegment\n                          });\n                          var deletedLinks;\n                          if (neighbour.left !== undefined) {\n                            deletedLinks = LinkService.deleteLinkBoundary(seg.id, neighbour.left.id);\n                            HistoryService.updateCurChangeObj({\n                              'type': 'ANNOT',\n                              'action': 'DELETELINKBOUNDARY',\n                              'name': levelname,\n                              'id': seg.id,\n                              'neighbourId': neighbour.left.id,\n                              'deletedLinks': deletedLinks\n                            });\n                          } else {\n                            deletedLinks = LinkService.deleteLinkBoundary(seg.id, -1);\n                            HistoryService.updateCurChangeObj({\n                              'type': 'ANNOT',\n                              'action': 'DELETELINKBOUNDARY',\n                              'name': levelname,\n                              'id': seg.id,\n                              'neighbourId': -1,\n                              'deletedLinks': deletedLinks\n                            });\n                          }\n                          HistoryService.addCurChangeObjToUndoStack();\n                          var lastEventMove = LevelService.getClosestItem(viewState.getLasPcm() + viewState.curViewPort.sS, levelname, Soundhandlerservice.wavJSO.Data.length);\n                          if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n                            var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(levelName, lastEventMove.nearest.id, lastEventMove.nearest.id);\n                            viewState.setcurMouseItem(lastEventMove.nearest, lastNeighboursMove, viewState.getLasPcm(), lastEventMove.isFirst, lastEventMove.isLast);\n                          }\n                          viewState.setcurClickItem(deletedSegment.clickSeg);\n                        } else {\n                          var deletedPoint = LevelService.deleteEvent(levelname, seg.id);\n                          if (deletedPoint !== false) {\n                            HistoryService.updateCurChangeObj({\n                              'type': 'ANNOT',\n                              'action': 'DELETEEVENT',\n                              'name': levelname,\n                              'start': deletedPoint.samplePoint,\n                              'id': deletedPoint.id,\n                              'pointName': deletedPoint.labels[0].value\n                            });\n                            HistoryService.addCurChangeObjToUndoStack();\n                            var lastEventMove = LevelService.getClosestItem(viewState.getLasPcm() + viewState.curViewPort.sS, levelname, Soundhandlerservice.wavJSO.Data.length);\n                            if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n                              var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(levelName, lastEventMove.nearest.id, lastEventMove.nearest.id);\n                              viewState.setcurMouseItem(lastEventMove.nearest, lastNeighboursMove, viewState.getLasPcm(), lastEventMove.isFirst, lastEventMove.isLast);\n                            }\n                          } else {\n                            viewState.setcurMouseItem(undefined, undefined, undefined, undefined, undefined);\n                          }\n                        }\n                      } else {\n                      }\n                    }\n                  } else {\n                    if (ConfigProviderService.vals.restrictions.deleteItem) {\n                      if (cseg !== undefined && cseg.length > 0) {\n                        if (viewState.getcurClickLevelType() === 'SEGMENT') {\n                          var deletedSegment = LevelService.deleteSegments(levelname, cseg[0].id, cseg.length);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETESEGMENTS',\n                            'name': levelname,\n                            'id': cseg[0].id,\n                            'length': cseg.length,\n                            'deletedSegment': deletedSegment\n                          });\n                          var deletedLinks = LinkService.deleteLinkSegment(cseg);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETELINKSEGMENT',\n                            'name': levelname,\n                            'segments': cseg,\n                            'deletedLinks': deletedLinks\n                          });\n                          HistoryService.addCurChangeObjToUndoStack();\n                          var lastEventMove = LevelService.getClosestItem(viewState.getLasPcm() + viewState.curViewPort.sS, levelname, Soundhandlerservice.wavJSO.Data.length);\n                          if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n                            var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(levelName, lastEventMove.nearest.id, lastEventMove.nearest.id);\n                            viewState.setcurMouseItem(lastEventMove.nearest, lastNeighboursMove, viewState.getLasPcm(), lastEventMove.isFirst, lastEventMove.isLast);\n                          }\n                          viewState.setcurClickItem(deletedSegment.clickSeg);\n                        } else {\n                          scope.dials.open('views/error.html', 'ModalCtrl', 'Delete Error: You can not delete Segments on Point Levels.');\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              if (!e.metaKey && !e.ctrlKey) {\n                e.preventDefault();\n                e.stopPropagation();\n              }\n            }\n          });\n        }\n        scope.safeApply = function (fn) {\n          var phase = this.$root.$$phase;\n          if (phase == '$apply' || phase == '$digest') {\n            if (fn && typeof fn === 'function') {\n              fn();\n            }\n          } else {\n            this.$apply(fn);\n          }\n        };\n        //remove binding on destroy\n        scope.$on('$destroy', function () {\n          $(window).off('keydown');\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('delete', function () {\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      var name = scope.level.name;\n      element.bind('click', function () {\n        scope.vs.setcurClickLevelName(name, attr.delete);\n        scope.dials.open('views/deleteLevel.html', 'ModalCtrl', name);\n      });\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('resize', function () {\n  return {\n    restrict: 'A',\n    link: function (scope, element) {\n      var elem = element.parent().parent();\n      var elemHeight = 0;\n      var deleteButton = elem.find(element.parent().children()[0]);\n      var resizeButton = elem.find(element.parent().children()[1]);\n      var saveButton = elem.find(element.parent().children()[2]);\n      element.bind('click', function () {\n        if (scope.open) {\n          scope.open = false;\n          elemHeight = elem.css('height');\n          elem.css({ 'height': '30px' });\n          if (scope.cps.vals.activeButtons.deleteSingleLevel) {\n            deleteButton.hide();\n          }\n          if (scope.cps.vals.activeButtons.saveSingleLevel) {\n            saveButton.hide();\n          }\n        } else {\n          scope.open = true;\n          elem.css({ 'height': elemHeight });\n          if (scope.cps.vals.activeButtons.deleteSingleLevel) {\n            deleteButton.show();\n          }\n          if (scope.cps.vals.activeButtons.saveSingleLevel) {\n            saveButton.show();\n          }\n        }\n        scope.updateView();\n      });\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('enlarge', [\n  '$rootScope',\n  'viewState',\n  'ConfigProviderService',\n  function ($rootScope, viewState, ConfigProviderService) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attrs) {\n        scope.$watch('viewState.curPerspectiveIdx', function () {\n          if (!$.isEmptyObject(ConfigProviderService.vals.perspectives)) {\n            if (!$.isEmptyObject(viewState.curPerspectiveIdx)) {\n              console.log(viewState.curPerspectiveIdx);\n              if (ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.order.length === 1) {\n                element.hide();\n              } else {\n                element.show();\n              }\n            }\n          }\n        }, true);\n        var open = false;\n        element.bind('click', function () {\n          if (open) {\n            open = false;\n            viewState.setenlarge(-1);\n          } else {\n            open = true;\n            viewState.setenlarge(attrs.enlarge);\n          }\n          $rootScope.$apply();\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('save', [\n  'dialogService',\n  'Espsparserservice',\n  function (dialogService, Espsparserservice) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attr) {\n        var name = scope.level.name;\n        element.bind('click', function () {\n          scope.vs.setcurClickLevelName(name, attr.save);\n          Espsparserservice.asyncParseJSO(name).then(function (result) {\n            dialogService.openExport('views/export.html', 'ExportCtrl', result, name + '_esps.txt');\n          });\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('previewtrack', [\n  'viewState',\n  'Soundhandlerservice',\n  function (viewState, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function (scope, element) {\n        var startPCM = -1;\n        ///////////////\n        // bindings\n        //\n        element.bind('click', function (x) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            var width = viewState.curViewPort.eS - viewState.curViewPort.sS;\n            startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n            if (!viewState.isEditing()) {\n              scope.$apply(function () {\n                viewState.setViewPort(startPCM - width / 2, startPCM + width / 2);\n              });\n            }\n          }\n        });\n        //\n        element.bind('mousedown', function (x) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n          }\n        });\n        //\n        element.bind('mousemove', function (x) {\n          var mbutton = 0;\n          if (x.buttons === undefined) {\n            mbutton = x.which;\n          } else {\n            mbutton = x.buttons;\n          }\n          switch (mbutton) {\n          case 1:\n            if (startPCM !== -1) {\n              var width = viewState.curViewPort.eS - viewState.curViewPort.sS;\n              startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n              if (!viewState.isEditing()) {\n                scope.$apply(function () {\n                  viewState.setViewPort(startPCM - width / 2, startPCM + width / 2);\n                });\n              }\n            }\n            break;\n          }\n        });\n        //\n        element.bind('mouseup', function () {\n          startPCM = -1;\n        });\n        //\n        element.bind('mouseout', function () {\n          startPCM = -1;\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Iohandlerservice', [\n  '$rootScope',\n  '$http',\n  '$location',\n  '$q',\n  'HistoryService',\n  'viewState',\n  'Soundhandlerservice',\n  'Ssffparserservice',\n  'Wavparserservice',\n  'Textgridparserservice',\n  'ConfigProviderService',\n  'Espsparserservice',\n  'Ssffdataservice',\n  'Websockethandler',\n  function Iohandlerservice($rootScope, $http, $location, $q, HistoryService, viewState, Soundhandlerservice, Ssffparserservice, Wavparserservice, Textgridparserservice, ConfigProviderService, Espsparserservice, Ssffdataservice, Websockethandler) {\n    // shared service object\n    var sServObj = {};\n    // $http.defaults.useXDomain = true;\n    sServObj.wsH = Websockethandler;\n    /**\n\t\t * default config is always loaded from same origin\n\t\t */\n    sServObj.httpGetDefaultConfig = function () {\n      var prom = $http.get('configFiles/default_emuwebappConfig.json');\n      return prom;\n    };\n    /**\n\t\t * default config is always loaded from same origin\n\t\t */\n    sServObj.httpGetPath = function (path, respType) {\n      var prom = $http.get(path, { responseType: respType });\n      return prom;\n    };\n    ////////////////////////////\n    // EMU-webApp protocol begins here\n    //\n    /**\n\t\t *\n\t\t */\n    sServObj.getProtocol = function () {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getProtocol not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getProtocol();\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getDoUserManagement = function () {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getDoUserManagement not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getDoUserManagement();\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.logOnUser = function (name, pwd) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of logOnUser not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.logOnUser(name, pwd);\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getDBconfigFile = function (nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getDBconfigFile not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getDBconfigFile();\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + nameOfDB + '_DBconfig.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBundleList = function (nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getBundleList not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getBundleList();\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + nameOfDB + '_bundleList.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBundle = function (name, session, nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getBundle not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getBundle(name, session);\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        // getProm = $http.get('testData/newAE/SES0000/' + name + '/' + name + '.json');\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + name + '_bndl.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.saveBundle = function (bundleData) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of saveBundle not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.saveBundle(bundleData);\n      }\n      // else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n      // getProm = $http.get('testData/newAE/SES0000/' + name + '/' + name + '.json');\n      // \tgetProm = $http.get('testData/testAeBundle.json'); // SIC SIC SIC HARDCODED -> name is ignored\n      // }\n      return getProm;\n    };\n    //\n    // EMU-webApp protocol ends here\n    ////////////////////////////\n    /**\n\t\t * pass through to according parser\n\t\t */\n    sServObj.parseLabelFile = function (string, annotates, name, fileType) {\n      var prom;\n      if (fileType === 'ESPS') {\n        prom = Espsparserservice.asyncParseEsps(string, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedESPS');\n      } else if (fileType === 'TEXTGRID') {\n        prom = Textgridparserservice.asyncParseTextGrid(string, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedTEXTGRID');\n      }\n      return prom;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Soundhandlerservice', [\n  '$document',\n  'Binarydatamaniphelper',\n  function Soundhandlerservice($document, Binarydatamaniphelper) {\n    // shared service object\n    var sServObj = {};\n    sServObj.wavJSO = {};\n    sServObj.player = $document[0].createElement('audio');\n    sServObj.player.isPlaying = false;\n    sServObj.setPlayerSrc = function (buf) {\n      var base64String = Binarydatamaniphelper.arrayBufferToBase64(buf);\n      this.player.src = 'data:audio/wav;base64,' + base64String;\n    };\n    sServObj.resetPlayerSrcFromTo = function (sampleStart, endSample) {\n      var bytePerSample = this.wavJSO.BitsPerSample / 8;\n      var header = this.wavJSO.origArrBuf.subarray(0, 44);\n      var data = this.wavJSO.origArrBuf.subarray(44, this.wavJSO.Data.length * bytePerSample);\n      var dv = new DataView(header);\n      dv.setUint32(40, (endSample - sampleStart) * bytePerSample, true);\n      // var Subchunk2Size = dv.getUint32(40, true);\n      // console.log(Subchunk2Size);\n      var newData = data.subarray(sampleStart * bytePerSample, (endSample - sampleStart) * bytePerSample);\n      var tmp = new Uint8Array(header.byteLength + newData.byteLength);\n      tmp.set(new Uint8Array(header), 0);\n      tmp.set(new Uint8Array(newData), header.byteLength);\n      var base64String = Binarydatamaniphelper.arrayBufferToBase64(tmp.buffer);\n      this.player.src = 'data:audio/wav;base64,' + base64String;\n    };\n    sServObj.playFromTo = function (sampleStart, endSample) {\n      this.resetPlayerSrcFromTo(sampleStart, endSample);\n      if (this.player.isPlaying) {\n        this.player.isPlaying = false;\n        this.player.pause();\n      } else {\n        this.player.isPlaying = true;\n        this.player.play();\n      }\n    };\n    sServObj.player.addEventListener('ended', function () {\n      this.isPlaying = false;\n    }, false);\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('drawssff', [\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'HistoryService',\n  'fontScaleService',\n  function (viewState, ConfigProviderService, Ssffdataservice, HistoryService, fontScaleService) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function postLink(scope, element, atts) {\n        scope.trackName = atts.ssffTrackname;\n        scope.assTrackName = '';\n        scope.lastDraw = Date.now();\n        // add watch vars to scope\n        scope.vs = viewState;\n        scope.hists = HistoryService;\n        scope.ssffds = Ssffdataservice;\n        ////////////////////\n        // observes\n        // observe attribute\n        atts.$observe('ssffTrackname', function (val) {\n          scope.trackName = val;\n        });\n        ////////////////////\n        // watches\n        //watch viewPort change\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n            scope.handleUpdate();\n          }\n        }, true);\n        //watch perspective change\n        scope.$watch('vs.curPerspectiveIdx', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        //watch vs.curCorrectionToolNr change\n        scope.$watch('vs.curCorrectionToolNr', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        //watch hists.\n        scope.$watch('hists.movesAwayFromLastSave', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        // watch ssffds.data change\n        scope.$watch('ssffds.data.length', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        // watch vs.spectroSettings change\n        scope.$watch('vs.spectroSettings', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        //\n        //////////////////////\n        /**\n         *\n         */\n        scope.handleUpdate = function () {\n          var ctx = element[0].getContext('2d');\n          ctx.clearRect(0, 0, element[0].width, element[0].height);\n          if (!$.isEmptyObject(Ssffdataservice.data)) {\n            if (Ssffdataservice.data.length !== 0) {\n              scope.assTrackName = '';\n              // check assignments (= overlays)\n              ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.assign.forEach(function (ass, i) {\n                if (ass.signalCanvasName === scope.trackName) {\n                  scope.assTrackName = ass.ssffTrackName;\n                  var tr = ConfigProviderService.getSsffTrackConfig(ass.ssffTrackName);\n                  var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                  var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                  var minMaxLims = ConfigProviderService.getLimsOfTrack(tr.name);\n                  // draw values  \n                  scope.drawValues(viewState, element[0], ConfigProviderService, col, sRaSt.sampleRate, sRaSt.startTime, minMaxLims);\n                }\n              });\n              scope.assTrackName = '';\n              // draw ssffTrack onto own canvas\n              if (scope.trackName !== 'OSCI' && scope.trackName !== 'SPEC') {\n                var tr = ConfigProviderService.getSsffTrackConfig(scope.trackName);\n                var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                var minMaxLims = ConfigProviderService.getLimsOfTrack(tr.name);\n                // draw values  \n                scope.drawValues(viewState, element[0], ConfigProviderService, col, sRaSt.sampleRate, sRaSt.startTime, minMaxLims);\n              }\n            }\n          } else {\n            ctx.clearRect(0, 0, element[0].width, element[0].height);\n          }\n        };\n        /**\n         * draw values onto canvas\n         */\n        scope.drawValues = function (viewState, canvas, config, col, sR, sT, minMaxLims) {\n          var ctx = canvas.getContext('2d');\n          var minVal, maxVal;\n          if (scope.trackName === 'SPEC' && scope.assTrackName === 'FORMANTS') {\n            minVal = viewState.spectroSettings.rangeFrom;\n            maxVal = viewState.spectroSettings.rangeTo;\n          } else {\n            minVal = col._minVal;\n            maxVal = col._maxVal;\n          }\n          var startTimeVP = viewState.getViewPortStartTime();\n          var endTimeVP = viewState.getViewPortEndTime();\n          var colStartSampleNr = Math.round(startTimeVP * sR + sT);\n          var colEndSampleNr = Math.round(endTimeVP * sR + sT);\n          var nrOfSamples = colEndSampleNr - colStartSampleNr;\n          var curSampleArrs = col.values.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n          if (nrOfSamples < canvas.width && nrOfSamples >= 2) {\n            var x, y, prevX, prevY, prevVal, curSampleInCol, curSampleInColTime;\n            ////////////////////////////////\n            // NEW VERSION\n            ////////////////////////////////\n            angular.forEach(curSampleArrs[0], function (contourVal, contourNr) {\n              // console.log(contourNr);\n              if ($.isEmptyObject(minMaxLims) || contourNr >= minMaxLims.minContourIdx && contourNr <= minMaxLims.maxContourIdx) {\n                // set color\n                if ($.isEmptyObject(minMaxLims)) {\n                  ctx.strokeStyle = 'hsl(' + contourNr * (360 / curSampleArrs[0].length) + ',80%, 50%)';\n                  ctx.fillStyle = 'hsl(' + contourNr * (360 / curSampleArrs[0].length) + ',80%, 50%)';\n                } else {\n                  var l = minMaxLims.maxContourIdx - minMaxLims.minContourIdx + 1;\n                  ctx.strokeStyle = 'hsl(' + contourNr * (360 / l) + ',80%, 50%)';\n                  ctx.fillStyle = 'hsl(' + contourNr * (360 / l) + ',80%, 50%)';\n                }\n                // overwrite color settings if they are preconfigured\n                var contColors = ConfigProviderService.getContourColorsOfTrack(scope.assTrackName);\n                if (contColors !== undefined) {\n                  if (contColors.colors[contourNr] !== undefined) {\n                    ctx.strokeStyle = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors[0].colors[contourNr];\n                    ctx.fillStyle = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors[0].colors[contourNr];\n                  }\n                }\n                // mark selected\n                // console.log(viewState.curCorrectionToolNr);\n                if (viewState.curCorrectionToolNr - 1 === contourNr && scope.trackName === 'SPEC' && scope.assTrackName === 'FORMANTS') {\n                  ctx.strokeStyle = ConfigProviderService.vals.colors.selectedContourColor;\n                  ctx.fillStyle = ConfigProviderService.vals.colors.selectedContourColor;\n                }\n                ctx.beginPath();\n                // first line from sample not in view (left)\n                if (colStartSampleNr >= 1) {\n                  var leftBorder = col.values[colStartSampleNr - 1];\n                  var leftVal = leftBorder[contourNr];\n                  curSampleInCol = colStartSampleNr - 1;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (leftVal - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.moveTo(x, y);\n                }\n                angular.forEach(curSampleArrs, function (curArr, curArrIdx) {\n                  // console.log(curArr[contourNr]);\n                  curSampleInCol = colStartSampleNr + curArrIdx;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (curArr[contourNr] - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                  ctx.lineTo(x, y);\n                });\n                // last line from sample not in view (right)\n                if (colEndSampleNr < col.values.length - 1) {\n                  var rightBorder = col.values[colEndSampleNr + 1];\n                  var rightVal = rightBorder[contourNr];\n                  curSampleInCol = colEndSampleNr + 1;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (rightVal - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.lineTo(x, y);\n                }\n                ctx.stroke();  // ctx.fill();\n              }\n            });\n          } else {\n            ctx.strokeStyle = 'red';\n            var txt;\n            // var tW;\n            var horizontalText;\n            if (nrOfSamples <= 2) {\n              horizontalText = fontScaleService.getTextImageTwoLines(ctx, 'Zoom out to', 'see contour(s)', ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor);\n              // ctx.fillStyle = ConfigProviderService.vals.colors.levelColor;\n              // ctx.fillRect(0, 0, canvas.width, canvas.height);\n              ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, canvas.width / 2 - horizontalText.width / 2, 25, horizontalText.width, horizontalText.height);\n            } else {\n              txt = 'Zoom in to see contour(s)';\n              horizontalText = fontScaleService.getTextImageTwoLines(ctx, 'Zoom in to', 'see contour(s)', ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor);\n              // ctx.fillStyle = ConfigProviderService.vals.colors.levelColor;\n              // ctx.fillRect(0, 0, canvas.width, canvas.height);              \n              ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, canvas.width / 2 - horizontalText.width / 2, 25, horizontalText.width, horizontalText.height);\n            }\n          }\n        }  //function\n;\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Ssffparserservice', [\n  '$q',\n  function Ssffparserservice($q) {\n    // shared service object\n    var sServObj = {};\n    var worker = new ssffParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e);\n      } else {\n        defer.reject(e);\n      }\n    }, false);\n    /**\n\t\t * parse array of ssff file using webworker\n\t\t * @param array of ssff files encoded as base64 stings\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseSsffArr = function (ssffArray) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseArr',\n        'ssffArr': ssffArray\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    /**\n\t\t * convert jso to ssff binary file using webworker\n\t\t * @param java script object of ssff file (internal rep)\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncJso2ssff = function (jso) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'jso2ssff',\n        'jso': JSON.stringify(jso)\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('mouseTrackAndCorrectionTool', [\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'Drawhelperservice',\n  'HistoryService',\n  'Soundhandlerservice',\n  function (viewState, ConfigProviderService, Ssffdataservice, Drawhelperservice, HistoryService, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function (scope, element, atts) {\n        var curMouseSample;\n        var dragStartSample;\n        var dragEndSample;\n        var canvas = element[0];\n        var ctx = canvas.getContext('2d');\n        // var elem = element[0];\n        var tr, col, sRaSt;\n        var trackName;\n        var bundleName;\n        /////////////////////////////\n        // observe attribute\n        atts.$observe('ssffTrackname', function (val) {\n          if (val) {\n            trackName = val;\n          }\n        });\n        // bundleName needed to reset tr, col, sRaSt on bundle change\n        atts.$observe('bundleName', function (val) {\n          if (val) {\n            bundleName = val;\n            if (!$.isEmptyObject(Ssffdataservice.data)) {\n              if (Ssffdataservice.data.length !== 0) {\n                tr = ConfigProviderService.getSsffTrackConfig('FORMANTS');\n                if (tr !== undefined) {\n                  col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                  sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                }\n              }\n            }\n          }\n        });\n        /////////////////////////////\n        // Bindings\n        element.bind('mousedown', function (event) {\n          dragStartSample = Math.round(viewState.getX(event) * viewState.getSamplesPerPixelVal(event) + viewState.curViewPort.sS);\n          dragEndSample = dragStartSample;\n          viewState.select(dragStartSample, dragStartSample);\n          //Drawhelperservice.drawViewPortTimes(ctx, true);\n          switchMarkupContext(event);\n          scope.$apply();\n        });\n        element.bind('mousemove', function (event) {\n          var mbutton = 0;\n          if (event.buttons === undefined) {\n            mbutton = event.which;\n          } else {\n            mbutton = event.buttons;\n          }\n          // perform mouse tracking\n          var mouseX = viewState.getX(event);\n          viewState.curMousePosSample = Math.round(viewState.curViewPort.sS + mouseX / element[0].width * (viewState.curViewPort.eS - viewState.curViewPort.sS));\n          switch (mbutton) {\n          case 0:\n            if (viewState.getPermission('labelAction')) {\n              switchMarkupContext(event);\n              if (!$.isEmptyObject(Ssffdataservice.data)) {\n                if (Ssffdataservice.data.length !== 0) {\n                  if (!viewState.getdragBarActive()) {\n                    if (viewState.curCorrectionToolNr !== undefined && !viewState.getdragBarActive() && !$.isEmptyObject(ConfigProviderService.getAssignment(trackName))) {\n                      // var col = Ssffdataservice.data[0].Columns[0];\n                      if (tr === undefined) {\n                        tr = ConfigProviderService.getSsffTrackConfig('FORMANTS');\n                        col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                        sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                      }\n                      var startTimeVP = viewState.getViewPortStartTime();\n                      var endTimeVP = viewState.getViewPortEndTime();\n                      var colStartSampleNr = Math.round(startTimeVP * sRaSt.sampleRate + sRaSt.startTime);\n                      var colEndSampleNr = Math.round(endTimeVP * sRaSt.sampleRate + sRaSt.startTime);\n                      var nrOfSamples = colEndSampleNr - colStartSampleNr;\n                      var curSampleArrs = col.values.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n                      // console.log(colStartSampleNr)\n                      var curMouseTime = startTimeVP + viewState.getX(event) / event.originalEvent.target.width * (endTimeVP - startTimeVP);\n                      var curMouseSample = Math.round((curMouseTime + sRaSt.startTime) * sRaSt.sampleRate) - 1;\n                      //-1 for in view correction\n                      var curMouseSampleTime = 1 / sRaSt.sampleRate * curMouseSample + sRaSt.startTime;\n                      if (curMouseSample - colStartSampleNr < 0 || curMouseSample - colStartSampleNr >= curSampleArrs.length) {\n                        console.log('early return');\n                        return;\n                      }\n                      viewState.curPreselColumnSample = curMouseSample - colStartSampleNr;\n                      var x = (curMouseSampleTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                      var y = canvas.height - curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1] / (viewState.spectroSettings.rangeTo - viewState.spectroSettings.rangeFrom) * canvas.height;\n                      // draw sample\n                      ctx.strokeStyle = 'black';\n                      ctx.fillStyle = 'black';\n                      ctx.beginPath();\n                      ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                      ctx.closePath();\n                      ctx.stroke();\n                      ctx.fill();\n                      if (event.shiftKey) {\n                        var oldValue = angular.copy(curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1]);\n                        var newValue = viewState.spectroSettings.rangeTo - viewState.getY(event) / event.originalEvent.target.height * viewState.spectroSettings.rangeTo;\n                        // SIC only using rangeTo\n                        curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1] = viewState.spectroSettings.rangeTo - viewState.getY(event) / event.originalEvent.target.height * viewState.spectroSettings.rangeTo;\n                        var updateObj = HistoryService.updateCurChangeObj({\n                            'type': 'SSFF',\n                            'trackName': tr.name,\n                            'sampleBlockIdx': colStartSampleNr + viewState.curPreselColumnSample,\n                            'sampleIdx': viewState.curCorrectionToolNr - 1,\n                            'oldValue': oldValue,\n                            'newValue': newValue\n                          });\n                        //draw updateObj as overlay\n                        for (var key in updateObj) {\n                          curMouseSampleTime = 1 / sRaSt.sampleRate * updateObj[key].sampleBlockIdx + sRaSt.startTime;\n                          x = (curMouseSampleTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                          y = canvas.height - updateObj[key].newValue / (viewState.spectroSettings.rangeTo - viewState.spectroSettings.rangeFrom) * canvas.height;\n                          // draw sample\n                          ctx.strokeStyle = 'red';\n                          ctx.fillStyle = 'red';\n                          // ctx.lineWidth = 4;\n                          ctx.beginPath();\n                          ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                          ctx.closePath();\n                          ctx.stroke();\n                          ctx.fill();\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n            break;\n          case 1:\n            if (!viewState.getdragBarActive()) {\n              setSelectDrag(event);\n            }\n            break;\n          }\n          scope.$apply();\n        });\n        element.bind('mouseup', function (event) {\n          if (!viewState.getdragBarActive()) {\n            setSelectDrag(event);\n            switchMarkupContext(event);\n          }\n        });\n        // on mouse leave clear markup canvas\n        element.bind('mouseleave', function (event) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              // if (!$.isEmptyObject(Ssffdataservice.data)) {\n              // if (Ssffdataservice.data.length !== 0) {\n              if (!viewState.getdragBarActive()) {\n                if (viewState.getPermission('labelAction')) {\n                  switchMarkupContext(event, false);\n                }\n              }  // }\n                 // }\n            }\n          }\n        });\n        //\n        ////////////////////\n        function switchMarkupContext(event, leave) {\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          // draw current viewport selected\n          if (atts.ssffTrackname == 'OSCI') {\n            Drawhelperservice.drawViewPortTimes(ctx, true);\n            Drawhelperservice.drawCurViewPortSelected(ctx, true);\n          } else if (atts.ssffTrackname == 'SPEC') {\n            Drawhelperservice.drawCurViewPortSelected(ctx, false);\n            Drawhelperservice.drawMinMaxAndName(ctx, '', viewState.spectroSettings.rangeFrom, viewState.spectroSettings.rangeTo, 2);\n          } else {\n            var tr = ConfigProviderService.getSsffTrackConfig(atts.ssffTrackname);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            Drawhelperservice.drawCurViewPortSelected(ctx, false);\n            Drawhelperservice.drawMinMaxAndName(ctx, atts.ssffTrackname, col._minVal, col._maxVal, 2);\n          }\n          // draw crossHairs\n          if (leave !== false && ConfigProviderService.vals.restrictions.drawCrossHairs) {\n            Drawhelperservice.drawCrossHairs(ctx, event, viewState.spectroSettings.rangeFrom, viewState.spectroSettings.rangeTo, 'Hz', atts.ssffTrackname);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n        }\n        function setSelectDrag(event) {\n          curMouseSample = Math.round(viewState.getX(event) * viewState.getSamplesPerPixelVal(event) + viewState.curViewPort.sS);\n          if (curMouseSample > dragStartSample) {\n            dragEndSample = curMouseSample;\n            viewState.select(dragStartSample, dragEndSample);\n          } else {\n            dragStartSample = curMouseSample;\n            viewState.select(dragStartSample, dragEndSample);\n          }\n          scope.$apply();\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Drawhelperservice', [\n  'viewState',\n  'ConfigProviderService',\n  'Soundhandlerservice',\n  'fontScaleService',\n  'Ssffdataservice',\n  function Drawhelperservice(viewState, ConfigProviderService, Soundhandlerservice, fontScaleService, Ssffdataservice) {\n    //shared service object to be returned\n    var sServObj = {};\n    function getScale(ctx, str, scale) {\n      return ctx.measureText(str).width * scale;\n    }\n    function getScaleWidth(ctx, str1, str2, scaleX) {\n      if (str1.toString().length > str2.toString().length) {\n        return getScale(ctx, str1, scaleX);\n      } else {\n        return getScale(ctx, str2, scaleX);\n      }\n    }\n    /**\n\t\t * drawing method to draw single line between two\n\t\t * envelope points. Is used by drawOsciOnCanvas if\n\t\t * envelope drawing is done\n\t\t * @param index\n\t\t * @param value\n\t\t * @param max\n\t\t * @param prevPeak\n\t\t * @param canvas\n\t\t */\n    function drawFrame(viewState, index, value, max, prevPeak, canvas, config) {\n      var ctx = canvas.getContext('2d');\n      //cur\n      var w = 1;\n      var h = Math.round(value * (canvas.height / max));\n      //rel to max\n      var x = index * w;\n      var y = Math.round((canvas.height - h) / 2);\n      //prev\n      // var prevW = 1;\n      var prevH = Math.round(prevPeak * (canvas.height / max));\n      var prevX = (index - 1) * w;\n      var prevY = Math.round((canvas.height - prevH) / 2);\n      // if (posC >= x) {\n      // \tconsole.error('here...')\n      // \tctx.fillStyle = config.vals.colors.playProgressColor;\n      // \tctx.strokeStyle = config.vals.colors.playProgressColor;\n      // } else {\n      ctx.fillStyle = config.vals.colors.osciColor;\n      ctx.strokeStyle = config.vals.colors.osciColor;\n      // }\n      // ctx.beginPath();\n      ctx.moveTo(prevX, prevY);\n      ctx.lineTo(x, y);  // ctx.stroke();\n    }\n    sServObj.osciPeaks = [];\n    /**\n\t\t * get current peaks to be drawn\n\t\t * if drawing over sample exact -> samples\n\t\t * if multiple samples per pixel -> calculate envelope points\n\t\t */\n    sServObj.calculatePeaks = function (viewState, canvas, data) {\n      var samplePerPx = (viewState.curViewPort.eS + 1 - viewState.curViewPort.sS) / canvas.width;\n      // PCM Samples per new pixel + one to correct for subtraction\n      var numberOfChannels = 1;\n      // hardcode for now...\n      var peaks = [];\n      var minPeak = Infinity;\n      var maxPeak = -Infinity;\n      var relData;\n      if (samplePerPx <= 1) {\n        // check if view at start            \n        if (viewState.curViewPort.sS === 0) {\n          relData = data.subarray(viewState.curViewPort.sS, viewState.curViewPort.eS + 2);  // +2 to compensate for length\n        } else {\n          relData = data.subarray(viewState.curViewPort.sS - 1, viewState.curViewPort.eS + 2);  // +2 to compensate for length\n        }\n        minPeak = Math.min.apply(Math, relData);\n        maxPeak = Math.max.apply(Math, relData);\n        peaks = Array.prototype.slice.call(relData);\n      } else {\n        relData = data.subarray(viewState.curViewPort.sS, viewState.curViewPort.eS);\n        for (var curPxIdx = 0; curPxIdx < canvas.width; curPxIdx++) {\n          var avrVal = 0;\n          for (var c = 0; c < numberOfChannels; c++) {\n            var vals = relData.subarray(curPxIdx * samplePerPx, (curPxIdx + 1) * samplePerPx);\n            // var peak = -Infinity;\n            var sum = 0;\n            for (var p = 0, l = vals.length; p < l; p++) {\n              // if (vals[p] > peak) {\n              // \tpeak = vals[p];\n              // }\n              sum += vals[p];\n            }\n            avrVal += sum / vals.length;\n          }\n          peaks[curPxIdx] = avrVal;\n          if (avrVal > maxPeak) {\n            maxPeak = avrVal;\n          }\n        }\n      }\n      //else\n      return {\n        'peaks': peaks,\n        'minPeak': minPeak,\n        'maxPeak': maxPeak,\n        'samplePerPx': samplePerPx\n      };\n    };\n    /**\n\t\t * @param cps color provider service\n\t\t */\n    sServObj.freshRedrawDrawOsciOnCanvas = function (viewState, canvas, allPeakVals, buffer, config) {\n      var ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      //set font\n      // ctx.font = (this.params.fontPxSize + \"px\" + \" \" + this.params.fontType);\n      if (allPeakVals.peaks && allPeakVals.samplePerPx >= 1) {\n        ctx.beginPath();\n        allPeakVals.peaks.forEach(function (peak, index) {\n          if (index !== 0) {\n            drawFrame(viewState, index, peak, allPeakVals.maxPeak, allPeakVals.peaks[index - 1], canvas, config);\n          }\n        });\n        ctx.stroke();\n      } else if (allPeakVals.samplePerPx < 1) {\n        // console.log(\"at 0 over sample exact\")\n        var hDbS = 1 / allPeakVals.samplePerPx / 2;\n        // half distance between samples\n        var sNr = viewState.curViewPort.sS;\n        // over sample exact\n        ctx.strokeStyle = config.vals.colors.osciColor;\n        ctx.fillStyle = config.vals.colors.osciColor;\n        // ctx.beginPath();\n        var i;\n        if (viewState.curViewPort.sS === 0) {\n          ctx.moveTo(hDbS, (allPeakVals.peaks[0] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          for (i = 0; i < allPeakVals.peaks.length; i++) {\n            ctx.lineTo(i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          }\n          ctx.stroke();\n          // draw sample dots\n          for (i = 0; i < allPeakVals.peaks.length; i++) {\n            ctx.beginPath();\n            ctx.arc(i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 3, 4, 0, 2 * Math.PI, false);\n            ctx.stroke();\n            ctx.fill();\n            if (config.vals.restrictions.drawSampleNrs) {\n              ctx.strokeText(sNr, i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 10);\n              sNr = sNr + 1;\n            }\n          }\n        } else {\n          //draw lines\n          ctx.beginPath();\n          ctx.moveTo(-hDbS, canvas.height - (allPeakVals.peaks[0] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          for (i = 1; i <= allPeakVals.peaks.length; i++) {\n            ctx.lineTo(i / allPeakVals.samplePerPx - hDbS, canvas.height - ((allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height + 3));\n          }\n          ctx.stroke();\n          // draw sample dots\n          for (i = 1; i <= allPeakVals.peaks.length; i++) {\n            ctx.beginPath();\n            ctx.arc(i / allPeakVals.samplePerPx - hDbS, canvas.height - (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 3, 4, 0, 2 * Math.PI, false);\n            ctx.stroke();\n            ctx.fill();\n            if (config.vals.restrictions.drawSampleNrs) {\n              ctx.fillText(sNr, i / allPeakVals.samplePerPx - hDbS, canvas.height - (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 10);\n              sNr = sNr + 1;\n            }\n          }\n        }\n      }\n      if (config.vals.restrictions.drawZeroLine) {\n        // draw zero line\n        ctx.strokeStyle = config.vals.colors.zeroLineColor;\n        ctx.fillStyle = config.vals.colors.zeroLineColor;\n        // see if Chrome ->dashed line\n        if (navigator.vendor === 'Google Inc.') {\n          ctx.setLineDash([2]);\n        }\n        if (allPeakVals.samplePerPx >= 1) {\n          ctx.beginPath();\n          ctx.moveTo(0, canvas.height / 2);\n          ctx.lineTo(canvas.width, canvas.height / 2);\n          ctx.stroke();\n          ctx.fillText('0', 5, canvas.height / 2 - 5, canvas.width);\n        } else {\n          var zeroLineY = canvas.height - (0 - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height;\n          ctx.beginPath();\n          ctx.moveTo(0, zeroLineY);\n          ctx.lineTo(canvas.width, zeroLineY);\n          ctx.stroke();\n          ctx.fill();\n          ctx.fillText('0', 5, canvas.height - (0 - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 5, canvas.width);\n        }\n        // see if Chrome ->dashed line\n        if (navigator.vendor === 'Google Inc.') {\n          ctx.setLineDash([0]);\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawMovingBoundaryLine\n\t\t */\n    sServObj.drawMovingBoundaryLine = function (ctx) {\n      var xOffset, sDist;\n      sDist = viewState.getSampleDist(ctx.canvas.width);\n      // calc. offset dependant on type of level of mousemove  -> default is sample exact\n      if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n        xOffset = 0;\n      } else {\n        xOffset = sDist / 2;\n      }\n      if (viewState.movingBoundary) {\n        ctx.fillStyle = ConfigProviderService.vals.colors.selectedBoundaryColor;\n        var p = Math.round(viewState.getPos(ctx.canvas.width, viewState.movingBoundarySample));\n        if (viewState.getcurMouseisLast()) {\n          ctx.fillRect(p + sDist, 0, 1, ctx.canvas.height);\n        } else {\n          ctx.fillRect(p + xOffset, 0, 1, ctx.canvas.height);\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawCurViewPortSelected\n\t\t */\n    sServObj.drawCurViewPortSelected = function (ctx, drawTimeAndSamples) {\n      var xOffset, sDist, space, horizontalText, scaleX;\n      sDist = viewState.getSampleDist(ctx.canvas.width);\n      // calc. offset dependant on type of level of mousemove  -> default is sample exact\n      if (viewState.getcurMouseLevelType() === 'seg') {\n        xOffset = 0;\n      } else {\n        xOffset = sDist / 2;\n      }\n      var posS = viewState.getPos(ctx.canvas.width, viewState.curViewPort.selectS);\n      var posE = viewState.getPos(ctx.canvas.width, viewState.curViewPort.selectE);\n      if (posS === posE) {\n        ctx.fillStyle = ConfigProviderService.vals.colors.selectedBorderColor;\n        ctx.fillRect(posS + xOffset, 0, 2, ctx.canvas.height);\n        if (drawTimeAndSamples) {\n          if (viewState.curViewPort.sS !== viewState.curViewPort.selectS && viewState.curViewPort.selectS !== -1) {\n            scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n            space = getScaleWidth(ctx, viewState.curViewPort.selectS, viewState.round(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n            horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.selectS, viewState.round(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, true);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, posE + 5, 0, horizontalText.width, horizontalText.height);\n          }\n        }\n      } else {\n        ctx.fillStyle = ConfigProviderService.vals.colors.selectedAreaColor;\n        ctx.fillRect(posS, 0, posE - posS, ctx.canvas.height);\n        ctx.strokeStyle = ConfigProviderService.vals.colors.selectedBorderColor;\n        ctx.beginPath();\n        ctx.moveTo(posS, 0);\n        ctx.lineTo(posS, ctx.canvas.height);\n        ctx.moveTo(posE, 0);\n        ctx.lineTo(posE, ctx.canvas.height);\n        ctx.closePath();\n        ctx.stroke();\n        if (drawTimeAndSamples) {\n          // start values\n          scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n          space = getScaleWidth(ctx, viewState.curViewPort.selectS, viewState.round(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n          horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.selectS, viewState.round(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, false);\n          ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, posS - space - 5, 0, horizontalText.width, horizontalText.height);\n          // end values\n          horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.selectE, viewState.round(viewState.curViewPort.selectE / Soundhandlerservice.wavJSO.SampleRate, 6), ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, true);\n          ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, posE + 5, 0, horizontalText.width, horizontalText.height);\n          // dur values\n          // check if space\n          space = getScale(ctx, viewState.round((viewState.curViewPort.selectE - viewState.curViewPort.selectS) / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n          if (posE - posS > space) {\n            var str1 = viewState.curViewPort.selectE - viewState.curViewPort.selectS - 1;\n            var str2 = viewState.round((viewState.curViewPort.selectE - viewState.curViewPort.selectS) / Soundhandlerservice.wavJSO.SampleRate, 6);\n            space = getScaleWidth(ctx, str1, str2, scaleX);\n            horizontalText = fontScaleService.getTextImageTwoLines(ctx, str1, str2, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, false);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, posS + (posE - posS) / 2 - space / 2, 0, horizontalText.width, horizontalText.height);\n          }\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawCrossHairs\n\t\t */\n    sServObj.drawCrossHairs = function (ctx, mouseEvt, min, max, unit, trackname) {\n      if (ConfigProviderService.vals.restrictions.drawCrossHairs) {\n        // ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n        ctx.strokeStyle = ConfigProviderService.vals.colors.crossHairsColor;\n        ctx.fillStyle = ConfigProviderService.vals.colors.crossHairsColor;\n        // see if Chrome -> dashed line\n        if (navigator.vendor === 'Google Inc.') {\n          ctx.setLineDash([2]);\n        }\n        // draw lines\n        var mouseX = viewState.getX(mouseEvt);\n        var mouseY = viewState.getY(mouseEvt);\n        if (navigator.vendor === 'Google Inc.') {\n          ctx.setLineDash([0]);\n        }\n        // draw frequency / sample / time\n        ctx.font = ConfigProviderService.vals.font.fontPxSize + 'px' + ' ' + ConfigProviderService.vals.font.fontType;\n        var mouseFreq = viewState.round(max - mouseY / ctx.canvas.height * max, 2);\n        // SIC only uses max\n        var tW = ctx.measureText(mouseFreq + unit).width;\n        var s1 = Math.round(viewState.curViewPort.sS + mouseX / ctx.canvas.width * (viewState.curViewPort.eS - viewState.curViewPort.sS));\n        var s2 = viewState.round(viewState.getViewPortStartTime() + mouseX / ctx.canvas.width * (viewState.getViewPortEndTime() - viewState.getViewPortStartTime()), 6);\n        var horizontalText = fontScaleService.getTextImage(ctx, mouseFreq + unit, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor, true);\n        var verticalText = fontScaleService.getTextImageTwoLines(ctx, s1, s2, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor, true);\n        if (max !== undefined || min !== undefined) {\n          if (trackname == 'OSCI') {\n            // no horizontal values\t\t\n            ctx.beginPath();\n            //ctx.moveTo(0, mouseY);\n            //ctx.lineTo(5, mouseY + 5);\n            //ctx.moveTo(0, mouseY);\n            //ctx.lineTo(ctx.canvas.width, mouseY);\n            //ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          } else if (trackname == 'SPEC') {\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, 5, mouseY, horizontalText.width, horizontalText.height);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, ctx.canvas.width - 5 - tW * (ctx.canvas.width / ctx.canvas.offsetWidth), mouseY, horizontalText.width, horizontalText.height);\n            ctx.beginPath();\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(5, mouseY + 5);\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(ctx.canvas.width, mouseY);\n            ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          } else {\n            // draw min max an name of track\n            var tr = ConfigProviderService.getSsffTrackConfig(trackname);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            mouseFreq = viewState.round(col._maxVal - mouseY / ctx.canvas.height * col._maxVal, 2);\n            horizontalText = fontScaleService.getTextImage(ctx, mouseFreq, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor, true);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, 5, mouseY, horizontalText.width, horizontalText.height);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, ctx.canvas.width - 5 - tW * (ctx.canvas.width / ctx.canvas.offsetWidth), mouseY, horizontalText.width, horizontalText.height);\n            ctx.beginPath();\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(5, mouseY + 5);\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(ctx.canvas.width, mouseY);\n            ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          }\n        }\n        ctx.drawImage(verticalText, 0, 0, verticalText.width, verticalText.height, mouseX + 5, 0, verticalText.width, verticalText.height);\n      }\n    };\n    /**\n\t\t * drawing method to drawMinMaxAndName\n\t\t * @param ctx is context to be drawn on\n\t\t * @param trackName name of track to be drawn in the center of the canvas (left aligned)\n\t\t * @param min value to be drawn at the bottom of the canvas (left aligned)\n\t\t * @param max value to be drawn at the top of the canvas (left aligned)\n\t\t * @param round value to round to for min/max values (== digits after comma)\n\t\t */\n    sServObj.drawMinMaxAndName = function (ctx, trackName, min, max, round) {\n      // ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n      ctx.strokeStyle = ConfigProviderService.vals.colors.labelColor;\n      ctx.fillStyle = ConfigProviderService.vals.colors.labelColor;\n      // var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n      var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n      var smallFontSize = ConfigProviderService.vals.font.fontPxSize * 3 / 4;\n      var th = smallFontSize * scaleY;\n      // draw corner pointers\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(5, 5);\n      ctx.moveTo(0, ctx.canvas.height);\n      ctx.lineTo(5, ctx.canvas.height - 5);\n      ctx.stroke();\n      ctx.closePath();\n      // draw ssffTrackName\n      if (trackName !== '') {\n        ctx.font = ConfigProviderService.vals.font.fontPxSize + 'px' + ' ' + ConfigProviderService.vals.font.fontType;\n        var trackNameImg = fontScaleService.getTextImage(ctx, trackName, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, true);\n        ctx.drawImage(trackNameImg, 0, ctx.canvas.height / 2 - ConfigProviderService.vals.font.fontPxSize * scaleY / 2);\n      }\n      // draw min/max vals\n      if (max !== undefined) {\n        var labelTxtImg = fontScaleService.getTextImage(ctx, 'max: ' + viewState.round(max, round), smallFontSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.endBoundaryColor);\n        ctx.drawImage(labelTxtImg, 5, 5, labelTxtImg.width, labelTxtImg.height);\n      }\n      // draw min/max vals\n      if (min !== undefined) {\n        labelTxtImg = fontScaleService.getTextImage(ctx, 'min: ' + viewState.round(min, round), smallFontSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.endBoundaryColor);\n        ctx.drawImage(labelTxtImg, 5, ctx.canvas.height - th - 5, labelTxtImg.width, labelTxtImg.height);\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.drawViewPortTimes = function (ctx) {\n      ctx.strokeStyle = ConfigProviderService.vals.colors.labelColor;\n      ctx.fillStyle = ConfigProviderService.vals.colors.labelColor;\n      ctx.font = ConfigProviderService.vals.font.fontPxSize + 'px' + ' ' + ConfigProviderService.vals.font.fontType;\n      // lines to corners\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(5, 5);\n      ctx.moveTo(ctx.canvas.width, 0);\n      ctx.lineTo(ctx.canvas.width - 5, 5);\n      ctx.closePath();\n      ctx.stroke();\n      var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n      var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n      var sTime;\n      var eTime;\n      var horizontalText;\n      var space;\n      if (viewState.curViewPort) {\n        //draw time and sample nr\n        sTime = viewState.round(viewState.curViewPort.sS / Soundhandlerservice.wavJSO.SampleRate, 6);\n        eTime = viewState.round(viewState.curViewPort.eS / Soundhandlerservice.wavJSO.SampleRate, 6);\n        horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.sS, sTime, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, true);\n        // ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, 0, 0, horizontalText.width, horizontalText.height);\n        ctx.drawImage(horizontalText, 5, 5);\n        space = getScaleWidth(ctx, viewState.curViewPort.eS, eTime, scaleX);\n        horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.eS, eTime, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, false);\n        ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, ctx.canvas.width - space - 5, 0, horizontalText.width, horizontalText.height);  //draw dot at edge of image\n                                                                                                                                                                         // var spaceW = getScaleWidth(ctx, viewState.curViewPort.eS, eTime, scaleX);\n                                                                                                                                                                         // var startPoint = (Math.PI / 180) * 0;\n                                                                                                                                                                         // var endPoint = (Math.PI / 180) * 360;\n                                                                                                                                                                         // ctx.beginPath();\n                                                                                                                                                                         // ctx.arc(spaceW, config.vals.font.fontPxSize * 2 * scaleY, 10, startPoint, endPoint, true);\n                                                                                                                                                                         // ctx.fill();\n                                                                                                                                                                         // ctx.closePath();\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('HistoryService', [\n  '$log',\n  'Ssffdataservice',\n  'LevelService',\n  'LinkService',\n  'ConfigProviderService',\n  'viewState',\n  'Soundhandlerservice',\n  function HistoryService($log, Ssffdataservice, LevelService, LinkService, ConfigProviderService, viewState, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    sServObj.movesAwayFromLastSave = 0;\n    //////////////////////////////////////////\n    // new dual stack implementation\n    //private\n    var undoStack = [];\n    var redoStack = [];\n    var curChangeObj = {};\n    // applyChanges should be called by undo redo functions\n    function applyChange(changeObj, applyOldVal) {\n      Object.keys(changeObj).forEach(function (key) {\n        var cur = changeObj[key];\n        if (cur.type === 'SSFF') {\n          if (applyOldVal) {\n            viewState.historyActionTxt = 'UNDO: SSFF manipulation';\n            var tr = ConfigProviderService.getSsffTrackConfig(cur.trackName);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            col.values[cur.sampleBlockIdx][cur.sampleIdx] = cur.oldValue;\n          } else {\n            viewState.historyActionTxt = 'REDO: SSFF manipulation';\n            var tr = ConfigProviderService.getSsffTrackConfig(cur.trackName);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            col.values[cur.sampleBlockIdx][cur.sampleIdx] = cur.newValue;\n          }\n        } else if (cur.type === 'ANNOT') {\n          switch (cur.action) {\n          case 'MOVEBOUNDARY':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: MOVEBOUNDARY';\n              LevelService.moveBoundary(cur.name, cur.id, -cur.movedBy, cur.isFirst, cur.isLast);\n            } else {\n              viewState.historyActionTxt = 'REDO: MOVEBOUNDARY';\n              LevelService.moveBoundary(cur.name, cur.id, cur.movedBy, cur.isFirst, cur.isLast);\n            }\n            break;\n          case 'MOVESEGMENT':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: MOVESEGMENT';\n              LevelService.moveSegment(cur.name, cur.id, cur.length, -cur.movedBy);\n            } else {\n              viewState.historyActionTxt = 'REDO: MOVESEGMENT';\n              LevelService.moveSegment(cur.name, cur.id, cur.length, cur.movedBy);\n            }\n            break;\n          case 'MOVEEVENT':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: MOVEEVENT';\n              LevelService.moveEvent(cur.name, cur.id, -cur.movedBy);\n            } else {\n              viewState.historyActionTxt = 'REDO: MOVEEVENT';\n              LevelService.moveEvent(cur.name, cur.id, cur.movedBy);\n            }\n            break;\n          case 'RENAMELABEL':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: RENAMELABEL';\n              LevelService.renameLabel(cur.name, cur.id, cur.attrIndex, cur.oldValue);\n            } else {\n              viewState.historyActionTxt = 'REDO: RENAMELABEL';\n              LevelService.renameLabel(cur.name, cur.id, cur.attrIndex, cur.newValue);\n            }\n            break;\n          case 'RENAMELEVEL':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: RENAMELEVEL';\n              LevelService.renameLevel(cur.newname, cur.name, cur.curPerspectiveIdx);\n            } else {\n              viewState.historyActionTxt = 'REDO: RENAMELEVEL';\n              LevelService.renameLevel(cur.name, cur.newname, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'DELETELEVEL':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETELEVEL';\n              LevelService.insertLevel(cur.level, cur.id, cur.curPerspectiveIdx);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETELEVEL';\n              LevelService.deleteLevel(cur.id, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'DELETEBOUNDARY':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETEBOUNDARY';\n              LevelService.deleteBoundaryInvers(cur.name, cur.id, cur.isFirst, cur.isLast, cur.deletedSegment);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETEBOUNDARY';\n              LevelService.deleteBoundary(cur.name, cur.id, cur.isFirst, cur.isLast);\n            }\n            break;\n          case 'DELETESEGMENTS':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETESEGMENTS';\n              LevelService.deleteSegmentsInvers(cur.name, cur.id, cur.length, cur.deletedSegment);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETESEGMENTS';\n              LevelService.deleteSegments(cur.name, cur.id, cur.length);\n            }\n            break;\n          case 'DELETEEVENT':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETEEVENT';\n              LevelService.insertEvent(cur.name, cur.start, cur.pointName, cur.id);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETEEVENT';\n              LevelService.deleteEvent(cur.name, cur.id);\n            }\n            break;\n          case 'DELETELINKSTO':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETELINKSTO';\n              LinkService.insertLinksTo(cur.deletedLinks);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETELINKSTO';\n              LinkService.deleteLinksTo(cur.id);\n            }\n            break;\n          case 'DELETELINKBOUNDARY':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETELINKBOUNDARY';\n              LinkService.deleteLinkBoundaryInvers(cur.deletedLinks);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETELINKBOUNDARY';\n              LinkService.deleteLinkBoundary(cur.id, cur.neighbourId);\n            }\n            break;\n          case 'DELETELINKSEGMENT':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETELINKSEGMENT';\n              LinkService.deleteLinkSegmentInvers(cur.deletedLinks);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETELINKSEGMENT';\n              LinkService.deleteLinkSegment(cur.segments);\n            }\n            break;\n          case 'INSERTLEVEL':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: INSERTLEVEL';\n              LevelService.deleteLevel(cur.id, cur.curPerspectiveIdx);\n            } else {\n              viewState.historyActionTxt = 'REDO: INSERTLEVEL';\n              LevelService.insertLevel(cur.level, cur.id, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'INSERTSEGMENTS':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: INSERTSEGMENTS';\n              LevelService.insertSegmentInvers(cur.name, cur.start, cur.end, cur.segName);\n            } else {\n              viewState.historyActionTxt = 'REDO: INSERTSEGMENTS';\n              LevelService.insertSegment(cur.name, cur.start, cur.end, cur.segName, cur.ids);\n            }\n            break;\n          case 'INSERTEVENT':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: INSERTEVENT';\n              LevelService.deleteEvent(cur.name, cur.id);\n            } else {\n              viewState.historyActionTxt = 'REDO: INSERTEVENT';\n              LevelService.insertEvent(cur.name, cur.start, cur.pointName, cur.id);\n            }\n            break;\n          case 'INSERTLINKSTO':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: INSERTLINKSTO';\n              LinkService.deleteLinksTo(cur.parentID, cur.childIDs);\n            } else {\n              viewState.historyActionTxt = 'REDO: INSERTLINKSTO';\n              LinkService.insertLinksTo(cur.parentID, cur.childIDs);\n            }\n            break;\n          case 'EXPANDSEGMENTS':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: EXPANDSEGMENTS';\n              LevelService.expandSegment(cur.rightSide, cur.item, cur.name, -cur.changeTime);\n            } else {\n              viewState.historyActionTxt = 'REDO: EXPANDSEGMENTS';\n              LevelService.expandSegment(cur.rightSide, cur.item, cur.name, cur.changeTime);\n            }\n            break;\n          }\n        }\n      });\n    }\n    /////////////////////////////////////\n    // public API\n    /**\n\t\t *\n\t\t */\n    sServObj.updateCurChangeObj = function (dataObj) {\n      // console.log(dataObj);\n      var dataKey;\n      if (dataObj.type === 'SSFF') {\n        dataKey = String(dataObj.type + '#' + dataObj.trackName) + '#' + String(dataObj.sampleBlockIdx) + '#' + String(dataObj.sampleIdx);\n        // update curChangeObj\n        if (!curChangeObj[dataKey]) {\n          curChangeObj[dataKey] = dataObj;\n        } else {\n          dataObj.oldValue = curChangeObj[dataKey].oldValue;\n          curChangeObj[dataKey] = dataObj;\n        }\n      } else if (dataObj.type === 'ANNOT') {\n        switch (dataObj.action) {\n        case 'MOVEBOUNDARY':\n        case 'MOVEEVENT':\n        case 'MOVESEGMENT':\n          dataKey = String(dataObj.type + '#' + dataObj.action + '#' + dataObj.name + '#' + dataObj.id);\n          if (!curChangeObj[dataKey]) {\n            curChangeObj[dataKey] = dataObj;\n          } else {\n            dataObj.movedBy += curChangeObj[dataKey].movedBy;\n            curChangeObj[dataKey] = dataObj;\n          }\n          break;\n        case 'INSERTLINKSTO':\n        case 'DELETELINKSTO':\n        case 'DELETELINKBOUNDARY':\n        case 'DELETELINKSEGMENT':\n        case 'DELETEBOUNDARY':\n        case 'DELETESEGMENTS':\n        case 'DELETEEVENT':\n          dataKey = String(dataObj.type + '#' + dataObj.action + '#' + dataObj.name);\n          if (!curChangeObj[dataKey]) {\n            curChangeObj[dataKey] = dataObj;\n          } else {\n            dataObj.oldValue = curChangeObj[dataKey].oldValue;\n            curChangeObj[dataKey] = dataObj;\n          }\n          break;\n        }\n      }\n      return curChangeObj;\n    };\n    // addCurChangeObjToUndoStack\n    sServObj.addCurChangeObjToUndoStack = function () {\n      // empty redo stack\n      redoStack = [];\n      // add to undoStack\n      if (!$.isEmptyObject(curChangeObj)) {\n        undoStack.push(curChangeObj);\n        sServObj.movesAwayFromLastSave += 1;\n      }\n      $log.info(curChangeObj);\n      // reset curChangeObj\n      curChangeObj = {};\n    };\n    // addCurChangeObjToUndoStack\n    sServObj.addObjToUndoStack = function (obj) {\n      // empty redo stack\n      redoStack = [];\n      var tmpObj = {};\n      var dataKey = String(obj.type + '#' + obj.action + '#' + obj.name + '#' + obj.id);\n      tmpObj[dataKey] = angular.copy(obj);\n      // add to undoStack\n      if (!$.isEmptyObject(tmpObj)) {\n        undoStack.push(tmpObj);\n        sServObj.movesAwayFromLastSave += 1;\n      }\n      // reset curChangeObj\n      curChangeObj = {};\n    };\n    // undo\n    sServObj.undo = function () {\n      if (undoStack.length > 0) {\n        // add to redo stack\n        var oldChangeObj = angular.copy(undoStack[undoStack.length - 1]);\n        redoStack.push(oldChangeObj);\n        applyChange(oldChangeObj, true);\n        // remove old \n        undoStack.pop();\n        sServObj.movesAwayFromLastSave -= 1;\n      }\n    };\n    // redo\n    sServObj.redo = function () {\n      if (redoStack.length > 0) {\n        var oldChangeObj = angular.copy(redoStack[redoStack.length - 1]);\n        undoStack.push(oldChangeObj);\n        applyChange(oldChangeObj, false);\n        redoStack.pop();\n        sServObj.movesAwayFromLastSave += 1;\n      }\n    };\n    // getNrOfPossibleUndos\n    sServObj.getNrOfPossibleUndos = function () {\n      return undoStack.length;\n    };\n    // return current History Stack\n    sServObj.getCurrentStack = function () {\n      return {\n        'undo': undoStack,\n        'redo': redoStack\n      };\n    };\n    // resetToInitState\n    sServObj.resetToInitState = function () {\n      undoStack = [];\n      redoStack = [];\n      curChangeObj = {};\n      sServObj.movesAwayFromLastSave = 0;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Wavparserservice', [\n  '$q',\n  function Wavparserservice($q) {\n    // shared service object\n    var sServObj = {};\n    var worker = new wavParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e.data);\n      }\n    });\n    /**\n\t\t * parse buffer containing wav file using webworker\n\t\t * @param buf\n\t\t * @returns promise\n\t\t */\n    sServObj.parseWavArrBuf = function (buf) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseBuf',\n        'buffer': buf\n      });\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Textgridparserservice', [\n  '$q',\n  'DataService',\n  'viewState',\n  'Soundhandlerservice',\n  function Textgridparserservice($q, DataService, viewState, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    var worker = new textGridParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e.data);\n      }\n    }, false);\n    /**\n\t\t * parse level data to Textgrid File\n\t\t * @param level data\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncToTextGrid = function () {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'toTextGrid',\n        'levels': DataService.getData().levels,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'buffLength': Soundhandlerservice.wavJSO.Data.length\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * parse array of ssff file using webworker\n\t\t * @param array of ssff files encoded as base64 stings\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseTextGrid = function (textGrid, annotates, name) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseTG',\n        'textGrid': textGrid,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'annotates': annotates,\n        'name': name\n      });\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').factory('uuid', function () {\n  // shared service object\n  var sServObj = {};\n  function rand(s) {\n    var p = (Math.random().toString(16) + '000000000').substr(2, 8);\n    return s ? '-' + p.substr(0, 4) + '-' + p.substr(4, 4) : p;\n  }\n  //\n  sServObj.new = function () {\n    return rand() + rand(true) + rand(true) + rand();\n  };\n  sServObj.newHash = function () {\n    return rand() + rand(true) + rand(true) + rand();\n  };\n  //\n  sServObj.empty = function () {\n    return '00000000-0000-0000-0000-000000000000';\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').factory('browserDetector', function () {\n  //shared service object to be returned\n  var sServObj = {};\n  sServObj.isMobile = {\n    Android: function () {\n      return navigator.userAgent.match(/Android/i);\n    },\n    BlackBerry: function () {\n      return navigator.userAgent.match(/BlackBerry/i);\n    },\n    iOS: function () {\n      return navigator.userAgent.match(/iPhone|iPad|iPod/i);\n    },\n    Opera: function () {\n      return navigator.userAgent.match(/Opera Mini/i);\n    },\n    Windows: function () {\n      return navigator.userAgent.match(/IEMobile/i);\n    },\n    any: function () {\n      return sServObj.isMobile.Android() || sServObj.isMobile.BlackBerry() || sServObj.isMobile.iOS() || sServObj.isMobile.Opera() || sServObj.isMobile.Windows();\n    }\n  };\n  sServObj.isBrowser = {\n    Firefox: function () {\n      return navigator.userAgent.match(/Firefox/i);\n    },\n    Chrome: function () {\n      return navigator.userAgent.match(/Chrome/i);\n    },\n    InternetExplorer: function () {\n      return navigator.userAgent.match(/MSIE/i);\n    },\n    Opera: function () {\n      return navigator.userAgent.match(/Opera/i);\n    },\n    PhantomJS: function () {\n      return navigator.userAgent.match(/PhantomJS/i);\n    },\n    any: function () {\n      return sServObj.isBrowser.Firefox() || sServObj.isBrowser.Chrome() || sServObj.isBrowser.InternetExplorer() || sServObj.isBrowser.Opera() || sServObj.isBrowser.PhantomJS();\n    }\n  };\n  sServObj.isMobileDevice = function () {\n    var data = sServObj.isMobile.any();\n    if (data === null) {\n      return false;\n    } else {\n      if (data.length > 0) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  };\n  sServObj.isDesktopDevice = function () {\n    var data = sServObj.isBrowser.any();\n    if (data === null) {\n      return false;\n    } else {\n      if (data.length > 0) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('fontScaleService', function fontScaleService() {\n  // shared service object\n  var sServObj = {};\n  sServObj.lastTextWidth = null;\n  sServObj.spaceTop = 0;\n  /**\n\t\t *\n\t\t */\n  sServObj.getTextImage = function (ctxOriginal, text, fontPxSize, fontType, color) {\n    var scaleY = ctxOriginal.canvas.height / ctxOriginal.canvas.offsetHeight;\n    var scaleX = ctxOriginal.canvas.width / ctxOriginal.canvas.offsetWidth;\n    fontPxSize = Math.floor(fontPxSize + 2 - scaleY / 2);\n    var img = document.createElement('canvas');\n    img.setAttribute('width', Math.round(scaleX * 200));\n    img.setAttribute('height', Math.round(scaleY * 100));\n    var ctx = img.getContext('2d');\n    ctx.save();\n    ctx.font = fontPxSize + 'px' + ' ' + fontType;\n    ctx.fillStyle = color;\n    ctx.scale(scaleX, scaleY);\n    ctx.fillText(text, 0, fontPxSize + sServObj.spaceTop);\n    sServObj.lastTextWidth = ctx.measureText(text).width * scaleX;\n    // draw frame to see size\n    ctx.restore();\n    // ctx.fillStyle = \"red\";\n    // ctx.strokeStyle = \"red\";\n    // ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    // ctx.stroke();\n    return img;\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.getLastImageWidth = function () {\n    return sServObj.lastTextWidth;\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.getTextImageTwoLines = function (ctxOriginal, text, text2, fontPxSize, fontType, color, alignLeft) {\n    var scaleY = ctxOriginal.canvas.height / ctxOriginal.canvas.offsetHeight;\n    var scaleX = ctxOriginal.canvas.width / ctxOriginal.canvas.offsetWidth;\n    fontPxSize = Math.floor(fontPxSize + 2 - scaleY / 2);\n    var img = document.createElement('canvas');\n    img.setAttribute('width', Math.round(scaleX * 200));\n    img.setAttribute('height', Math.round(scaleY * 100));\n    var ctx = img.getContext('2d');\n    ctx.save();\n    ctx.font = fontPxSize + 'px' + ' ' + fontType;\n    ctx.fillStyle = color;\n    ctx.scale(scaleX, scaleY);\n    sServObj.lastTextWidth = ctx.measureText(text).width * scaleX;\n    if (alignLeft) {\n      ctx.fillText(text, 0, fontPxSize + sServObj.spaceTop);\n      ctx.fillText(text2, 0, 2 * fontPxSize + sServObj.spaceTop);\n    } else {\n      var a = ctx.measureText(text).width;\n      var b = ctx.measureText(text2).width;\n      // var c;\n      if (a > b) {\n        ctx.fillText(text, 0, fontPxSize + sServObj.spaceTop);\n        ctx.fillText(text2, a - b, 2 * fontPxSize + sServObj.spaceTop);\n      } else {\n        ctx.fillText(text, b - a, fontPxSize + sServObj.spaceTop);\n        ctx.fillText(text2, 0, 2 * fontPxSize + sServObj.spaceTop);\n      }\n    }\n    // draw frame to see size\n    ctx.restore();\n    // ctx.fillStyle = 'red';\n    // ctx.strokeStyle = 'red';\n    // ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    // ctx.stroke();\n    return img;\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('Espsparserservice', [\n  '$q',\n  'LevelService',\n  'Soundhandlerservice',\n  function Espsparserservice($q, LevelService, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    var worker = new espsParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e.data);\n      }\n    }, false);\n    /**\n\t\t * parse ESPS file using webworker\n\t\t * @param esps\n\t\t * @param annotates\n\t\t * @param name\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseEsps = function (esps, annotates, name) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseESPS',\n        'esps': esps,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'annotates': annotates,\n        'name': name\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * parse JSO data to ESPS file using webworker\n\t\t * @param name\n\t\t * @param sampleRate\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseJSO = function (name) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseJSO',\n        'level': LevelService.getLevelDetails(name).level,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate\n      });\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('LoginCtrl', [\n  '$scope',\n  '$rootScope',\n  '$http',\n  'ConfigProviderService',\n  'Iohandlerservice',\n  'viewState',\n  'dialogService',\n  function ($scope, $rootScope, $http, ConfigProviderService, Iohandlerservice, viewState, dialogService) {\n    $scope.loginData = {\n      'username': '',\n      'password': '',\n      'errorMsg': ''\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.tryLogin = function () {\n      Iohandlerservice.logOnUser($scope.loginData.username, $scope.loginData.password).then(function (res) {\n        if (res === 'LOGGEDON') {\n          dialogService.close(true);\n        } else {\n          $scope.loginData.errorMsg = 'ERROR: ' + res;\n        }\n      });\n    };\n    // FOR DEVELOPMENT\n    // $scope.tryLogin(); // for autologin uncomment and set username + password\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cancel = function () {\n      dialogService.close(false);\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Ssffdataservice', [\n  'viewState',\n  'Soundhandlerservice',\n  function Ssffdataservice(viewState, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    sServObj.data = [];\n    /**\n\t\t *\n\t\t */\n    sServObj.getColumnOfTrack = function (trackName, columnName) {\n      var res;\n      sServObj.data.forEach(function (tr) {\n        if (tr.ssffTrackName === trackName) {\n          tr.Columns.forEach(function (col) {\n            if (col.name === columnName) {\n              res = col;\n            }\n          });\n        }\n      });\n      if (res !== undefined) {\n        return res;\n      } else {\n        alert('could not getColumnOfTrack of trackname: ' + trackName);\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSampleRateAndStartTimeOfTrack = function (trackName) {\n      var res = {};\n      sServObj.data.forEach(function (tr) {\n        if (tr.ssffTrackName === trackName) {\n          res.sampleRate = tr.sampleRate;\n          res.startTime = tr.startTime;\n        }\n      });\n      if (res !== undefined) {\n        return res;\n      } else {\n        alert('could not getSampleRateAndStartTimeOfTrack of trackname: ' + trackName);\n      }\n    };\n    /**\n\t\t * calculates the closest audio sample of\n\t\t * the passed in column sample nr\n\t\t */\n    sServObj.calculateSamplePosInVP = function (colSampleNr, sampleRate, startTime) {\n      var sampleTime = colSampleNr / sampleRate + startTime;\n      var audioSample = Math.round(sampleTime * Soundhandlerservice.wavJSO.SampleRate);\n      return audioSample;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('DataService', function DataService() {\n  // shared service object\n  var sServObj = {};\n  sServObj.data = {};\n  sServObj.maxItemID = 0;\n  ///////////////////////////////\n  // public api\n  /**\n\t\t * returns all the data\n\t\t * @return the data\n\t\t */\n  sServObj.getData = function () {\n    return sServObj.data;\n  };\n  /**\n\t\t * sets all the level data\n\t\t * @param data containing all level data\n\t\t */\n  sServObj.setLevelData = function (data) {\n    sServObj.data.levels = data;\n  };\n  /**\n\t\t * returns all the level data\n\t\t * @return data containing all level data\n\t\t */\n  sServObj.getLevelData = function () {\n    return sServObj.data.levels;\n  };\n  /**\n\t\t * returns a specific level at given position\n\t\t * @param position of the level in the level array\n\t\t */\n  sServObj.getLevelDataAt = function (position) {\n    return sServObj.data.levels[position];\n  };\n  /**\n\t\t * inserts a single level into level data at a given position\n\t\t * @param position of the level in the level array\n\t\t * @param newLevel the new level to insert\n\t\t */\n  sServObj.insertLevelDataAt = function (position, newLevel) {\n    sServObj.data.levels.splice(position, 0, newLevel);\n  };\n  /**\n\t\t * deletes a single level from level data at a given position\n\t\t * @param position of the level in the level array\n\t\t */\n  sServObj.deleteLevelDataAt = function (position) {\n    sServObj.data.levels.splice(position, 1);\n  };\n  /**\n\t\t * returns all the link data\n\t\t * @return the data\n\t\t */\n  sServObj.getLinkData = function () {\n    return sServObj.data.links;\n  };\n  /**\n\t\t * sets all the link data\n\t\t * @param data containing all link data\n\t\t */\n  sServObj.setLinkData = function (data) {\n    sServObj.data.links = data;\n  };\n  /**\n\t\t * inserts a single link into link data by pushing it\n\t\t * on to the array\n\t\t * @param newLink the new link to insert\n\t\t */\n  sServObj.insertLinkData = function (newLink) {\n    sServObj.data.links.push(newLink);\n  };\n  /**\n\t\t * deletes a single link from link data at a given position\n\t\t * @param position of the link in the link array\n\t\t */\n  sServObj.deleteLinkDataAt = function (position) {\n    sServObj.data.links.splice(position, 1);\n  };\n  /**\n\t\t * inserts a single link into link data at a given position\n\t\t * @param position of the link in the link array\n\t\t * @param newLink the new link to insert\n\t\t */\n  sServObj.insertLinkDataAt = function (position, newLink) {\n    sServObj.data.links.splice(position, 0, newLink);\n  };\n  /**\n\t\t * changes a single link at a given position with new data\n\t\t * @param position of the link in the link array\n\t\t * @param fromNewID the new fromID of the link\n\t\t * @param toNewID the new toID of the link\n\t\t */\n  sServObj.changeLinkDataAt = function (position, fromNewID, toNewID) {\n    sServObj.data.links[position].fromID = fromNewID;\n    sServObj.data.links[position].toID = toNewID;\n  };\n  /**\n\t\t * sets annotation data and sets maxItemID \n\t\t * by parsing id in elements\n\t\t * should be used to fill links and levels\t\t \n\t\t * @param the data\n\t\t */\n  sServObj.setData = function (data) {\n    angular.copy(data, sServObj.data);\n    angular.forEach(sServObj.data.levels, function (level) {\n      level.items.forEach(function (item) {\n        if (item.id > sServObj.maxItemID) {\n          sServObj.maxItemID = item.id;\n        }\n      });\n    });\n  };\n  /**\n\t\t * called externally by functions\n\t\t */\n  sServObj.getNewId = function () {\n    sServObj.maxItemID += 1;\n    return sServObj.maxItemID;\n  };\n  /**\n\t\t * called internally by functions\n\t\t */\n  sServObj.raiseId = function (amount) {\n    sServObj.maxItemID += amount;\n  };\n  /**\n\t\t * called internally by functions\n\t\t */\n  sServObj.lowerId = function (amount) {\n    sServObj.maxItemID -= amount;\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('LevelService', [\n  '$q',\n  'DataService',\n  'LinkService',\n  'ConfigProviderService',\n  'Soundhandlerservice',\n  'viewState',\n  'Ssffdataservice',\n  'ArrayHelperService',\n  function LevelService($q, DataService, LinkService, ConfigProviderService, Soundhandlerservice, viewState, Ssffdataservice, ArrayHelperService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.lasteditArea = null;\n    // holding current edit area\n    sServObj.lasteditAreaElem = null;\n    // holding current edit area element\n    /**\n\t\t * search for the according label field in labels\n\t\t * and return its index\n\t\t *    @param attrDefName\n\t\t *    @param labels\n\t\t */\n    function getLabelIdx(attrDefName, labels) {\n      var labelIdx;\n      angular.forEach(labels, function (l, idx) {\n        if (l.name === attrDefName) {\n          labelIdx = idx;\n        }\n      });\n      return labelIdx;\n    }\n    /**\n\t\t * returns level details (level object and sorting id) by passing in level Name\n\t\t */\n    sServObj.getLevelDetails = function (name) {\n      var curLevel = null;\n      var id = null;\n      angular.forEach(DataService.getLevelData(), function (level, num) {\n        if (level.name === name) {\n          curLevel = level;\n          id = num;\n        }\n      });\n      return {\n        level: curLevel,\n        id: id\n      };\n    };\n    /**\n\t\t * returns level details (level object and sorting id) by passing in level Name\n\t\t */\n    sServObj.getLevelsByType = function (types) {\n      var levels = [];\n      angular.forEach(DataService.getLevelData(), function (level, num) {\n        var t = level.type;\n        if (types.indexOf(t) >= 0) {\n          levels.push(level);\n        }\n      });\n      return levels;\n    };\n    /**\n\t\t * gets element order by passing in elemtent id\n\t\t */\n    sServObj.getOrderById = function (name, eid) {\n      var ret = undefined;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (e, num) {\n            if (e.id === eid) {\n              ret = num;\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * gets element id by passing in element order\n\t\t */\n    sServObj.getIdByOrder = function (name, order) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (num == order) {\n              ret = element.id;\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * gets item details by passing in levelName and item order\n\t\t */\n    sServObj.getItemDetails = function (name, order) {\n      var details = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (num == order) {\n              details = element;\n            }\n          });\n        }\n      });\n      return details;\n    };\n    /**\n\t\t * gets element details by passing in levelName and elemtent order\n\t\t */\n    sServObj.getLastItem = function (name) {\n      var details = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          details = level.items[level.items.length - 1];\n        }\n      });\n      return details;\n    };\n    /**\n\t\t * get next Element in order\n\t\t */\n    sServObj.getNextItem = function (name, id) {\n      var details = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (element.id == id) {\n              details = level.items[num + 1];\n            }\n          });\n        }\n      });\n      return details;\n    };\n    /**\n\t\t * gets item from leve by passing in levelName and item id\n\t\t *\n\t\t * @return item\n\t\t */\n    sServObj.getItemFromLevelById = function (levelName, id) {\n      var foundItm = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelName) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              foundItm = element;\n            }\n          });\n        }\n      });\n      return foundItm;\n    };\n    /**\n\t\t * gets item from leve by passing in levelName and item id\n\t\t *\n\t\t * @return item\n\t\t */\n    sServObj.getItemsFromLevelByIdAndLength = function (levelName, id, length) {\n      var foundItms = [];\n      var lastID = id;\n      for (var j = 0; j < length; j++) {\n        var segment = sServObj.getItemFromLevelById(levelName, lastID);\n        lastID = sServObj.getNextItem(levelName, segment.id);\n        foundItms.push(segment);\n      }\n      return foundItms;\n    };\n    /**\n\t\t * Getter for last edit Area Element\n\t\t *   @return lasteditAreaElem last edit Area Element\n\t\t */\n    sServObj.getlasteditAreaElem = function () {\n      return sServObj.lasteditAreaElem;\n    };\n    /**\n\t\t * Setter for last edit Area Element\n\t\t *   @param lasteditAreaElem last edit Area Element\n\t\t */\n    sServObj.setlasteditAreaElem = function (e) {\n      sServObj.lasteditAreaElem = e;\n    };\n    /**\n\t\t * Setter for last edit Area\n\t\t *   @param lasteditAreaElem last edit Area\n\t\t */\n    sServObj.setlasteditArea = function (name) {\n      sServObj.lasteditArea = name;\n    };\n    /**\n\t\t * Getter for last edit Area\n\t\t *   @return lasteditAreaElem last edit Area\n\t\t */\n    sServObj.getlasteditArea = function () {\n      return sServObj.lasteditArea;\n    };\n    /**\n\t\t * Getter for id of last edited Element\n\t\t *   @return lasteditAreaElem last edit Area\n\t\t */\n    sServObj.getlastID = function () {\n      return sServObj.lasteditArea.substr(1);\n    };\n    /**\n\t\t * Remove currently open html textarea (if there is a textarea open)\n\t\t * and set viewState.editing to false.\n\t\t */\n    sServObj.deleteEditArea = function () {\n      if (null !== sServObj.getlasteditArea()) {\n        $('.' + sServObj.getlasteditArea()).remove();\n      }\n      viewState.editing = false;\n    };\n    /**\n\t\t * Calculate values (x,y,width,height) for textarea to open\n\t\t * depending on the current Level type, the current canvas\n\t\t * and the current clicked Element\n\t\t *   @param lastEventClick the current clicked Level Element\n\t\t *   @param element the current html Element to get canvas from\n\t\t *   @param type the current Level type\n\t\t */\n    sServObj.openEditArea = function (lastEventClick, element, type) {\n      var levelName = viewState.getcurClickLevelName();\n      var attrDefName = viewState.getCurAttrDef(levelName);\n      // find labelIdx\n      var labelIdx = getLabelIdx(attrDefName, lastEventClick.labels);\n      var elem = element.find('canvas').context.getContext('2d');\n      var clientWidth = elem.canvas.clientWidth;\n      var clientOffset = elem.canvas.offsetLeft;\n      var top = elem.canvas.offsetTop;\n      var height = elem.canvas.clientHeight - 1;\n      var len = 10;\n      if (labelIdx !== undefined) {\n        if (lastEventClick.labels[labelIdx].value.length > 0) {\n          len = lastEventClick.labels[labelIdx].value.length * 7;\n        }\n      }\n      var editText = '';\n      if (lastEventClick.labels.length > 0) {\n        if (lastEventClick.labels[labelIdx] !== undefined) {\n          editText = lastEventClick.labels[labelIdx].value;\n        } else {\n          editText = '';\n        }\n      }\n      if (type === 'SEGMENT') {\n        var start = Math.floor(viewState.getPos(clientWidth, lastEventClick.sampleStart) + clientOffset);\n        var end = Math.ceil(viewState.getPos(clientWidth, lastEventClick.sampleStart + lastEventClick.sampleDur + 1) + clientOffset);\n        var width = end - start;\n        if (width < 2 * len) {\n          var zoom = viewState.curViewPort.eS - viewState.curViewPort.sS;\n          if (zoom <= 10) {\n            // if already zoomed in but text is still too long\n            sServObj.createEditAreaElement(element, start, top, end - start, height, lastEventClick.labels[labelIdx].value, lastEventClick.id);\n          } else {\n            viewState.zoomViewPort(true, this);\n            sServObj.openEditArea(lastEventClick, element, type);\n            return;\n          }\n        }\n        sServObj.createEditAreaElement(element, start, top, end - start, height, editText, lastEventClick.id);\n      } else {\n        var start = viewState.getPos(clientWidth, lastEventClick.samplePoint) + clientOffset - len / 2;\n        var end = viewState.getPos(clientWidth, lastEventClick.samplePoint) + clientOffset + len / 2;\n        var width = end - start;\n        if (width < 2 * len) {\n          width = 2 * len;\n        }\n        sServObj.createEditAreaElement(element, start, top, width, height, editText, lastEventClick.id);\n      }\n      sServObj.createSelection(element.find('textarea')[0], 0, editText.length);\n    };\n    /**\n\t\t * Create a Text Selection in a html Textarea\n\t\t *   @param field the textarea element\n\t\t *   @param start the starting character position as int\n\t\t *   @param end the ending character position as int\n\t\t */\n    sServObj.createSelection = function (field, start, end) {\n      if (field.createTextRange) {\n        var selRange = field.createTextRange();\n        selRange.collapse(true);\n        selRange.moveStart('character', start);\n        selRange.moveEnd('character', end);\n        selRange.select();\n      } else if (field.setSelectionRange) {\n        field.setSelectionRange(start, end);\n      } else if (field.selectionStart) {\n        field.selectionStart = start;\n        field.selectionEnd = end;\n      }\n      field.focus();\n    };\n    /**\n\t\t * create a html textarea element at given\n\t\t *   @param x the x Position\n\t\t *   @param y the y Position\n\t\t *   @param width the Width\n\t\t *   @param height the Height\n\t\t *   @param label the Text Content of the Textarea\n\t\t *   @param labelid the id of the element\n\t\t */\n    sServObj.createEditAreaElement = function (element, x, y, width, height, label, labelid) {\n      var textid = '_' + labelid;\n      element.prepend($('<textarea>').attr({\n        id: textid,\n        'class': textid + ' emuwebapp-labelEdit',\n        'ng-model': 'message',\n        'autofocus': 'true'\n      }).css({\n        'left': Math.round(x + 2) + 'px',\n        'top': Math.round(y) + 'px',\n        'width': Math.round(width) - 4 + 'px',\n        'height': Math.round(height) - 1 + 'px',\n        'padding-top': Math.round(height / 3 + 1) + 'px',\n        'overflow-x': 'hidden',\n        'overflow-y': 'hidden'\n      }).text(label));\n    };\n    /**\n\t\t * insert a new Item with id labelname start and duration at position on level\n\t\t */\n    sServObj.insertItemDetails = function (id, levelname, position, labelname, start, duration) {\n      var attrdefs = ConfigProviderService.getLevelDefinition(levelname).attributeDefinitions;\n      var curAttrDef = viewState.getCurAttrDef(levelname);\n      var newElement;\n      if (attrdefs === undefined) {\n        // ugly hack if attrdefs undefined\n        attrdefs = [];\n      }\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelname) {\n          if (level.type == 'SEGMENT') {\n            newElement = {\n              id: id,\n              sampleStart: start,\n              sampleDur: duration,\n              labels: []\n            };\n            if (attrdefs.length > 0) {\n              for (var i = 0; i < attrdefs.length; i++) {\n                if (attrdefs[i].name === curAttrDef) {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                } else {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                }\n              }\n            } else {\n              newElement.labels.push({\n                name: levelname,\n                value: labelname\n              });\n            }\n          } else if (level.type == 'EVENT') {\n            newElement = {\n              id: id,\n              samplePoint: start,\n              labels: []\n            };\n            if (attrdefs.length > 0) {\n              for (var i = 0; i < attrdefs.length; i++) {\n                if (attrdefs[i].name === curAttrDef) {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                } else {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                }\n              }\n            } else {\n              newElement.labels.push({\n                name: levelname,\n                value: labelname\n              });\n            }\n          }\n          level.items.splice(position, 0, newElement);\n        }\n      });\n    };\n    /**\n\t\t * sets element details by passing in levelName and elemtent id\n\t\t */\n    sServObj.updateSegItemInLevel = function (levelname, id, labelname, labelIdx, start, duration) {\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelname) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              if (start !== undefined) {\n                element.sampleStart = start;\n              }\n              if (duration !== undefined) {\n                element.sampleDur = duration;\n              }\n              if (labelname !== undefined) {\n                element.labels[labelIdx].value = labelname;\n              }\n            }\n          });\n        }\n      });\n    };\n    /**\n\t\t * sets element details by passing in levelName and elemtent id\n\t\t */\n    sServObj.setPointDetails = function (levelname, id, labelname, start) {\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelname) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              element.samplePoint = start;\n              element.labels[0].value = labelname;\n            }\n          });\n        }\n      });\n    };\n    /**\n\t\t * gets item details by passing in levelName and item id's\n\t\t */\n    sServObj.getItemNeighboursFromLevel = function (levelName, firstid, lastid) {\n      var left = undefined;\n      var right = undefined;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelName) {\n          level.items.forEach(function (itm, num) {\n            if (itm.id == firstid) {\n              left = level.items[num - 1];\n            }\n            if (itm.id == lastid) {\n              right = level.items[num + 1];\n            }\n          });\n        }\n      });\n      return {\n        left: left,\n        right: right\n      };\n    };\n    /**\n\t\t * get item details by passing in level, sampleNr and maximum pcm\n\t\t *\n\t\t * @param level\n\t\t * @param sampleNr\n\t\t * @param maximum \n\t\t * @returns object of the form {current: item, nearest: item, isFirst: boolean, isLast: boolean} where \n\t\t * - current is the actual item where the mouse is\n\t\t * - nearest is the item next to the current one depending on where the mouse is (ie if over 50% right element, under 50% left element)\n\t\t * - isFirst is true if the mouse is before the first item\n\t\t * - isLast is true if the mouse is after the last item\n\t\t *          \n\t\t */\n    sServObj.getClosestItem = function (sampleNr, levelname, maximum) {\n      var level = sServObj.getLevelDetails(levelname).level;\n      var current = undefined;\n      var nearest = undefined;\n      var isFirst = undefined;\n      var isLast = undefined;\n      if (level.items.length > 0) {\n        current = nearest = level.items[0];\n        isFirst = true;\n        isLast = false;\n        if (level.type === 'SEGMENT') {\n          angular.forEach(level.items, function (itm, index) {\n            if (sampleNr >= itm.sampleStart - 0.5) {\n              // 0.5 sample correction\n              if (sampleNr <= itm.sampleStart + itm.sampleDur + 0.5) {\n                // 0.5 sample correction\n                if (sampleNr - itm.sampleStart >= itm.sampleDur / 2) {\n                  if (level.items[index + 1] !== undefined) {\n                    current = level.items[index];\n                    nearest = level.items[index + 1];\n                    isLast = false;\n                  } else {\n                    isLast = true;\n                    current = nearest = level.items[level.items.length - 1];\n                  }\n                } else {\n                  isLast = false;\n                  current = nearest = level.items[index];\n                }\n              }\n              isFirst = false;\n            }\n            if (sampleNr >= itm.sampleStart - 0.5) {\n              if (sampleNr <= itm.sampleStart + itm.sampleDur + 0.5) {\n                // 0.5 sample correction\n                current = itm;\n              } else {\n                isLast = true;\n                current = nearest = level.items[level.items.length - 1];\n              }\n            }\n          });\n        } else {\n          var spaceLower = 0;\n          var spaceHigher = 0;\n          isFirst = false;\n          isLast = false;\n          angular.forEach(level.items, function (evt, index) {\n            if (index < level.items.length - 1) {\n              spaceHigher = evt.samplePoint + (level.items[index + 1].samplePoint - level.items[index].samplePoint) / 2;\n            } else {\n              spaceHigher = maximum;\n            }\n            if (index > 0) {\n              spaceLower = evt.samplePoint - (level.items[index].samplePoint - level.items[index - 1].samplePoint) / 2;\n            } else {\n              spaceLower = 0;\n            }\n            if (sampleNr <= spaceHigher && sampleNr >= spaceLower) {\n              current = nearest = evt;\n            }\n          });\n        }\n      }\n      return {\n        current: current,\n        nearest: nearest,\n        isFirst: isFirst,\n        isLast: isLast\n      };\n    };\n    /**\n\t\t * deletes a level by its name\n\t\t */\n    sServObj.deleteLevel = function (levelIndex, curPerspectiveIdx) {\n      var lvl = DataService.getLevelDataAt(levelIndex);\n      DataService.deleteLevelDataAt(levelIndex);\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.splice(levelIndex, 1);\n      return lvl;\n    };\n    /**\n\t\t * adds a level by its name\n\t\t */\n    sServObj.insertLevel = function (originalLevel, levelIndex, curPerspectiveIdx) {\n      if (DataService.getLevelData() === undefined) {\n        DataService.setLevelData([]);\n      }\n      DataService.insertLevelDataAt(levelIndex, originalLevel);\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.splice(levelIndex, 0, originalLevel.name);\n    };\n    /**\n\t\t * rename the label of an element by passing in level name and id\n\t\t */\n    sServObj.renameLabel = function (levelName, id, attrIndex, newLabelName) {\n      sServObj.updateSegItemInLevel(levelName, id, newLabelName, attrIndex);\n    };\n    /**\n\t\t * rename the label of a level by passing in level name and id\n\t\t */\n    sServObj.renameLevel = function (oldname, newname, curPerspectiveIdx) {\n      //rename level name\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === oldname) {\n          level.name = newname;\n          // rename all first label names to match new \n          angular.forEach(level.items, function (item) {\n            item.labels[0].name = newname;\n          });\n        }\n      });\n      // update order name as well\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order[ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.indexOf(oldname)] = newname;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteSegmentsInvers = function (name, id, length, deletedSegment) {\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx;\n      var x, insertPoint;\n      insertPoint = 0;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          insertPoint = deletedSegment.order;\n          for (x in deletedSegment.segments) {\n            level.items.splice(insertPoint++, 0, deletedSegment.segments[x]);\n          }\n        }\n      });\n      var lastNeighbours = sServObj.getItemNeighboursFromLevel(name, deletedSegment.segments[0].id, deletedSegment.segments[deletedSegment.segments.length - 1].id);\n      if (lastNeighbours.left !== undefined && lastNeighbours.right === undefined) {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.left.labels);\n        sServObj.updateSegItemInLevel(name, lastNeighbours.left.id, lastNeighbours.left.labels[labelIdx].value, labelIdx, lastNeighbours.left.sampleStart, lastNeighbours.left.sampleDur - deletedSegment.timeRight);\n      } else if (lastNeighbours.left === undefined && lastNeighbours.right !== undefined) {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.right.labels);\n        sServObj.updateSegItemInLevel(name, lastNeighbours.right.id, lastNeighbours.right.labels[labelIdx].value, labelIdx, lastNeighbours.right.sampleStart + deletedSegment.timeLeft, lastNeighbours.right.sampleDur - deletedSegment.timeLeft);\n      } else if (lastNeighbours.left === undefined && lastNeighbours.right === undefined) {\n      } else {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.left.labels);\n        sServObj.updateSegItemInLevel(name, lastNeighbours.left.id, lastNeighbours.left.labels[labelIdx].value, labelIdx, lastNeighbours.left.sampleStart, lastNeighbours.left.sampleDur - deletedSegment.timeLeft);\n        sServObj.updateSegItemInLevel(name, lastNeighbours.right.id, lastNeighbours.right.labels[labelIdx].value, labelIdx, lastNeighbours.right.sampleStart + deletedSegment.timeRight, lastNeighbours.right.sampleDur - deletedSegment.timeRight);\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteSegments = function (name, id, length) {\n      var firstSegment = sServObj.getItemFromLevelById(name, id);\n      var firstOrder = sServObj.getOrderById(name, id);\n      var lastSegment = sServObj.getItemDetails(name, firstOrder + length - 1);\n      var neighbours = sServObj.getItemNeighboursFromLevel(name, firstSegment.id, lastSegment.id);\n      var timeLeft = 0;\n      var timeRight = 0;\n      var deleteOrder = null;\n      var deletedSegment = null;\n      var clickSeg = null;\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, firstSegment.labels);\n      for (var i = firstOrder; i < firstOrder + length; i++) {\n        timeLeft += sServObj.getItemDetails(name, i).sampleDur + 1;\n      }\n      if (timeLeft % 2 == 0) {\n        timeLeft = timeLeft / 2;\n        timeRight = timeLeft;\n      } else {\n        timeLeft = Math.ceil(timeLeft / 2);\n        timeRight = timeLeft - 1;\n      }\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          angular.forEach(level.items, function (evt, order) {\n            if (evt.id == id) {\n              deleteOrder = order;\n              deletedSegment = level.items.splice(deleteOrder, length);\n            }\n          });\n        }\n      });\n      if (neighbours.left !== undefined && neighbours.right === undefined) {\n        sServObj.updateSegItemInLevel(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur + timeRight);\n        clickSeg = neighbours.left;\n      } else if (neighbours.left === undefined && neighbours.right !== undefined) {\n        sServObj.updateSegItemInLevel(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart - timeLeft, neighbours.right.sampleDur + timeLeft);\n        clickSeg = neighbours.right;\n      } else if (neighbours.left === undefined && neighbours.right === undefined) {\n        // nothing left to do level empty now\n        viewState.setcurMouseItem(undefined, undefined, undefined);\n      } else {\n        sServObj.updateSegItemInLevel(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur + timeLeft);\n        sServObj.updateSegItemInLevel(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart - timeRight, neighbours.right.sampleDur + timeRight);\n        clickSeg = neighbours.left;\n      }\n      return {\n        order: deleteOrder,\n        segments: deletedSegment,\n        timeLeft: timeLeft,\n        timeRight: timeRight,\n        clickSeg: clickSeg\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertSegmentInvers = function (name, start, end, newLabel) {\n      var ret = true;\n      var diff, diff2;\n      angular.forEach(DataService.getLevelData(), function (t) {\n        if (t.name === name) {\n          if (start == end) {\n            var startOrder = -1;\n            angular.forEach(t.items, function (evt, order) {\n              if (start == evt.sampleStart) {\n                startOrder = order;\n                ret = true;\n              }\n            });\n            if (ret) {\n              var diff = 0;\n              if (t.items[startOrder] !== undefined) {\n                diff = t.items[startOrder].sampleDur + 1;\n              }\n              if (t.items[startOrder - 1] !== undefined) {\n                // if not leftmost item\n                t.items[startOrder - 1].sampleDur += diff;\n              }\n              t.items.splice(startOrder, 1);\n            }\n          } else {\n            var startOrder = -1;\n            angular.forEach(t.items, function (evt, order) {\n              if (start == evt.sampleStart) {\n                startOrder = order;\n                ret = true;\n              }\n            });\n            if (ret) {\n              if (t.items[startOrder + 1] === undefined) {\n                // if rightmost item\n                t.items.splice(startOrder - 1, 2);\n              } else if (t.items[startOrder - 1] === undefined) {\n                // if leftmost item\n                t.items.splice(startOrder, 2);\n              } else {\n                // in the middle\n                diff = t.items[startOrder].sampleDur + 1;\n                diff2 = t.items[startOrder + 1].sampleDur + 1;\n                t.items[startOrder - 1].sampleDur += diff + diff2;\n                t.items.splice(startOrder, 2);\n              }\n            }\n          }\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertSegment = function (name, start, end, newLabel, ids) {\n      var ret = true;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          if (start == end) {\n            if (level.items.length == 0) {\n              // if on an empty level\n              return {\n                ret: false,\n                ids: ids\n              };\n            } else {\n              // if not on an empty level\n              if (ids === undefined) {\n                ids = [];\n                ids[0] = DataService.getNewId();\n              }\n              var startID = -1;\n              if (start < level.items[0].sampleStart) {\n                // before first segment\n                var diff = level.items[0].sampleStart - start;\n                sServObj.insertItemDetails(ids[0], name, 0, newLabel, start, diff - 1);\n              } else if (start > level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) {\n                // after last segment\n                var newStart = level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur + 1;\n                sServObj.insertItemDetails(ids[0], name, level.items.length, newLabel, newStart, start - newStart);\n              } else {\n                angular.forEach(level.items, function (evt, id) {\n                  if (start >= evt.sampleStart && start <= evt.sampleStart + evt.sampleDur) {\n                    startID = id;\n                  }\n                  if (evt.sampleStart == start) {\n                    ret = false;\n                  }\n                  if (evt.sampleStart + evt.sampleDur + 1 == start) {\n                    ret = false;\n                  }\n                });\n                if (ret) {\n                  var diff = start - level.items[startID].sampleStart - 1;\n                  sServObj.insertItemDetails(ids[0], name, startID + 1, newLabel, start, level.items[startID].sampleDur - diff - 1);\n                  level.items[startID].sampleDur = diff;\n                }\n              }\n            }\n          } else {\n            if (ids === undefined) {\n              ids = [];\n              ids[0] = DataService.getNewId();\n              ids[1] = DataService.getNewId();\n            }\n            if (level.items.length == 0) {\n              // if on an empty level\n              sServObj.insertItemDetails(ids[0], name, 0, newLabel, start, end - start - 1);\n            } else {\n              // if not on an empty level\t\t\t\t\n              if (end < level.items[0].sampleStart) {\n                // before first segment\n                var diff = level.items[0].sampleStart - end - 1;\n                var diff2 = end - start - 1;\n                sServObj.insertItemDetails(ids[0], name, 0, newLabel, end, diff);\n                sServObj.insertItemDetails(ids[1], name, 0, newLabel, start, diff2);\n              } else if (start > level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) {\n                // after last segment\n                var diff = start - (level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) - 1;\n                var diff2 = end - start - 1;\n                var len = level.items.length;\n                sServObj.insertItemDetails(ids[0], name, len, newLabel, level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur, diff);\n                sServObj.insertItemDetails(ids[1], name, len + 1, newLabel, start, diff2);\n              } else {\n                // in the middle\t\t\t\n                var startID = -1;\n                var endID = -1;\n                angular.forEach(level.items, function (evt, id) {\n                  if (start >= evt.sampleStart && start <= evt.sampleStart + evt.sampleDur) {\n                    startID = id;\n                  }\n                  if (end >= evt.sampleStart && end <= evt.sampleStart + evt.sampleDur) {\n                    endID = id;\n                  }\n                });\n                ret = startID === endID;\n                if (ret && startID !== -1) {\n                  var diff = start - level.items[startID].sampleStart - 1;\n                  var diff2 = end - start - 1;\n                  sServObj.insertItemDetails(ids[0], name, startID + 1, newLabel, start, diff2);\n                  sServObj.insertItemDetails(ids[1], name, startID + 2, newLabel, end, level.items[startID].sampleDur - diff - 1 - diff2 - 1);\n                  level.items[startID].sampleDur = diff;\n                }\n              }\n            }\n          }\n        }\n      });\n      return {\n        ret: ret,\n        ids: ids\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertEvent = function (name, start, pointName, id) {\n      var ret = false;\n      var alreadyExists = false;\n      var pos = undefined;\n      var last = undefined;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name && level.type === 'EVENT') {\n          if (level.items.length > 0) {\n            last = level.items[0].samplePoint;\n          } else {\n            last = 0;\n          }\n          angular.forEach(level.items, function (evt, order) {\n            if (Math.floor(start) === Math.floor(evt.samplePoint)) {\n              alreadyExists = true;\n            }\n            if (start > evt.samplePoint) {\n              pos = order + 1;\n            }\n          });\n        }\n      });\n      if (!alreadyExists) {\n        if (id === undefined) {\n          id = DataService.getNewId();\n        }\n        sServObj.insertItemDetails(id, name, pos, pointName, start);\n      }\n      return {\n        alreadyExists: alreadyExists,\n        id: id\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteEvent = function (name, id) {\n      var ret = false;\n      angular.forEach(DataService.getLevelData(), function (t) {\n        if (t.name === name && t.type == 'EVENT') {\n          var last = 0;\n          angular.forEach(t.items, function (evt, order) {\n            if (!ret) {\n              if (id == evt.id) {\n                ret = evt;\n                t.items.splice(order, 1);\n              }\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t *   delete a single boundary between items\n\t\t *   @param toDelete\n\t\t *   @param name\n\t\t *   @param levelType\n\t\t */\n    sServObj.deleteBoundary = function (name, id, isFirst, isLast) {\n      var toDelete = sServObj.getItemFromLevelById(name, id);\n      var last = null;\n      var retOrder = null;\n      var retEvt = null;\n      var clickSeg = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          last = level.items[0];\n          angular.forEach(level.items, function (evt, order) {\n            if (level.type === 'SEGMENT') {\n              if (toDelete.sampleStart == evt.sampleStart && toDelete.sampleDur == evt.sampleDur) {\n                if (order === 0 && isFirst) {\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = level.items[0];\n                } else if (order === level.items.length - 1 && isLast) {\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = level.items[level.items.length - 1];\n                } else {\n                  for (var i = 0; i < last.labels.length; i++) {\n                    last.labels[i].value += evt.labels[i].value;\n                  }\n                  last.sampleDur += evt.sampleDur + 1;\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = last;\n                }\n              }\n            }\n            last = evt;\n          });\n          if (clickSeg == null) {\n            clickSeg = level.items[0];\n          }\n        }\n      });\n      return {\n        order: retOrder,\n        event: retEvt,\n        clickSeg: clickSeg\n      };\n    };\n    /**\n\t\t *   restore a single boundary between items\n\t\t *   @param toDelete\n\t\t *   @param name\n\t\t *   @param levelType\n\t\t */\n    sServObj.deleteBoundaryInvers = function (name, id, isFirst, isLast, deletedSegment) {\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.splice(deletedSegment.order, 0, deletedSegment.event);\n          var oldName = deletedSegment.event.labels[0].value;\n          if (!isFirst && !isLast) {\n            oldName = level.items[deletedSegment.order - 1].labels[0].value.slice(0, level.items[deletedSegment.order - 1].labels[0].value.length - deletedSegment.event.labels[0].value.length);\n            level.items[deletedSegment.order - 1].labels[0].value = oldName;\n            level.items[deletedSegment.order - 1].sampleDur -= deletedSegment.event.sampleDur + 1;\n          }\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.snapBoundary = function (toTop, levelName, segment, neighbor, type) {\n      var neighTd;\n      var neighTdIdx;\n      var absMinDist = Infinity;\n      var absDist;\n      var minDist = undefined;\n      var sample;\n      var sampleTarget;\n      if (type == 'SEGMENT') {\n        sample = segment.sampleStart;\n      } else if (type == 'EVENT') {\n        sample = segment.samplePoint;\n      }\n      angular.forEach(DataService.getLevelData(), function (thisTd, tIdx) {\n        if (thisTd.name === levelName) {\n          if (toTop) {\n            if (tIdx >= 1) {\n              neighTd = DataService.getLevelData()[tIdx - 1];\n            } else {\n              return false;\n            }\n          } else {\n            if (tIdx < DataService.getLevelData().length - 1) {\n              neighTd = DataService.getLevelData()[tIdx + 1];\n            } else {\n              return false;\n            }\n          }\n          neighTd.items.forEach(function (itm, order) {\n            if (neighTd.type == 'SEGMENT') {\n              sampleTarget = itm.sampleStart;\n            } else if (neighTd.type == 'EVENT') {\n              sampleTarget = itm.samplePoint;\n            }\n            absDist = Math.abs(sample - sampleTarget);\n            if (absDist < absMinDist) {\n              absMinDist = absDist;\n              minDist = sampleTarget - sample;\n            }\n          });\n        }\n      });\n      if (minDist !== undefined) {\n        if (type == 'SEGMENT') {\n          this.moveBoundary(levelName, segment.id, minDist, 0);\n        } else if (type == 'EVENT') {\n          this.moveEvent(levelName, segment.id, minDist);\n        }\n        return minDist;\n      } else {\n        return false;\n      }\n    };\n    /**\n\t\t *  moves a boundary of a given segment\n\t\t *\n\t\t *  @param {string} name The name of the level in which the segment lies.\n\t\t *  @param {number} id The id of the segment.\n\t\t *  @param {number} changeTime The time to add or substract.\n\t\t *  @param {isFirst} if item is first\n\t\t *  @param {isLast} if item is last\n\t\t *\n\t\t */\n    sServObj.moveBoundary = function (levelName, id, changeTime, isFirst, isLast) {\n      var orig = sServObj.getItemFromLevelById(levelName, id);\n      var attrDefName = viewState.getCurAttrDef(levelName);\n      var labelIdx = getLabelIdx(attrDefName, orig.labels);\n      var ln = sServObj.getItemNeighboursFromLevel(levelName, id, id);\n      if (isFirst) {\n        // before first item\n        var origRight = ln.right;\n        if (origRight !== undefined) {\n          if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + changeTime < origRight.sampleStart) {\n            sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        } else {\n          if (orig.sampleStart + changeTime >= 0 && orig.sampleDur - changeTime >= 0 && orig.sampleStart + orig.sampleDur + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n            sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        }\n      } else if (isLast) {\n        // after last item\n        if (orig.sampleDur + changeTime >= 0 && orig.sampleDur + orig.sampleStart + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart, orig.sampleDur + changeTime);\n        }\n      } else {\n        if (ln.left === undefined) {\n          var origRight = ln.right;\n          if (origRight !== undefined) {\n            if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + changeTime < origRight.sampleStart) {\n              sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n            }\n          } else {\n            if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + orig.sampleDur + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n              sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n            }\n          }\n        } else {\n          var origLeft = ln.left;\n          if (origLeft.sampleDur + changeTime >= 0 && orig.sampleStart + changeTime >= 0 && orig.sampleDur - changeTime >= 0) {\n            sServObj.updateSegItemInLevel(levelName, ln.left.id, undefined, labelIdx, origLeft.sampleStart, origLeft.sampleDur + changeTime);\n            sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.moveEvent = function (name, id, changeTime) {\n      var orig = sServObj.getItemFromLevelById(name, id);\n      if (LinkService.isIntermediate(id)) {\n        var neighbour = sServObj.getItemNeighboursFromLevel(name, id, id);\n        if (orig.samplePoint + changeTime > 0 && orig.samplePoint + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          if (neighbour.left !== undefined) {\n            // if not first event\n            if (orig.samplePoint + changeTime > neighbour.left.samplePoint) {\n              if (orig.samplePoint + changeTime < neighbour.right.samplePoint) {\n                sServObj.setPointDetails(name, orig.id, orig.labels[0].value, orig.samplePoint + changeTime);\n              }\n            }\n          } else {\n            // if first event\n            if (orig.samplePoint + changeTime > 0) {\n              if (orig.samplePoint + changeTime < neighbour.right.samplePoint) {\n                sServObj.setPointDetails(name, orig.id, orig.labels[0].value, orig.samplePoint + changeTime);\n              }\n            }\n          }\n        }\n      } else {\n        if (orig.samplePoint + changeTime > 0 && orig.samplePoint + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          sServObj.setPointDetails(name, orig.id, orig.labels[0].value, orig.samplePoint + changeTime);\n        }\n        //resort Points after moving\n        angular.forEach(DataService.getLevelData(), function (t) {\n          if (t.name === name) {\n            t.items.sort(sServObj.orderPoints);\n          }\n        });\n      }\n    };\n    /**\n\t\t * reorder points on Event level after moving them. This is needed when Points are moved before or after each other\n\t\t *\n\t\t */\n    sServObj.orderPoints = function (a, b) {\n      //Compare \"a\" and \"b\" in some fashion, and return -1, 0, or 1\n      if (a.samplePoint > b.samplePoint)\n        return 1;\n      if (a.samplePoint < b.samplePoint)\n        return -1;\n      return 0;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.moveSegment = function (name, id, length, changeTime) {\n      var firstOrder = sServObj.getOrderById(name, id);\n      var firstSegment = sServObj.getItemDetails(name, firstOrder);\n      var lastSegment = sServObj.getItemDetails(name, firstOrder + length - 1);\n      var lastNeighbours = sServObj.getItemNeighboursFromLevel(name, firstSegment.id, lastSegment.id);\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, firstSegment.labels);\n      if (lastNeighbours.left === undefined && lastNeighbours.right !== undefined) {\n        var right = sServObj.getItemFromLevelById(name, lastNeighbours.right.id);\n        if (firstSegment.sampleStart + changeTime > 0 && lastNeighbours.right.sampleDur - changeTime >= 0) {\n          sServObj.updateSegItemInLevel(name, right.id, undefined, labelIdx, right.sampleStart + changeTime, right.sampleDur - changeTime);\n          for (var i = firstOrder; i < firstOrder + length; i++) {\n            var orig = sServObj.getItemDetails(name, i);\n            sServObj.updateSegItemInLevel(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n          }\n        }\n      } else if (lastNeighbours.right === undefined && lastNeighbours.left !== undefined) {\n        var left = sServObj.getItemFromLevelById(name, lastNeighbours.left.id);\n        if (lastNeighbours.left.sampleDur + changeTime >= 0) {\n          if (lastSegment.sampleStart + lastSegment.sampleDur + changeTime < Soundhandlerservice.wavJSO.Data.length) {\n            sServObj.updateSegItemInLevel(name, left.id, undefined, labelIdx, left.sampleStart, left.sampleDur + changeTime);\n            for (var i = firstOrder; i < firstOrder + length; i++) {\n              var orig = sServObj.getItemDetails(name, i);\n              sServObj.updateSegItemInLevel(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n            }\n          }\n        }\n      } else if (lastNeighbours.right !== undefined && lastNeighbours.left !== undefined) {\n        var origLeft = sServObj.getItemFromLevelById(name, lastNeighbours.left.id);\n        var origRight = sServObj.getItemFromLevelById(name, lastNeighbours.right.id);\n        if (origLeft.sampleDur + changeTime >= 0 && origRight.sampleDur - changeTime >= 0) {\n          sServObj.updateSegItemInLevel(name, origLeft.id, undefined, labelIdx, origLeft.sampleStart, origLeft.sampleDur + changeTime);\n          sServObj.updateSegItemInLevel(name, origRight.id, undefined, labelIdx, origRight.sampleStart + changeTime, origRight.sampleDur - changeTime);\n          for (var i = firstOrder; i < firstOrder + length; i++) {\n            var orig = sServObj.getItemDetails(name, i);\n            sServObj.updateSegItemInLevel(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n          }\n        }\n      } else if (lastNeighbours.right === undefined && lastNeighbours.left === undefined) {\n        var first = sServObj.getItemDetails(name, firstOrder);\n        var last = sServObj.getItemDetails(name, firstOrder + length - 1);\n        if (first.sampleStart + changeTime > 0 && last.sampleDur + last.sampleStart + changeTime < Soundhandlerservice.wavJSO.Data.length) {\n          for (var i = firstOrder; i < firstOrder + length; i++) {\n            var orig = sServObj.getItemDetails(name, i);\n            sServObj.updateSegItemInLevel(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.expandSegment = function (rightSide, segments, name, changeTime) {\n      var startTime = 0;\n      var neighbours = sServObj.getItemNeighboursFromLevel(name, segments[0].id, segments[segments.length - 1].id);\n      var segTime = changeTime * segments.length;\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, segments[0].labels);\n      var tempItem;\n      var allow = true;\n      if (rightSide) {\n        // if expand or shrink on RIGHT side\n        if (neighbours.right === undefined) {\n          // last element\n          var lastLength = segments[segments.length - 1].sampleStart + segments[segments.length - 1].sampleDur + changeTime * segments.length;\n          if (lastLength <= Soundhandlerservice.wavJSO.Data.length) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegItemInLevel(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n              startTime += changeTime;\n            });\n          }\n        } else {\n          angular.forEach(segments, function (seg) {\n            if (seg.sampleDur + 1 + changeTime < 0) {\n              allow = false;\n            }\n          });\n          if (allow && neighbours.right.sampleDur - changeTime * segments.length > 0) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegItemInLevel(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n              startTime += changeTime;\n            });\n            sServObj.updateSegItemInLevel(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart + startTime, neighbours.right.sampleDur - startTime);\n          }\n        }\n      } else {\n        // if expand or shrink on LEFT side\n        if (neighbours.left === undefined) {\n          // first element\n          var first = sServObj.getItemDetails(name, 0);\n          if (first.sampleStart + changeTime * (segments.length + 1) > 0) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegItemInLevel(name, tempItem.id, undefined, tempItem.sampleStart - changeTime, labelIdx, tempItem.sampleDur + changeTime);\n            });\n          }\n        } else {\n          angular.forEach(segments, function (seg) {\n            if (seg.sampleDur + 1 + changeTime < 0) {\n              allow = false;\n            }\n          });\n          if (allow && neighbours.left.sampleDur - changeTime * segments.length > 0) {\n            startTime = 0;\n            angular.forEach(segments, function (seg, i) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              startTime = -(segments.length - i) * changeTime;\n              sServObj.updateSegItemInLevel(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n            });\n            sServObj.updateSegItemInLevel(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur - segments.length * changeTime);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.calcDistanceToNearestZeroCrossing = function (sample) {\n      // walk right\n      var distRight = Infinity;\n      var distLeft = Infinity;\n      for (var i = sample; i < Soundhandlerservice.wavJSO.Data.length - 1; i++) {\n        if (Soundhandlerservice.wavJSO.Data[i] >= 0 && Soundhandlerservice.wavJSO.Data[i + 1] < 0 || Soundhandlerservice.wavJSO.Data[i] < 0 && Soundhandlerservice.wavJSO.Data[i + 1] >= 0) {\n          distRight = i - sample;\n          break;\n        }\n      }\n      // walk left\n      for (var i = sample; i > 1; i--) {\n        if (Soundhandlerservice.wavJSO.Data[i] >= 0 && Soundhandlerservice.wavJSO.Data[i - 1] < 0 || Soundhandlerservice.wavJSO.Data[i] < 0 && Soundhandlerservice.wavJSO.Data[i - 1] >= 0) {\n          distLeft = i - sample;\n          break;\n        }\n      }\n      var res;\n      if (Math.abs(distLeft) < Math.abs(distRight)) {\n        res = distLeft;\n      } else {\n        res = distRight + 1;\n      }\n      return res;\n    };\n    /**\n\t\t * get all labels (curAttr def applies) of a level and\n\t\t * return them as a flat array\n\t\t * @param levelName\n\t\t * @return array containing all labels (form==['x','y','z'])\n\t\t */\n    sServObj.getAllLabelsOfLevel = function (levelDetails) {\n      var curAttrDef = viewState.getCurAttrDef(levelDetails.level.name);\n      var labels = [];\n      for (var i = 0; i < levelDetails.level.items.length; i++) {\n        for (var j = 0; j < levelDetails.level.items[i].labels.length; j++) {\n          if (levelDetails.level.items[i].labels[j].name === curAttrDef) {\n            labels.push(levelDetails.level.items[i].labels[j].value);\n          }\n        }\n      }\n      return labels;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('LinkService', [\n  'DataService',\n  function LinkService(DataService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t * adds single links by pairing all childIds \n\t\t * with the parent id (form=={'fromID':fromID, 'toID':toID})\n\t\t * @param fromID father node\n\t\t * @param toID child node\n\t\t */\n    sServObj.insertLink = function (fromID, toID) {\n      DataService.insertLinkData({\n        'fromID': fromID,\n        'toID': toID\n      });\n    };\n    /**\n\t\t * adds single links to DataService\n\t\t * by pairing all childIds with the parent \n\t\t * at a given position\n\t\t * @param fromID father node\n\t\t * @param toID child node\n\t\t * @param order position of the node pair\n\t\t */\n    sServObj.insertLinkAt = function (fromID, toID, order) {\n      DataService.insertLinkDataAt(order, {\n        'fromID': fromID,\n        'toID': toID\n      });\n    };\n    /**\n\t\t * removes single link from DataService\n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLink = function (fromID, toID) {\n      var ret = -1;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.fromID === fromID && link.toID === toID) {\n          DataService.deleteLinkDataAt(linkIdx);\n          ret = linkIdx;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given link exists \n\t\t * that matches the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.linkExists = function (fromID, toID) {\n      var ret = false;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.fromID === fromID && link.toID === toID) {\n          ret = true;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given node has parents\n\t\t * @param ID node to check\n\t\t */\n    sServObj.hasParents = function (ID) {\n      var ret = false;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.toID === ID) {\n          ret = true;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given node has children\n\t\t * @param ID node to check\n\t\t */\n    sServObj.hasChildren = function (ID) {\n      var ret = false;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.fromID === ID) {\n          ret = true;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given node has parents or children\n\t\t * @param ID node to check\n\t\t */\n    sServObj.isIntermediate = function (ID) {\n      return sServObj.hasChildren(ID) || sServObj.hasParents(ID);\n    };\n    /**\n\t\t * adds multiple links to DataService\n\t\t * by pairing all childIds with the parent \n\t\t * id (form=={'fromID':fromID, 'toID':childId})\n\t\t */\n    sServObj.insertLinksTo = function (fromID, toIDs) {\n      angular.forEach(toIDs, function (toID) {\n        sServObj.insertLink(fromID, toID);\n      });\n    };\n    /**\n\t\t * removes multiple links to children from DataService\n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLinksTo = function (fromID, toIDs) {\n      var ret = [];\n      angular.forEach(toIDs, function (toID) {\n        sServObj.deleteLink(fromID, toID);\n        ret.push({\n          fromID: fromID,\n          toID: toID\n        });\n      });\n      return ret;\n    };\n    /**\n\t\t * adds multiple links to DataService\n\t\t * by pairing all parentIds with the child \n\t\t * id (form=={'fromID':fromID, 'toID':childId})\n\t\t */\n    sServObj.insertLinksFrom = function (fromIDs, toID) {\n      angular.forEach(fromIDs, function (fromID) {\n        sServObj.insertLink(fromID, toID);\n      });\n    };\n    /**\n\t\t * removes multiple links to parents from DataService\n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLinksFrom = function (fromIDs, toID) {\n      var ret = [];\n      angular.forEach(fromIDs, function (fromID) {\n        ret.push({\n          fromID: fromID,\n          toID: toID\n        });\n        sServObj.deleteLink(fromID, toID);\n      });\n      return ret;\n    };\n    /**\n\t\t * returns all links\n\t\t * that match the form {'toID':toID}\n\t\t */\n    sServObj.getLinksTo = function (toID) {\n      var ret = [];\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.toID === toID) {\n          ret.push({\n            link: link,\n            order: linkOrder\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * returns all links\n\t\t * that match the form {'toID':toID}\n\t\t */\n    sServObj.getLinksFrom = function (fromID) {\n      var ret = [];\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.fromID === fromID) {\n          ret.push({\n            link: link,\n            order: linkOrder\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * change a Link (form=={'fromID':fromID, 'toID':toID}) \n\t\t * to (to=={'fromID':fromID, 'toID':toNewID}) \n\t\t */\n    sServObj.changeLinkTo = function (fromID, toID, toNewID) {\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.fromID === fromID && link.toID === toID) {\n          DataService.changeLinkDataAt(linkOrder, fromID, toNewID);\n        }\n      });\n    };\n    /**\n\t\t * change a Link (form=={'fromID':fromID, 'toID':toID}) \n\t\t * to (to=={'fromID':fromID, 'toID':toNewID}) \n\t\t */\n    sServObj.changeLinkFrom = function (fromID, toID, fromNewID) {\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.fromID === fromID && link.toID === toID) {\n          DataService.changeLinkDataAt(linkOrder, fromNewID, toID);\n        }\n      });\n    };\n    /**\n\t\t * removes multiple links from and to ID \n\t\t */\n    sServObj.deleteLinkSegment = function (segments) {\n      var linksTo = [];\n      var linksFrom = [];\n      angular.forEach(segments, function (segment) {\n        angular.forEach(sServObj.getLinksTo(segment.id), function (found) {\n          linksTo.push({\n            fromID: found.link.fromID,\n            toID: found.link.toID\n          });\n          sServObj.deleteLink(found.link.fromID, found.link.toID);\n        });\n        angular.forEach(sServObj.getLinksFrom(segment.id), function (found) {\n          linksFrom.push({\n            fromID: found.link.fromID,\n            toID: found.link.toID\n          });\n          sServObj.deleteLink(found.link.fromID, found.link.toID);\n        });\n      });\n      return {\n        linksTo: linksTo,\n        linksFrom: linksFrom\n      };\n    };\n    /**\n\t\t * removes multiple links from and to ID \n\t\t */\n    sServObj.deleteLinkSegmentInvers = function (deleted) {\n      angular.forEach(deleted.linksTo, function (found) {\n        sServObj.insertLink(found.fromID, found.toID);\n      });\n      angular.forEach(deleted.linksFrom, function (found) {\n        sServObj.insertLink(found.fromID, found.toID);\n      });\n    };\n    /**\n\t\t * reorganizes multiple links from and to ID \n\t\t * if a boundary between two items is deleted \n\t\t */\n    sServObj.deleteLinkBoundary = function (ID, neighbourID) {\n      var linksTo = [];\n      var linksFrom = [];\n      var ord = 0;\n      if (neighbourID > 0) {\n        // if not first item\n        angular.forEach(sServObj.getLinksTo(ID), function (found) {\n          if (sServObj.linkExists(found.link.fromID, neighbourID)) {\n            ord = sServObj.deleteLink(found.link.fromID, ID);\n            linksTo.push({\n              fromID: found.link.fromID,\n              toID: ID,\n              deleted: true,\n              order: ord,\n              neighbourID: 0\n            });\n          } else {\n            sServObj.changeLinkTo(found.link.fromID, ID, neighbourID);\n            linksTo.push({\n              fromID: found.link.fromID,\n              toID: ID,\n              deleted: false,\n              order: ord,\n              neighbourID: neighbourID\n            });\n          }\n        });\n        angular.forEach(sServObj.getLinksFrom(ID), function (found) {\n          if (sServObj.linkExists(neighbourID, found.link.toID)) {\n            ord = sServObj.deleteLink(ID, found.link.toID);\n            linksFrom.push({\n              fromID: ID,\n              toID: found.link.toID,\n              deleted: true,\n              order: ord,\n              neighbourID: 0\n            });\n          } else {\n            sServObj.changeLinkFrom(ID, found.link.toID, neighbourID);\n            linksFrom.push({\n              fromID: ID,\n              toID: found.link.toID,\n              deleted: false,\n              order: ord,\n              neighbourID: neighbourID\n            });\n          }\n        });\n      } else {\n        angular.forEach(sServObj.getLinksTo(ID), function (found) {\n          ord = sServObj.deleteLink(found.link.fromID, ID);\n          linksTo.push({\n            fromID: found.link.fromID,\n            toID: ID,\n            deleted: true,\n            order: ord,\n            neighbourID: 0\n          });\n        });\n        angular.forEach(sServObj.getLinksFrom(ID), function (found) {\n          ord = sServObj.deleteLink(ID, found.link.toID);\n          linksFrom.push({\n            fromID: ID,\n            toID: found.link.toID,\n            deleted: true,\n            order: ord,\n            neighbourID: 0\n          });\n        });\n      }\n      return {\n        linksTo: linksTo,\n        linksFrom: linksFrom\n      };\n    };\n    /**\n\t\t * removes multiple links from and to ID \n\t\t */\n    sServObj.deleteLinkBoundaryInvers = function (deleted) {\n      angular.forEach(deleted.linksTo, function (found) {\n        if (found.deleted) {\n          sServObj.insertLinkAt(found.fromID, found.toID, found.order);\n        } else {\n          sServObj.changeLinkTo(found.fromID, found.neighbourID, found.toID);\n        }\n      });\n      angular.forEach(deleted.linksFrom, function (found) {\n        if (found.deleted) {\n          sServObj.insertLinkAt(found.fromID, found.toID, found.order);\n        } else {\n          sServObj.changeLinkFrom(found.neighbourID, found.toID, found.fromID);\n        }\n      });\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Websockethandler', [\n  '$q',\n  '$rootScope',\n  '$location',\n  '$timeout',\n  'HistoryService',\n  'Ssffparserservice',\n  'ConfigProviderService',\n  'viewState',\n  'Wavparserservice',\n  'Soundhandlerservice',\n  'Espsparserservice',\n  'uuid',\n  'Binarydatamaniphelper',\n  'Ssffdataservice',\n  'dialogService',\n  function Websockethandler($q, $rootScope, $location, $timeout, HistoryService, Ssffparserservice, ConfigProviderService, viewState, Wavparserservice, Soundhandlerservice, Espsparserservice, uuid, Binarydatamaniphelper, Ssffdataservice, dialogService) {\n    // shared service object\n    var sServObj = {};\n    // Keep all pending requests here until they get responses\n    var callbacks = {};\n    // Create our websocket object with the address to the websocket\n    var ws = {};\n    // empty promise object to be resolved when connection is up\n    var conPromise = {};\n    var connected = false;\n    ////////////////////////////\n    // ws function\n    // broadcast on open\n    function wsonopen(message) {\n      connected = true;\n      $rootScope.$apply(conPromise.resolve(message));\n    }\n    function wsonmessage(message) {\n      listener(angular.fromJson(message.data));\n    }\n    function wsonerror(message) {\n      // console.log(message);\n      console.error('WEBSOCKET ERROR!!!!!');\n      $rootScope.$apply(conPromise.resolve(message));\n    }\n    function wsonclose(message) {\n      console.log(message);\n      if (!message.wasClean && connected) {\n        // show no clean disconnect error\n        dialogService.open('views/error.html', 'ModalCtrl', 'A non clean diconnect to the server occurred! This probably means that the server is down. Please check the server and reconnect!').then(function () {\n          $rootScope.$broadcast('connectionDisrupted');\n        });\n      }\n      connected = false;\n      console.log('WEBSOCKET closed!!!!!');\n    }\n    function sendRequest(request) {\n      var defer = $q.defer();\n      var callbackId = getCallbackId();\n      callbacks[callbackId] = {\n        time: new Date(),\n        cb: defer\n      };\n      request.callbackID = callbackId;\n      ws.send(angular.toJson(request));\n      // timeout request if not answered\n      $timeout(function () {\n        var tOutResp = {\n            'callbackID': callbackId,\n            'status': {\n              'type': 'ERROR:TIMEOUT',\n              'message': 'Sent request of type: ' + request.type + ' timed out after ' + ConfigProviderService.vals.main.serverTimeoutInterval + 'ms!  Please check the server...'\n            }\n          };\n        listener(tOutResp);\n      }, ConfigProviderService.vals.main.serverTimeoutInterval);\n      return defer.promise;\n    }\n    function listener(data) {\n      var messageObj = data;\n      // console.log(\"Received data from websocket: \", messageObj);\n      // If an object exists with callbackID in our callbacks object, resolve it\n      if (callbacks.hasOwnProperty(messageObj.callbackID)) {\n        // console.log(callbacks[messageObj.callbackID]);\n        // console.log('resolving callback: ' + messageObj.type + ' Nr.: ' + messageObj.callbackID);\n        switch (messageObj.type) {\n        case 'getESPSfile':\n          alert('espsfile');\n          //handleReceivedESPS(messageObj.fileName, messageObj.data);\n          break;\n        case 'getSSFFfile':\n          alert('ssfffile');\n          //handleReceivedSSFF(messageObj.fileName, messageObj.data);\n          break;\n        }\n        // resolve promise with data only\n        if (messageObj.status.type === 'SUCCESS') {\n          $rootScope.$apply(callbacks[messageObj.callbackID].cb.resolve(messageObj.data));\n        } else {\n          // show protocol error and disconnect from server\n          dialogService.open('views/error.html', 'ModalCtrl', 'Communication error with server! Error message is: ' + messageObj.status.message);\n        }\n        delete callbacks[messageObj.callbackID];\n      } else {\n        if (messageObj.status.type === 'ERROR:TIMEOUT') {\n        } else {\n          dialogService.open('views/error.html', 'ModalCtrl', 'What just happened? You should not be here...');\n        }\n      }\n    }\n    // This creates a new callback ID for a request\n    function getCallbackId() {\n      var newUUID = uuid.new();\n      return newUUID;\n    }\n    ///////////////////////////////////////////\n    // public api\n    sServObj.initConnect = function (url) {\n      var defer = $q.defer();\n      ws = new WebSocket(url);\n      ws.onopen = wsonopen;\n      ws.onmessage = wsonmessage;\n      ws.onerror = wsonerror;\n      ws.onclose = wsonclose;\n      conPromise = defer;\n      return defer.promise;\n    };\n    //\n    sServObj.isConnected = function () {\n      return connected;\n    };\n    // close connection with ws\n    sServObj.closeConnect = function () {\n      ws.onclose = function () {\n      };\n      ws.close();\n    };\n    ////////////////////////////\n    // EMU-webApp protocol begins here\n    //\n    // ws getProtocol\n    sServObj.getProtocol = function () {\n      var request = { type: 'GETPROTOCOL' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getProtocol\n    sServObj.getDoUserManagement = function () {\n      var request = { type: 'GETDOUSERMANAGEMENT' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws logOnUser\n    sServObj.logOnUser = function (name, pwd) {\n      var request = {\n          type: 'LOGONUSER',\n          userName: name,\n          pwd: pwd\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getConfigFile\n    sServObj.getDBconfigFile = function () {\n      var request = { type: 'GETGLOBALDBCONFIG' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getBundleList\n    sServObj.getBundleList = function () {\n      var request = { type: 'GETBUNDLELIST' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  getBundle\n    sServObj.getBundle = function (name, session) {\n      var request = {\n          type: 'GETBUNDLE',\n          name: name,\n          session: session\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  saveBundle\n    sServObj.saveBundle = function (bundleData) {\n      var request = {\n          type: 'SAVEBUNDLE',\n          data: bundleData\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  disconnecting\n    sServObj.disconnectWarning = function () {\n      var request = { type: 'DISCONNECTWARNING' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    //\n    // EMU-webApp protocol ends here\n    ////////////////////////////\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('WsconnectionCtrl', [\n  '$scope',\n  'ConfigProviderService',\n  'Iohandlerservice',\n  'viewState',\n  'dialogService',\n  function ($scope, ConfigProviderService, Iohandlerservice, viewState, dialogService) {\n    $scope.serverInfos = {};\n    $scope.serverInfos.Url = ConfigProviderService.vals.main.serverUrl;\n    $scope.connectionError = '';\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    $scope.tryConnection = function () {\n      dialogService.close($scope.serverInfos.Url);\n    };\n    $scope.cancel = function () {\n      dialogService.close(false);\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Binarydatamaniphelper', function Binarydatamaniphelper() {\n  // shared service object\n  var sServObj = {};\n  /**\n\t\t *\n\t\t */\n  sServObj.base64ToArrayBuffer = function (stringBase64) {\n    var binaryString = window.atob(stringBase64);\n    var len = binaryString.length;\n    var bytes = new Uint8Array(len);\n    for (var i = 0; i < len; i++) {\n      var ascii = binaryString.charCodeAt(i);\n      bytes[i] = ascii;\n    }\n    return bytes.buffer;\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.arrayBufferToBase64 = function (buffer) {\n    var binary = '';\n    var bytes = new Uint8Array(buffer);\n    var len = bytes.byteLength;\n    for (var i = 0; i < len; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }\n    return window.btoa(binary);\n  };\n  /**\n\t\t *\n\t\tsServObj.stringToArrayBuffer = function (str) {\n\t\t\tvar ab = new ArrayBuffer(str.length);\n\t\t\tvar view = new Uint8Array(ab);\n\t\t\tfor (var i = 0; i < str.length; ++i) {\n\t\t\t\tview[i] = str.charCodeAt(i);\n\t\t\t}\n\t\t\treturn ab;\n\t\t};\n\t\t */\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('dialogService', [\n  '$modal',\n  'viewState',\n  function dialogService($modal, viewState) {\n    // shared service object\n    var sServObj = {};\n    var modalInstance = {};\n    /**\n\t\t *\n\t\t */\n    sServObj.open = function (templatefile, argCtrl, passedIn) {\n      viewState.setState('modalShowing');\n      modalInstance = $modal.open({\n        backdrop: 'static',\n        keyboard: false,\n        templateUrl: templatefile,\n        controller: argCtrl,\n        resolve: {\n          passedInTxt: function () {\n            return passedIn;\n          },\n          passedInOpts: function () {\n            return passedIn;\n          }\n        }\n      });\n      return modalInstance.result;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.openExport = function (templatefile, argCtrl, data, txt) {\n      viewState.setState('modalShowing');\n      modalInstance = $modal.open({\n        backdrop: 'static',\n        keyboard: false,\n        templateUrl: templatefile,\n        controller: argCtrl,\n        resolve: {\n          exportData: function () {\n            return data;\n          },\n          exportName: function () {\n            return txt;\n          }\n        }\n      });\n      return modalInstance.result;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.close = function (res) {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      modalInstance.close(res);\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Appcachehandler', [\n  '$http',\n  'dialogService',\n  function Appcachehandler($http, dialogService) {\n    // shared service object\n    var sServObj = {};\n    var appCache = window.applicationCache;\n    // var cacheProperties = {\n    // \tfilesDownloaded: 0,\n    // \ttotalFiles: 0\n    // };\n    // function getTotalFiles() {\n    // \t// First, reset the total file count and download count.\n    // \tcacheProperties.filesDownloaded = 0;\n    // \tcacheProperties.totalFiles = 0;\n    // \t$http.get('manifest.appcache').success(function (content) {\n    // \t\t// console.log(content);\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp(\n    // \t\t\t\t'(NETWORK|FALLBACK):' +\n    // \t\t\t\t'((?!(NETWORK|FALLBACK|CACHE):)[\\\\w\\\\W]*)',\n    // \t\t\t\t'gi'\n    // \t\t\t),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out all comments.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('#[^\\\\r\\\\n]*(\\\\r\\\\n?|\\\\n)', 'g'),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out the cache manifest header and\n    // \t\t// trailing slashes.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('CACHE MANIFEST\\\\s*|\\\\s*$', 'g'),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out extra line breaks and replace with\n    // \t\t// a hash sign that we can break on.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('[\\\\r\\\\n]+', 'g'),\n    // \t\t\t'#'\n    // \t\t);\n    // \t\t// Get the total number of files.\n    // \t\tvar totalFiles = content.split('#').length;\n    // \t\t// Store the total number of files. Here, we are\n    // \t\t// adding one for *THIS* file, which is cached\n    // \t\t// implicitly as it points to the manifest.\n    // \t\tcacheProperties.totalFiles = (totalFiles + 1);\n    // \t\t// console.log('##########################');\n    // \t\t// alert('INFO: appcache update of: ' + cacheProperties.totalFiles + ' files');\n    // \t});\n    // }\n    // function handleCheckingEvent(e) {\n    // \tconsole.log('###### handleCheckingEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleNoupdateEvent(e) {\n    // \tconsole.log('###### handleNoupdateEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleDownloadingEvent(e) {\n    // \tconsole.log('######## handleDownloadingEvent ##########');\n    // \tconsole.log(e);\n    // \tgetTotalFiles();\n    // }\n    // function handleProgressEvent(e) {\n    // \tconsole.log('###### handleProgressEvent ##########');\n    // \tconsole.log(e);\n    // }\n    /**\n\t\t *\n\t\t */\n    // function handleCachedEvent(e) {\n    // \tconsole.log('###### handleCachedEvent ##########');\n    // \tconsole.log(e);\n    // }\n    /**\n\t\t *\n\t\t */\n    function handleUpdatereadyEvent(e) {\n      console.log('###### handleUpdatereadyEvent ##########');\n      dialogService.open('views/confirmModal.html', 'ConfirmmodalCtrl', 'A new version of the EMU-WebApp is available and has already been downloaded and cached in your browser. Would you like to use it? CAUTION: A reload will delete all current changes... TIP: the next time you use the EMU-webApp you will automatically use the updated version)').then(function (res) {\n        if (res) {\n          appCache.swapCache();\n          window.location.reload();\n        }\n      });\n    }\n    // function handleObsoleteEvent(e) {\n    // \tconsole.log('###### handleObsoleteEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleErrorEvent(e) {\n    // \tconsole.log('###### handleErrorEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // // bind evts\n    // // appCache.addEventListener('progress', handleProgressEvent, false);\n    // appCache.addEventListener('checking', handleCheckingEvent, false);\n    // appCache.addEventListener('noupdate', handleNoupdateEvent, false);\n    // appCache.addEventListener('downloading', handleDownloadingEvent, false);\n    // appCache.addEventListener('progress', handleProgressEvent, false);\n    // appCache.addEventListener('cached', handleCachedEvent, false);\n    appCache.addEventListener('updateready', handleUpdatereadyEvent, false);\n    // appCache.addEventListener('obsolete', handleObsoleteEvent, false);\n    // appCache.addEventListener('error', handleErrorEvent, false);\n    // /////////////////////////////////////////////////\n    // // public api\n    sServObj.checkForNewVersion = function () {\n      // console.log('check for new version');\n      if (appCache.status !== 0 && appCache.status !== 3) {\n        // uncached == 0 & downloading == 3\n        console.log('INFO: appCache.status: ' + appCache.status);\n        appCache.update();\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('AboutCtrl', [\n  '$scope',\n  'ConfigProviderService',\n  'dialogService',\n  function ($scope, ConfigProviderService, dialogService) {\n    $scope.cps = ConfigProviderService;\n    $scope.getStrRep = function (code) {\n      var str;\n      switch (code) {\n      case 8:\n        str = 'BACKSPACE';\n        break;\n      case 9:\n        str = 'TAB';\n        break;\n      case 13:\n        str = 'ENTER';\n        break;\n      case 16:\n        str = 'SHIFT';\n        break;\n      case 18:\n        str = 'ALT';\n        break;\n      case 32:\n        str = 'SPACE';\n        break;\n      case 37:\n        str = '\\u2190';\n        break;\n      case 39:\n        str = '\\u2192';\n        break;\n      case 38:\n        str = '\\u2191';\n        break;\n      case 40:\n        str = '\\u2193';\n        break;\n      case 42:\n        str = '+';\n        break;\n      case 43:\n        str = '+';\n        break;\n      case 45:\n        str = '-';\n        break;\n      case 95:\n        str = '-';\n        break;\n      default:\n        str = String.fromCharCode(code);\n      }\n      return str;\n    };\n    $scope.cancel = function () {\n      dialogService.close();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('spectSettingsCtrl', [\n  '$scope',\n  'dialogService',\n  'viewState',\n  'DataService',\n  'mathHelperService',\n  'Soundhandlerservice',\n  function ($scope, dialogService, viewState, DataService, mathHelperService, Soundhandlerservice) {\n    $scope.vs = viewState;\n    $scope.options = Object.keys($scope.vs.getWindowFunctions());\n    $scope.selWindowInfo = {};\n    $scope.selWindowInfo.name = Object.keys($scope.vs.getWindowFunctions())[$scope.vs.spectroSettings.window - 1];\n    $scope.modalVals = {\n      'rangeFrom': $scope.vs.spectroSettings.rangeFrom,\n      'rangeTo': $scope.vs.spectroSettings.rangeTo,\n      'dynamicRange': $scope.vs.spectroSettings.dynamicRange,\n      'windowSizeInSecs': $scope.vs.spectroSettings.windowSizeInSecs,\n      'window': $scope.vs.spectroSettings.window,\n      'drawHeatMapColors': $scope.vs.spectroSettings.drawHeatMapColors,\n      'preEmphasisFilterFactor': $scope.vs.spectroSettings.preEmphasisFilterFactor,\n      'heatMapColorAnchors': viewState.spectroSettings.heatMapColorAnchors,\n      '_fftN': 512,\n      '_windowSizeInSamples': Soundhandlerservice.wavJSO.SampleRate * $scope.vs.spectroSettings.windowSizeInSecs\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getColorOfAnchor = function (anchorNr) {\n      var curStyle = {\n          'background-color': 'rgb(' + $scope.modalVals.heatMapColorAnchors[anchorNr][0] + ',' + $scope.modalVals.heatMapColorAnchors[anchorNr][1] + ',' + $scope.modalVals.heatMapColorAnchors[anchorNr][2] + ')',\n          'width': '10px',\n          'height': '10px'\n        };\n      return curStyle;\n    };\n    //////////////////////////\n    // window size functions\n    /**\n\t\t *\n\t\t */\n    $scope.calcWindowSizeInSamples = function () {\n      $scope.modalVals._windowSizeInSamples = Soundhandlerservice.wavJSO.SampleRate * $scope.modalVals.windowSizeInSecs;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.calcFftN = function () {\n      var fftN = mathHelperService.calcClosestPowerOf2Gt($scope.modalVals._windowSizeInSamples);\n      // fftN must be greater than 512 (leads to better resolution of spectrogram)\n      if (fftN < 512) {\n        fftN = 512;\n      }\n      console.log(fftN);\n      $scope.modalVals._fftN = fftN;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.calcWindowSizeVals = function () {\n      $scope.calcWindowSizeInSamples();\n      $scope.calcFftN();\n    };\n    //\n    ////////////////////\n    /**\n\t\t *\n\t\t */\n    $scope.cancel = function () {\n      dialogService.close(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.error = function (errorMsg) {\n      dialogService.close();\n      dialogService.open('views/error.html', 'ModalCtrl', 'Sorry: ' + errorMsg);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.saveSpectroSettings = function () {\n      if ($scope.modalVals.dynamicRange % 1 === 0) {\n        if ($scope.modalVals.rangeFrom % 1 === 0) {\n          if ($scope.modalVals.rangeTo % 1 === 0) {\n            if ($scope.modalVals.rangeFrom >= 0) {\n              if ($scope.modalVals.rangeTo <= DataService.data.sampleRate / 2) {\n                viewState.setspectroSettings($scope.modalVals.windowSizeInSecs, $scope.modalVals.rangeFrom, $scope.modalVals.rangeTo, $scope.modalVals.dynamicRange, $scope.selWindowInfo.name, $scope.modalVals.drawHeatMapColors, $scope.modalVals.preEmphasisFilterFactor, $scope.modalVals.heatMapColorAnchors);\n                $scope.cancel();\n              } else {\n                $scope.error('View Range (Hz) upper boundary is a value bigger than ' + DataService.data.sampleRate / 2);\n              }\n            } else {\n              $scope.error('View Range (Hz) lower boundary is a value below zero');\n            }\n          } else {\n            $scope.error('View Range (Hz) upper boundary has to be an Integer value.');\n          }\n        } else {\n          $scope.error('View Range (Hz) lower boundary has to be an Integer value.');\n        }\n      } else {\n        $scope.error('Dynamic Range has to be an Integer value.');\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ConfirmmodalCtrl', [\n  '$scope',\n  'dialogService',\n  'passedInTxt',\n  function ($scope, dialogService, passedInTxt) {\n    $scope.passedInTxt = passedInTxt;\n    $scope.confirm = function () {\n      dialogService.close(true);\n    };\n    $scope.cancel = function () {\n      dialogService.close(false);\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('SelectThresholdModalCtrl', [\n  '$scope',\n  'dialogService',\n  'passedInOpts',\n  'ArrayHelperService',\n  function ($scope, dialogService, passedInOpts, ArrayHelperService) {\n    $scope.passedInOpts = passedInOpts;\n    $scope.myData = ArrayHelperService.convertArrayToXYjsoArray(passedInOpts.y);\n    $scope.select = function (idx) {\n      dialogService.close(idx);\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('SelectLabelModalCtrl', [\n  '$scope',\n  'dialogService',\n  'passedInOpts',\n  'ArrayHelperService',\n  function ($scope, dialogService, passedInOpts, ArrayHelperService) {\n    $scope.passedInOpts = passedInOpts;\n    $scope.select = function (idx) {\n      dialogService.close(idx);\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').filter('regex', function () {\n  return function (input, regex) {\n    var patt = new RegExp(regex.toLowerCase());\n    var out = [];\n    for (var i = 0; i < input.length; i++) {\n      if (patt.test(input[i].name.toLowerCase())) {\n        out.push(input[i]);\n      }\n    }\n    return out;\n  };\n});\n'use strict';\nangular.module('emuwebApp').filter('levelsFilter', [\n  'ConfigProviderService',\n  'viewState',\n  function (ConfigProviderService, viewState) {\n    return function (input) {\n      if (input) {\n        var patt1 = new RegExp('SEGMENT');\n        var patt2 = new RegExp('EVENT');\n        var out = [];\n        var idx;\n        for (var i = 0; i < input.length; i++) {\n          if (patt1.test(input[i].type) || patt2.test(input[i].type)) {\n            if (ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases !== undefined) {\n              idx = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order.indexOf(input[i].name);\n              if (idx !== -1) {\n                out[idx] = input[i];\n              }\n            }\n          }\n        }\n        // console.log(out)\n        return out;\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ModalCtrl', [\n  '$scope',\n  'dialogService',\n  'passedInTxt',\n  'viewState',\n  'LevelService',\n  'HistoryService',\n  function ($scope, dialogService, passedInTxt, viewState, LevelService, HistoryService) {\n    $scope.passedInTxt = passedInTxt;\n    $scope.passedOutTxt = { 'var': null };\n    $scope.cancel = function () {\n      dialogService.close();\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *  Save changes made on SSFF\n\t\t */\n    $scope.saveChanges = function (name) {\n      dialogService.close('saveChanges');\n    };\n    /**\n\t\t *  Save changes made on SSFF\n\t\t */\n    $scope.discardChanges = function (name) {\n      dialogService.close('discardChanges');\n    };\n    /**\n\t\t *  Rename a level\n\t\t */\n    $scope.renameLevel = function () {\n      LevelService.renameLevel($scope.passedInTxt, $scope.passedOutTxt.var, viewState.curPerspectiveIdx);\n      HistoryService.addObjToUndoStack({\n        'type': 'ANNOT',\n        'action': 'RENAMELEVEL',\n        'newname': $scope.passedOutTxt.var,\n        'name': $scope.passedInTxt,\n        'curPerspectiveIdx': viewState.curPerspectiveIdx\n      });\n      dialogService.close();\n    };\n    /**\n\t\t *  Delete a complete level from LevelService\n\t\t */\n    $scope.deleteLevel = function () {\n      var lvl = LevelService.getLevelDetails(viewState.getcurClickLevelName());\n      LevelService.deleteLevel(viewState.getcurClickLevelIndex(), viewState.curPerspectiveIdx);\n      HistoryService.addObjToUndoStack({\n        'type': 'ANNOT',\n        'action': 'DELETELEVEL',\n        'level': lvl.level,\n        'id': viewState.getcurClickLevelIndex(),\n        'curPerspectiveIdx': viewState.curPerspectiveIdx\n      });\n      dialogService.close();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('showMenu', [\n  '$animate',\n  function ($animate) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        scope.$watch(attrs.showMenu, function (newVal) {\n          if (newVal) {\n            $animate.addClass(element, 'emuwebapp-expandWidthTo200px');\n          } else {\n            $animate.removeClass(element, 'emuwebapp-expandWidthTo200px');\n            $animate.addClass(element, 'emuwebapp-shrinkWidthTo0px');\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('showTwod', [\n  '$animate',\n  function ($animate) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        scope.$watch(attrs.showTwod, function (newVal) {\n          if (newVal) {\n            $animate.addClass(element, '.slideIn2dCanvases');\n          } else {\n            $animate.removeClass(element, '.slideIn2dCanvases');\n          }\n        });\n      }\n    };\n  }\n]);\n// simple animation to add slideLeft class\nangular.module('emuwebApp').animation('.slideIn2dCanvases', function () {\n  return {\n    addClass: function (element, className) {\n      element.addClass('slide2dCanvases');\n    },\n    removeClass: function (element, className) {\n      element.removeClass('slide2dCanvases');\n    }\n  };\n});\nangular.module('emuwebApp').directive('bgSplitter', [\n  '$rootScope',\n  'viewState',\n  function ($rootScope, viewState) {\n    return {\n      restrict: 'E',\n      replace: true,\n      transclude: true,\n      scope: { showTwoDimCans: '@' },\n      template: '<div class=\"emuwebapp-split-panes vertical\" ng-transclude></div>',\n      controller: [\n        '$scope',\n        function ($scope) {\n          $scope.panes = [];\n          $scope.bottomRightResizePane;\n          this.addPane = function (pane) {\n            if ($scope.panes.length > 1)\n              throw 'splitters can only have two panes';\n            $scope.panes.push(pane);\n            return $scope.panes.length;\n          };\n          this.setBottomRightResizePane = function (pane) {\n            $scope.bottomRightResizePane = pane;\n          };\n        }\n      ],\n      link: function (scope, element, attrs) {\n        var dragBottomRightResizePaneTopResizer = false;\n        var dragBottomRightResizePaneLeftResizer = false;\n        var dragBottomRightResizePaneCornerResizer = false;\n        // create split pane view\n        var handler = angular.element('<div id=\"emuwebapp-split-handler\" class=\"emuwebapp-split-handler\"><span></span></div>');\n        var pane1 = scope.panes[0];\n        var pane2 = scope.panes[1];\n        var pane3 = scope.bottomRightResizePane;\n        var bottomRightResizePaneTopResizer = angular.element('<div class=\"emuwebapp-bottomRightResizePaneTopResizer\"></div>');\n        var bottomRightResizePaneLeftResizer = angular.element('<div class=\"emuwebapp-bottomRightResizePaneLeftResizer\"></div>');\n        var bottomRightResizePaneCornerResizer = angular.element('<div class=\"emuwebapp-bottomRightResizePaneCornerResizer\"></div>');\n        pane3.elem.prepend(bottomRightResizePaneLeftResizer);\n        pane3.elem.prepend(bottomRightResizePaneTopResizer);\n        pane3.elem.prepend(bottomRightResizePaneCornerResizer);\n        var pane1Min = pane1.minSize || 0;\n        var pane2Min = pane2.minSize || 0;\n        var dragSplitPaneResizer = false;\n        var drag = false;\n        pane1.elem.after(handler);\n        attrs.$observe('showTwoDimCans', function (val) {\n          if (val === 'false') {\n            scope.bottomRightResizePane.elem.hide();\n          } else {\n            scope.bottomRightResizePane.elem.show();\n          }\n        });\n        ////////////////////\n        // bindings\n        element.bind('mousemove', function (ev) {\n          if (!drag)\n            return;\n          var bounds = element[0].getBoundingClientRect();\n          var pos = 0;\n          if (dragSplitPaneResizer) {\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            // perc = pos/height * 100;\n            // console.log(perc);\n            if (pos < pane1Min)\n              return;\n            if (height - pos < pane2Min)\n              return;\n            handler.css('top', pos + 'px');\n            pane1.elem.css('height', pos + 'px');\n            pane2.elem.css('top', pos + 'px');\n            viewState.setdragBarHeight(pos);\n          }\n          if (dragBottomRightResizePaneTopResizer) {\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            if (pos <= 10 || height - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('top', pos + 'px');\n            var tmp = height - pos;\n            pane3.elem.css('height', tmp + 'px');\n          }\n          if (dragBottomRightResizePaneLeftResizer) {\n            var width = bounds.right - bounds.left;\n            pos = ev.clientX - bounds.left;\n            if (pos <= 10 || width - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('left', pos + 'px');\n            var tmp = width - pos;\n            pane3.elem.css('width', tmp + 'px');\n          }\n          if (dragBottomRightResizePaneCornerResizer) {\n            // do height and top\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            if (pos <= 10 || height - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('top', pos + 'px');\n            var tmp = height - pos;\n            pane3.elem.css('height', tmp + 'px');\n            // do width and left\n            var width = bounds.right - bounds.left;\n            pos = ev.clientX - bounds.left;\n            if (pos <= 10 || width - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('left', pos + 'px');\n            var tmp = width - pos;\n            pane3.elem.css('width', tmp + 'px');\n          }\n        });\n        handler.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragSplitPaneResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneTopResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneTopResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneLeftResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneLeftResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneCornerResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneCornerResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        angular.element(document).bind('mouseup', function (ev) {\n          drag = false;\n          dragSplitPaneResizer = false;\n          dragBottomRightResizePaneTopResizer = false;\n          dragBottomRightResizePaneLeftResizer = false;\n          dragBottomRightResizePaneCornerResizer = false;\n          viewState.setdragBarActive(false);\n          $rootScope.$digest();\n        });\n      }\n    };\n  }\n]).directive('bgPane', function () {\n  return {\n    restrict: 'E',\n    require: '^bgSplitter',\n    replace: true,\n    transclude: true,\n    scope: {\n      minSize: '=',\n      type: '@',\n      showTwoDimCans: '@'\n    },\n    template: '<div class=\"{{typeclass}}\" ng-transclude></div>',\n    link: function (scope, element, attrs, bgSplitterCtrl) {\n      var newElement;\n      if (scope.type !== 'emuwebapp-bottomRightResizePane') {\n        scope.elem = element;\n        scope.index = bgSplitterCtrl.addPane(scope);\n        scope.typeclass = 'split-pane' + scope.index;\n      } else {\n        scope.elem = element;\n        scope.index = 3;\n        scope.typeclass = 'emuwebapp-bottomRightResizePane';\n        bgSplitterCtrl.setBottomRightResizePane(scope);\n      }\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('ssffTrack', [\n  '$timeout',\n  'viewState',\n  'ConfigProviderService',\n  function ($timeout, viewState, ConfigProviderService) {\n    return {\n      templateUrl: 'views/ssffTrack.html',\n      restrict: 'E',\n      link: function postLink(scope, element, attrs) {\n        // select the needed DOM elements from the template\n        var canvasLength = element.find('canvas').length;\n        var ssffCanvas = element.find('canvas')[1];\n        var markupCanvas = element.find('canvas')[canvasLength - 1];\n        // var context = canvas0.getContext('2d');\n        var markupCtx = markupCanvas.getContext('2d');\n        var trackName;\n        attrs.$observe('trackName', function (val) {\n          if (val) {\n            trackName = val;\n          }\n        });\n        scope.order = attrs.order;\n        /////////////////////\n        // watches\n        // on broadcast msg from main ctrl openSubmenu refresh timeline\n        scope.$on('refreshTimeline', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              drawSsffTrackMarkup();\n            }\n          }\n        });\n        //\n        scope.$watch('vs.timelineSize', function () {\n          $timeout(scope.redraw, 10);\n        });\n        scope.$watch('vs.curViewPort', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('ssffds.data.length', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundary', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundarySample', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        //\n        /////////////////////\n        scope.redraw = function () {\n          drawSsffTrackMarkup();\n        };\n        /**\n         *\n         */\n        function drawSsffTrackMarkup() {\n          if (!$.isEmptyObject(scope.ssffds.data)) {\n            if (scope.ssffds.data.length !== 0) {\n              markupCtx.clearRect(0, 0, markupCtx.canvas.width, markupCtx.canvas.height);\n              // draw moving boundary line if moving\n              scope.dhs.drawMovingBoundaryLine(markupCtx);\n              // draw current viewport selected\n              scope.dhs.drawCurViewPortSelected(markupCtx, false);\n              // draw min max an name of track\n              var tr = scope.cps.getSsffTrackConfig(trackName);\n              var col = scope.ssffds.getColumnOfTrack(tr.name, tr.columnName);\n              scope.dhs.drawMinMaxAndName(markupCtx, trackName, col._minVal, col._maxVal, 2);\n            }\n          }\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('progressThing', [\n  '$animate',\n  function ($animate) {\n    return {\n      template: '<div class=\"emuwebapp-progressThing\">{{vs.somethingInProgressTxt}}</div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        // element.text('this is the progressThing directive');\n        attrs.$observe('showThing', function (newVal) {\n          if (newVal === 'true') {\n            // $animate.removeClass(element, 'hideProgressThing');\n            $animate.removeClass(element, 'emuwebapp-shrinkHeightTo0px');\n            $animate.removeClass(element, 'emuwebapp-animationStopped');\n            $animate.addClass(element, 'emuwebapp-expandHeightTo20px');\n            $animate.addClass(element, 'emuwebapp-animationRunning');\n          } else {\n            // $animate.addClass(element, 'hideProgressThing');\n            $animate.removeClass(element, 'emuwebapp-expandHeightTo20px');\n            $animate.removeClass(element, 'emuwebapp-animationRunning');\n            $animate.addClass(element, 'emuwebapp-shrinkHeightTo0px');\n            $animate.addClass(element, 'emuwebapp-animationStopped');\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('historyActionPopup', [\n  '$animate',\n  function ($animate) {\n    return {\n      template: '<div class=\"emuwebapp-historyActionPopup\"> <div class=\"emuwebapp-historyActionModal\">{{vs.historyActionTxt}}</div></div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        ////////////////\n        //watches\n        scope.$watch('vs.historyActionTxt', function () {\n          if (scope.vs.historyActionTxt !== '') {\n            $animate.addClass(element, 'emuwebapp-historyActionPopupThere').then(function () {\n              scope.vs.historyActionTxt = '';\n              $animate.removeClass(element, 'emuwebapp-historyActionPopupThere');\n              scope.$apply();\n            });\n          }\n        }, true);\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('emuhierarchy', [\n  'viewState',\n  'DataService',\n  'LevelService',\n  'HierarchyLayoutService',\n  'Soundhandlerservice',\n  function (viewState, DataService, LevelService, HierarchyLayoutService, Soundhandlerservice) {\n    return {\n      template: '<div class=\"emuwebapp-hierarchy-container\"></div>',\n      restrict: 'E',\n      scope: {\n        path: '=',\n        vertical: '=',\n        playing: '='\n      },\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        //////////////////////\n        // private variables\n        scope.selectedItem;\n        //\n        //////////////////////\n        //////////////////////\n        // watches \n        scope.cLAD = viewState.curLevelAttrDefs;\n        scope.$watch('path', function (newValue) {\n          console.debug('Rendering due to path change: ', newValue);\n          scope.selectVisibleNodes();\n          scope.render();\n        }, false);\n        scope.$watch('vertical', function (newValue) {\n          console.debug('Rendering due to rotation: ', newValue);\n          scope.selectVisibleNodes();\n          scope.render();\n        }, false);\n        scope.$watch('cLAD', function (newValue) {\n          console.debug('Rendering due to attribute change: ', newValue);\n          scope.render();\n        }, true);\n        scope.$watch('playing', function (newValue) {\n          console.debug('Play() triggered', newValue, scope.selectedItem);\n          if (typeof scope.selectedItem !== 'undefined' && newValue !== 0) {\n            scope.play(scope.selectedItem);\n          }\n        }, true);\n        //\n        //////////////////////\n        //////////////////////\n        // helper functions\n        /**\n\t * Function to center node when clicked/dropped so node doesn't get lost when\n\t * collapsing/moving with large amount of children.\n\t */\n        scope.centerNode = function (node) {\n          var x = -node._x + scope.width / 2;\n          var y = -node._y + scope.height / 2;\n          svg.transition().duration(scope.duration).attr('transform', scope.getOrientatedTransform() + 'translate(' + x + ',' + y + ')');\n          zoomListener.translate([\n            x,\n            y\n          ]);\n        };\n        /**\n\t * The zoom function is called by the zoom listener, which listens for d3 zoom events and must be appended to the svg element\n\t */\n        scope.zoom = function () {\n          svg.attr('transform', scope.getOrientatedTransform());\n        };\n        scope.getOrientatedTransform = function () {\n          var transform = 'scale(' + zoomListener.scale() + ')';\n          transform += 'translate(' + zoomListener.translate() + ')';\n          if (scope.vertical) {\n            transform += 'scale(-1,1),rotate(90)';\n          } else {\n            transform += 'rotate(0)';\n          }\n          return transform;\n        };\n        scope.getOrientatedNodeTransform = function (d) {\n          // Parameter d is never used because this is independent from the node's position\n          if (scope.vertical) {\n            return 'scale(-1,1)rotate(90)';\n          } else {\n            return 'scale(1,1)rotate(0)';\n          }\n        };\n        scope.getNodeText = function (d) {\n          var level = viewState.getCurAttrDef(HierarchyLayoutService.getLevelName(d.id));\n          for (var i = 0; i < d.labels.length; ++i) {\n            if (d.labels[i].name === level) {\n              return d.labels[i].value;\n            }\n          }\n          console.debug('Likely a bug: Did not find the label selected for display', 'Selected level:', level, 'Node: ', d);\n          return 'NO VALUE';\n        };\n        scope.getOrientatedTextAnchor = function (d) {\n          if (scope.vertical) {\n            return 'middle';\n          } else {\n            return 'begin';\n          }\n        };\n        scope.getOrientatedTextX = function (d) {\n          if (scope.vertical) {\n            return 0;\n          } else {\n            return 10;\n          }\n        };\n        scope.getOrientatedTextY = function (d) {\n          if (scope.vertical) {\n            return '1.45em';\n          } else {\n            return '0.35em';\n          }\n        };\n        scope.getPath = function (d) {\n          var controlX = d._fromX;\n          var controlY = d._toY;\n          return 'M' + d._fromX + ' ' + d._fromY + 'Q' + controlX + ' ' + controlY + ' ' + d._toX + ' ' + d._toY;\n        };\n        scope.nodeOnClick = function (d) {\n          console.debug('Clicked node', d);\n          //scope.centerNode(d);\n          // (De-)Collapse sub-tree\n          var isCollapsing;\n          if (typeof d._collapsed === 'undefined' || d._collapsed === false) {\n            isCollapsing = true;\n          } else if (d._collapsed === true) {\n            isCollapsing = false;\n          } else {\n            console.debug('Likely a bug: the following node appears to be neither collapsed nor uncollapsed:', d);\n          }\n          d._collapsed = isCollapsing;\n          var currentDescendant;\n          var descendants = HierarchyLayoutService.findChildren(d, scope.path);\n          while (descendants.length > 0) {\n            currentDescendant = descendants.pop();\n            descendants = descendants.concat(HierarchyLayoutService.findChildren(currentDescendant, scope.path));\n            if (isCollapsing) {\n              if (typeof currentDescendant._collapsedParents === 'undefined') {\n                currentDescendant._collapsedParents = 1;\n              } else {\n                currentDescendant._collapsedParents += 1;\n              }\n            } else {\n              currentDescendant._collapsedParents -= 1;\n            }\n            currentDescendant._collapsePosition = [\n              d._x,\n              d._y\n            ];\n          }\n          scope.selectVisibleNodes();\n          scope.render();\n        };\n        scope.nodeOnRightClick = function (d) {\n          scope.play(d);\n        };\n        scope.nodeOnMouseOver = function (d) {\n          scope.selectedItem = d;\n          scope.render();\n        };\n        scope.play = function (d) {\n          var timeInfoLevel = scope.path[0];\n          if (typeof timeInfoLevel === 'undefined') {\n            console.debug('Likely a bug: There is no path selection. Not executing play():', d);\n            return;\n          }\n          var timeInfoType = LevelService.getLevelDetails(timeInfoLevel).level.type;\n          var firstTimeItem = null;\n          var lastTimeItem = null;\n          var itemList = [d];\n          var currentItem;\n          while (itemList.length > 0) {\n            currentItem = itemList.pop();\n            if (currentItem.labels[0].name === timeInfoLevel) {\n              if (lastTimeItem === null) {\n                lastTimeItem = currentItem;\n              }\n              firstTimeItem = currentItem;\n            }\n            itemList = itemList.concat(HierarchyLayoutService.findChildren(currentItem, scope.path));\n          }\n          console.debug('Node info for playback: ', timeInfoType, d, firstTimeItem, lastTimeItem);\n          if (firstTimeItem === null) {\n            console.debug('No time information found for node, aborting playback', d);\n            return;\n          }\n          var startSample = 0;\n          var endSample = 0;\n          if (timeInfoType === 'EVENT') {\n            startSample = firstTimeItem.samplePoint;\n            endSample = lastTimeItem.samplePoint;\n          } else if (timeInfoType === 'SEGMENT') {\n            startSample = firstTimeItem.sampleStart;\n            endSample = lastTimeItem.sampleStart + lastTimeItem.sampleDur;\n          }\n          console.debug('Sample information for playback:', startSample, endSample);\n          Soundhandlerservice.playFromTo(startSample, endSample);\n        };\n        scope.selectVisibleNodes = function () {\n          // Try to set all nodes to invisible. Later we will search all\n          // paths and if we find one uncollasped path to a node, that\n          // node will be set visible.\n          var rootLevelItems = LevelService.getLevelDetails(scope.path[scope.path.length - 1]).level.items;\n          var items = [];\n          items = items.concat(rootLevelItems);\n          var currentItem;\n          while (items.length > 0) {\n            currentItem = items.pop();\n            items = items.concat(HierarchyLayoutService.findChildren(currentItem, scope.path));\n            currentItem._visible = false;\n          }\n          // Now all nodes on the selected scope.path have been set invisible\n          items = [];\n          items = items.concat(rootLevelItems);\n          while (items.length > 0) {\n            currentItem = items.pop();\n            if (!currentItem._collapsed) {\n              items = items.concat(HierarchyLayoutService.findChildren(currentItem, scope.path));\n            }\n            currentItem._visible = true;\n          }\n        };\n        //\n        /////////////////////////////\n        /////////////////////////////\n        // inital d3.js setup stuff\n        /*var margin = {\n            top: 0,\n            right: 0,\n            bottom: 0,\n            left: 0\n          },\n          barHeight = 20,\n          percent = d3.format('%'),\n\t  duration = 750;\n\t*/\n        scope.element = element;\n        scope.width = 0;\n        scope.height = 0;\n        scope.duration = 750;\n        // scaleExtent limits the amount of zooming possible\n        var zoomListener = d3.behavior.zoom().scaleExtent([\n            0.5,\n            10\n          ]).on('zoom', scope.zoom);\n        // Create the d3 element and position it based on margins\n        var svg = d3.select(element[0]).append('svg').attr('width', '100%').attr('height', '100%').style('background-color', 'darkgrey').call(zoomListener).on('dblclick.zoom', null).append('g').append('g');\n        scope.element = element;\n        //\n        /////////////////////////////\n        /**\n         *\n         */\n        scope.render = function () {\n          ////\n          // Get current width and height of SVG\n          scope.width = parseInt(d3.select(scope.element[0]).style('width'), 10);\n          scope.height = parseInt(d3.select(scope.element[0]).style('height'), 10);\n          // Set orientation\n          svg.transition().duration(scope.duration).attr('transform', scope.getOrientatedTransform());\n          /////\n          // Compute the new tree layout (first nodes and then links)\n          //\n          var nodes = [];\n          // At the moment I have two different approaches to calculating the layout of a hierarchy\n          //\n          // The first is simpler and is used by first calling layoutNonItemLevel() for the bottom-most level (the one with time information)\n          // and then calling layoutItemLevel() for all other levels. Unfortunately, it will in some cases render multiple nodes to the same\n          // position (happens when they share the same set of children).\n          //\n          // The second one looks simpler in this file, because it is completely done in one function. But that function is actually quite\n          // complex.\n          //\n          // It might be desirable to find some sort of collision detection for the first approach (which is commented out below)\n          //\n          /////\n          // This is the aforementioned second approach\n          HierarchyLayoutService.calculateWeightsBottomUp(scope.path);\n          //\n          /////\n          for (var i = 0; i < scope.path.length; ++i) {\n            /////\n            // This is the aformentioned first approach\n            /*\n\t\t\tif (i === 0) {\n\t\t\t\tHierarchyLayoutService.layoutNonItemLevel(scope.path[0], scope.path.length);\n\t\t\t} else {\n\t\t\t\tHierarchyLayoutService.layoutItemLevel(scope.path[i], scope.path.length-i);\n\t\t\t}\n\t\t\t*/\n            //////\n            // Add all nodes that are not collapsed\n            var levelItems = LevelService.getLevelDetails(scope.path[i]).level.items;\n            for (var ii = 0; ii < levelItems.length; ++ii) {\n              if (levelItems[ii]._visible) {\n                nodes.push(levelItems[ii]);\n              }\n            }  // Add all nodes, no matter whether they are collapsed or not\n               //nodes = nodes.concat(LevelService.getLevelDetails(scope.path[i]).level.items);\n          }\n          // Now layout links\n          //\n          // We must only draw links that are part of the currently selected path.\n          // We must therefore filter the links.\n          //\n          // We must also filter out links that are collapsed\n          //\n          // What follows below is a probably very low-performance approach to filtering\n          //\n          var links = [];\n          var allLinks = DataService.getData().links;\n          for (var l = 0; l < allLinks.length; ++l) {\n            for (var i = 0; i < scope.path.length - 1; ++i) {\n              var element = LevelService.getItemFromLevelById(scope.path[i], allLinks[l].toID);\n              var parentElement = LevelService.getItemFromLevelById(scope.path[i + 1], allLinks[l].fromID);\n              if (element === null) {\n                continue;\n              }\n              if (parentElement === null) {\n                continue;\n              }\n              if (!element._visible)\n                continue;\n              if (parentElement._collapsed || !parentElement._visible)\n                continue;\n              links.push(allLinks[l]);\n            }\n          }\n          // Transform relative coordinates (_posInLevel and _depth) to actual coordinates (_x and _y)\n          var offsetX = 25;\n          var depthToX = function (depth) {\n            var size = scope.vertical ? scope.height : scope.width;\n            return offsetX + depth / scope.path.length * size;\n          };\n          var posInLevelToY = function (posInLevel) {\n            var size = scope.vertical ? scope.width : scope.height;\n            return posInLevel * size;\n          };\n          nodes.forEach(function (d) {\n            d._x = depthToX(d._depth);\n            d._y = posInLevelToY(d._posInLevel);\n          });\n          links.forEach(function (d) {\n            d._fromX = depthToX(d._fromDepth);\n            d._fromY = posInLevelToY(d._fromPosInLevel);\n            d._toX = depthToX(d._toDepth);\n            d._toY = posInLevelToY(d._toPosInLevel);\n          });\n          //////\n          // Now that all actual coordinates have been calculated, we\n          // update our SVG using d3js data joins\n          //\n          // For an introduction to the concept see\n          // http://bost.ocks.org/mike/join/\n          //\n          //\n          // Define the data set to be visualised\n          var dataSet = svg.selectAll('g.emuhierarchy-node').data(nodes, function (d) {\n              return d.id;\n            });\n          var newNodes = dataSet.enter();\n          var oldNodes = dataSet.exit();\n          //\n          // Add nodes that were previously not part of the svg.\n          //\n          // Any node will consist of an svg group (\"g\"), a circle, a\n          // text and a second, invisible circle for mouseover handling.\n          //\n          // Note that properties that can be changed after the node is \n          // added will be set further below\n          newNodes = newNodes.append('g').attr('class', 'emuhierarchy-node').attr('pointer-events', 'mouseover').on('click', scope.nodeOnClick).on('mouseover', scope.nodeOnMouseOver).on('contextmenu', scope.play);\n          ;\n          newNodes.append('circle').attr('class', 'emuhierarchy-nodeCircle').attr('r', 0).transition().duration(scope.duration).attr('r', 4.5);\n          ;\n          newNodes.append('text').attr('class', 'emuhierarchy-nodeText');\n          ;\n          // Make sure that nodes that appear due to their ancestry being uncollapsed do not fly in from the origin\n          // (as do all other nodes)\n          newNodes.attr('transform', function (d) {\n            if (typeof d._collapsePosition !== 'undefined') {\n              var x = d._collapsePosition[0];\n              var y = d._collapsePosition[1];\n              delete d._collapsePosition;\n              return 'translate(' + x + ',' + y + ')' + scope.getOrientatedNodeTransform();\n            }\n          });\n          /*\n\n\t\t// phantom node to give us mouseover in a radius around it\n\t\tnewNodes.append('circle')\n\t\t\t.attr('class', 'emuhierarchy-ghostCircle')\n\t\t\t.attr('r', 30)\n\t\t\t.attr('opacity', 0.2) // change this to zero to hide the target area\n\t\t\t.style('fill', 'red')\n\t\t\t.attr('pointer-events', 'mouseover')\n\t\t\t.on('mouseover', function (node) {\n\t\t\t\tconsole.debug(node);\n\t\t\t\toverCircle(node);\n\t\t\t})\n\t\t\t.on('mouseout', function (node) {\n\t\t\t\toutCircle(node);\n\t\t\t});\n\n\t\t*/\n          //\n          // Remove nodes that shall no longer be part of the svg\n          // Transition exiting nodes to the origin\n          oldNodes = oldNodes.transition().duration(scope.duration).attr('transform', function (d) {\n            if (d._collapsePosition) {\n              var x = d._collapsePosition[0];\n              var y = d._collapsePosition[1];\n              delete d._collapsePosition;\n              return 'translate(' + x + ',' + y + ')';\n            } else {\n              return 'translate(' + 0 + ',' + 0 + ')';\n            }\n          }).remove();\n          oldNodes.select('text').style('fill-opacity', 0);\n          //\n          // Set or update properties that are subject to change after\n          // the node is added.\n          dataSet.select('text').attr('x', scope.getOrientatedTextX).attr('y', scope.getOrientatedTextY).attr('text-anchor', scope.getOrientatedTextAnchor).attr('transform', scope.getOrientatedTextTransform).text(scope.getNodeText);\n          ;\n          // Change the circle fill depending on whether it has children and is collapsed\n          dataSet.select('circle.emuhierarchy-nodeCircle').classed('collapsed', function (d) {\n            return d._collapsed;\n          }).classed('selected', function (d) {\n            if (typeof scope.selectedItem === 'undefined') {\n              return false;\n            }\n            return d.id === scope.selectedItem.id;\n          });\n          //.attr('r', 4.5)\n          //.style('fill', function (d) {\n          //\treturn d._children ? 'lightsteelblue' : '#fff';\n          //})\n          ;\n          // Transition nodes to their new position\n          dataSet.transition().duration(scope.duration).attr('transform', function (d) {\n            return 'translate(' + d._x + ',' + d._y + ')' + scope.getOrientatedNodeTransform();\n          });\n          //\n          //\n          // Now we turn to visualising links\n          var linkSet = svg.selectAll('path.emuhierarchy-link').data(links, function (d) {\n              // Form unique link ID\n              return 's' + d.fromID + 't' + d.toID;\n            });\n          var newLinks = linkSet.enter();\n          var oldLinks = linkSet.exit();\n          newLinks.insert('path', 'g').attr('class', 'emuhierarchy-link').style('opacity', 0).transition().duration(scope.duration).style('opacity', 1);\n          ;\n          oldLinks.transition().duration(scope.duration).style('opacity', 0).remove();\n          // Transition links to their new position.\n          linkSet.transition().duration(scope.duration).attr('d', scope.getPath).style('opacity', 1);\n          ;\n        };\n        /**\n         * SIC... not being called\n         */\n        scope.resizeHierarchy = function () {\n          console.log('###############');\n          console.log(scope.width);\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('epg', [\n  'viewState',\n  function (viewState) {\n    return {\n      template: '<div class=\"emuwebapp-twoDimCanvasContainer\"><canvas width=\"512\" height=\"512\"></canvas></div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        // element.text('this is the epg directive');\n        var canvas = element.find('canvas')[0];\n        var tr, col, sRaSt;\n        ////////////////////\n        // watches\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                  drawEpgGrid(scope);\n                }\n              }\n            }\n          }\n        }, true);\n        scope.$watch('vs.curMousePosSample', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                drawEpgGrid(scope);\n              }\n            }\n          }\n        }, true);\n        //\n        ////////////////////\n        /**\n\t\t\t\t * drawing method to drawEpgGrid\n\t\t\t\t */\n        function drawEpgGrid(scope) {\n          tr = scope.cps.getSsffTrackConfig('EPG');\n          // SIC SIC SIC hardcoded for now although it might stay that way because it only is allowed to draw epg data anyway\n          col = scope.ssffds.getColumnOfTrack(tr.name, tr.columnName);\n          sRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(tr.name);\n          var ctx = canvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          ctx.fillStyle = 'green';\n          ctx.strokeStyle = scope.cps.vals.colors.osciColor;\n          ctx.font = scope.cps.vals.font.fontPxSize + 'px' + ' ' + scope.cps.vals.font.fontType;\n          var gridWidth = canvas.width / 8;\n          var gridHeight = canvas.height / 8;\n          var sInterv = 1 / sRaSt.sampleRate - sRaSt.startTime;\n          var curFrame = Math.round(scope.vs.curMousePosSample / scope.shs.wavJSO.SampleRate / sInterv);\n          var binValStrArr;\n          angular.forEach(col.values[curFrame], function (el, elIdx) {\n            binValStrArr = el.toString(2).split('').reverse();\n            while (binValStrArr.length < 8) {\n              binValStrArr.push('0');\n            }\n            binValStrArr.forEach(function (binStr, binStrIdx) {\n              if (binStr === '1') {\n                ctx.fillStyle = 'grey';\n                ctx.fillRect(binStrIdx * gridWidth + 5, gridHeight * elIdx + 5, gridWidth - 10, gridHeight - 10);\n              } else {\n                ctx.fillStyle = 'white';\n                ctx.fillRect(binStrIdx * gridWidth + 5, gridHeight * elIdx + 5, gridWidth - 10, gridHeight - 10);\n              }\n            });\n          });\n          // draw labels\n          var horizontalText = scope.fontImage.getTextImageTwoLines(ctx, 'EPG', 'Frame:' + curFrame, scope.cps.vals.font.fontPxSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor, true);\n          ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, 5, 0, horizontalText.width, horizontalText.height);\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('dots', [\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'fontScaleService',\n  'Soundhandlerservice',\n  function (viewState, ConfigProviderService, Ssffdataservice, fontScaleService, Soundhandlerservice) {\n    return {\n      template: '<div class=\"emuwebapp-twoDimCanvasContainer\"><canvas width=\"512\" height=\"512\"></canvas></div>',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      link: function postLink(scope, element, attrs) {\n        scope.cps = ConfigProviderService;\n        scope.ssffds = Ssffdataservice;\n        scope.vs = viewState;\n        scope.fontImage = fontScaleService;\n        scope.shs = Soundhandlerservice;\n        var canvas = element.find('canvas')[0];\n        var globalMinX = Infinity;\n        var globalMaxX = -Infinity;\n        var globalMinY = Infinity;\n        var globalMaxY = -Infinity;\n        var tr, col, sRaSt;\n        ////////////////////\n        // watches\n        //\n        scope.$watch('ssffds.data.length', function () {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                scope.drawDots();\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                  scope.drawDots();\n                }\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curMousePosSample', function () {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                scope.drawDots();\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curPerspectiveIdx', function () {\n          globalMinX = Infinity;\n          globalMaxX = -Infinity;\n          globalMinY = Infinity;\n          globalMaxY = -Infinity;\n        }, true);\n        //\n        //////////////////\n        scope.setGlobalMinMaxVals = function () {\n          // body...\n          //console.log(scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases);\n          var dD = scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0];\n          // SIC SIC SIC hardcoded\n          for (var i = 0; i < dD.dots.length; i++) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(dD.dots[i].xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (xCol._minVal < globalMinX) {\n              globalMinX = xCol._minVal;\n            }\n            if (xCol._maxVal > globalMaxX) {\n              globalMaxX = xCol._maxVal;\n            }\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(dD.dots[i].ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (yCol._minVal < globalMinY) {\n              globalMinY = yCol._minVal;\n            }\n            if (yCol._maxVal > globalMaxY) {\n              globalMaxY = yCol._maxVal;\n            }\n          }\n        };\n        function getScale(ctx, str, scale) {\n          return ctx.measureText(str).width * scale;\n        }\n        function getScaleWidth(ctx, str1, str2, scaleX) {\n          if (str1.toString().length > str2.toString().length) {\n            return getScale(ctx, str1, scaleX);\n          } else {\n            return getScale(ctx, str2, scaleX);\n          }\n        }\n        /**\n\t\t\t\t * drawing method to drawDots\n\t\t\t\t */\n        scope.drawDots = function () {\n          if (globalMinX === Infinity) {\n            scope.setGlobalMinMaxVals();\n          }\n          var ctx = canvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          //////////////////////////////\n          // markup to improve visualization \n          var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n          var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n          // draw corner pointers\n          ctx.beginPath();\n          ctx.moveTo(0, 0);\n          ctx.lineTo(5, 5);\n          ctx.moveTo(0, canvas.height);\n          ctx.lineTo(5, canvas.height - 5);\n          ctx.moveTo(canvas.width, canvas.height);\n          ctx.lineTo(canvas.width - 5, canvas.height - 5);\n          ctx.stroke();\n          ctx.closePath();\n          var smallFontSize = scope.cps.vals.font.fontPxSize * 3 / 4;\n          // ymax\n          var labelTxtImg = scope.fontImage.getTextImage(ctx, 'yMax: ' + scope.vs.round(globalMaxY, 2), smallFontSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n          ctx.drawImage(labelTxtImg, 5, 5, labelTxtImg.width, labelTxtImg.height);\n          // xmin + y min\n          labelTxtImg = scope.fontImage.getTextImageTwoLines(ctx, 'yMin: ' + scope.vs.round(globalMinY, 2), 'xMin: ' + scope.vs.round(globalMinX, 2), smallFontSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor, true);\n          ctx.drawImage(labelTxtImg, 5, canvas.height - smallFontSize * scaleY * 2 - 5, labelTxtImg.width, labelTxtImg.height);\n          // xmax\n          var tw = ctx.measureText('xMax: ' + scope.vs.round(globalMaxX, 5)).width * scaleX;\n          // SIC why 5???\n          labelTxtImg = scope.fontImage.getTextImage(ctx, 'xMax: ' + scope.vs.round(globalMaxX, 2), smallFontSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n          ctx.drawImage(labelTxtImg, canvas.width - tw - 5, canvas.height - smallFontSize * scaleY - 5, labelTxtImg.width, labelTxtImg.height);\n          var dD = scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0];\n          // SIC SIC SIC hardcoded\n          // frame nr\n          var xsRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[0].xSsffTrack);\n          // use first track for sample numbers\n          var ysRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[0].ySsffTrack);\n          var sInterv = 1 / xsRaSt.sampleRate;\n          var curMousePosTime = scope.vs.curMousePosSample / scope.shs.wavJSO.SampleRate;\n          var curFrame;\n          if (xsRaSt.startTime === 1 / xsRaSt.sampleRate / 2) {\n            curFrame = Math.round(curMousePosTime * xsRaSt.sampleRate);\n          } else {\n            curFrame = Math.round(curMousePosTime * xsRaSt.sampleRate + (xsRaSt.startTime - 1 / xsRaSt.sampleRate / 2) * xsRaSt.sampleRate);\n          }\n          // check if due to math.round curFrame > col.length\n          var trConf = scope.cps.getSsffTrackConfig(dD.dots[0].xSsffTrack);\n          var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n          if (curFrame > xCol.values.length - 1) {\n            curFrame = xCol.values.length - 1;\n          }\n          tw = ctx.measureText('frame: ' + curFrame).width * scaleX;\n          labelTxtImg = scope.fontImage.getTextImage(ctx, 'frame: ' + curFrame, scope.cps.vals.font.fontPxSize - 4, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n          var degrees = 90;\n          ctx.save();\n          ctx.rotate(degrees * Math.PI / 180);\n          ctx.drawImage(labelTxtImg, canvas.width / 2 - tw / 2, -canvas.height);\n          ctx.restore();\n          //////////////////////////////\n          // draw dots\n          var allDots = [];\n          for (var i = 0; i < dD.dots.length; i++) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(dD.dots[i].xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(dD.dots[i].ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            // check if x and why have the same amount of cols\n            if (xCol.values.length !== yCol.values.length) {\n              alert('columns do not have same length or length of one not 1');\n              return;\n            }\n            var xsRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[i].xSsffTrack);\n            var ysRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[i].ySsffTrack);\n            // check if sampleRate and startTime is the same\n            if (xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample) {\n              alert('xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample');\n              return;\n            }\n            var x = (xCol.values[curFrame][dD.dots[i].xContourNr] - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n            var y = canvas.height - (yCol.values[curFrame][dD.dots[i].yContourNr] - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n            var startPoint = Math.PI / 180 * 0;\n            var endPoint = Math.PI / 180 * 360;\n            ctx.strokeStyle = dD.dots[i].color;\n            ctx.beginPath();\n            ctx.arc(x, y, 20, startPoint, endPoint, true);\n            ctx.stroke();\n            ctx.closePath();\n            ctx.beginPath();\n            ctx.arc(x, y, 2, startPoint, endPoint, true);\n            ctx.fill();\n            ctx.closePath();\n            // draw labels\n            var labelTxtImg = scope.fontImage.getTextImage(ctx, dD.dots[i].name, scope.cps.vals.font.fontPxSize - 4, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor);\n            ctx.drawImage(labelTxtImg, x, y - 5, labelTxtImg.width, labelTxtImg.height);\n            // append to all dots\n            allDots.push({\n              'name': dD.dots[i].name,\n              'x': x,\n              'y': y\n            });\n          }\n          var f, t;\n          dD.connectLines.forEach(function (c) {\n            allDots.forEach(function (d) {\n              if (d.name === c.fromDot) {\n                f = d;\n              }\n              if (d.name === c.toDot) {\n                t = d;\n              }\n            });\n            // draw line\n            ctx.strokeStyle = c.color;\n            ctx.beginPath();\n            ctx.moveTo(f.x, f.y);\n            ctx.lineTo(t.x, t.y);\n            ctx.stroke();\n            ctx.closePath();\n          });\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('myDropZone', [\n  '$animate',\n  '$compile',\n  'browserDetector',\n  'appStateService',\n  'dialogService',\n  function ($animate, $compile, browserDetector, appStateService, dialogService) {\n    return {\n      templateUrl: 'views/myDropZone.html',\n      restrict: 'E',\n      scope: {},\n      link: function postLink(scope, element, attr) {\n        scope.dropTextDefault = 'Drop your files here or click here to open a file';\n        scope.dropTextErrorFileType = 'Error: Could not parse file. The following file types are supported: .WAV .TEXTGRID';\n        scope.dropTextErrorAPI = 'Sorry ! The File APIs are not fully supported in your browser.';\n        scope.dropAllowed = 'Drop file(s) to start loading !';\n        scope.dropParsingStarted = 'Parsing started';\n        scope.dropParsingWaiting = '.TextGrid loaded! Please load .WAV file in order to start!';\n        scope.dropHintDefault = 'Load .TextGrid first or .TextGrid and .WAV at once!';\n        scope.dropText = scope.dropTextDefault;\n        scope.dropHint = scope.dropHintDefault;\n        scope.dropClass = '';\n        scope.error = false;\n        scope.traverseFileTreeChrome = function (item, path) {\n          path = path || '';\n          if (item.isFile) {\n            item.file(function (file) {\n              var extension = file.name.substr(file.name.lastIndexOf('.') + 1).toUpperCase();\n              if (scope.error !== true && extension === 'WAV') {\n                scope.$apply(function () {\n                  scope.dropText = scope.dropTextDefault;\n                  scope.dropClass = '';\n                });\n                scope.$parent.wav = file;\n                scope.$parent.handleLocalFiles();\n              } else if (scope.error !== true && extension === 'TEXTGRID') {\n                scope.$parent.grid = file;\n                scope.$apply(function () {\n                  scope.dropText = scope.dropParsingWaiting;\n                });\n              } else if (scope.error !== true) {\n                scope.error = true;\n                scope.$parent.other = file;\n                scope.dropText = scope.dropTextErrorFileType;\n                scope.dropClass = 'error';\n                dialogService.open('views/error.html', 'ModalCtrl', 'Error: Unknown File Type for File ' + scope.$parent.other.name).then(function (res) {\n                  scope.dropText = scope.dropTextDefault;\n                  scope.dropClass = '';\n                });\n                appStateService.resetToInitState();\n              }\n            });\n          } else if (item.isDirectory) {\n            var dirReader = item.createReader();\n            dirReader.readEntries(function (entries) {\n              for (var i = 0; i < entries.length; i++) {\n                scope.traverseFileTreeChrome(entries[i], path + item.name + '/');\n              }\n            });\n          }\n        };\n        scope.traverseFileTreeFirefox = function (item, path) {\n          path = path || '';\n          if (item.size > 0) {\n            var extension = item.name.substr(item.name.lastIndexOf('.') + 1).toUpperCase();\n            if (scope.error !== true && extension === 'WAV') {\n              scope.$parent.wav = item;\n              scope.$parent.handleLocalFiles();\n              scope.$apply(function () {\n                scope.dropText = scope.dropAllowed;\n                scope.dropClass = '';\n              });\n            } else if (scope.error !== true && extension === 'TEXTGRID') {\n              scope.$parent.grid = item;\n              scope.$apply(function () {\n                scope.dropText = scope.dropParsingWaiting;\n                scope.dropClass = 'waiting';\n              });\n            } else if (scope.error !== true) {\n              scope.error = true;\n              scope.$parent.other = item;\n              scope.dropText = scope.dropTextErrorFileType;\n              scope.dropClass = 'error';\n              dialogService.open('views/error.html', 'ModalCtrl', 'Error: Unknown File Type for File ' + scope.$parent.other.name).then(function (res) {\n                scope.dropText = scope.dropTextDefault;\n                scope.dropClass = '';\n                appStateService.resetToInitState();\n              });\n            }\n          } else if (item.isDirectory) {\n            var dirReader = item.createReader();\n            dirReader.readEntries(function (entries) {\n              for (var i = 0; i < entries.length; i++) {\n                scope.traverseFileTreeFirefox(entries[i], path + item.name + '/');\n              }\n            });\n          }\n        };\n        scope.dragEnterLeave = function (evt) {\n          evt.preventDefault();\n          scope.$apply(function () {\n            scope.dropText = scope.dropTextDefault;\n            scope.dropClass = '';\n          });\n        };\n        scope.handleDragOver = function (evt) {\n          evt.preventDefault();\n          scope.$apply(function () {\n            scope.dropText = scope.dropAllowed;\n            scope.dropClass = 'over';\n          });\n        };\n        scope.dropFiles = function (evt) {\n          scope.error = false;\n          evt.stopPropagation();\n          evt.preventDefault();\n          scope.$apply(function () {\n            if (window.File && window.FileReader && window.FileList && window.Blob) {\n              if (evt.originalEvent !== undefined) {\n                if (browserDetector.isBrowser.Firefox()) {\n                  var dt = evt.originalEvent.dataTransfer;\n                  var files = dt.files;\n                  var count = files.length;\n                  for (var i = 0; i < files.length; i++) {\n                    scope.traverseFileTreeFirefox(files[i]);\n                  }\n                } else {\n                  var items = evt.originalEvent.dataTransfer.items;\n                  for (var i = 0; i < items.length; i++) {\n                    var item = items[i].webkitGetAsEntry();\n                    if (item) {\n                      scope.traverseFileTreeChrome(item);\n                    }\n                  }\n                }\n              } else {\n                scope.dropText = scope.dropTextErrorFileType;\n                scope.dropClass = 'error';\n                dialogService.open('views/error.html', 'ModalCtrl', 'Error: Unknown File Type for File ' + scope.$parent.other.name).then(function (res) {\n                  scope.dropText = scope.dropTextDefault;\n                  scope.dropClass = '';\n                  appStateService.resetToInitState();\n                });\n              }\n            } else {\n              dialogService.open('views/error.html', 'ModalCtrl', scope.dropTextErrorAPI);\n              scope.dropText = scope.dropTextDefault;\n              scope.dropClass = '';\n            }\n          });\n        };\n        element.bind('drop', function (event) {\n          scope.dropFiles(event);\n        });\n        element.bind('dragover', function (event) {\n          scope.handleDragOver(event);\n        });\n        element.bind('dragenter', function (event) {\n          scope.dragEnterLeave(event);\n        });\n        element.bind('dragleave', function (event) {\n          scope.dragEnterLeave(event);\n        });\n        element.bind('click', function (event) {\n          element.context.children[0].children[1].click();\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('myDropZoneInput', [\n  '$animate',\n  'browserDetector',\n  'dialogService',\n  'appStateService',\n  function ($animate, browserDetector, dialogService, appStateService) {\n    return {\n      templateUrl: 'views/myDropZoneInput.html',\n      restrict: 'E',\n      scope: {},\n      link: function postLink(scope, element, attr) {\n        scope.handler = false;\n        scope.acceptGrid = '.TextGrid';\n        scope.acceptWav = 'audio/wav';\n        scope.acceptBoth = scope.acceptWav + ',' + scope.acceptGrid;\n        scope.acceptFile = scope.acceptBoth;\n        scope.handleFilesonChange = function () {\n          scope.handler = true;\n          var loadedFiles = element.context.children.fileDialog;\n          if (browserDetector.isBrowser.Firefox()) {\n            for (var i = 0; i < loadedFiles.files.length; i++) {\n              var file = loadedFiles.files[i];\n              var extension = file.name.substr(file.name.lastIndexOf('.') + 1).toUpperCase();\n              if (extension === 'WAV' && file.type.match('audio/x-wav')) {\n                scope.$apply(function () {\n                  scope.$parent.dropText = scope.$parent.dropTextDefault;\n                  scope.acceptFile = scope.acceptBoth;\n                });\n                scope.$parent.$parent.wav = file;\n                scope.$parent.$parent.handleLocalFiles();\n              } else if (extension === 'TEXTGRID') {\n                scope.$parent.$parent.grid = file;\n                scope.$apply(function () {\n                  scope.$parent.dropText = scope.$parent.dropParsingWaiting;\n                  scope.acceptFile = scope.acceptWav;\n                });\n              } else {\n                scope.$parent.error = true;\n                scope.$parent.$parent.other = file;\n                scope.$parent.dropText = scope.$parent.dropTextErrorFileType;\n                scope.$parent.dropClass = 'error';\n                dialogService.open('views/error.html', 'ModalCtrl', 'Error: Unknown File Type for File ' + scope.$parent.other.name).then(function (res) {\n                  scope.$parent.dropText = scope.$parent.dropTextDefault;\n                  scope.$parent.dropClass = '';\n                  appStateService.resetToInitState();\n                });\n              }\n            }\n          } else {\n            for (var i = 0; i < loadedFiles.files.length; i++) {\n              var file = loadedFiles.files[i];\n              var extension = file.name.substr(file.name.lastIndexOf('.') + 1).toUpperCase();\n              if (extension === 'WAV' && file.type.match('audio/wav')) {\n                scope.$apply(function () {\n                  scope.$parent.dropText = scope.$parent.dropTextDefault;\n                  scope.acceptFile = scope.acceptBoth;\n                });\n                scope.$parent.$parent.wav = file;\n                scope.$parent.$parent.handleLocalFiles();\n              } else if (extension === 'TEXTGRID') {\n                scope.$apply(function () {\n                  scope.$parent.dropText = scope.$parent.dropParsingWaiting;\n                  scope.acceptFile = scope.acceptWav;\n                });\n                scope.$parent.$parent.grid = file;\n              } else {\n                scope.$parent.error = true;\n                scope.$parent.$parent.other = file;\n                scope.$parent.dropText = scope.$parent.dropTextErrorFileType;\n                scope.$parent.dropClass = 'error';\n                dialogService.open('views/error.html', 'ModalCtrl', 'Error: Unknown File Type for File ' + scope.$parent.other.name).then(function (res) {\n                  scope.$parent.dropText = scope.$parent.dropTextDefault;\n                  scope.$parent.dropClass = '';\n                  appStateService.resetToInitState();\n                });\n              }\n            }\n          }\n        };\n        element.bind('change', function (event) {\n          scope.handleFilesonChange(event);\n        });\n        element.bind('click', function (event) {\n          var elem = angular.element('input');\n          if (elem[1] !== undefined) {\n            elem[1].click();\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('emuwebapp', [\n  'viewState',\n  'Iohandlerservice',\n  'ConfigProviderService',\n  function (viewState, Iohandlerservice, ConfigProviderService) {\n    return {\n      templateUrl: 'views/emuwebapp.html',\n      restrict: 'E',\n      scope: {\n        audioGetUrl: '@',\n        labelGetUrl: '@',\n        labelType: '@'\n      },\n      link: function postLink(scope, element, attrs) {\n        ////////////////////////\n        // Bindings\n        element.bind('mouseenter', function (event) {\n          viewState.mouseInEmuWebApp = true;\n        });\n        element.bind('mouseleave', function (event) {\n          viewState.mouseInEmuWebApp = false;\n        });\n        ///////////////////////\n        // observe attrs\n        attrs.$observe('audioGetUrl', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.audioGetUrl = val;\n          }\n        });\n        attrs.$observe('labelGetUrl', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.labelGetUrl = val;\n          }\n        });\n        attrs.$observe('labelType', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.labelType = val;\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Validationservice', [\n  '$http',\n  '$q',\n  function Validationservice($http, $q) {\n    //shared service object to be returned\n    var sServObj = {};\n    var schemasJsos = [];\n    var names = [\n        'annotationFileSchema',\n        'emuwebappConfigSchema',\n        'DBconfigFileSchema',\n        'bundleListSchema'\n      ];\n    /**\n\t\t *\n\t\t */\n    sServObj.loadSchemas = function () {\n      var proms = [];\n      angular.forEach(names, function (n) {\n        proms.push($http.get('schemaFiles/' + n + '.json'));\n      });\n      return $q.all(proms);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setSchemas = function (schemaArr) {\n      angular.forEach(schemaArr, function (s) {\n        schemasJsos.push({\n          name: s.config.url,\n          data: s.data\n        });\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.validateJSO = function (schemaName, jso) {\n      var schema;\n      angular.forEach(schemasJsos, function (s) {\n        if (s.name === 'schemaFiles/' + schemaName + '.json') {\n          schema = s;\n        }\n      });\n      if (schema !== undefined && tv4.validate(jso, schema.data)) {\n        return true;\n      } else {\n        if (schema === undefined) {\n          return 'Schema: ' + schemaName + ' is currently undefined! This is probably due to a misnamed schema file on the server...';\n        } else {\n          return tv4.error;\n        }\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ShowhierarchyCtrl', [\n  '$scope',\n  'DataService',\n  'viewState',\n  'dialogService',\n  'ConfigProviderService',\n  'LevelService',\n  'HierarchyLayoutService',\n  function ($scope, DataService, viewState, dialogService, ConfigProviderService, LevelService, HierarchyLayoutService) {\n    // Scope data\n    var playing = 0;\n    $scope.paths = {\n      possible: [],\n      possibleAsStr: [],\n      selected: ''\n    };\n    // Find non-ITEM levels to start calculating possible paths through the hierarchy of levels\n    angular.forEach(ConfigProviderService.curDbConfig.levelDefinitions, function (l) {\n      if (l.type !== 'ITEM') {\n        $scope.paths.possible = $scope.paths.possible.concat(HierarchyLayoutService.findPaths(l.name));\n      }\n    });\n    // convert array paths to strings\n    angular.forEach($scope.paths.possible, function (arr, arrIdx) {\n      if (arrIdx === 0) {\n        // select first possible path on load\n        $scope.paths.selected = arr.join(' \\u2190 ');\n      }\n      $scope.paths.possibleAsStr.push(arr.join(' \\u2190 '));\n    });\n    //////////////\n    // watches\n    //\n    //////////////\n    /**\n\t\t * Returns index of the currently selected path (within the $scope.paths.possible array)\n\t\t */\n    $scope.getSelIdx = function () {\n      var selIdx = $scope.paths.possibleAsStr.indexOf($scope.paths.selected);\n      return selIdx;\n    };\n    $scope.rotateHierarchy = function () {\n      viewState.rotateHierarchy();\n    };\n    $scope.getRotation = function () {\n      return viewState.isHierarchyRotated();\n    };\n    $scope.playSelection = function () {\n      ++playing;\n    };\n    $scope.getPlaying = function () {\n      return playing;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.isCurrentAttrDef = function (levelName, attrDef) {\n      if (viewState.getCurAttrDef(levelName) === attrDef) {\n        return true;\n      } else {\n        return false;\n      }\n    };\n    /**\n\t\t * set current attribute definition\n\t\t * just delegates same fuction call to viewState\n\t\t *\n\t\t * @param levelName name of level\n\t\t * @param attrDef name of attribute definition\n\t\t */\n    $scope.setCurrentAttrDef = function (levelName, attrDef) {\n      viewState.setCurAttrDef(levelName, attrDef);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getAllAttrDefs = function (levelName) {\n      var levDef = ConfigProviderService.getLevelDefinition(levelName);\n      return levDef.attributeDefinitions;\n    };\n    /**\n\t\t * cancel dialog i.e. close\n\t\t */\n    $scope.cancel = function () {\n      var traverse = function (o) {\n        for (var i in o) {\n          if (i.substr(0, 1) === '_') {\n            delete o[i];\n          }\n          if (o[i] !== null && typeof o[i] === 'object') {\n            //going one step down in the object tree\n            traverse(o[i]);\n          }\n        }\n      };\n      traverse(DataService.getData());\n      dialogService.close();\n      viewState.showHierarchy();\n    };\n  }\n]);\n'use strict';\n/**\n * This service aims to provide functions for laying out the hierarchy of a\n * bundle (ie, calculating the positions of the nodes). The actual drawing is\n * done in a directive, the manipulation of the hierarchy is done in another\n * service.\n *\n * While the DBConfig allows for a complex network of levels, the visualisation\n * is always limited to one straight path of levels. Set this path via the\n * public function setPath(p).\n *\n * A selection menu shall be offered comprising all possible paths through the\n * hierarchy.\n */\nangular.module('emuwebApp').service('HierarchyLayoutService', [\n  'ConfigProviderService',\n  'LevelService',\n  'DataService',\n  function (ConfigProviderService, LevelService, DataService) {\n    // shared service object\n    var sServObj = {};\n    ////////////////////////////////////////////\n    // private vars and functions\n    var svgGroup;\n    var parentsFound;\n    //\n    /////////////////////\n    /////////////////////\n    // public API\n    /**\n\t\t * Find all parent levels of a given level by iterating through the\n\t\t * current database's linkDefinitions.\n\t\t *\n\t\t * @param childLevel The name of the level whose parents to find\n\t\t * @returns An array of names of childLevel's parent levels\n\t\t */\n    sServObj.findParentLevels = function (childLevel) {\n      var parents = [];\n      for (var i = 0; i < ConfigProviderService.curDbConfig.linkDefinitions.length; ++i) {\n        if (ConfigProviderService.curDbConfig.linkDefinitions[i].sublevelName === childLevel) {\n          parents.push(ConfigProviderService.curDbConfig.linkDefinitions[i].superlevelName);\n        }\n      }\n      return parents;\n    };\n    /**\n\t\t * Calculate the position of nodes within a non-item level (ie, one with time information)\n\t\t *\n\t\t * The nodes are positioned at a regular distance to each other.\n\t\t * The first node will be at position -0.5, the last at somewhat\n\t\t * below 0.5.\n\t\t *\n\t\t * It is taken for granted that the order of the nodes within\n\t\t * the array is coherent with the time information.\n\t\t */\n    sServObj.layoutNonItemLevel = function (name, levelDepth) {\n      var nodes = LevelService.getLevelDetails(name).level.items;\n      for (var i = 0; i < nodes.length; ++i) {\n        nodes[i]._posInLevel = i / nodes.length + 0.01;\n        //- 0.5;\n        nodes[i]._depth = levelDepth;\n        // Additionally, calculate link positions\n        var links = DataService.getData().links;\n        for (var l = 0; l < links.length; ++l) {\n          if (links[l].toID === nodes[i].id) {\n            links[l]._toPosInLevel = nodes[i]._posInLevel;\n            links[l]._toDepth = nodes[i]._depth;\n          }\n        }\n      }\n    };\n    /**\n\t\t * Calculate the position of nodes within an item level (ie, one without time information)\n\t\t * \n\t\t * This is done by looking at the position of the first and the\n\t\t * last child of each node and centering the node in-between\n\t\t */\n    sServObj.layoutItemLevel = function (name, levelDepth) {\n      var nodes = LevelService.getLevelDetails(name).level.items;\n      for (var i = 0; i < nodes.length; ++i) {\n        // Find first and last child of nodes[i]\n        var children = sServObj.findChildren(nodes[i], selectedPath);\n        if (children.length === 0) {\n          nodes[i]._posInLevel = null;\n        }\n        // FIXME if this function was actually used, the following would of course fail if children was an empty array\n        var firstChild = children[0];\n        var lastChild = children[children.length - 1];\n        nodes[i]._posInLevel = firstChild._posInLevel + (lastChild._posInLevel - firstChild._posInLevel) / 2;\n        nodes[i]._depth = levelDepth;\n        // Additionally, calculate link positions\n        var links = DataService.getData().links;\n        for (var l = 0; l < links.length; ++l) {\n          if (links[l].toID === nodes[i].id) {\n            links[l]._toPosInLevel = nodes[i]._posInLevel;\n            links[l]._toDepth = nodes[i]._depth;\n          }\n          if (links[l].fromID === nodes[i].id) {\n            links[l]._fromPosInLevel = nodes[i]._posInLevel;\n            links[l]._fromDepth = nodes[i]._depth;\n          }\n        }\n      }\n    };\n    /**\n\t\t * This function aims to find and store the parents of every node\n\t\t */\n    sServObj.findParents = function (selectedPath) {\n      var i, ii, c;\n      if (parentsFound) {\n        return;\n      } else {\n        parentsFound = true;\n      }\n      /////\n      // Iterate throug levels top-down\n      for (i = selectedPath.length - 1; i >= 0; --i) {\n        var level = LevelService.getLevelDetails(selectedPath[i]).level;\n        // Iterate through the current level's items\n        // And save them as _parents in their children\n        for (ii = 0; ii < level.items.length; ++ii) {\n          var children = sServObj.findChildren(level.items[ii], selectedPath);\n          //console.debug('label', level.items[ii].labels[0].value, 'number of children: ', children.length);\n          for (c = 0; c < children.length; ++c) {\n            if (typeof children[c]._parents === 'undefined') {\n              children[c]._parents = [];\n            }\n            children[c]._parents.push(level.items[ii]);\n          }\n        }\n      }\n    };\n    /**\n\t\t * Calculate the weights (size within their level) of all nodes bottom-up\n\t\t * This is most likely rather slow and definitely needs tweaking\n\t\t */\n    sServObj.calculateWeightsBottomUp = function (selectedPath) {\n      var i, ii, iii;\n      sServObj.findParents(selectedPath);\n      // Iterate through levels bottom-up\n      for (i = 0; i < selectedPath.length; ++i) {\n        var level = LevelService.getLevelDetails(selectedPath[i]).level;\n        level._weight = 0;\n        //////\n        // Iterate through items to calculate their _weight and the level's _weight\n        for (ii = 0; ii < level.items.length; ++ii) {\n          var itemWeight = level.items[ii]._weight;\n          if (typeof itemWeight === 'undefined') {\n            itemWeight = 1;\n            level.items[ii]._weight = 1;\n          }\n          // This would create tidier drawings but depends on knowledge of each node's parents \n          if (typeof level.items[ii]._parents !== 'undefined') {\n          }\n          level._weight += itemWeight;\n        }\n        /////\n        // Iterate through items again to calculate their _posInLevel and _depth.\n        // This is done in a new for loop because it depends on the correctness of level._weight\n        var posInLevel = 0;\n        for (ii = 0; ii < level.items.length; ++ii) {\n          level.items[ii]._posInLevel = (posInLevel + level.items[ii]._weight / 2) / level._weight;\n          posInLevel += level.items[ii]._weight;\n          level.items[ii]._depth = selectedPath.length - i - 1;\n          //////\n          // Additionally, calculate link positions\n          var links = DataService.getData().links;\n          for (var l = 0; l < links.length; ++l) {\n            if (links[l].toID === level.items[ii].id) {\n              links[l]._toPosInLevel = level.items[ii]._posInLevel;\n              links[l]._toDepth = level.items[ii]._depth;\n            }\n            if (links[l].fromID === level.items[ii].id) {\n              links[l]._fromPosInLevel = level.items[ii]._posInLevel;\n              links[l]._fromDepth = level.items[ii]._depth;\n            }\n          }\n        }\n      }\n    };\n    /**\n\t\t * Recursively find all paths through the hierarchy of levels.\n\t\t * This is done bottom-up because there is no explicit root element in the levelDefinitions.\n\t\t *\n\t\t * @param startLevel The name of the level from which to start\n\t\t * @param path An array of levels' names that form a path to startLevel (optional; shouldn't be an empty array)\n\t\t */\n    sServObj.findPaths = function (startLevel, path) {\n      if (typeof path === 'undefined') {\n        var path = [startLevel];\n      } else {\n        path = path.concat([startLevel]);\n      }\n      // Find all parents of startLevel\n      var parents = this.findParentLevels(startLevel);\n      // If we have no more parents, we're at the end of the\n      // path and thus returning it\n      if (parents.length === 0) {\n        return [path];\n      }\n      // If, on the other hand, there are parents, we start\n      // recursion to find all paths\n      var paths = [];\n      for (var i = 0; i < parents.length; ++i) {\n        paths = paths.concat(sServObj.findPaths(parents[i], path));\n      }\n      return paths;\n    };\n    /**\n\t\t * SIC this should probably be moved to the LevelService as it might\n\t\t * be useful for other parts of the webApp\n\t\t */\n    sServObj.getLevelName = function (nodeID) {\n      var levelName = null;\n      for (var i = 0; i < DataService.getData().levels.length; ++i) {\n        for (var ii = 0; ii < DataService.getData().levels[i].items.length; ++ii) {\n          if (DataService.getData().levels[i].items[ii].id === nodeID) {\n            levelName = DataService.getData().levels[i].name;\n            break;\n          }\n        }\n      }\n      return levelName;\n    };\n    /**\n\t\t * Find all children of a node d that are part of the currently selected\n\t\t * path through the hierarchy\n\t\t *\n\t\t * @return an array of children nodes\n\t\t * @return empty array if there are no children (previously would return null due to a d3 dependency that no longer exists)\n\t\t */\n    sServObj.findChildren = function (d, selectedPath) {\n      var children = [];\n      // Find the level that d is a part of\n      // Return empty array if that fails (which shouldn't happen at all)\n      var currentLevel = sServObj.getLevelName(d.id);\n      if (currentLevel === null) {\n        console.log('Likely a bug: failed to find a node\\'s level', d);\n        return [];\n      }\n      // Find the child level\n      var childLevel = null;\n      for (var i = 0; i < selectedPath.length - 1; ++i) {\n        if (selectedPath[i + 1] === currentLevel) {\n          childLevel = selectedPath[i];\n          break;\n        }\n      }\n      if (childLevel === null) {\n        return [];\n      }\n      // Iterate over links to find children\n      for (var li = 0; li < DataService.getData().links.length; ++li) {\n        if (DataService.getData().links[li].fromID === d.id) {\n          // Iterate over levels to find the object corresponding to d.id\n          for (var l = 0; l < DataService.getData().levels.length; ++l) {\n            if (DataService.getData().levels[l].name !== childLevel) {\n              continue;\n            }\n            for (var it = 0; it < DataService.getData().levels[l].items.length; ++it) {\n              if (DataService.getData().levels[l].items[it].id === DataService.getData().links[li].toID) {\n                children.push(DataService.getData().levels[l].items[it]);\n              }\n            }\n          }\n        }\n      }\n      return children;\n    };\n    return sServObj;\n  }\n]);\n/*##########################################\n##########################################\n##########################################\n########  THE REMAINDER IS ONLY LEFT TO ##\n########  USE SOME IDEAS  IT IS NEVER  ##\n########  CALLED                        ##\n##########################################\n##########################################\n##########################################\n*/\n/**\n\t\t * @todo documentation\n\t\t * for the time being: this function is no fun to read because it is based on a d3 example and contains a lot of sub-functions.\n\t\t * you'd better wait until I have polished it to a certain degree.\n\t\t */\n//sServObj.oldDrawHierarchy = function () {\nvar foooooooo = function () {\n  // Make sure that any private properties that have been added during a previous call of this function are removed\n  for (var x = 0; x < DataService.getData().levels.length; ++x) {\n    for (var y = 0; y < DataService.getData().levels[x].items.length; ++y) {\n      delete DataService.getData().levels[x].items[y]._visited;\n      delete DataService.getData().levels[x].items[y]._parents;\n      delete DataService.getData().levels[x].items[y]._weight;\n    }\n  }\n  // Calculate total nodes, max label length\n  var totalNodes = 0;\n  var maxLabelLength = 0;\n  // variables for drag/drop\n  var selectedNode = null;\n  var draggingNode = null;\n  // panning variables\n  var panSpeed = 200;\n  var panBoundary = 20;\n  // Within 20px from edges will pan when dragging.\n  // Misc. variables\n  var i = 0;\n  var tree = d3.layout.myLayout().size([\n      viewerHeight,\n      viewerWidth\n    ]);\n  tree = tree.children(sServObj.findChildren);\n  // define a d3 diagonal projection for use by the node paths later on.\n  var diagonal = d3.svg.diagonal().projection(function (d) {\n      return [\n        d.y,\n        d.x\n      ];\n    });\n  // A recursive helper function for performing some setup by walking through all nodes\n  function visit(parent, visitFn, childrenFn) {\n    if (!parent)\n      return;\n    visitFn(parent);\n    var children = childrenFn(parent);\n    if (children) {\n      var count = children.length;\n      for (var i = 0; i < count; i++) {\n        visit(children[i], visitFn, childrenFn);\n      }\n    }\n  }\n  // Call visit function to establish maxLabelLength\n  /*visit(DataService.getData(), function(d) {\n\t\t\t\ttotalNodes++;\n\t\t\t\tmaxLabelLength = Math.max(d.name.length, maxLabelLength);\n\n\t\t\t}, function(d) {\n\t\t\t\treturn d.children && d.children.length > 0 ? d.children : null;\n\t\t\t});*/\n  maxLabelLength = 15;\n  // sort the tree according to the node names\n  function sortTree() {\n  }\n  // Sort the tree initially incase the JSON isn't in a sorted order.\n  sortTree();\n  // TODO: Pan function, can be better implemented.\n  function pan(domNode, direction) {\n    var speed = panSpeed;\n    if (panTimer) {\n      clearTimeout(panTimer);\n      translateCoords = d3.transform(svgGroup.attr('transform'));\n      if (direction == 'left' || direction == 'right') {\n        translateX = direction == 'left' ? translateCoords.translate[0] + speed : translateCoords.translate[0] - speed;\n        translateY = translateCoords.translate[1];\n      } else if (direction == 'up' || direction == 'down') {\n        translateX = translateCoords.translate[0];\n        translateY = direction == 'up' ? translateCoords.translate[1] + speed : translateCoords.translate[1] - speed;\n      }\n      scaleX = translateCoords.scale[0];\n      scaleY = translateCoords.scale[1];\n      var scale = zoomListener.scale();\n      svgGroup.transition().attr('transform', 'translate(' + translateX + ',' + translateY + ')scale(' + scale + ')');\n      d3.select(domNode).select('g.node').attr('transform', 'translate(' + translateX + ',' + translateY + ')');\n      zoomListener.scale(zoomListener.scale());\n      zoomListener.translate([\n        translateX,\n        translateY\n      ]);\n      panTimer = setTimeout(function () {\n        pan(domNode, speed, direction);\n      }, 50);\n    }\n  }\n  function initiateDrag(d, domNode) {\n    draggingNode = d;\n    d3.select(domNode).select('.ghostCircle').attr('pointer-events', 'none');\n    d3.selectAll('.ghostCircle').attr('class', 'ghostCircle show');\n    d3.select(domNode).attr('class', 'node activeDrag');\n    svgGroup.selectAll('g.node').sort(function (a, b) {\n      // select the parent and sort the path's\n      if (a.id != draggingNode.id)\n        return 1;  // a is not the hovered element, send \"a\" to the back\n      else\n        return -1;  // a is the hovered element, bring \"a\" to the front\n    });\n    // if nodes has children, remove the links and nodes\n    if (nodes.length > 1) {\n      // remove link paths\n      links = tree.links(nodes);\n      nodePaths = svgGroup.selectAll('path.link').data(links, function (d) {\n        return d.target.id;\n      }).remove();\n      // remove child nodes\n      nodesExit = svgGroup.selectAll('g.node').data(nodes, function (d) {\n        return d.id;\n      }).filter(function (d, i) {\n        if (d.id == draggingNode.id) {\n          return false;\n        }\n        return true;\n      }).remove();\n    }\n    // remove parent link\n    parentLink = tree.links(tree.nodes(draggingNode.parent));\n    svgGroup.selectAll('path.link').filter(function (d, i) {\n      if (d.target.id == draggingNode.id) {\n        return true;\n      }\n      return false;\n    }).remove();\n    dragStarted = null;\n  }\n  // define the baseSvg, attaching a class for styling and the zoomListener\n  d3.select('#emuwebapp-tree-container svg').remove();\n  var baseSvg = d3.select('#emuwebapp-tree-container').append('svg').attr('width', viewerWidth).attr('height', viewerHeight).attr('class', 'overlay').call(zoomListener);\n  // Define the drag listeners for drag/drop behaviour of nodes.\n  /*var dragListener = d3.behavior.drag()\n\t\t\t\t.on(\"dragstart\", function(d) {\n\t\t\t\t\tif (d == root) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdragStarted = true;\n\t\t\t\t\tnodes = tree.nodes(d);\n\t\t\t\t\td3.event.sourceEvent.stopPropagation();\n\t\t\t\t\t// it's important that we suppress the mouseover event on the node being dragged. Otherwise it will absorb the mouseover event and the underlying node will not detect it d3.select(sServObj).attr('pointer-events', 'none');\n\t\t\t\t})\n\t\t\t\t.on(\"drag\", function(d) {\n\t\t\t\t\tif (d == root) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (dragStarted) {\n\t\t\t\t\t\tdomNode = sServObj;\n\t\t\t\t\t\tinitiateDrag(d, domNode);\n\t\t\t\t\t}\n\n\t\t\t\t\t// get coords of mouseEvent relative to svg container to allow for panning\n\t\t\t\t\trelCoords = d3.mouse($('svg').get(0));\n\t\t\t\t\tif (relCoords[0] < panBoundary) {\n\t\t\t\t\t\tpanTimer = true;\n\t\t\t\t\t\tpan(sServObj, 'left');\n\t\t\t\t\t} else if (relCoords[0] > ($('svg').width() - panBoundary)) {\n\n\t\t\t\t\t\tpanTimer = true;\n\t\t\t\t\t\tpan(sServObj, 'right');\n\t\t\t\t\t} else if (relCoords[1] < panBoundary) {\n\t\t\t\t\t\tpanTimer = true;\n\t\t\t\t\t\tpan(sServObj, 'up');\n\t\t\t\t\t} else if (relCoords[1] > ($('svg').height() - panBoundary)) {\n\t\t\t\t\t\tpanTimer = true;\n\t\t\t\t\t\tpan(sServObj, 'down');\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tclearTimeout(panTimer);\n\t\t\t\t\t\t} catch (e) {\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\td.x0 += d3.event.dy;\n\t\t\t\t\td.y0 += d3.event.dx;\n\t\t\t\t\tvar node = d3.select(sServObj);\n\t\t\t\t\tnode.attr(\"transform\", \"translate(\" + d.y0 + \",\" + d.x0 + \")\");\n\t\t\t\t\tupdateTempConnector();\n\t\t\t\t}).on(\"dragend\", function(d) {\n\t\t\t\t\tif (d == root) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdomNode = sServObj;\n\t\t\t\t\tif (selectedNode) {\n\t\t\t\t\t\t// now remove the element from the parent, and insert it into the new elements children\n\t\t\t\t\t\tvar index = draggingNode.parent.children.indexOf(draggingNode);\n\t\t\t\t\t\tif (index > -1) {\n\t\t\t\t\t\t\tdraggingNode.parent.children.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (typeof selectedNode.children !== 'undefined' || typeof selectedNode._children !== 'undefined') {\n\t\t\t\t\t\t\tif (typeof selectedNode.children !== 'undefined') {\n\t\t\t\t\t\t\t\tselectedNode.children.push(draggingNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselectedNode._children.push(draggingNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tselectedNode.children = [];\n\t\t\t\t\t\t\tselectedNode.children.push(draggingNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Make sure that the node being added to is expanded so user can see added node is correctly moved\n\t\t\t\t\t\texpand(selectedNode);\n\t\t\t\t\t\tsortTree();\n\t\t\t\t\t\tendDrag();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendDrag();\n\t\t\t\t\t}\n\t\t\t\t});\n/*\n\t\t\tfunction endDrag() {\n\t\t\t\tselectedNode = null;\n\t\t\t\td3.selectAll('.ghostCircle').attr('class', 'ghostCircle');\n\t\t\t\td3.select(domNode).attr('class', 'node');\n\t\t\t\t// now restore the mouseover event or we won't be able to drag a 2nd time\n\t\t\t\td3.select(domNode).select('.ghostCircle').attr('pointer-events', '');\n\t\t\t\tupdateTempConnector();\n\t\t\t\tif (draggingNode !== null) {\n\t\t\t\t\tupdate(root);\n\t\t\t\t\tcenterNode(draggingNode);\n\t\t\t\t\tdraggingNode = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Helper functions for collapsing and expanding nodes.\n\n\t\t\tfunction collapse(d) {\n\t\t\t\tif (d.children) {\n\t\t\t\t\td._children = d.children;\n\t\t\t\t\td._children.forEach(collapse);\n\t\t\t\t\td.children = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction expand(d) {\n\t\t\t\tif (d._children) {\n\t\t\t\t\td.children = d._children;\n\t\t\t\t\td.children.forEach(expand);\n\t\t\t\t\td._children = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar overCircle = function(d) {\n\t\t\t\tselectedNode = d;\n\t\t\t\tupdateTempConnector();\n\t\t\t};\n\t\t\tvar outCircle = function(d) {\n\t\t\t\tselectedNode = null;\n\t\t\t\tupdateTempConnector();\n\t\t\t};\n\n\t\t\t// Function to update the temporary connector indicating dragging affiliation\n\t\t\tvar updateTempConnector = function() {\n\t\t\t\tvar data = [];\n\t\t\t\tif (draggingNode !== null && selectedNode !== null) {\n\t\t\t\t\t// have to flip the source coordinates since we did sServObj for the existing connectors on the original tree\n\t\t\t\t\tdata = [{\n\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\tx: selectedNode.y0,\n\t\t\t\t\t\t\ty: selectedNode.x0\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttarget: {\n\t\t\t\t\t\t\tx: draggingNode.y0,\n\t\t\t\t\t\t\ty: draggingNode.x0\n\t\t\t\t\t\t}\n\t\t\t\t\t}];\n\t\t\t\t}\n\t\t\t\tvar link = svgGroup.selectAll(\".templink\").data(data);\n\n\t\t\t\tlink.enter().append(\"path\")\n\t\t\t\t\t.attr(\"class\", \"templink\")\n\t\t\t\t\t.attr(\"d\", d3.svg.diagonal())\n\t\t\t\t\t.attr('pointer-events', 'none');\n\n\t\t\t\tlink.attr(\"d\", d3.svg.diagonal());\n\n\t\t\t\tlink.exit().remove();\n\t\t\t};*/\n  // Toggle children function\n  function toggleChildren(d) {\n    if (d.children) {\n      d._children = d.children;\n      d.children = null;\n    } else if (d._children) {\n      d.children = d._children;\n      d._children = null;\n    }\n    return d;\n  }\n  // Toggle children on click.\n  function click(d) {\n    if (d3.event.defaultPrevented)\n      return;\n    // click suppressed\n    d = toggleChildren(d);\n    update(d);\n    centerNode(d);\n  }\n  function update(source) {\n    //\n    // Compute the new height, function counts total children of root node and sets tree height accordingly.\n    // sServObj prevents the layout looking squashed when new nodes are made visible or looking sparse when nodes are removed\n    // sServObj makes the layout more consistent.\n    var levelWidth = [1];\n    var childCount = function (level, n) {\n      //if (n.children && n.children.length > 0) {\n      var children = tree.children()(n);\n      if (children && children.length > 0) {\n        if (levelWidth.length <= level + 1)\n          levelWidth.push(0);\n        levelWidth[level + 1] += children.length;\n        children.forEach(function (d) {\n          childCount(level + 1, d);\n        });\n      }\n    };\n    childCount(0, root);\n    var newHeight = d3.max(levelWidth) * 25;\n    // 25 pixels per line\n    tree = tree.size([\n      newHeight,\n      viewerWidth\n    ]);\n    // Compute the new tree layout.\n    var nodes = tree.nodes(root).reverse(), links = tree.links(nodes);\n    sServObj.calculateWeightsBottomUp();\n    // Set widths between levels based on maxLabelLength.\n    nodes.forEach(function (d) {\n      d.y = d.depth * (maxLabelLength * 10);  //maxLabelLength * 10px\n                                              // alternatively to keep a fixed scale one can set a fixed depth per level\n                                              // Normalize for fixed-depth by commenting out below line\n                                              // d.y = (d.depth * 500); //500px per level.\n                                              //console.debug(d);\n                                              //d.x = 20* d._weight / d._levelWeight;\n                                              //level.items[ii].x = 20*  level.items[ii]._weight / level._weight;\n    });\n    // Update the nodes\n    var node = svgGroup.selectAll('g.node').data(nodes, function (d) {\n        return d.id || (d.id = ++i);\n      });\n    // Enter any new nodes at the parent's previous position.\n    var nodeEnter = node.enter().append('g').attr('class', 'node').attr('transform', function (d) {\n        return 'translate(' + source.y0 + ',' + source.x0 + ')';\n      }).on('click', click);\n    nodeEnter.append('circle').attr('class', 'nodeCircle').attr('r', 0).style('fill', function (d) {\n      return d._children ? 'lightsteelblue' : '#fff';\n    });\n    nodeEnter.append('text').attr('x', function (d) {\n      return d.children || d._children ? -10 : 10;\n    }).attr('dy', '.35em').attr('class', 'nodeText').attr('text-anchor', function (d) {\n      return d.children || d._children ? 'end' : 'start';\n    }).text(function (d) {\n      var text = d.labels[0].value;\n      for (var i = 1; i < d.labels.length; ++i) {\n        text += ' / ' + d.labels[i].name + ': ' + d.labels[i].value;\n      }\n      return text;\n    }).style('fill-opacity', 0);\n    // phantom node to give us mouseover in a radius around it\n    nodeEnter.append('circle').attr('class', 'ghostCircle').attr('r', 30).attr('opacity', 0.2).style('fill', 'red').attr('pointer-events', 'mouseover').on('mouseover', function (node) {\n      overCircle(node);\n    }).on('mouseout', function (node) {\n      outCircle(node);\n    });\n    // Update the text to reflect whether node has children or not.\n    node.select('text').attr('transform', function (d) {\n      if (rotated) {\n        return 'scale(1, -1)';  // SIC SIC SIC ... not working\n      } else {\n        return 'scale(1, 1)';\n      }\n    }).attr('x', 10).attr('text-anchor', 'start').text(function (d) {\n      var text = d.labels[0].value;\n      for (var i = 1; i < d.labels.length; ++i) {\n        text += ' / ' + d.labels[i].name + ': ' + d.labels[i].value;\n      }\n      return text;\n    });\n    // Change the circle fill depending on whether it has children and is collapsed\n    node.select('circle.nodeCircle').attr('r', 4.5).style('fill', function (d) {\n      return d._children ? 'lightsteelblue' : '#fff';\n    });\n    // Transition nodes to their new position.\n    var nodeUpdate = node.transition().duration(duration).attr('transform', function (d) {\n        return 'translate(' + d.y + ',' + d.x + ')';\n      });\n    // Fade the text in\n    nodeUpdate.select('text').style('fill-opacity', 1);\n    // Transition exiting nodes to the parent's new position.\n    var nodeExit = node.exit().transition().duration(duration).attr('transform', function (d) {\n        return 'translate(' + source.y + ',' + source.x + ')';\n      }).remove();\n    nodeExit.select('circle').attr('r', 0);\n    nodeExit.select('text').style('fill-opacity', 0);\n    // Update the links\n    var link = svgGroup.selectAll('path.link').data(links, function (d) {\n        //return d.target.id;\n        return 's' + d.source.id + 't' + d.target.id;\n      });\n    // Enter any new links at the parent's previous position.\n    link.enter().insert('path', 'g').attr('class', 'link').attr('d', function (d) {\n      var o = {\n          x: source.x0,\n          y: source.y0\n        };\n      return diagonal({\n        source: o,\n        target: o\n      });\n    });\n    // Transition links to their new position.\n    link.transition().duration(duration).attr('d', diagonal);\n    // Transition exiting nodes to the parent's new position.\n    link.exit().transition().duration(duration).attr('d', function (d) {\n      var o = {\n          x: source.x,\n          y: source.y\n        };\n      return diagonal({\n        source: o,\n        target: o\n      });\n    }).remove();\n    // Stash the old positions for transition.\n    nodes.forEach(function (d) {\n      d.x0 = d.x;\n      d.y0 = d.y;\n    });\n    // check for rotation if so rotate\n    if (rotated) {\n    }\n  }\n  // Append a group which holds all nodes and which the zoom Listener can act upon.\n  svgGroup = baseSvg.append('g');\n  // Define the root\n  // I presume that the root level of the currently selected path only has one item,\n  // which will be defined as the hierarchy's root item\n  root = LevelService.getLevelDetails(selectedPath[selectedPath.length - 1]).level.items[0];\n  //root = DataService.getData().levels[0].items[0];\n  root.x0 = viewerHeight / 2;\n  root.y0 = 0;\n  // Layout the tree initially and center on the root node.\n  update(root);\n  centerNode(root);\n};\n'use strict';\nangular.module('emuwebApp').service('ArrayHelperService', [\n  '$q',\n  'dialogService',\n  function ArrayHelperService($q, dialogService) {\n    // shared service object\n    var sServObj = {};\n    var defer;\n    // defer promise obj\n    /**\n\t\t * convert values of array to max values\n\t\t *\n\t\t * @param arr array to convert\n\t\t * @returns array containing Math.abs() values\n\t\t */\n    sServObj.convertToAbsValues = function (arr) {\n      for (var i = 0; i < arr.length; i++) {\n        arr[i] = Math.abs(arr[i]);\n      }\n      return arr;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.multiplyEachElement = function (arr, val) {\n      for (var i = 0; i < arr.length; i++) {\n        arr[i] = arr[i] * val;\n      }\n      return arr;\n    };\n    /**\n\t\t * find value between two points\n\t\t * by linearly interpolating them\n\t\t */\n    sServObj.interp2points = function (x0, y0, x1, y1, x) {\n      return y0 + (y1 - y0) * ((x - x0) / (x1 - x0));\n    };\n    /**\n\t\t * find min or maximum value in array\n\t\t *\n\t\t * @param arr array to search in\n\t\t * @param minOrMax string value either 'min' or 'max'\n\t\t * @returns object with attributes val and idx\n\t\t */\n    sServObj.findMinMax = function (arr, minOrMax) {\n      var val, idx;\n      if (minOrMax === 'min') {\n        val = Infinity;\n        for (var i = 0; i < arr.length; i++) {\n          if (arr[i] < val) {\n            val = arr[i];\n            idx = i;\n          }\n        }\n      } else if (minOrMax === 'max') {\n        val = -Infinity;\n        for (var i = 0; i < arr.length; i++) {\n          if (arr[i] > val) {\n            val = arr[i];\n            idx = i;\n          }\n        }\n      }\n      return {\n        'val': val,\n        'idx': idx\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.flattenArrayOfArray = function (arrOfArrs) {\n      var merged = [];\n      merged = merged.concat.apply(merged, arrOfArrs);\n      return merged;\n    };\n    /**\n\t\t * convert array to an array that contains\n\t\t * objects of the form {x: i, y:y[i]}\n\t\t */\n    sServObj.convertArrayToXYjsoArray = function (y) {\n      var xyArray = [];\n      for (var i = 0; i < y.length; i++) {\n        xyArray.push({\n          x: i,\n          y: y[i]\n        });\n      }\n      return xyArray;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('AnagestService', [\n  '$q',\n  '$log',\n  'viewState',\n  'LevelService',\n  'LinkService',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'ArrayHelperService',\n  'dialogService',\n  'HistoryService',\n  function AnagestService($q, $log, viewState, LevelService, LinkService, ConfigProviderService, Ssffdataservice, ArrayHelperService, dialogService, HistoryService) {\n    // shared service object\n    var sServObj = {};\n    // defer object \n    var defer;\n    /**\n\t\t *\n\t\t */\n    sServObj.insertAnagestEvents = function () {\n      var defer = $q.defer();\n      // precheck if there are items in selection\n      var itemInSel = viewState.getItemsInSelection(DataService.data.levels);\n      if (itemInSel.length !== 0) {\n        dialogService.open('views/error.html', 'ModalCtrl', 'There are already events in the selected area! This is not permitted...').then(function () {\n          defer.reject();\n        });\n        return defer;\n      }\n      // vertical position signal\n      var trackName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.verticalPosSsffTrackName;\n      var tr = ConfigProviderService.getSsffTrackConfig(trackName);\n      var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n      var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n      // velocity signal\n      var vTrackName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.velocitySsffTrackName;\n      var vTr = ConfigProviderService.getSsffTrackConfig(vTrackName);\n      var vCol = Ssffdataservice.getColumnOfTrack(vTr.name, vTr.columnName);\n      var vSRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(vTr.name);\n      if (col.length !== 1 || vCol.length !== 1) {\n        dialogService.open('views/error.html', 'ModalCtrl', 'UPS... the column length of of one of the tracks is != 1 this means something is badly configured in the DB!!!').then(function () {\n          defer.reject();\n        });\n        return defer;\n      }\n      // flatten columns\n      var flatColVals = ArrayHelperService.flattenArrayOfArray(col.values);\n      var flatVcolVals = ArrayHelperService.flattenArrayOfArray(vCol.values);\n      /////////////////////////////////////////\n      var gdat = [\n          NaN,\n          NaN\n        ];\n      var vdat = [\n          NaN,\n          NaN\n        ];\n      var ndat = [\n          NaN,\n          NaN\n        ];\n      var cdat = [\n          NaN,\n          NaN\n        ];\n      // easiest way to handle non-tangential signals (and has no effect on tangential signals)\n      flatVcolVals = ArrayHelperService.convertToAbsValues(flatVcolVals);\n      // selected column samples\n      var startTimeSel = viewState.getSelectedStartTime();\n      var endTimeSel = viewState.getSelectedEndTime();\n      var colStartSampleNr = Math.round(startTimeSel * sRaSt.sampleRate + sRaSt.startTime);\n      var colEndSampleNr = Math.round(endTimeSel * sRaSt.sampleRate + sRaSt.startTime);\n      var nrOfSamples = colEndSampleNr - colStartSampleNr;\n      var selCol = flatColVals.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n      var selVCol = flatVcolVals.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n      ;\n      // maxConstr\n      var maxVerticalPos = ArrayHelperService.findMinMax(selCol, 'max');\n      cdat[0] = maxVerticalPos.idx;\n      // max vel before max constriction\n      var maxVelBeforeMaxConstr = ArrayHelperService.findMinMax(selVCol.slice(0, cdat[0] + 1), 'max');\n      vdat[0] = maxVelBeforeMaxConstr.idx;\n      // min vel before max vel\n      var minVelBeforeMaxVel = ArrayHelperService.findMinMax(selVCol.slice(0, vdat[0] + 1), 'min');\n      // gesture onset\n      $log.info('Looking for gesture onset');\n      sServObj.interactiveFindThresholds(selVCol.slice(0, vdat[0] + 1), minVelBeforeMaxVel.val, maxVelBeforeMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, 1, 'Looking for gesture onset').then(function (resp) {\n        // keyboard;\n        var on20 = resp;\n        gdat[0] = on20;\n        // min vel between max vel 1 and max constriction\n        var minVelBetwMaxVel1maxConstr = ArrayHelperService.findMinMax(selVCol.slice(vdat[0], cdat[0] + 1), 'min');\n        var minp = minVelBetwMaxVel1maxConstr.idx + vdat[0];\n        // nucleus onset\n        $log.info('Looking for nucleus onset');\n        sServObj.interactiveFindThresholds(selVCol.slice(vdat[0], minp + 1), minVelBetwMaxVel1maxConstr.val, maxVelBeforeMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, -1, 'Looking for nucleus onset').then(function (resp) {\n          var off20 = resp;\n          ndat[0] = off20 + vdat[0];\n          // max vel after max constriction\n          var maxVelAfterMaxConstr = ArrayHelperService.findMinMax(selVCol.slice(cdat[0]), 'max');\n          // max vel before max constriction\n          vdat[1] = maxVelAfterMaxConstr.idx + cdat[0];\n          // minimum between max constriction and max vel after constriction\n          var minBetwMaxConstrMaxVelConstr = ArrayHelperService.findMinMax(selVCol.slice(cdat[0], vdat[1] + 1), 'min');\n          minp = minBetwMaxConstrMaxVelConstr.idx + cdat[0];\n          // nucleus offset\n          $log.info('Looking for nucleus offset');\n          sServObj.interactiveFindThresholds(selVCol.slice(minp, vdat[1] + 1), minBetwMaxConstrMaxVelConstr.val, maxVelAfterMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, 1, 'Looking for nucleus offset').then(function (resp) {\n            var on20 = resp;\n            ndat[1] = on20 + minp;\n            // minimum velocity after max vel after constriction\n            var minVelAfterMaxVelAfterConstr = ArrayHelperService.findMinMax(selVCol.slice(vdat[1]), 'min');\n            minp = minVelAfterMaxVelAfterConstr.idx + vdat[1];\n            // gesture offset\n            $log.info('Looking for gesture offset');\n            sServObj.interactiveFindThresholds(selVCol.slice(vdat[1], minp + 1), minVelAfterMaxVelAfterConstr.val, maxVelAfterMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, -1, 'Looking for gesture offset').then(function (resp) {\n              var off20 = resp;\n              gdat[1] = off20 + vdat[1];\n              // insert points\n              // var insPoint;\n              var curLabel;\n              // console.log(gdat)\n              gdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + gdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              gdat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + gdat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.gestureOnOffsetLabels[0];\n              var gdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), gdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': gdat[0],\n                'id': gdat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.gestureOnOffsetLabels[1];\n              var gdat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), gdat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': gdat[1],\n                'id': gdat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(vdat);\n              vdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + vdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              vdat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + vdat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxVelocityOnOffsetLabels[0];\n              var vdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), vdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': vdat[0],\n                'id': vdat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxVelocityOnOffsetLabels[1];\n              var vdat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), vdat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': vdat[1],\n                'id': vdat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(ndat);\n              ndat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + ndat[0], sRaSt.sampleRate, sRaSt.startTime);\n              ndat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + ndat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.constrictionPlateauBeginEndLabels[0];\n              var ndat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), ndat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': ndat[0],\n                'id': ndat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.constrictionPlateauBeginEndLabels[1];\n              var ndat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), ndat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': ndat[1],\n                'id': ndat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(cdat);\n              cdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + cdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxConstrictionLabel;\n              var cdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), cdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': cdat[0],\n                'id': cdat0insPoint.id,\n                'pointName': curLabel\n              });\n              var linkLevelName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.autoLinkLevelName;\n              var linkLevelDetails = LevelService.getLevelDetails(linkLevelName);\n              var linkLevelLabels = LevelService.getAllLabelsOfLevel(linkLevelDetails);\n              dialogService.open('views/SelectLabelModal.html', 'SelectLabelModalCtrl', linkLevelLabels).then(function (itemIdx) {\n                var childIDs = [\n                    gdat0insPoint.id,\n                    gdat1insPoint.id,\n                    vdat0insPoint.id,\n                    vdat1insPoint.id,\n                    ndat0insPoint.id,\n                    ndat1insPoint.id,\n                    cdat0insPoint.id\n                  ];\n                LinkService.insertLinksTo(linkLevelDetails.level.items[itemIdx].id, childIDs);\n                HistoryService.updateCurChangeObj({\n                  'type': 'ANNOT',\n                  'action': 'INSERTLINKSTO',\n                  'name': linkLevelDetails.level.name,\n                  'parentID': linkLevelDetails.level.items[itemIdx].id,\n                  'childIDs': childIDs\n                });\n                HistoryService.addCurChangeObjToUndoStack();\n              });\n              defer.resolve();\n            });\n          });\n        });\n      }, function () {\n        console.error('rejected duuuude!!!!');\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * find threshold in array (an adapted reimplementation of findth.m by\n\t\t * Phil Hoole Version 17.6.2006)\n\t\t *\n\t\t * @param x\n\t\t * @param minVal\n\t\t * @param maxVal\n\t\t * @param threshold\n\t\t * @param direction\n\t\t * @param descriptions describes the task\n\t\t * @returns promise that resolves to threshold value\n\t\t */\n    sServObj.interactiveFindThresholds = function (x, minVal, maxVal, threshold, direction, description) {\n      // console.log('interactiveFindThresholds');\n      var thdat = minVal + (maxVal - minVal) * threshold;\n      var thdir = direction;\n      thdat = thdat * thdir;\n      var xx = ArrayHelperService.multiplyEachElement(x, thdir);\n      // handle positive/neg.\n      var lx = xx.length;\n      var xsh = xx.slice(1, lx);\n      var loguk = 0;\n      var higuk = lx - 1;\n      // console.log(lx);\n      // console.log(xx);\n      // console.log(xsh);\n      // console.log(loguk);\n      // console.log(higuk);\n      // vz=find((xsh>=thdat)&(xx(1:(lx-1))<thdat));\n      var vz = [];\n      for (var i = 0; i < xx.length; i++) {\n        if (xsh[i] >= thdat && xx[i] < thdat) {\n          vz.push(i);\n        }\n      }\n      // anavv=find(vz>=loguk & vz<=higuk);\n      var anavv = [];\n      for (var i = 0; i < vz.length; i++) {\n        if (vz[i] >= loguk && vz[i] <= higuk) {\n          anavv.push(i);\n        }\n      }\n      if (anavv.length > 1) {\n        defer = $q.defer();\n        var infos = {};\n        infos.description = description;\n        infos.options = [];\n        infos.y = xx;\n        infos.minVal = minVal;\n        infos.maxVal = maxVal;\n        infos.threshold = threshold;\n        for (var i = 0; i < vz.length; i++) {\n          infos.options.push({\n            'thresholdIdx': vz[i],\n            'thresholdValue': xx[i]\n          });\n        }\n        dialogService.open('views/SelectThresholdModal.html', 'SelectThresholdModalCtrl', infos).then(function (resp) {\n          var ap = vz[anavv[resp]];\n          // console.log('-----')\n          // console.log(xx[ap])\n          // console.log(xx[ap + 1])\n          // console.log(ap);\n          // console.log(ap + 1);\n          ap = ArrayHelperService.interp2points(xx[ap], ap, xx[ap + 1], ap + 1, thdat);\n          defer.resolve(ap);\n        });\n        return defer.promise;\n      } else if (anavv.length === 0) {\n        defer = $q.defer();\n        dialogService.open('views/error.html', 'ModalCtrl', 'Could not find any values that step over the threshold!!').then(function () {\n          defer.reject('Could not find any values that step over the threshold!!');\n        });\n        return defer.promise;\n      } else {\n        defer = $q.defer();\n        var ap = vz[anavv[0]];\n        ap = ArrayHelperService.interp2points(xx[ap], ap, xx[ap + 1], ap + 1, thdat);\n        defer.resolve(ap);\n        return defer.promise;\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc directive\n * @name emuWebAppApp.directive:lineChart\n * @description\n * # lineChart\n */\nangular.module('emuwebApp').directive('lineChart', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      data: '=',\n      threshold: '='\n    },\n    link: function postLink(scope, element, attrs) {\n      //////////////////////\n      // watches \n      scope.$watch('data', function () {\n        scope.render(scope.data);\n      }, true);\n      //////////////////////\n      //Set margins, width, and height\n      var margin = {\n          top: 20,\n          right: 20,\n          bottom: 20,\n          left: 40\n        }, width = 400 - margin.left - margin.right, height = 200 - margin.top - margin.bottom;\n      //Create the d3 element and position it based on margins\n      var svg = d3.select(element[0]).append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n      //Create the scales we need for the graph\n      var x = d3.scale.linear().range([\n          0,\n          width\n        ]);\n      var y = d3.scale.linear().range([\n          height,\n          0\n        ]);\n      //Create the axes we need for the graph\n      var xAxis = d3.svg.axis().scale(x).tickSize(5).tickSubdivide(true);\n      var yAxis = d3.svg.axis().scale(y).orient('left');\n      // line drawing function\n      var lineFunc = d3.svg.line().x(function (d) {\n          return x(d.x);\n        }).y(function (d) {\n          return y(d.y);\n        }).interpolate('linear');\n      /**\n\t\t\t\t *\n\t\t\t\t */\n      scope.render = function (data) {\n        //Set our scale's domains\n        // x.domain(data.map(function (d) {\n        // \treturn d.name;\n        // }));\n        // y.domain([0, d3.max(data, function (d) {\n        // \treturn d.count;\n        // })]);\n        x.domain([\n          d3.min(data, function (d) {\n            return d.x;\n          }),\n          d3.max(data, function (d) {\n            return d.x;\n          })\n        ]);\n        y.domain([\n          d3.min(data, function (d) {\n            return d.y;\n          }),\n          d3.max(data, function (d) {\n            return d.y;\n          })\n        ]);\n        //Remove the axes so we can draw updated ones\n        svg.selectAll('g.axis').remove();\n        //Render X axis\n        svg.append('g').attr('class', 'x axis').attr('transform', 'translate(0,' + height + ')').call(xAxis);\n        //Render Y axis\n        svg.append('g').attr('class', 'y axis').call(yAxis);\n        // Render path\n        var lines = svg.append('svg:path').attr('d', lineFunc(data)).attr('stroke', 'red').attr('stroke-width', 1).attr('fill', 'none');\n        // draw threshold SIC SIC SIC... not working yet!\n        svg.append('svg:line').attr('x1', 5).attr('y1', 5).attr('x2', 200).attr('y2', 200).attr('class', 'label-line');\n        var verticalLine = svg.append('line').attr({\n            'x1': x(scope.threshold),\n            'y1': 0,\n            'x2': x(scope.threshold),\n            'y2': height\n          }).attr('stroke', 'steelblue').attr('class', 'verticalLine');  //Create or update the bar data\n                                                                         // var bars = svg.selectAll('.bar').data(data);\n                                                                         // bars.enter()\n                                                                         // \t.append('rect')\n                                                                         // \t.attr('class', 'bar')\n                                                                         // \t.attr('x', function (d) {\n                                                                         // \t\treturn x(d.name);\n                                                                         // \t})\n                                                                         // \t.attr('width', x.rangeBand());\n                                                                         //Animate bars\n                                                                         // bars\n                                                                         // \t.transition()\n                                                                         // \t.duration(1000)\n                                                                         // \t.attr('height', function (d) {\n                                                                         // \t\treturn height - y(d.count);\n                                                                         // \t})\n                                                                         // \t.attr('y', function (d) {\n                                                                         // \t\treturn y(d.count);\n                                                                         // \t})\n      };\n    }\n  };\n});\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.loadedMetaDataService\n * @description\n * # loadedMetaDataService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('loadedMetaDataService', [\n  'dialogService',\n  'Validationservice',\n  function loadedMetaDataService(dialogService, Validationservice) {\n    // shared service object\n    var sServObj = {};\n    //////////////////////\n    // private vars\n    var uniqSessionList = [];\n    var bundleList = [];\n    var curBndl = {};\n    var demoDbName = '';\n    //////////////////////\n    // private functions\n    function genUniqSessionList(bndlList) {\n      var sList = [];\n      var fistSes;\n      bndlList.forEach(function (bndl, idx) {\n        sList[bndl.session] = { 'collapsed': true };\n        if (idx === 0) {\n          fistSes = bndl.session;\n        }\n      });\n      // open fist session up \n      sList[fistSes].collapsed = false;\n      return sList;\n    }\n    //////////////////////\n    //////////////////////\n    // public API\n    ///////////////\n    // bundleList\n    /**\n\t\t * setter for bundleList\n\t\t * @returns validation result for bundle list\n\t\t */\n    sServObj.setBundleList = function (bList) {\n      // validate\n      var validRes = Validationservice.validateJSO('bundleListSchema', bList);\n      if (validRes === true) {\n        // set\n        bundleList = bList;\n        // generate uniqSessionList\n        uniqSessionList = genUniqSessionList(bundleList);\n      }\n      return validRes;\n    };\n    /**\n\t\t * getter for bundleList\n\t\t */\n    sServObj.getBundleList = function () {\n      return bundleList;\n    };\n    ///////////\n    // curBndl \n    /**\n\t\t * set curBndl\n\t\t */\n    sServObj.setCurBndl = function (bndl) {\n      curBndl = bndl;\n    };\n    /**\n\t\t * setter curBndl name\n\t\t */\n    sServObj.setCurBndlName = function (name) {\n      curBndl.name = name;\n    };\n    /**\n\t\t * setter curBndl name\n\t\t */\n    sServObj.getCurBndlName = function () {\n      return curBndl.name;\n    };\n    /**\n\t\t * getter curBndl\n\t\t */\n    sServObj.getCurBndl = function () {\n      return curBndl;\n    };\n    //////////////\n    // demoDbName\n    /**\n\t\t * setter curBndl\n\t\t */\n    sServObj.setDemoDbName = function (name) {\n      demoDbName = name;\n    };\n    /**\n\t\t * getter curBndl\n\t\t */\n    sServObj.getDemoDbName = function () {\n      return demoDbName;\n    };\n    ///////////////////\n    // uniqSessionList\n    /**\n\t\t *\n\t\t */\n    sServObj.toggleCollapseSession = function (session) {\n      uniqSessionList[session].collapsed = !uniqSessionList[session].collapsed;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.updateCollapseSessionState = function (text) {\n      angular.forEach(sServObj.getBundleList(), function (bundle) {\n        if (bundle.name.indexOf(text)) {\n          uniqSessionList[bundle.session].collapsed = false;\n        } else {\n          uniqSessionList[bundle.session].collapsed = true;\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSessionCollapseState = function (session) {\n      return uniqSessionList[session].collapsed;\n    };\n    ///////////////////\n    // other functions\n    /**\n\t\t * reset all private vals to init state\n\t\t */\n    sServObj.resetToInitState = function () {\n      uniqSessionList = [];\n      bundleList = [];\n      curBndl = {};\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc function\n * @name emuwebApp.controller:BundlelistsidebarctrlCtrl\n * @description\n * # bundleListSideBarCtrl\n * Controller of the bundleListSideBar\n */\nangular.module('emuwebApp').controller('bundleListSideBarCtrl', [\n  '$scope',\n  'viewState',\n  'HistoryService',\n  'loadedMetaDataService',\n  'dbObjLoadSaveService',\n  'ConfigProviderService',\n  function ($scope, viewState, HistoryService, loadedMetaDataService, dbObjLoadSaveService, ConfigProviderService) {\n    $scope.vs = viewState;\n    $scope.lmds = loadedMetaDataService;\n    $scope.dolss = dbObjLoadSaveService;\n    $scope.cps = ConfigProviderService;\n    $scope.filterText = '';\n    /**\n\t\t * returns false if bndl is current bndl\n\t\t */\n    $scope.uttIsDisabled = function (bndl) {\n      if (bndl.name === loadedMetaDataService.getCurBndl().name) {\n        return false;\n      } else {\n        return true;\n      }\n    };\n    /**\n\t\t * returns jso with css defining color dependent\n\t\t * on if changes have been made that have not been saved\n\t\t * @param bndl object containing name attribute of bundle item\n\t\t * requesting color\n\t\t * @returns color as jso object used by ng-style\n\t\t */\n    $scope.getBndlColor = function (bndl) {\n      var curColor;\n      if (HistoryService.movesAwayFromLastSave !== 0) {\n        curColor = {\n          'background-color': '#f00',\n          'color': 'white'\n        };\n      } else {\n        curColor = {\n          'background-color': '#999',\n          'color': 'black'\n        };\n      }\n      // console.log(bndl.name)\n      if (bndl.name === loadedMetaDataService.getCurBndl().name) {\n        return curColor;\n      }\n    };\n    /**\n\t\t * checks if name is undefined\n\t\t * @return bool\n\t\t */\n    $scope.isSessionDefined = function (ses) {\n      if (ses === 'undefined') {\n        return false;\n      } else {\n        return true;\n      }\n    };\n  }\n]);\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.dbObjLoadSaveService\n * @description\n * # dbObjLoadSaveService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('dbObjLoadSaveService', [\n  '$log',\n  '$q',\n  'DataService',\n  'viewState',\n  'HistoryService',\n  'loadedMetaDataService',\n  'Ssffdataservice',\n  'Iohandlerservice',\n  'Binarydatamaniphelper',\n  'Wavparserservice',\n  'Soundhandlerservice',\n  'Ssffparserservice',\n  'Validationservice',\n  'LevelService',\n  'dialogService',\n  'ConfigProviderService',\n  function dbObjLoadSaveService($log, $q, DataService, viewState, HistoryService, loadedMetaDataService, Ssffdataservice, Iohandlerservice, Binarydatamaniphelper, Wavparserservice, Soundhandlerservice, Ssffparserservice, Validationservice, LevelService, dialogService, ConfigProviderService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t * general loadBundle method.\n\t\t * @param bndl object containing name attribute of currently loaded bundle\n\t\t */\n    sServObj.loadBundle = function (bndl) {\n      // check if bndl has to be saved\n      if (HistoryService.movesAwayFromLastSave !== 0 && ConfigProviderService.vals.main.comMode !== 'DEMO') {\n        if (bndl !== loadedMetaDataService.getCurBndl()) {\n          // $scope.lastclickedutt = bndl;\n          dialogService.open('views/saveChanges.html', 'ModalCtrl', bndl.name).then(function (messModal) {\n            if (messModal === 'saveChanges') {\n              // save current bundle\n              sServObj.saveBundle().then(function () {\n                // load new bundle\n                sServObj.loadBundle(bndl);\n              });\n            } else if (messModal === 'discardChanges') {\n              // reset history\n              HistoryService.resetToInitState();\n              // load new bundle\n              sServObj.loadBundle(bndl);\n            }\n          });\n        }\n      } else {\n        if (bndl !== loadedMetaDataService.getCurBndl() && ConfigProviderService.vals.main.comMode !== 'embedded') {\n          // reset history\n          HistoryService.resetToInitState();\n          // set state\n          viewState.setState('loadingSaving');\n          viewState.somethingInProgress = true;\n          viewState.somethingInProgressTxt = 'Loading bundle: ' + bndl.name;\n          // empty ssff files\n          Ssffdataservice.data = [];\n          Iohandlerservice.getBundle(bndl.name, bndl.session, loadedMetaDataService.getDemoDbName()).then(function (bundleData) {\n            // check if response from http request\n            if (bundleData.status === 200) {\n              bundleData = bundleData.data;\n            }\n            var arrBuff;\n            // set wav file\n            arrBuff = Binarydatamaniphelper.base64ToArrayBuffer(bundleData.mediaFile.data);\n            viewState.somethingInProgressTxt = 'Parsing WAV file...';\n            Wavparserservice.parseWavArrBuf(arrBuff).then(function (messWavParser) {\n              var wavJSO = messWavParser;\n              viewState.curViewPort.sS = 0;\n              viewState.curViewPort.eS = wavJSO.Data.length;\n              viewState.curViewPort.selectS = -1;\n              viewState.curViewPort.selectE = -1;\n              viewState.curClickSegments = [];\n              viewState.curClickLevelName = undefined;\n              viewState.curClickLevelType = undefined;\n              viewState.resetSelect();\n              // FOR DEVELOPMENT:\n              // viewState.curViewPort.sS = 52063;\n              // viewState.curViewPort.eS = 52100;\n              // viewState.curViewPort.selectS = 27575;\n              // viewState.curViewPort.selectE = 34538;\n              Soundhandlerservice.wavJSO = wavJSO;\n              // set all ssff files\n              viewState.somethingInProgressTxt = 'Parsing SSFF files...';\n              Ssffparserservice.asyncParseSsffArr(bundleData.ssffFiles).then(function (ssffJso) {\n                Ssffdataservice.data = ssffJso.data;\n                var validRes = Validationservice.validateJSO('annotationFileSchema', bundleData.annotation);\n                if (validRes === true) {\n                  // set annotation\n                  DataService.setData(bundleData.annotation);\n                  loadedMetaDataService.setCurBndl(bndl);\n                  viewState.setState('labeling');\n                  viewState.somethingInProgress = false;\n                  viewState.somethingInProgressTxt = 'Done!';  // FOR DEVELOPMENT:\n                                                               // $scope.menuBundleSaveBtnClick(); // for testing save button\n                                                               // $scope.showHierarchyBtnClick(); // for devel of showHierarchy modal\n                                                               // $scope.spectSettingsBtnClick(); // for testing spect settings dial\n                } else {\n                  dialogService.open('views/error.html', 'ModalCtrl', 'Error validating annotation file: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                    $scope.resetToInitState();\n                  });\n                }\n              }, function (errMess) {\n                dialogService.open('views/error.html', 'ModalCtrl', 'Error parsing SSFF file: ' + errMess.status.message).then(function () {\n                  $scope.resetToInitState();\n                });\n              });\n            }, function (errMess) {\n              dialogService.open('views/error.html', 'ModalCtrl', 'Error parsing wav file: ' + errMess.status.message).then(function () {\n                $scope.resetToInitState();\n              });\n            });\n          }, function (errMess) {\n            // check for http vs websocket response\n            if (errMess.data) {\n              dialogService.open('views/error.html', 'ModalCtrl', 'Error loading bundle: ' + errMess.data).then(function () {\n                $scope.resetToInitState();\n              });\n            } else {\n              dialogService.open('views/error.html', 'ModalCtrl', 'Error loading bundle: ' + errMess.status.message).then(function () {\n                $scope.resetToInitState();\n              });\n            }\n          });\n        }\n      }\n    };\n    /**\n\t\t * general purpose save bundle function.\n\t\t * @return promise that is resolved after completion (rejected on error)\n\t\t */\n    sServObj.saveBundle = function () {\n      // check if something has changed\n      // if (HistoryService.movesAwayFromLastSave !== 0) {\n      if (viewState.getPermission('saveBndlBtnClick')) {\n        var defer = $q.defer();\n        viewState.somethingInProgress = true;\n        viewState.setState('loadingSaving');\n        //create bundle json\n        var bundleData = {};\n        viewState.somethingInProgressTxt = 'Creating bundle json...';\n        bundleData.ssffFiles = [];\n        var formants = {};\n        // ssffFiles (only FORMANTS are allowed to be manipulated so only this track is sent back to server)\n        Ssffdataservice.data.forEach(function (el) {\n          if (el.ssffTrackName === 'FORMANTS') {\n            formants = el;\n          }\n        });\n        if (!$.isEmptyObject(formants)) {\n          Ssffparserservice.asyncJso2ssff(formants).then(function (messParser) {\n            bundleData.ssffFiles.push({\n              'ssffTrackName': formants.ssffTrackName,\n              'encoding': 'BASE64',\n              'data': Binarydatamaniphelper.arrayBufferToBase64(messParser.data)\n            });\n            sServObj.getAnnotationAndSaveBndl(bundleData, defer);\n          }, function (errMess) {\n            dialogService.open('views/error.html', 'ModalCtrl', 'Error converting javascript object to SSFF file: ' + errMess.status.message);\n            defer.reject();\n          });\n        } else {\n          sServObj.getAnnotationAndSaveBndl(bundleData, defer);\n        }\n        return defer.promise;  // }\n      } else {\n        $log.info('Action: menuBundleSaveBtnClick not allowed!');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getAnnotationAndSaveBndl = function (bundleData, defer) {\n      // annotation\n      bundleData.annotation = DataService.getData();\n      // add session\n      var curBndl = loadedMetaDataService.getCurBndl();\n      if (typeof curBndl.session !== 'undefined') {\n        bundleData.session = curBndl.session;\n      }\n      viewState.somethingInProgressTxt = 'Saving bundle...';\n      Iohandlerservice.saveBundle(bundleData).then(function () {\n        viewState.somethingInProgressTxt = 'Done!';\n        viewState.somethingInProgress = false;\n        HistoryService.movesAwayFromLastSave = 0;\n        defer.resolve();\n        viewState.setState('labeling');\n      }, function (errMess) {\n        // console.log(mess);\n        dialogService.open('views/error.html', 'ModalCtrl', 'Error saving bundle: ' + errMess.status.message).then(function () {\n          $scope.resetToInitState();\n        });\n        defer.reject();\n      });\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.appStateService\n * @description\n * # appStateService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('appStateService', [\n  '$log',\n  '$rootScope',\n  'viewState',\n  'Iohandlerservice',\n  'loadedMetaDataService',\n  'Soundhandlerservice',\n  'DataService',\n  'Ssffdataservice',\n  'HistoryService',\n  function appStateService($log, $rootScope, viewState, Iohandlerservice, loadedMetaDataService, Soundhandlerservice, DataService, Ssffdataservice, HistoryService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t *\n\t\t */\n    sServObj.resetToInitState = function () {\n      if (Iohandlerservice.wsH.isConnected()) {\n        Iohandlerservice.wsH.disconnectWarning().then(function (resp) {\n          $log.info('Closing websocket connection to server');\n          Iohandlerservice.wsH.closeConnect();\n        });\n      }\n      // $scope.curBndl = {};\n      loadedMetaDataService.resetToInitState();\n      Soundhandlerservice.wavJSO = {};\n      DataService.setData({});\n      Ssffdataservice.data = [];\n      HistoryService.resetToInitState();\n      viewState.setState('noDBorFilesloaded');\n      viewState.somethingInProgress = false;\n      viewState.resetToInitState();\n      HistoryService.resetToInitState();\n      viewState.showDropZone = true;\n      $rootScope.$broadcast('resetToInitState');  //$scope.loadDefaultConfig();\n    };\n    return sServObj;\n  }\n]);\n/**\n * A simple class that creates another thread\n * which does the wavParserWorker work\n * @class wavParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction wavParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nwavParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    //expand ArrayBuffer with subarray function\n    ArrayBuffer.prototype.subarray = function (offset, length) {\n      var sub = new ArrayBuffer(length);\n      var subView = new Int8Array(sub);\n      var thisView = new Int8Array(this);\n      for (var i = 0; i < length; i++) {\n        subView[i] = thisView[offset + i];\n      }\n      return sub;\n    };\n    global.ab2str = function (ab) {\n      var unis = [];\n      for (var i = 0; i < ab.length; i++) {\n        unis.push(ab[i]);\n      }\n      return String.fromCharCode.apply(null, unis);\n    };\n    global.wav2jso = function (buf) {\n      var wavRep = {};\n      // var uIntBuffView = new Uint8Array(buf);\n      var curBinIdx, curBuffer, curBufferView;\n      // var dv = new DataView(buf);\n      // var ChunkSize = dv.getUint32(4)\n      // console.log(ChunkSize)\n      // ChunkId == RIFF CHECK\n      curBinIdx = 0;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.ChunkID = global.ab2str(curBufferView);\n      if (wavRep.ChunkID !== 'RIFF') {\n        // console.error('Wav read error: ChunkID not RIFF. Got ' + wavRep.ChunkID);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: ChunkID not RIFF but ' + wavRep.ChunkID\n          }\n        };\n      }\n      // ChunkSize\n      curBinIdx = 4;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.ChunkSize = curBufferView[0];\n      // console.log(chunkSize)\n      // Format == WAVE CHECK\n      curBinIdx = 8;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.Format = global.ab2str(curBufferView);\n      if (wavRep.Format !== 'WAVE') {\n        // console.error('Wav read error: Format not WAVE. Got ' + wavRep.Format);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Format not WAVE but ' + wavRep.Format\n          }\n        };\n      }\n      // Subchunk1ID == \"fmt \" CHECK\n      curBinIdx = 12;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.Subchunk1ID = global.ab2str(curBufferView);\n      if (wavRep.Subchunk1ID !== 'fmt ') {\n        // console.error('Wav read error: Subchunk1ID not fmt. Got ' + wavRep.Subchunk1ID);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Subchunk1ID not fmt  but ' + wavRep.Subchunk1ID\n          }\n        };\n      }\n      // Subchunk1Size == 16 CHECK\n      curBinIdx = 16;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.Subchunk1Size = curBufferView[0];\n      if (wavRep.Subchunk1Size !== 16) {\n        // console.error('Wav read error: Subchunk1Size not 16');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Subchunk1Size not 16 but ' + wavRep.Subchunk1Size\n          }\n        };\n      }\n      // AudioFormat == 1  CHECK\n      curBinIdx = 20;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.AudioFormat = curBufferView[0];\n      if (wavRep.AudioFormat !== 1) {\n        // console.error('Wav read error: AudioFormat not 1');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: AudioFormat not 1 but ' + wavRep.AudioFormat\n          }\n        };\n      }\n      // NumChannels == 1  CHECK\n      curBinIdx = 22;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.NumChannels = curBufferView[0];\n      // console.error('Wav read error: NumChannels not 1');\n      if (wavRep.NumChannels !== 1) {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: NumChannels not 1 but ' + wavRep.NumChannels\n          }\n        };\n      }\n      // SampleRate \n      curBinIdx = 24;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.SampleRate = curBufferView[0];\n      // ByteRate\n      curBinIdx = 28;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.ByteRate = curBufferView[0];\n      // BlockAlign\n      curBinIdx = 32;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.BlockAlign = curBufferView[0];\n      // console.error(blockAlign);\n      // BitsPerSample\n      curBinIdx = 34;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.BitsPerSample = curBufferView[0];\n      if (wavRep.BitsPerSample !== 16) {\n        // console.error('Wav read error: NumChannels not 1');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: BitsPerSample not 16 but ' + wavRep.BitsPerSample\n          }\n        };\n      }\n      // Subchunk2ID\n      curBinIdx = 36;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.Subchunk2ID = global.ab2str(curBufferView);\n      if (wavRep.Subchunk2ID !== 'data') {\n        // console.error('Wav read error: BitsPerSample not 16');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Subchunk2ID not data but ' + wavRep.Subchunk2ID\n          }\n        };\n      }\n      // Subchunk2Size\n      curBinIdx = 40;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.Subchunk2Size = curBufferView[0];\n      // Data\n      curBinIdx = 44;\n      curBuffer = buf.subarray(curBinIdx, wavRep.Subchunk2Size);\n      curBufferView = new Int16Array(curBuffer);\n      wavRep.Data = curBufferView;\n      // console.log(wavRep);\n      // finally append original array buffer\n      wavRep.origArrBuf = buf;\n      return wavRep;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        switch (e.data.cmd) {\n        case 'parseBuf':\n          var parserRes = global.wav2jso(e.data.buffer);\n          if (parserRes.status === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': parserRes\n            });\n          } else {\n            global.postMessage(parserRes);\n          }\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to wavParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to wavParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      URL.revokeObjectURL(this.url);\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n/**\n * A simple class that creates another thread\n * which does the espsParserWorker work\n * @class espsParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction espsParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nespsParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    global.toJSO = function (string, annotates, name, sampleRate) {\n      var labelJSO = {};\n      labelJSO.name = name;\n      labelJSO.annotates = annotates;\n      labelJSO.sampleRate = sampleRate;\n      labelJSO.levels = [];\n      // var ext = '_' + filePath.split('.')[filePath.split('.').length - 1];\n      // remove all empty lines from string\n      string = string.replace(/([ \\t]*\\r?\\n)+/g, '\\n');\n      // replace all blanks with single whitespace\n      string = string.replace(/[ \\t]+/g, ' ');\n      var lines = string.split('\\n');\n      // find header end\n      var headEndIdx;\n      for (var i = 0; i < lines.length; i++) {\n        if (lines[i] === '#') {\n          headEndIdx = i;\n          break;\n        }\n      }\n      //init empty labelJSO\n      labelJSO.levels[0] = {};\n      labelJSO.levels[0].name = name;\n      labelJSO.levels[0].items = [];\n      var idCounter = 1;\n      // set level type\n      var prevLineArr;\n      var curLineArr = lines[headEndIdx + 1].split(/\\s+/);\n      if (curLineArr[curLineArr.length - 1] !== 'H#') {\n        labelJSO.levels[0].type = 'EVENT';\n      } else {\n        labelJSO.levels[0].type = 'SEGMENT';\n      }\n      if (labelJSO.levels[0].type === 'EVENT') {\n        for (i = headEndIdx + 1; i < lines.length - 1; i++) {\n          curLineArr = lines[i].split(/\\s+/);\n          labelJSO.levels[0].items.push({\n            id: idCounter,\n            labels: [{\n                name: name,\n                value: curLineArr[curLineArr.length - 1]\n              }],\n            samplePoint: Math.floor(curLineArr[1] * sampleRate)\n          });\n          idCounter += 1;\n        }\n      } else {\n        // take care of H# by not doing anything :-)\n        idCounter += 1;\n        for (i = headEndIdx + 2; i < lines.length - 1; i++) {\n          curLineArr = lines[i].split(/\\s+/);\n          prevLineArr = lines[i - 1].split(/\\s+/);\n          labelJSO.levels[0].items.push({\n            id: idCounter,\n            labels: [{\n                name: name,\n                value: curLineArr[curLineArr.length - 1]\n              }],\n            sampleStart: Math.floor(prevLineArr[1] * sampleRate),\n            sampleDur: Math.floor(curLineArr[1] * sampleRate) - Math.floor(prevLineArr[1] * sampleRate) - 1\n          });\n          idCounter += 1;\n        }\n      }\n      return labelJSO;\n    };\n    /**\n\t * SIC! This function probably has to be fixed...\n\t */\n    global.toESPS = function (data, name, sampleRate) {\n      var espsStr = '';\n      // construct header\n      espsStr += 'signal ' + name + '\\n';\n      espsStr += 'nfields 1\\n';\n      espsStr += '#\\n';\n      var curLabel;\n      for (var j = 0; j < data.length; j++) {\n        //angular.forEach(data, function (i, idx) {\n        if (data[j].labels[0].value === '' && j === 0) {\n          curLabel = 'H#';\n        } else {\n          curLabel = data[j].labels[0].value;\n        }\n        espsStr += '\\t' + String((data[j].sampleStart + data[j].sampleDur) / sampleRate) + '\\t125\\t' + curLabel + '\\n';\n      }\n      //});\n      // console.log(espsStr);\n      return espsStr;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        var retVal;\n        switch (e.data.cmd) {\n        case 'parseESPS':\n          retVal = global.toJSO(e.data.esps, e.data.annotates, e.data.name, e.data.sampleRate);\n          if (retVal.type === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        case 'parseJSO':\n          retVal = global.toESPS(e.data.level.items, e.data.level.name, e.data.sampleRate);\n          if (retVal.type === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to espsParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to espsParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      URL.revokeObjectURL(this.url);\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n/**\n * A simple class that creates another thread\n * which does the textGridParserWorker work\n * @class textGridParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction textGridParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\ntextGridParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    global.l1 = 'File type = \"ooTextFile\"';\n    global.l2 = 'Object class = \"TextGrid\"';\n    global.localID = 0;\n    /**\n\t * test to see if all the segments in seg levels\n\t * are \"snapped\" -> sampleStart+dur+1 = sampleStart of next Segment\n\t */\n    global.testForGapsInLabelJSO = function (labelJSO) {\n      var counter = 0;\n      for (var i = 0; i < labelJSO.levels.length; i++) {\n        if (labelJSO.levels[i].type === 'SEGMENT') {\n          for (var j = 0; j < labelJSO.levels[i].items.length - 1; j++) {\n            if (labelJSO.levels[i].items[j].sampleStart + labelJSO.levels[i].items[j].sampleDur + 1 !== labelJSO.levels[i].items[j + 1].sampleStart) {\n              counter = counter + 1;\n            }\n          }\n        }\n      }\n    };\n    /**\n\t *\n\t */\n    global.findTimeOfMinSample = function () {\n      return 0;  // maybe needed at some point...\n    };\n    /**\n\t *\n\t */\n    global.findTimeOfMaxSample = function (buffLength, sampleRate) {\n      return buffLength / sampleRate;\n    };\n    /**\n\t * parse a textgrid string to the specified json format\n\t *\n\t * @param string TextGrid file string to be parsed\n\t * @returns a label java script object\n\t */\n    global.toJSO = function (string, myFile, myName, sampleRate) {\n      var VU_STR = '123abcABCCBAcba321';\n      // very unlikly string\n      // remove all empty lines from string\n      string = string.replace(/([ \\t]*\\r?\\n)+/g, '\\n');\n      // replace blanks in quates with VU_STR to preserve blanks in labels\n      string = string.replace(/(\"[^\\n]*\")/g, function ($0, $1) {\n        var res = $1.replace(/\\s+/g, VU_STR);\n        return res;\n      });\n      // remove remaining blanks\n      string = string.replace(/[\\t ]+/g, '');\n      // convert VU_STR back to blanks\n      var re = new RegExp(VU_STR, 'g');\n      string = string.replace(re, ' ');\n      var lines = string.split('\\n');\n      var tT, tN, eT, lab;\n      var inHeader = true;\n      var labs = [];\n      //meta info for labelJSO\n      var labelJSO = {\n          name: myName,\n          annotates: myFile,\n          sampleRate: sampleRate,\n          levels: [],\n          links: []\n        };\n      if (lines[0].replace(/\\s+/g, '') === global.l1.replace(/\\s+/g, '') && lines[1].replace(/\\s+/g, '') === global.l2.replace(/\\s+/g, '')) {\n        for (var i = 2; i < lines.length; i++) {\n          var cL = lines[i];\n          if (cL === 'item[]:') {\n            inHeader = false;\n            continue;\n          }\n          if (inHeader) {\n            continue;\n          }\n          if (cL.indexOf('item[') === 0) {\n            // get level name\n            tN = lines[i + 2].split(/=/)[1].replace(/\"/g, '');\n            // get level type\n            if (lines[i + 1].split(/=/)[1] === '\"IntervalTier\"') {\n              tT = 'SEGMENT';\n              // adding new level\n              labelJSO.levels.push({\n                name: tN,\n                type: tT,\n                items: []\n              });\n            } else if (lines[i + 1].split(/=/)[1] === '\"TextTier\"') {\n              tT = 'EVENT';\n              // adding new level\n              labelJSO.levels.push({\n                name: tN,\n                type: tT,\n                items: []\n              });\n            } else {\n            }\n          }\n          if (labelJSO.levels.length > 0 && labelJSO.levels[labelJSO.levels.length - 1].type === 'SEGMENT' && cL.indexOf('intervals') === 0 && cL.indexOf('intervals:') !== 0) {\n            // parse seg levels event\n            var eSt = Math.floor(lines[i + 1].split(/=/)[1] * sampleRate) + 1;\n            // correct to zero for first sample\n            if (eSt === 1) {\n              eSt = 0;\n            }\n            var eEt = Math.floor(lines[i + 2].split(/=/)[1] * sampleRate);\n            lab = lines[i + 3].split(/=/)[1].replace(/\"/g, '');\n            var labs = [];\n            labs.push({\n              name: labelJSO.levels[labelJSO.levels.length - 1].name,\n              value: lab\n            });\n            labelJSO.levels[labelJSO.levels.length - 1].items.push({\n              id: global.localID,\n              sampleStart: eSt,\n              sampleDur: eEt - eSt + 1,\n              labels: labs\n            });\n            ++global.localID;\n          } else if (labelJSO.levels.length > 0 && labelJSO.levels[labelJSO.levels.length - 1].type === 'EVENT' && cL.indexOf('points') === 0 && cL.indexOf('points:') !== 0) {\n            // parse point level event\n            eT = lines[i + 1].split(/=/)[1] * sampleRate;\n            lab = lines[i + 2].split(/=/)[1].replace(/\"/g, '');\n            labs = [];\n            labs.push({\n              name: labelJSO.levels[labelJSO.levels.length - 1].name,\n              value: lab\n            });\n            labelJSO.levels[labelJSO.levels.length - 1].items.push({\n              id: global.localID,\n              samplePoint: Math.round(eT),\n              labels: labs\n            });\n            ++global.localID;\n          }\n        }\n        // console.log(JSON.stringify(labelJSO, undefined, 2));\n        global.testForGapsInLabelJSO(labelJSO);\n        return labelJSO;\n      } else {\n        // alert('bad header in TextGrid file!!! The header has to be: ', global.l1, '\\n', global.l2);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'bad header in TextGrid file!!! The header has to be: ' + global.l1 + '\\n' + global.l2\n          }\n        };\n      }\n    };\n    /**\n\t * converts the internal levels format returned from levelHandler.getLevels\n\t * to a string containing a TextGrid file\n\t */\n    global.toTextGrid = function (levelData, buffLength, sampleRate) {\n      var tG = '';\n      var nl = '\\n';\n      var t = '\\t';\n      // writing header infos\n      tG = tG + global.l1 + nl + global.l2 + nl + nl;\n      tG = tG + 'xmin = ' + global.findTimeOfMinSample() + nl;\n      tG = tG + 'xmax = ' + global.findTimeOfMaxSample(buffLength, sampleRate) + nl;\n      tG = tG + 'levels? <exists>' + nl;\n      tG = tG + 'size = ' + levelData.length + nl;\n      tG = tG + 'item []:' + nl;\n      //var levelNr = 0;\n      for (var levelNr = 0; levelNr < levelData.length; levelNr++) {\n        //angular.forEach(levelData, function (curLevel) {\n        //write level items\n        //levelNr = levelNr + 1;\n        var curLevel = levelData[levelNr];\n        tG = tG + t + 'item [' + levelNr + ']:' + nl;\n        if (curLevel.type === 'SEGMENT') {\n          tG = tG + t + t + 'class = \"IntervalTier\"' + nl;\n        } else if (curLevel.type === 'EVENT') {\n          tG = tG + t + t + 'class = \"TextTier\"' + nl;\n        }\n        tG = tG + t + t + 'name = \"' + curLevel.name + '\"' + nl;\n        tG = tG + t + t + 'xmin = ' + global.findTimeOfMinSample() + nl;\n        tG = tG + t + t + 'xmax = ' + global.findTimeOfMaxSample(buffLength, sampleRate) + nl;\n        if (curLevel.type === 'SEGMENT') {\n          tG = tG + t + t + 'intervals: size = ' + curLevel.items.length + nl;\n        } else if (curLevel.type === 'EVENT') {\n          tG = tG + t + t + 'points: size = ' + curLevel.items.length + nl;\n        }\n        var curVal;\n        for (var j = 0; j < curLevel.items.length; j++) {\n          var evtNr = j + 1;\n          if (curLevel.type === 'SEGMENT') {\n            tG = tG + t + t + t + 'intervals [' + evtNr + ']:' + nl;\n            if (curLevel.items[j].sampleStart !== 0) {\n              curVal = curLevel.items[j].sampleStart / sampleRate + 1 / sampleRate / 2;\n              tG = tG + t + t + t + t + 'xmin = ' + curVal + nl;\n            } else {\n              tG = tG + t + t + t + t + 'xmin = ' + 0 + nl;\n            }\n            if (j < curLevel.items.length - 1) {\n              curVal = (curLevel.items[j].sampleStart + curLevel.items[j].sampleDur) / sampleRate + 1 / sampleRate / 2;\n              tG = tG + t + t + t + t + 'xmax = ' + curVal + nl;\n            } else {\n              tG = tG + t + t + t + t + 'xmax = ' + global.findTimeOfMaxSample(buffLength, sampleRate) + nl;\n            }\n            tG = tG + t + t + t + t + 'text = \"' + curLevel.items[j].labels[0].value + '\"' + nl;\n          } else if (curLevel.type === 'EVENT') {\n            tG = tG + t + t + t + 'points[' + evtNr + ']:' + nl;\n            tG = tG + t + t + t + t + 'time = ' + curLevel.items[j].sampleStart / sampleRate + nl;\n            tG = tG + t + t + t + t + 'mark = \"' + curLevel.items[j].label + '\"' + nl;\n          }\n        }\n      }\n      return tG;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        var retVal;\n        switch (e.data.cmd) {\n        case 'parseTG':\n          retVal = global.toJSO(e.data.textGrid, e.data.annotates, e.data.name, e.data.sampleRate);\n          if (retVal.status === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        case 'toTextGrid':\n          retVal = global.toTextGrid(e.data.levels, e.data.buffLength, e.data.sampleRate);\n          if (retVal.status === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to textGridParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to textGridParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      URL.revokeObjectURL(this.url);\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n//'use strict';\n/**\n * A simple class that creates another thread\n * which does the spectroDrawingWorker work\n * @class spectroDrawingWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction spectroDrawingWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nspectroDrawingWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    /**\n\t\t * A handy web worker to draw a spectrom (and calculate a fft)\n\t\t *\n\t\t * @version 1.2\n\t\t * @author Georg Raess <georg.raess@campus.lmu.de>\n\t\t * @link http://www.phonetik.uni-muenchen.de/\n\t\t *\n\t\t */\n    ///////////////////////////////////\n    // start: global vars\n    global.executed = false;\n    global.PI = 3.141592653589793;\n    // value : Math.PI\n    global.TWO_PI = 6.283185307179586;\n    // value : 2 * Math.PI\n    global.totalMax = 0;\n    global.dynRangeInDB = 50;\n    global.myWindow = {\n      BARTLETT: 1,\n      BARTLETTHANN: 2,\n      BLACKMAN: 3,\n      COSINE: 4,\n      GAUSS: 5,\n      HAMMING: 6,\n      HANN: 7,\n      LANCZOS: 8,\n      RECTANGULAR: 9,\n      TRIANGULAR: 10\n    };\n    global.imgWidth = 0;\n    global.imgHeight = 0;\n    global.upperFreq = 0;\n    global.lowerFreq = 0;\n    global.pixelRatio = 1;\n    global.heatMapColorAnchors = [\n      [\n        255,\n        0,\n        0\n      ],\n      [\n        0,\n        255,\n        0\n      ],\n      [\n        0,\n        0,\n        0\n      ]\n    ];\n    global.samplesPerPxl = 0;\n    global.sampleRate = 0;\n    global.preEmphasisFilterFactor = 0.97;\n    global.transparency = 0;\n    global.drawHeatMapColors = false;\n    global.N = 0;\n    global.windowSizeInSecs = 0.01;\n    global.audioBuffer = undefined;\n    global.audioBufferChannels = 0;\n    global.wFunction = 0;\n    global.myFFT = undefined;\n    global.pixelHeight = 1;\n    global.internalalpha = 1;\n    global.maxPsd = 0;\n    global.HzStep = 0;\n    global.paint = [];\n    global.sin = undefined;\n    global.cos = undefined;\n    global.ceilingFreqFftIdx = 0;\n    global.floorFreqFftIdx = 0;\n    global.resultImgArr = undefined;\n    // end: global vars\n    //////////////////////////////////\n    /////////////////////////////////\n    // start: math helper functions\n    // used by FFT\n    global.toLinearLevel = function (dbLevel) {\n      return Math.pow(10, dbLevel / 10);\n    };\n    // calculate decadic logarithm\n    global.log10 = function (arg) {\n      return Math.log(arg) / 2.302585092994046;  // Math.log(x) / Math.LN10\n    };\n    // calculate magintude\n    global.magnitude = function (real, imag) {\n      return Math.sqrt(real * real + imag * imag);\n    };\n    // end: math helper functions\n    ////////////////////////////////\n    ///////////////////////////////////////////////////\n    // start: FFT class (incl. fft() function itself)\n    global.FFT = function () {\n      var m, i, x;\n      var n = global.N;\n      m = parseInt(Math.log(n) / 0.6931471805599453, 10);\n      if (n !== 1 << m) {\n        // Make sure n is a power of 2\n        console.log('ERROR : FFT length must be power of 2');\n      }\n      if (global.cos === undefined || n !== global.N) {\n        // this means that the following is only executed \n        // when no COS table exists\n        // or n changes\n        global.cos = new Float32Array(n / 2);\n        // precompute cos table\n        for (x = 0; x < n / 2; x++) {\n          global.cos[x] = Math.cos(-2 * global.PI * x / n);\n        }\n      }\n      if (global.sin === undefined || n !== global.N) {\n        // this means that the following is only executed \n        // when no COS table exists\n        // or n changes \n        global.sin = new Float32Array(n / 2);\n        // precompute sin table\n        for (x = 0; x < n / 2; x++) {\n          global.sin[x] = Math.sin(-2 * global.PI * x / n);\n        }\n      }\n      /**\n\t\t\t * apply window function and pre-emphasis from idx 0 to length\n\t\t\t * in buffer given\n\t\t\t *\n\t\t\t * @param type is the chosen window Function as enum\n\t\t\t * @param alpha is the alpha value for Window Functions (default 0.16)\n\t\t\t * @param buffer is the zero padded magnitude spectrum\n\t\t\t * @param length is the length to in the buffer (starting at idx 0)\n\t\t\t * to which to apply the window to. If the buffer is [x0, x1, x2, x4] and\n\t\t\t * length is 2 the window will be applied to [x0, x1, x2] this is needed\n\t\t\t * to only apply function to non-zero-padded values of magnitude spectrum.\n\t\t\t * @return the windowed/pre-emphasised buffer\n\t\t\t */\n      this.applyWindowFuncAndPreemph = function (type, alpha, buffer, length) {\n        // var length = buffer.length;\n        this.alpha = alpha;\n        switch (type) {\n        case global.myWindow.BARTLETT:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionBartlett(length, i);\n          }\n          break;\n        case global.myWindow.BARTLETTHANN:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionBartlettHann(length, i);\n          }\n          break;\n        case global.myWindow.BLACKMAN:\n          this.alpha = this.alpha || 0.16;\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionBlackman(length, i, alpha);\n          }\n          break;\n        case global.myWindow.COSINE:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionCosine(length, i);\n          }\n          break;\n        case global.myWindow.GAUSS:\n          this.alpha = this.alpha || 0.25;\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionGauss(length, i, alpha);\n          }\n          break;\n        case global.myWindow.HAMMING:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionHamming(length, i);\n          }\n          break;\n        case global.myWindow.HANN:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionHann(length, i);\n          }\n          break;\n        case global.myWindow.LANCZOS:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionLanczos(length, i);\n          }\n          break;\n        case global.myWindow.RECTANGULAR:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionRectangular(length, i);\n          }\n          break;\n        case global.myWindow.TRIANGULAR:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionTriangular(length, i);\n          }\n          break;\n        }\n        return buffer;\n      };\n      ////////////////////////////////////\n      // start: the windowing functions\n      this.wFunctionBartlett = function (length, index) {\n        return 2 / (length - 1) * ((length - 1) / 2 - Math.abs(index - (length - 1) / 2));\n      };\n      this.wFunctionBartlettHann = function (length, index) {\n        return 0.62 - 0.48 * Math.abs(index / (length - 1) - 0.5) - 0.38 * Math.cos(global.TWO_PI * index / (length - 1));\n      };\n      this.wFunctionBlackman = function (length, index, alpha) {\n        var a0 = (1 - alpha) / 2;\n        var a1 = 0.5;\n        var a2 = alpha / 2;\n        return a0 - a1 * Math.cos(global.TWO_PI * index / (length - 1)) + a2 * Math.cos(4 * global.PI * index / (length - 1));\n      };\n      this.wFunctionCosine = function (length, index) {\n        return Math.cos(global.PI * index / (length - 1) - global.PI / 2);\n      };\n      this.wFunctionGauss = function (length, index, alpha) {\n        return Math.pow(Math.E, -0.5 * Math.pow((index - (length - 1) / 2) / (alpha * (length - 1) / 2), 2));\n      };\n      this.wFunctionHamming = function (length, index) {\n        return 0.54 - 0.46 * Math.cos(global.TWO_PI * index / (length - 1));\n      };\n      this.wFunctionHann = function (length, index) {\n        return 0.5 * (1 - Math.cos(global.TWO_PI * index / (length - 1)));\n      };\n      this.wFunctionLanczos = function (length, index) {\n        var x = 2 * index / (length - 1) - 1;\n        return Math.sin(global.PI * x) / (global.PI * x);\n      };\n      this.wFunctionRectangular = function () {\n        return 1;\n      };\n      this.wFunctionTriangular = function (length, index) {\n        return 2 / length * (length / 2 - Math.abs(index - (length - 1) / 2));\n      };\n      // end: the windowing functions\n      ///////////////////////////////////\n      /**\n\t\t\t * calculate and apply according pre-emphasis on sample\n\t\t\t */\n      this.applyPreEmph = function (curSample, prevSample) {\n        return curSample - global.preEmphasisFilterFactor * prevSample;\n      };\n      // the FFT calculation\n      this.fft = function (x, y) {\n        // Bit-reverse\n        var i, j, k, n1, n2, a, c, s, t1, t2;\n        // Bit-reverse\n        j = 0;\n        n2 = n / 2;\n        for (i = 1; i < n - 1; i++) {\n          n1 = n2;\n          while (j >= n1) {\n            j = j - n1;\n            n1 = n1 / 2;\n          }\n          j = j + n1;\n          if (i < j) {\n            t1 = x[i];\n            x[i] = x[j];\n            x[j] = t1;\n            t1 = y[i];\n            y[i] = y[j];\n            y[j] = t1;\n          }\n        }\n        // FFT\n        n1 = 0;\n        n2 = 1;\n        for (i = 0; i < m; i++) {\n          n1 = n2;\n          n2 = n2 + n2;\n          a = 0;\n          for (j = 0; j < n1; j++) {\n            c = global.cos[a];\n            s = global.sin[a];\n            a += 1 << m - i - 1;\n            for (k = j; k < n; k = k + n2) {\n              t1 = c * x[k + n1] - s * y[k + n1];\n              t2 = s * x[k + n1] + c * y[k + n1];\n              x[k + n1] = x[k] - t1;\n              y[k + n1] = y[k] - t2;\n              x[k] = x[k] + t1;\n              y[k] = y[k] + t2;\n            }\n          }\n        }\n      };\n    };\n    // end: FFT class \n    ///////////////////\n    /////////////////////////////////\n    // start: rendering function \n    /**\n\t\t * interpolates a 3D color space and calculate accoring\n\t\t * value on that plane\n\t\t *\n\t\t * @param minval is the minimum value to map to (number)\n\t\t * @param maxval is the maximum value to map to (number)\n\t\t * @param val is the value itself (number)\n\t\t * @param colors is an array of arrays containing the colors\n\t\t * to interpol. against (of the form: [[255, 0, 0],[0, 255, 0],[0, 0, 255]])\n\t\t */\n    global.convertToHeatmap = function (minval, maxval, val, colors) {\n      var maxIndex = colors.length - 1;\n      var v = (val - minval) / (maxval - minval) * maxIndex;\n      var i1 = Math.floor(v);\n      var i2 = Math.min.apply(null, [\n          Math.floor(v) + 1,\n          maxIndex\n        ]);\n      var rgb1 = colors[i1];\n      var rgb2 = colors[i2];\n      var f = v - i1;\n      return {\n        'r': Math.floor(rgb1[0] + f * (rgb2[0] - rgb1[0])),\n        'g': Math.floor(rgb1[1] + f * (rgb2[1] - rgb1[1])),\n        'b': Math.floor(rgb1[2] + f * (rgb2[2] - rgb1[2]))\n      };\n    };\n    /**\n\t\t * draws a single line of the spectrogram into the imageResult array.\n\t\t * by calculating the RGB value of the current pixel with:\n\t\t * 255-(255*scaled)\n\t\t * @param xIdx in the global.paint array\n\t\t */\n    global.drawVerticalLineOfSpectogram = function (xIdx) {\n      // set upper boundary for linear interpolation\n      var x1 = global.pixelHeight;\n      var rgb, index, px, py;\n      // value for first interpolation at lower boundry (height=0)\n      // calculate the one sided power spectral density PSD (f, t) in Pa2/Hz\n      // PSD(f) proportional to 2|X(f)|2 / (t2 - t1)\n      var psd = 2 * Math.pow(global.paint[xIdx][1], 2) / global.N;\n      var psdLog = 10 * global.log10(psd / global.maxPsd);\n      var scaledVal = (psdLog + global.dynRangeInDB) / global.dynRangeInDB;\n      if (scaledVal > 1) {\n        scaledVal = 1;\n      } else if (scaledVal < 0) {\n        scaledVal = 0;\n      }\n      for (var i = 0; i < global.paint[xIdx].length; i++) {\n        var y0 = scaledVal;\n        // !!!! set y0 to previous scaled value\n        // for each value in paint[] calculate pixelHeight interpolation points\n        // x0=0\n        // x1=pixelHeight\n        // if(paint[i-1]<0) paint[i-1] = 1\n        // y0=paint[i-1]    \n        // y1=paint[i]\n        // !!!! calculate next scaledValue [0...1] \n        psd = 2 * Math.pow(global.paint[xIdx][i], 2) / global.N;\n        psdLog = 10 * global.log10(psd / global.maxPsd);\n        scaledVal = (psdLog + global.dynRangeInDB) / global.dynRangeInDB;\n        if (scaledVal > 1) {\n          scaledVal = 1;\n        }\n        if (scaledVal < 0) {\n          scaledVal = 0;\n        }\n        // !!!! set y1 to this scaled value\n        var y1 = scaledVal;\n        if (global.pixelHeight >= 1) {\n          // do interpolation between y0 (previous scaledValue) and y1 (scaledValue now)\n          for (var b = 0; b < global.pixelHeight; b++) {\n            var y2 = y0 + (y1 - y0) / x1 * b;\n            // calculate corresponding color value for interpolation point [0...255]\n            rgb = 255 - Math.round(255 * y2);\n            // set internal image buffer to calculated & interpolated value\n            px = Math.floor(xIdx);\n            py = Math.floor(global.imgHeight - (global.pixelHeight * (i - 2) + b));\n            index = (px + py * global.imgWidth) * 4;\n            if (global.drawHeatMapColors) {\n              if (!isNaN(rgb)) {\n                var hmVals = global.convertToHeatmap(0, 255, rgb, global.heatMapColorAnchors);\n                global.resultImgArr[index + 0] = hmVals.r;\n                global.resultImgArr[index + 1] = hmVals.g;\n                global.resultImgArr[index + 2] = hmVals.b;\n                global.resultImgArr[index + 3] = global.transparency;\n              } else {\n                global.resultImgArr[index + 0] = rgb;\n                global.resultImgArr[index + 1] = rgb;\n                global.resultImgArr[index + 2] = rgb;\n                global.resultImgArr[index + 3] = global.transparency;\n              }\n            } else {\n              global.resultImgArr[index + 0] = rgb;\n              global.resultImgArr[index + 1] = rgb;\n              global.resultImgArr[index + 2] = rgb;\n              global.resultImgArr[index + 3] = global.transparency;\n            }\n          }\n        } else {\n          rgb = 255 - Math.round(255 * y1);\n          // set internal image buffer to calculated & interpolated value\n          px = Math.floor(xIdx);\n          py = Math.floor(global.imgHeight - global.pixelHeight * (i - 2));\n          index = (px + py * global.imgWidth) * 4;\n          global.resultImgArr[index + 0] = rgb;\n          global.resultImgArr[index + 1] = rgb;\n          global.resultImgArr[index + 2] = rgb;\n          global.resultImgArr[index + 3] = global.transparency;\n        }\n      }\n    };\n    /**\n\t\t * calculates Magnitude by\n\t\t * - reading the current (defined with offset) data from localSoundBuffer\n\t\t * - applying the current Window Function to the selected data\n\t\t * - calculating the actual FFT\n\t\t * - (and saving the biggest value in totalMax)\n\t\t *\n\t\t * @param offset calculated offset in PCM Stream\n\t\t * @return magnitude spectrum as Float32Array\n\t\t */\n    global.calcMagnitudeSpectrum = function (offset, windowSizeInSamples) {\n      // imaginary array of length N\n      var imag = new Float32Array(global.N);\n      // real array of length N\n      var real = new Float32Array(global.N);\n      // result array of length c - d\n      var result = new Float32Array(global.ceilingFreqFftIdx - global.floorFreqFftIdx);\n      // set real values by reading local sound buffer (this auto zeropads everything > windowSizeInSamples)\n      for (var j = 0; j < windowSizeInSamples; j++) {\n        real[j] = global.audioBuffer[offset + j];\n      }\n      // apply window function and pre-emphasis to non zero padded real \n      global.myFFT.applyWindowFuncAndPreemph(global.wFunction, global.internalalpha, real, windowSizeInSamples);\n      // calculate FFT over real and save to result\n      global.myFFT.fft(real, imag);\n      // calculate magnitude for each spectral component \n      for (var low = 0; low <= global.ceilingFreqFftIdx - global.floorFreqFftIdx; low++) {\n        result[low] = global.magnitude(real[low + global.floorFreqFftIdx], imag[low + global.floorFreqFftIdx]);\n        if (global.totalMax < result[low]) {\n          global.totalMax = result[low];\n        }\n      }\n      return result;\n    };\n    /**\n\t\t * initial function call for calculating and drawing Spectrogram\n\t\t * input sample data comes from the buffer global.audioBuffer\n\t\t * - first loop calculates magnitude spectra to draw (calcMagnitudeSpectrum())\n\t\t * - second loop draws these values into the global.resultImgArr (drawVerticalLineOfSpectogram())\n\t\t */\n    global.renderSpectrogram = function () {\n      if (!global.executed) {\n        // start execution once\n        global.executed = true;\n        var windowSizeInSamples = global.sampleRate * global.windowSizeInSecs;\n        // instance of FFT with windowSize N\n        global.myFFT = new global.FFT();\n        // array holding FFT results paint[canvas width][canvas height]\n        global.paint = new Array(global.imgWidth);\n        // Hz per pixel height\n        global.HzStep = global.sampleRate / 2 / (global.N / 2);\n        // upper Hz boundary to display\n        global.ceilingFreqFftIdx = Math.ceil(global.upperFreq / global.HzStep);\n        // lower Hz boundary to display\n        global.floorFreqFftIdx = Math.floor(global.lowerFreq / global.HzStep);\n        // -1 for value below display when lower>0\n        // height between two interpolation points\n        global.pixelHeight = global.imgHeight / (global.ceilingFreqFftIdx - global.floorFreqFftIdx - 2);\n        // ugly hack in order to support PhantomJS < 2.0 testing\n        if (typeof Uint8ClampedArray === 'undefined') {\n          Uint8ClampedArray = Uint8Array;\n        }\n        // create new picture\n        global.resultImgArr = new Uint8ClampedArray(Math.ceil(global.imgWidth * global.imgHeight * 4));\n        // calculate i FFT runs, save result into paint and set maxPsd while doing so\n        for (var i = 0; i < global.imgWidth; i++) {\n          global.paint[i] = global.calcMagnitudeSpectrum(Math.round(i * global.samplesPerPxl), windowSizeInSamples);\n          global.maxPsd = 2 * Math.pow(global.totalMax, 2) / global.N;\n        }\n        // draw spectrogram on png image with canvas width\n        // one column is drawn per drawVerticalLineOfSpectogram\n        for (var j = 0; j < global.imgWidth; j++) {\n          global.drawVerticalLineOfSpectogram(j);\n        }\n        // post generated image block with settings back\n        global.postMessage({\n          'window': global.wFunction,\n          'samplesPerPxl': global.samplesPerPxl,\n          'pixelHeight': global.pixelHeight,\n          'pixelRatio': global.pixelRatio,\n          'width': global.imgWidth,\n          'height': global.imgHeight,\n          'img': global.resultImgArr.buffer\n        }, [global.resultImgArr.buffer]);\n        // free vars\n        global.myFFT = null;\n        // stop execution\n        global.executed = false;\n      }\n    };\n    // end: rendering function \n    //////////////////////////////\n    //////////////////////////\n    // communication functions\n    /**\n\t\t * function to handle messages events if used ad web worker\n\t\t * @param e message event\n\t\t */\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        var render = true;\n        var renderError = '';\n        var data = e.data;\n        if (data.windowSizeInSecs !== undefined) {\n          global.windowSizeInSecs = data.windowSizeInSecs;\n        } else {\n          renderError = 'windowSizeInSecs';\n          render = false;\n        }\n        if (data.fftN !== undefined) {\n          global.N = data.fftN;\n        } else {\n          renderError = 'fftN';\n          render = false;\n        }\n        if (data.alpha !== undefined) {\n          global.internalalpha = data.alpha;\n        } else {\n          renderError = 'alpha';\n          render = false;\n        }\n        if (data.upperFreq !== undefined) {\n          global.upperFreq = data.upperFreq;\n        } else {\n          renderError = 'upperFreq';\n          render = false;\n        }\n        if (data.lowerFreq !== undefined) {\n          global.lowerFreq = data.lowerFreq;\n        } else {\n          renderError = 'lowerFreq';\n          render = false;\n        }\n        if (data.samplesPerPxl !== undefined) {\n          global.samplesPerPxl = data.samplesPerPxl;\n        } else {\n          renderError = 'samplesPerPxl';\n          render = false;\n        }\n        if (data.window !== undefined) {\n          switch (data.window) {\n          case 1:\n            global.wFunction = global.myWindow.BARTLETT;\n            break;\n          case 2:\n            global.wFunction = global.myWindow.BARTLETTHANN;\n            break;\n          case 3:\n            global.wFunction = global.myWindow.BLACKMAN;\n            break;\n          case 4:\n            global.wFunction = global.myWindow.COSINE;\n            break;\n          case 5:\n            global.wFunction = global.myWindow.GAUSS;\n            break;\n          case 6:\n            global.wFunction = global.myWindow.HAMMING;\n            break;\n          case 7:\n            global.wFunction = global.myWindow.HANN;\n            break;\n          case 8:\n            global.wFunction = global.myWindow.LANCZOS;\n            break;\n          case 9:\n            global.wFunction = global.myWindow.RECTANGULAR;\n            break;\n          case 10:\n            global.wFunction = global.myWindow.TRIANGULAR;\n            break;\n          }\n        } else {\n          renderError = 'window';\n          render = false;\n        }\n        if (data.imgWidth !== undefined) {\n          global.imgWidth = data.imgWidth;\n        } else {\n          renderError = 'imgWidth';\n          render = false;\n        }\n        if (data.imgHeight !== undefined) {\n          global.imgHeight = data.imgHeight;\n        } else {\n          renderError = 'imgHeight';\n          render = false;\n        }\n        if (data.dynRangeInDB !== undefined) {\n          global.dynRangeInDB = data.dynRangeInDB;\n        } else {\n          renderError = 'dynRangeInDB';\n          render = false;\n        }\n        if (data.pixelRatio !== undefined) {\n          global.pixelRatio = data.pixelRatio;\n        } else {\n          renderError = 'pixelRatio';\n          render = false;\n        }\n        if (data.sampleRate !== undefined) {\n          global.sampleRate = data.sampleRate;\n        } else {\n          renderError = 'sampleRate';\n          render = false;\n        }\n        if (data.audioBufferChannels !== undefined) {\n          global.audioBufferChannels = data.audioBufferChannels;\n        } else {\n          renderError = 'audioBufferChannels';\n          render = false;\n        }\n        if (data.transparency !== undefined) {\n          global.transparency = data.transparency;\n        } else {\n          renderError = 'transparency';\n          render = false;\n        }\n        if (data.audioBuffer !== undefined) {\n          global.audioBuffer = new Float32Array(data.audioBuffer);\n        } else {\n          renderError = 'audioBuffer';\n          render = false;\n        }\n        if (data.drawHeatMapColors !== undefined) {\n          global.drawHeatMapColors = data.drawHeatMapColors;\n        } else {\n          renderError = 'drawHeatMapColors';\n          render = false;\n        }\n        if (data.preEmphasisFilterFactor !== undefined) {\n          global.preEmphasisFilterFactor = data.preEmphasisFilterFactor;\n        } else {\n          renderError = 'preEmphasisFilterFactor';\n          render = false;\n        }\n        if (data.heatMapColorAnchors !== undefined) {\n          global.heatMapColorAnchors = data.heatMapColorAnchors;\n        } else {\n          renderError = 'heatMapColorAnchors';\n          render = false;\n        }\n        if (render) {\n          global.renderSpectrogram();\n        } else {\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': renderError + ' is undefined'\n            }\n          });\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to spectroDrawingWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(spectroDrawingWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        webkitURL.revokeObjectURL(this.url);\n      } else {\n        URL.revokeObjectURL(this.url);\n      }\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }  //\n     /////////////////////\n};\n/**\n * A simple class that creates another thread\n * which does the ssffParserWorker work\n * @class ssffParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction ssffParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nssffParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    var ssffData = {};\n    var headID = 'SSFF -- (c) SHLRC\\n';\n    var machineID = 'Machine IBM-PC\\n';\n    var sepString = '-----------------\\n';\n    ssffData.ssffTrackName = '';\n    ssffData.sampleRate = -1;\n    ssffData.startTime = -1;\n    ssffData.origFreq = -1;\n    ssffData.Columns = [];\n    /**\n\t * Mock for atob btoa for web kit based browsers that don't support these in webworkers\n\t */\n    (function () {\n      var base64EncodeChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n      var base64DecodeChars = new Array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1);\n      function base64encode(str) {\n        var out, i, len;\n        var c1, c2, c3;\n        len = str.length;\n        i = 0;\n        out = '';\n        while (i < len) {\n          c1 = str.charCodeAt(i++) & 255;\n          if (i === len) {\n            out += base64EncodeChars.charAt(c1 >> 2);\n            out += base64EncodeChars.charAt((c1 & 3) << 4);\n            out += '==';\n            break;\n          }\n          c2 = str.charCodeAt(i++);\n          if (i === len) {\n            out += base64EncodeChars.charAt(c1 >> 2);\n            out += base64EncodeChars.charAt((c1 & 3) << 4 | (c2 & 240) >> 4);\n            out += base64EncodeChars.charAt((c2 & 15) << 2);\n            out += '=';\n            break;\n          }\n          c3 = str.charCodeAt(i++);\n          out += base64EncodeChars.charAt(c1 >> 2);\n          out += base64EncodeChars.charAt((c1 & 3) << 4 | (c2 & 240) >> 4);\n          out += base64EncodeChars.charAt((c2 & 15) << 2 | (c3 & 192) >> 6);\n          out += base64EncodeChars.charAt(c3 & 63);\n        }\n        return out;\n      }\n      function base64decode(str) {\n        var c1, c2, c3, c4;\n        var i, len, out;\n        len = str.length;\n        i = 0;\n        out = '';\n        while (i < len) {\n          do {\n            c1 = base64DecodeChars[str.charCodeAt(i++) & 255];\n          } while (i < len && c1 === -1);\n          if (c1 === -1) {\n            break;\n          }\n          do {\n            c2 = base64DecodeChars[str.charCodeAt(i++) & 255];\n          } while (i < len && c2 === -1);\n          if (c2 === -1) {\n            break;\n          }\n          out += String.fromCharCode(c1 << 2 | (c2 & 48) >> 4);\n          do {\n            c3 = str.charCodeAt(i++) & 255;\n            if (c3 === 61) {\n              return out;\n            }\n            c3 = base64DecodeChars[c3];\n          } while (i < len && c3 === -1);\n          if (c3 === -1) {\n            break;\n          }\n          out += String.fromCharCode((c2 & 15) << 4 | (c3 & 60) >> 2);\n          do {\n            c4 = str.charCodeAt(i++) & 255;\n            if (c4 === 61) {\n              return out;\n            }\n            c4 = base64DecodeChars[c4];\n          } while (i < len && c4 === -1);\n          if (c4 === -1) {\n            break;\n          }\n          out += String.fromCharCode((c3 & 3) << 6 | c4);\n        }\n        return out;\n      }\n      //var scope = (typeof window !== 'undefined') ? window : global;\n      if (!global.btoa) {\n        global.btoa = base64encode;\n      }\n      if (!global.atob) {\n        global.atob = base64decode;\n      }\n    }());\n    /**\n\t *\n\t */\n    global.base64ToArrayBuffer = function (stringBase64) {\n      var binaryString = global.atob(stringBase64);\n      var len = binaryString.length;\n      var bytes = new Uint8Array(len);\n      for (var i = 0; i < len; i++) {\n        var ascii = binaryString.charCodeAt(i);\n        bytes[i] = ascii;\n      }\n      return bytes.buffer;\n    };\n    /**\n\t * round to n decimal digits after the comma\n\t * used to help display numbers with a given\n\t * precision\n\t */\n    global.round = function (x, n) {\n      if (n < 1 || n > 14) {\n        return false;\n      }\n      var e = Math.pow(10, n);\n      var k = (Math.round(x * e) / e).toString();\n      if (k.indexOf('.') === -1) {\n        k += '.';\n      }\n      k += e.toString().substring(1);\n      return k.substring(0, k.indexOf('.') + n + 1);\n    };\n    /**\n\t * helper function to convert string to Uint8Array\n\t * @param string\n\t */\n    global.stringToUint = function (string) {\n      var charList = string.split('');\n      var uintArray = [];\n      for (var i = 0; i < charList.length; i++) {\n        uintArray.push(charList[i].charCodeAt(0));\n      }\n      return new Uint8Array(uintArray);\n    };\n    /**\n\t *\n\t */\n    global.Uint8Concat = function (first, second) {\n      var firstLength = first.length;\n      var result = new Uint8Array(firstLength + second.length);\n      result.set(first);\n      result.set(second, firstLength);\n      return result;\n    };\n    /**\n\t * convert arraybuffer containing a ssff file\n\t * to a javascript object\n\t * @param buf arraybuffer containing ssff file\n\t * @param name is ssffTrackName\n\t * @returns ssff javascript object\n\t */\n    global.ssff2jso = function (buf, name) {\n      ssffData.ssffTrackName = name;\n      ssffData.Columns = [];\n      // console.log('SSFF loaded');\n      var uIntBuffView = new Uint8Array(buf);\n      // Causes \"RangeError: Maximum call stack size exceeded\"\n      // with some browsers (?)(Chrome/Chromium on Ubuntu)\n      //var buffStr = String.fromCharCode.apply(null, uIntBuffView);\n      var buffStr = '';\n      for (var j = 0; j < uIntBuffView.length; j++) {\n        buffStr = buffStr + String.fromCharCode(uIntBuffView[j]);\n      }\n      var newLsep = buffStr.split(/^/m);\n      //check if header has headID and machineID\n      if (newLsep[0] !== headID) {\n        // alert('SSFF parse error: first line != SSFF -- (c) SHLRC');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'SSFF parse error: first line != SSFF -- (c) SHLRC in ssffTrackName ' + name\n          }\n        };\n      }\n      if (newLsep[1] !== machineID) {\n        // alert('SSFF parse error: machineID != Machine IBM-PC');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'SSFF parse error: machineID != Machine IBM-PC in ssffTrackName ' + name\n          }\n        };\n      }\n      // search header for Record_Freq and Start_Time\n      ssffData.sampleRate = undefined;\n      ssffData.startTime = undefined;\n      var counter = 0;\n      while (newLsep[counter] !== sepString) {\n        if (newLsep[counter].split(/[ ,]+/)[0] === 'Record_Freq') {\n          // console.log(\"FOUND Record_Freq\")\n          ssffData.sampleRate = parseFloat(newLsep[counter].split(/[ ,]+/)[1].replace(/(\\r\\n|\\n|\\r)/gm, ''));\n        }\n        if (newLsep[counter].split(/[ ,]+/)[0] === 'Start_Time') {\n          // console.log(\"FOUND Start_Time\")\n          ssffData.startTime = parseFloat(newLsep[counter].split(/[ ,]+/)[1].replace(/(\\r\\n|\\n|\\r)/gm, ''));\n        }\n        counter += 1;\n      }\n      // check if found Record_Freq and Start_Time\n      if (ssffData.sampleRate === undefined || ssffData.startTime === undefined) {\n        // alert('SSFF parse error: Required fields Record_Freq or Start_Time not set!');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'SSFF parse error: Required fields Record_Freq or Start_Time not set in ssffTrackName ' + name\n          }\n        };\n      }\n      for (var i = 4; i < newLsep.length; i++) {\n        if (newLsep[i].split(/[ ,]+/)[0] === 'Original_Freq') {\n          ssffData.origFreq = parseFloat(newLsep[i].split(/[ ,]+/)[2].replace(/(\\r\\n|\\n|\\r)/gm, ''));\n        }\n        if (newLsep[i] === sepString) {\n          break;\n        }\n        var lSpl = newLsep[i].split(/[ ]+/);\n        if (lSpl[0] === 'Column') {\n          ssffData.Columns.push({\n            'name': lSpl[1],\n            'ssffdatatype': lSpl[2],\n            'length': parseInt(lSpl[3].replace(/(\\r\\n|\\n|\\r)/gm, ''), 10),\n            'values': [],\n            '_minVal': Infinity,\n            '_maxVal': -Infinity\n          });\n        }\n      }\n      var curBinIdx = newLsep.slice(0, i + 1).join('').length;\n      var curBufferView, curBuffer, curLen, curMin, curMax;\n      while (curBinIdx <= uIntBuffView.length) {\n        for (i = 0; i < ssffData.Columns.length; i++) {\n          //console.log(ssffData.Columns[i].length);\n          if (ssffData.Columns[i].ssffdatatype === 'DOUBLE') {\n            curLen = 8 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            // ugly hack in order to support PhantomJS < 2.0 testing\n            if (typeof Float64Array == 'undefined') {\n              Float64Array = Float32Array;\n            }\n            curBufferView = new Float64Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n            // set _minVal and _maxVal\n            curMin = Math.min.apply(null, Array.prototype.slice.call(curBufferView));\n            curMax = Math.max.apply(null, Array.prototype.slice.call(curBufferView));\n            if (curMin < ssffData.Columns[i]._minVal) {\n              ssffData.Columns[i]._minVal = curMin;\n            }\n            if (curMax > ssffData.Columns[i]._maxVal) {\n              ssffData.Columns[i]._maxVal = curMax;\n            }\n          } else if (ssffData.Columns[i].ssffdatatype === 'FLOAT') {\n            curLen = 4 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            curBufferView = new Float32Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n            // set _minVal and _maxVal\n            curMin = Math.min.apply(null, Array.prototype.slice.call(curBufferView));\n            curMax = Math.max.apply(null, Array.prototype.slice.call(curBufferView));\n            if (curMin < ssffData.Columns[i]._minVal) {\n              ssffData.Columns[i]._minVal = curMin;\n            }\n            if (curMax > ssffData.Columns[i]._maxVal) {\n              ssffData.Columns[i]._maxVal = curMax;\n            }\n          } else if (ssffData.Columns[i].ssffdatatype === 'SHORT') {\n            curLen = 2 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            curBufferView = new Uint16Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n            // set _minVal and _maxVal\n            curMin = Math.min.apply(null, Array.prototype.slice.call(curBufferView));\n            curMax = Math.max.apply(null, Array.prototype.slice.call(curBufferView));\n            if (curMin < ssffData.Columns[i]._minVal) {\n              ssffData.Columns[i]._minVal = curMin;\n            }\n            if (curMax > ssffData.Columns[i]._maxVal) {\n              ssffData.Columns[i]._maxVal = curMax;\n            }\n          } else if (ssffData.Columns[i].ssffdatatype === 'BYTE') {\n            curLen = 1 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            curBufferView = new Uint8Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n          } else {\n            // alert('Unsupported column type! Only DOUBLE, FLOAT, SHORT, BYTE column types are currently supported');\n            return {\n              'status': {\n                'type': 'ERROR',\n                'message': 'Unsupported column type! Only DOUBLE, FLOAT, SHORT, BYTE column types are currently supported in ssffTrackName ' + name\n              }\n            };\n          }\n        }  //for\n      }\n      //while\n      return ssffData;\n    };\n    /**\n\t * convert javascript object of label file to\n\t * array buffer containing\n\t * @param ssff javascipt object\n\t * @returns ssff arraybuffer\n\t */\n    global.jso2ssff = function (jso) {\n      // create header\n      var headerStr = headID + machineID;\n      headerStr += 'Record_Freq ' + global.round(jso.sampleRate, 1) + '\\n';\n      headerStr += 'Start_Time ' + jso.startTime + '\\n';\n      jso.Columns.forEach(function (col) {\n        // console.log(col.name)\n        headerStr += 'Column ' + col.name + ' ' + col.ssffdatatype + ' ' + col.length + '\\n';\n      });\n      headerStr += 'Original_Freq DOUBLE ' + global.round(jso.origFreq, 1) + '\\n';\n      headerStr += sepString;\n      // preallocate data buffer\n      var bytePerTime = 0;\n      var failed = false;\n      jso.Columns.forEach(function (col) {\n        if (col.ssffdatatype === 'SHORT') {\n          bytePerTime += 2 * col.length;\n        } else {\n          failed = true;\n        }\n      });\n      // check if failed\n      if (failed) {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Unsupported column type! Only SHORT columns supported for now!'\n          }\n        };\n      }\n      var byteSizeOfDataBuffer = bytePerTime * jso.Columns[0].values.length;\n      var dataBuff = new ArrayBuffer(byteSizeOfDataBuffer);\n      var dataBuffView = new DataView(dataBuff);\n      // convert buffer to header\n      var ssffBufView = new Uint8Array(global.stringToUint(headerStr));\n      // loop through vals and append array of each column to ssffBufView\n      var byteOffSet = 0;\n      jso.Columns[0].values.forEach(function (curArray, curArrayIDX) {\n        jso.Columns.forEach(function (curCol) {\n          if (curCol.ssffdatatype === 'SHORT') {\n            curCol.values[curArrayIDX].forEach(function (val) {\n              dataBuffView.setInt16(byteOffSet, val, true);\n              byteOffSet += 2;\n            });\n          } else {\n            failed = true;\n          }\n        });\n      });\n      // check if failed\n      if (failed) {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Unsupported column type! Only SHORT columns supported for now!'\n          }\n        };\n      }\n      // concatenate header with data\n      var tmp = new Uint8Array(dataBuffView.buffer);\n      ssffBufView = new global.Uint8Concat(ssffBufView, tmp);\n      return {\n        'status': {\n          'type': 'SUCCESS',\n          'message': ''\n        },\n        'data': ssffBufView.buffer\n      };\n    };\n    /**\n\t * loop over ssff files in ssffArr and create a ssffJsoArr\n\t */\n    global.parseArr = function (ssffArr) {\n      var noError = true;\n      var resArr = [];\n      var ssffJso;\n      for (var i = 0; i < ssffArr.length; i++) {\n        ssffJso = {};\n        var arrBuff;\n        arrBuff = global.base64ToArrayBuffer(ssffArr[i].data);\n        ssffJso = global.ssff2jso(arrBuff, ssffArr[i].ssffTrackName);\n        if (ssffJso.status === undefined) {\n          resArr.push(JSON.parse(JSON.stringify(ssffJso)));  // YUCK... don't know if SIC but YUCK!!!\n        } else {\n          noError = false;\n          return ssffJso;\n        }\n      }\n      if (noError) {\n        return {\n          'status': {\n            'type': 'SUCCESS',\n            'message': ''\n          },\n          'data': resArr\n        };\n      } else {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Error in parseArr() with: ' + JSON.stringify(ssffArr)\n          }\n        };\n      }\n    };\n    //expand ArrayBuffer with subarray function\n    ArrayBuffer.prototype.subarray = function (offset, length) {\n      var sub = new ArrayBuffer(length);\n      var subView = new Int8Array(sub);\n      var thisView = new Int8Array(this);\n      for (var i = 0; i < length; i++) {\n        subView[i] = thisView[offset + i];\n      }\n      return sub;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        switch (e.data.cmd) {\n        case 'parseArr':\n          global.postMessage(global.parseArr(e.data.ssffArr));\n          break;\n        case 'jso2ssff':\n          global.postMessage(global.jso2ssff(JSON.parse(e.data.jso)));\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to ssffParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to ssffParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n      this.worker = undefined;\n    }\n    if (this.url) {\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        webkitURL.revokeObjectURL(this.url);\n      } else {\n        URL.revokeObjectURL(this.url);\n      }\n      this.url = undefined;\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.mathHelperService\n * @description\n * # mathHelperService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('mathHelperService', function () {\n  //shared service object to be returned\n  var sServObj = {};\n  //////////////////////\n  //////////////////////\n  // public API\n  /**\n\t\t * calculate the closest power of two that is\n\t\t * greater than the passed in number\n\t\t * @param num\n\t\t * @returns power of two value\n\t\t */\n  sServObj.calcClosestPowerOf2Gt = function (num) {\n    var curExp = 0;\n    while (Math.pow(2, curExp) < num) {\n      curExp = curExp + 1;\n    }\n    return Math.pow(2, curExp);\n  };\n  return sServObj;\n});"]}