"use strict";function EspsParserWorker(a){a=a||window.Worker,this.url=this.getWorkerURL(),this.worker=new a(this.url)}function TextGridParserWorker(a){a=a||window.Worker,this.url=this.getWorkerURL(),this.worker=new a(this.url)}function SpectroDrawingWorker(a){a=a||window.Worker,this.url=this.getWorkerURL(),this.worker=new a(this.url)}function SsffParserWorker(a){a=a||window.Worker,this.url=this.getWorkerURL(),this.worker=new a(this.url)}ArrayBuffer.prototype.subarray=function(a,b){for(var c=new ArrayBuffer(b),d=new Int8Array(c),e=new Int8Array(this),f=0;f<b;f++)d[f]=e[a+f];return c},angular.module("emuwebApp",["ngAnimate","angular.filter","btford.markdown"]).config(["$locationProvider",function(a){a.html5Mode(!0)}]),angular.module("emuwebApp").service("ConfigProviderService",["$q","viewState",function(a,b){var c={};return c.vals={},c.design={},c.curDbConfig={},c.initDbConfig={},c.embeddedVals={audioGetUrl:"",labelGetUrl:"",labelType:"",fromUrlParams:!1},c.setDesign=function(a){angular.copy(a,c.design)},c.setVals=function(a){$.isEmptyObject(c.vals)?c.vals=a:angular.forEach(Object.keys(a),function(b){angular.isArray(c.vals[b])?(c.vals[b]=[],angular.forEach(a[b],function(a){c.vals[b].push(a)})):angular.forEach(Object.keys(a[b]),function(d){void 0!==c.vals[b][d]?c.vals[b][d]=a[b][d]:console.error("BAD ENTRY IN CONFIG! Key1: "+b+" key2: "+d)})})},c.getDelta=function(b){var d=a.defer(),e=c.getDeltas(b,c.initDbConfig);return d.resolve(e),d.promise},c.getDeltas=function(a,b){var d={};return angular.forEach(a,function(a,e){angular.equals(a,b[e])||(Array.isArray(a)?(d[e]=[],angular.copy(a,d[e])):"object"==typeof a?(d[e]={},d[e]=c.getDeltas(a,b[e])):"clear"!==e&&"openDemoDB"!==e&&"specSettings"!==e&&(d[e]=a))}),d},c.getSsffTrackConfig=function(a){var b;return void 0!==c.curDbConfig.ssffTrackDefinitions&&angular.forEach(c.curDbConfig.ssffTrackDefinitions,function(c){c.name===a&&(b=c)}),b},c.getValueLimsOfTrack=function(a){var d={};return angular.forEach(c.vals.perspectives[b.curPerspectiveIdx].signalCanvases.minMaxValLims,function(b){b.ssffTrackName===a&&(d=b)}),d},c.getContourLimsOfTrack=function(a){var d={};return angular.forEach(c.vals.perspectives[b.curPerspectiveIdx].signalCanvases.contourLims,function(b){b.ssffTrackName===a&&(d=b)}),d},c.getContourColorsOfTrack=function(a){var d;return angular.forEach(c.vals.perspectives[b.curPerspectiveIdx].signalCanvases.contourColors,function(b){b.ssffTrackName===a&&(d=b)}),d},c.getAssignment=function(a){var d={};return angular.forEach(c.vals.perspectives[b.curPerspectiveIdx].signalCanvases.assign,function(b){b.signalCanvasName===a&&(d=b)}),d},c.getLevelDefinition=function(a){var b={};return angular.forEach(c.curDbConfig.levelDefinitions,function(c){c.name===a&&(b=c)}),b},c.getAttrDefsNames=function(a){var b=[];return angular.forEach(c.getLevelDefinition(a).attributeDefinitions,function(a){b.push(a.name)}),b},c.setPerspectivesOrder=function(a,b){void 0!==c.vals&&void 0!==c.vals.perspectives&&void 0!==c.vals.perspectives[a]&&void 0!==c.vals.perspectives[a].levelCanvases&&(c.vals.perspectives[a].levelCanvases.order=b)},c.getStrRep=function(a){var b;switch(a){case 8:b="BACKSPACE";break;case 9:b="TAB";break;case 13:b="ENTER";break;case 16:b="SHIFT";break;case 18:b="ALT";break;case 32:b="SPACE";break;case 37:b="←";break;case 39:b="→";break;case 38:b="↑";break;case 40:b="↓";break;case 42:b="+";break;case 43:b="+";break;case 45:b="-";break;case 95:b="-";break;default:b=String.fromCharCode(a)}return b},c}]),angular.module("emuwebApp").controller("MainController",["$scope","$rootScope","$log","$compile","$timeout","$q","$window","$document","$location","viewState","HistoryService","Iohandlerservice","Soundhandlerservice","ConfigProviderService","fontScaleService","Ssffdataservice","LevelService","Textgridparserservice","Espsparserservice","Binarydatamaniphelper","Wavparserservice","Ssffparserservice","Drawhelperservice","Validationservice","Appcachehandler","loadedMetaDataService","dbObjLoadSaveService","appStateService","DataService","modalService","browserDetector",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E){a.cps=n,a.hists=k,a.fontImage=o,a.levServ=q,a.dataServ=C,a.vs=j,a.ssffds=p,a.shs=m,a.dhs=w,a.wps=u,a.io=l,a.ach=y,a.lmds=z,a.connectBtnLabel="connect",a.tmp={},a.dbLoaded=!1,a.is2dCancasesHidden=!0,a.windowWidth=g.outerWidth,a.internalVars={},a.internalVars.showAboutHint=!1,a.ach.checkForNewVersion(),angular.element(g).bind("resize",function(){q.deleteEditArea(),j.setWindowWidth(g.outerWidth),j.hierarchyState.isShown()&&++j.hierarchyState.resize,a.$digest()}),angular.element(g).bind("keyup",function(b){b.keyCode!==n.vals.keyMappings.shift&&b.keyCode!==n.vals.keyMappings.alt||(k.addCurChangeObjToUndoStack(),a.$digest())}),angular.element(g).bind("blur",function(){j.focusOnEmuWebApp=!1}),angular.element(h).bind("blur",function(){j.focusOnEmuWebApp=!1}),angular.element(g).bind("focus",function(){j.focusOnEmuWebApp=!0}),angular.element(h).bind("focus",function(){j.focusOnEmuWebApp=!0}),window.onbeforeunload=function(){if(""===n.embeddedVals.audioGetUrl&&z.getBundleList().length>0&&!n.vals.main.autoConnect)return"Do you really wish to leave/reload the EMU-webApp? All unsaved changes will be lost..."},a.$on("connectionDisrupted",function(){B.resetToInitState()}),a.$on("resetToInitState",function(){a.loadDefaultConfig()}),a.$on("reloadToInitState",function(b,c){a.loadDefaultConfig(),j.url=c.url,j.somethingInProgressTxt="Connecting to server...",j.somethingInProgress=!0,l.wsH.initConnect(c.url).then(function(b){"error"===b.type?D.open("views/error.html","Could not connect to websocket server: "+c.url).then(function(){B.resetToInitState()}):a.handleConnectedToWSserver(c)},function(a){D.open("views/error.html","Could not connect to websocket server: "+JSON.stringify(a,null,4)).then(function(){B.resetToInitState()})})});var F=i.search();F.audioGetUrl&&F.labelGetUrl&&F.labelType&&(n.embeddedVals.audioGetUrl=F.audioGetUrl,n.embeddedVals.labelGetUrl=F.labelGetUrl,n.embeddedVals.labelType=F.labelType,n.embeddedVals.fromUrlParams=!0),a.loadFilesForEmbeddedApp=function(){n.embeddedVals.audioGetUrl&&(n.vals.activeButtons.openDemoDB=!1,l.httpGetPath(n.embeddedVals.audioGetUrl,"arraybuffer").then(function(a){j.showDropZone=!1;var b=n.embeddedVals.audioGetUrl;z.setCurBndlName(b.substr(0,b.lastIndexOf(".")).substr(b.lastIndexOf("/")+1,b.length)),j.getsubmenuOpen()&&j.toggleSubmenu(n.design.animation.period),j.somethingInProgressTxt="Loading DB config...";var c,d=i.search();c=d.DBconfigGetUrl?d.DBconfigGetUrl:"configFiles/embedded_emuwebappConfig.json",l.httpGetPath(c).then(function(b){j.curPerspectiveIdx=0,n.setVals(b.data.EMUwebAppConfig);var c=x.validateJSO("emuwebappConfigSchema",n.vals);if(c===!0)if(n.embeddedVals.fromUrlParams&&(n.vals.main.catchMouseForKeyBinding=!1),n.curDbConfig=b.data,c=x.validateJSO("DBconfigFileSchema",n.curDbConfig),c===!0){var e=[{session:"File(s)",name:"from URL parameters"}];z.setBundleList(e),z.setCurBndl(e[0]),j.somethingInProgress=!0,j.somethingInProgressTxt="Parsing WAV file...",u.parseWavAudioBuf(a.data).then(function(a){var b=a;j.curViewPort.sS=0,j.curViewPort.eS=b.length,j.resetSelect(),m.audioBuffer=b;var c;c=("TEXTGRID"===n.embeddedVals.labelType,"text"),l.httpGetPath(n.embeddedVals.labelGetUrl,c).then(function(a){j.somethingInProgressTxt="Parsing "+n.embeddedVals.labelType+" file...",l.parseLabelFile(a.data,n.embeddedVals.labelGetUrl,"embeddedTextGrid",n.embeddedVals.labelType).then(function(a){var b=a;if(C.setData(b),!d.DBconfigGetUrl){var c=[],e=[];b.levels.forEach(function(a){c.push(a.name),e.push({name:a.name,type:a.type,attributeDefinitions:{name:a.name,type:"string"}})}),n.curDbConfig.levelDefinitions=e,n.vals.perspectives[j.curPerspectiveIdx].levelCanvases.order=c}j.setCurLevelAttrDefs(n.curDbConfig.levelDefinitions),j.somethingInProgressTxt="Done!",j.somethingInProgress=!1,j.setState("labeling")},function(a){D.open("views/error.html","Error parsing wav file: "+a.status.message)})},function(a){D.open("views/error.html","Could not get label file: "+n.embeddedVals.labelGetUrl+" ERROR "+JSON.stringify(a.message,null,4))})},function(a){D.open("views/error.html","Error parsing wav file: "+a.status.message)})}else D.open("views/error.html","Error validating / checking DBconfig: "+JSON.stringify(c,null,4));else D.open("views/error.html","Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): "+JSON.stringify(c,null,4))},function(a){D.open("views/error.html","Could not get embedded_config.json: "+a)})},function(a){D.open("views/error.html","Could not get audio file:"+n.embeddedVals.audioGetUrl+" ERROR: "+JSON.stringify(a,null,4))}))},a.loadDefaultConfig=function(){j.somethingInProgress=!0,j.somethingInProgressTxt="Loading schema files",x.loadSchemas().then(function(b){x.setSchemas(b),l.httpGetDefaultDesign().then(function(b){n.setDesign(b.data),l.httpGetDefaultConfig().then(function(b){j.somethingInProgressTxt="Validating emuwebappConfig";var c=x.validateJSO("emuwebappConfigSchema",b.data);c===!0?(n.setVals(b.data),angular.copy(a.cps.vals,a.cps.initDbConfig),a.handleDefaultConfigLoaded(),a.loadFilesForEmbeddedApp(),a.checkIfToShowWelcomeModal(),j.somethingInProgress=!1):D.open("views/error.html","Error validating / checking emuwebappConfigSchema: "+JSON.stringify(c,null,4)).then(function(){B.resetToInitState()})},function(a){D.open("views/error.html","Could not get defaultConfig for EMU-webApp:  status: "+a.status+" headers: "+a.headers+" config "+a.config).then(function(){B.resetToInitState()})})},function(a){D.open("views/error.html","Could not get defaultConfig for EMU-webApp:  status: "+a.status+" headers: "+a.headers+" config "+a.config).then(function(){B.resetToInitState()})})},function(a){D.open("views/error.html","Error loading schema file: "+JSON.stringify(a,null,4)).then(function(){B.resetToInitState()})})},a.loadDefaultConfig(),a.checkIfToShowWelcomeModal=function(){var b=localStorage.getItem("haveShownWelcomeModal");E.isBrowser.PhantomJS()||null!==b||(localStorage.setItem("haveShownWelcomeModal","true"),a.internalVars.showAboutHint=!0)},a.getCurBndlName=function(){return z.getCurBndlName()},a.handleDefaultConfigLoaded=function(){j.getsubmenuOpen()||j.toggleSubmenu(n.design.animation.period);var b=i.search();(n.vals.main.autoConnect||"true"===b.autoConnect)&&("undefined"!=typeof b.serverUrl&&(n.vals.main.serverUrl=b.serverUrl),l.wsH.initConnect(n.vals.main.serverUrl).then(function(b){"error"===b.type?D.open("views/error.html","Could not connect to websocket server: "+n.vals.main.serverUrl).then(function(){B.resetToInitState()}):a.handleConnectedToWSserver({session:null,reload:null})},function(a){D.open("views/error.html","Could not connect to websocket server: "+JSON.stringify(a,null,4)).then(function(){B.resetToInitState()})})),j.setspectroSettings(n.vals.spectrogramSettings.windowSizeInSecs,n.vals.spectrogramSettings.rangeFrom,n.vals.spectrogramSettings.rangeTo,n.vals.spectrogramSettings.dynamicRange,n.vals.spectrogramSettings.window,n.vals.spectrogramSettings.drawHeatMapColors,n.vals.spectrogramSettings.preEmphasisFilterFactor,n.vals.spectrogramSettings.heatMapColorAnchors),j.setTransitionTime(n.design.animation.period)},a.handleConnectedToWSserver=function(b){var c=b.session,d=b.reload;j.showDropZone=!1,n.vals.main.comMode="WS",n.vals.activeButtons.openDemoDB=!1,j.somethingInProgress=!0,j.somethingInProgressTxt="Checking protocol...",l.getProtocol().then(function(b){"EMU-webApp-websocket-protocol"===b.protocol&&"0.0.2"===b.version?(j.somethingInProgressTxt="Checking user management...",l.getDoUserManagement().then(function(b){"NO"===b?a.innerHandleConnectedToWSserver({session:c,reload:d}):D.open("views/loginModal.html").then(function(b){b?a.innerHandleConnectedToWSserver({session:c,reload:d}):B.resetToInitState()})})):D.open("views/error.html","Could not connect to websocket server: "+n.vals.main.serverUrl+'. It does not speak the same protocol as this client. Its protocol answer was: "'+b.protocol+'" with the version: "'+b.version+'"').then(function(){B.resetToInitState()})})},a.innerHandleConnectedToWSserver=function(a){var b=a.session,c=a.reload;j.somethingInProgressTxt="Loading DB config...",l.httpGetDefaultDesign().then(function(a){n.setDesign(a.data),l.getDBconfigFile().then(function(a){j.curPerspectiveIdx=0,n.setVals(a.EMUwebAppConfig);var d=x.validateJSO("emuwebappConfigSchema",n.vals);d===!0?(n.curDbConfig=a,j.setCurLevelAttrDefs(n.curDbConfig.levelDefinitions),d=x.validateJSO("DBconfigFileSchema",a),d===!0?(j.somethingInProgressTxt="Loading bundle list...",l.getBundleList().then(function(a){d=z.setBundleList(a),n.vals.activeButtons.clear=!0,n.vals.activeButtons.specSettings=!0,d===!0?(null===b&&(b=z.getBundleList()[0]),A.loadBundle(b).then(function(){}),c&&z.openCollapseSession(b.session)):D.open("views/error.html","Error validating bundleList: "+JSON.stringify(d,null,4)).then(function(){B.resetToInitState()})})):D.open("views/error.html","Error validating / checking DBconfig: "+JSON.stringify(d,null,4)).then(function(){B.resetToInitState()})):D.open("views/error.html","Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): "+JSON.stringify(d,null,4)).then(function(){B.resetToInitState()})})})},a.toggleCollapseSession=function(b){a.uniqSessionList[b].collapsed=!a.uniqSessionList[b].collapsed},a.getEnlarge=function(a){var b=n.vals.perspectives[j.curPerspectiveIdx].signalCanvases.order.length,c=50;return j.getenlarge()===-1?"auto":1===b?"auto":2===b?j.getenlarge()===a?"70%":"27%":j.getenlarge()===a?c+"%":(95-c)/(b-1)+"%"},a.cursorInTextField=function(){j.setcursorInTextField(!0)},a.cursorOutOfTextField=function(){j.setcursorInTextField(!1)},a.addLevelSegBtnClick=function(){if(j.getPermission("addLevelSegBtnClick")){var a=0;void 0!==C.data.levels&&(a=C.data.levels.length);var b="levelNr"+a,c={items:[],name:b,type:"SEGMENT"};if(void 0===j.getCurAttrDef(b)){var d={name:b,type:"EVENT",attributeDefinitions:{name:b,type:"string"}};j.setCurLevelAttrDefs(d)}q.insertLevel(c,a,j.curPerspectiveIdx),k.addObjToUndoStack({type:"ANNOT",action:"INSERTLEVEL",level:c,id:a,curPerspectiveIdx:j.curPerspectiveIdx}),j.selectLevel(!1,n.vals.perspectives[j.curPerspectiveIdx].levelCanvases.order,q)}},a.addLevelPointBtnClick=function(){if(j.getPermission("addLevelPointBtnClick")){var a=0;void 0!==C.data.levels&&(a=C.data.levels.length);var b="levelNr"+a,c={items:[],name:b,type:"EVENT"};if(void 0===j.getCurAttrDef(b)){var d={name:b,type:"EVENT",attributeDefinitions:{name:b,type:"string"}};j.setCurLevelAttrDefs(d)}q.insertLevel(c,a,j.curPerspectiveIdx),k.addObjToUndoStack({type:"ANNOT",action:"INSERTLEVEL",level:c,id:a,curPerspectiveIdx:j.curPerspectiveIdx}),j.selectLevel(!1,n.vals.perspectives[j.curPerspectiveIdx].levelCanvases.order,q)}},a.renameSelLevelBtnClick=function(){j.getPermission("renameSelLevelBtnClick")&&(void 0!==j.getcurClickLevelName()?D.open("views/renameLevel.html",j.getcurClickLevelName()):D.open("views/error.html","Rename Error : Please choose a Level first !"))},a.downloadTextGridBtnClick=function(){j.getPermission("downloadTextGridBtnClick")&&r.asyncToTextGrid().then(function(a){a=a.replace(/\t/g,"    "),D.open("views/export.html",z.getCurBndl().name+".TextGrid",a)})},a.downloadAnnotationBtnClick=function(){j.getPermission("downloadAnnotationBtnClick")&&x.validateJSO("emuwebappConfigSchema",C.getData())&&D.open("views/export.html",z.getCurBndl().name+"_annot.json",angular.toJson(C.getData(),!0))},a.spectSettingsBtnClick=function(){j.getPermission("spectSettingsChange")&&D.open("views/spectSettings.html")},a.connectBtnClick=function(){j.getPermission("connectBtnClick")&&D.open("views/connectModal.html").then(function(b){b&&(j.somethingInProgressTxt="Connecting to server...",j.somethingInProgress=!0,j.url=b,l.wsH.initConnect(b).then(function(c){"error"===c.type?D.open("views/error.html","Could not connect to websocket server: "+b).then(function(){B.resetToInitState()}):a.handleConnectedToWSserver({session:null,reload:null})},function(a){D.open("views/error.html","Could not connect to websocket server: "+JSON.stringify(a,null,4)).then(function(){B.resetToInitState()})}))})},a.openDemoDBbtnClick=function(b){j.getPermission("openDemoBtnDBclick")&&(a.dropdown=!1,n.vals.activeButtons.openDemoDB=!1,z.setDemoDbName(b),j.showDropZone=!1,j.somethingInProgress=!0,j.setState("loadingSaving"),n.vals.main.comMode="DEMO",j.somethingInProgressTxt="Loading DB config...",l.httpGetDefaultDesign().then(function(a){n.setDesign(a.data),l.getDBconfigFile(b).then(function(a){var c=a.data;j.curPerspectiveIdx=0,n.setVals(c.EMUwebAppConfig);var d=x.validateJSO("emuwebappConfigSchema",n.vals);d===!0?(n.curDbConfig=c,j.setCurLevelAttrDefs(n.curDbConfig.levelDefinitions),d=x.validateJSO("DBconfigFileSchema",n.curDbConfig),d===!0?(j.somethingInProgressTxt="Loading bundle list...",l.getBundleList(b).then(function(a){var b=a.data;z.setBundleList(b),n.vals.activeButtons.clear=!0,n.vals.activeButtons.specSettings=!0,A.loadBundle(z.getBundleList()[0])},function(a){D.open("views/error.html","Error loading bundle list of "+b+": "+a.data+" STATUS: "+a.status).then(function(){B.resetToInitState()})})):D.open("views/error.html","Error validating / checking DBconfig: "+JSON.stringify(d,null,4)).then(function(){B.resetToInitState()})):D.open("views/error.html","Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): "+JSON.stringify(d,null,4)).then(function(){B.resetToInitState()})},function(a){D.open("views/error.html","Error loading DB config of "+b+": "+a.data+" STATUS: "+a.status).then(function(){B.resetToInitState()})})}))},a.aboutBtnClick=function(){j.getPermission("aboutBtnClick")&&D.open("views/help.html")},a.showHierarchyBtnClick=function(){j.hierarchyState.isShown()||(j.hierarchyState.toggleHierarchy(),D.open("views/showHierarchyModal.html"))},a.showEditDBconfigBtnClick=function(){D.open("views/tabbed.html").then(function(b){b===!1||(x.validateJSO("emuwebappConfigSchema",b)?a.cps.getDelta(b).then(function(b){l.saveConfiguration(angular.toJson(b,!0)).then(function(){0!==k.movesAwayFromLastSave&&"DEMO"!==n.vals.main.comMode?D.open("views/confirmModal.html","Do you wish to clear all loaded data and if connected disconnect from the server? CAUTION: YOU HAVE UNSAVED CHANGES! These will be lost if you confirm.").then(function(a){a&&B.reloadToInitState()}):B.reloadToInitState(a.lmds.getCurBndl())})}):D.open("views/error.html","Sorry, there were errors in your configuration."))})},a.searchBtnClick=function(){j.getPermission("searchBtnClick")&&D.open("views/searchAnnot.html")},a.clearBtnClick=function(){var a;a=0!==k.movesAwayFromLastSave&&"DEMO"!==n.vals.main.comMode?"Do you wish to clear all loaded data and if connected disconnect from the server? CAUTION: YOU HAVE UNSAVED CHANGES! These will be lost if you confirm.":"Do you wish to clear all loaded data and if connected disconnect from the server? You have NO unsaved changes so no changes will be lost.",D.open("views/confirmModal.html",a).then(function(a){a&&B.resetToInitState()})},a.cmdZoomAll=function(){j.getPermission("zoom")&&(q.deleteEditArea(),j.setViewPort(0,m.audioBuffer.length))},a.cmdZoomIn=function(){j.getPermission("zoom")&&(q.deleteEditArea(),j.zoomViewPort(!0))},a.cmdZoomOut=function(){j.getPermission("zoom")&&(q.deleteEditArea(),j.zoomViewPort(!1))},a.cmdZoomLeft=function(){j.getPermission("zoom")&&(q.deleteEditArea(),j.shiftViewPort(!1))},a.cmdZoomRight=function(){j.getPermission("zoom")&&(q.deleteEditArea(),j.shiftViewPort(!0))},a.cmdZoomSel=function(){j.getPermission("zoom")&&(q.deleteEditArea(),j.setViewPort(j.curViewPort.selectS,j.curViewPort.selectE))},a.cmdPlayView=function(){j.getPermission("playaudio")&&(m.playFromTo(j.curViewPort.sS,j.curViewPort.eS),j.animatePlayHead(j.curViewPort.sS,j.curViewPort.eS))},a.cmdPlaySel=function(){j.getPermission("playaudio")&&(m.playFromTo(j.curViewPort.selectS,j.curViewPort.selectE),j.animatePlayHead(j.curViewPort.selectS,j.curViewPort.selectE))},a.cmdPlayAll=function(){j.getPermission("playaudio")&&(m.playFromTo(0,m.audioBuffer.length),j.animatePlayHead(0,m.audioBuffer.length))},a.changePerspective=function(a){for(var b,c=0;c<n.vals.perspectives.length;c++)a.name===n.vals.perspectives[c].name&&(b=c);j.curPerspectiveIdx=b,j.setRightsubmenuOpen(!j.getRightsubmenuOpen())},a.getPerspectiveColor=function(a){var b;return b=j.curPerspectiveIdx===-1||a.name===n.vals.perspectives[j.curPerspectiveIdx].name?"emuwebapp-curSelPerspLi":"emuwebapp-perspLi"}}]),angular.module("emuwebApp").directive("level",["$timeout","$animate","viewState","ConfigProviderService","Drawhelperservice","HistoryService","fontScaleService","modalService","LevelService","loadedMetaDataService","HierarchyLayoutService","DataService",function(a,b,c,d,e,f,g,h,i,j,k,l){return{templateUrl:"views/level.html",restrict:"E",scope:{level:"=",idx:"="},link:function(a,m){var n=m.find("canvas");a.open=!0,a.vs=c,a.hists=f,a.cps=d,a.modal=h,a.lmds=j,a.hls=k,a.ds=l,a.ls=i;var o=m.find("div");a.levelDef=d.getLevelDefinition(a.level.name),a.backgroundCanvas={background:d.design.color.lightGrey},a.drawHierarchy=!1,a.$watch("vs.lastUpdate",function(b,c){b!==c&&a.redraw()}),a.$watch("vs.curViewPort",function(b,c){c.sS!==b.sS||c.eS!==b.eS||c.windowWidth!==b.windowWidth?(a.drawLevelDetails(),a.drawLevelMarkup()):a.drawLevelMarkup()},!0),a.$watch("vs.curMouseX",function(){a.vs.getcurMouseLevelName()===a.level.name&&(a.drawLevelDetails(),a.drawLevelMarkup())},!0),a.$watch("vs.curClickLevelName",function(b){void 0!==b&&a.drawLevelMarkup()},!0),a.$watch("vs.movingBoundarySample",function(){a.level.name===a.vs.curMouseLevelName&&a.drawLevelDetails(),a.drawLevelMarkup()},!0),a.$watch("vs.movingBoundary",function(){a.drawLevelMarkup()},!0),a.$watch("hists.movesAwayFromLastSave",function(){a.drawLevelDetails(),a.drawLevelMarkup()},!0),a.$watch("lmds.getCurBndl()",function(b,c){b.name===c.name&&b.session===c.session||(a.drawLevelDetails(),a.drawLevelMarkup())},!0),a.redraw=function(){a.drawLevelDetails(),a.drawLevelMarkup()},a.changeCurAttrDef=function(c,d){var e=a.vs.getCurAttrDef(a.level.name);e!==c&&(a.vs.setCurAttrDef(a.level.name,c,d),m.hasClass("emuwebapp-level-animation")||(a.vs.setEditing(!1),i.deleteEditArea(),b.addClass(o,"emuwebapp-level-animation").then(function(){b.removeClass(o,"emuwebapp-level-animation"),a.drawLevelDetails(),a.drawLevelMarkup()})))},a.getAttrDefBtnColor=function(b){var c,d=a.vs.getCurAttrDef(a.level.name);return c=b===d?{background:"-webkit-radial-gradient(50% 50%, closest-corner, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0) 60%)"}:{"background-color":"white"}},a.updateView=function(){$.isEmptyObject(a.cps)||a.drawLevelDetails()},m.bind("mouseleave",function(){a.vs.setcurMouseItem(void 0,void 0,void 0),a.drawLevelMarkup()}),a.drawLevelDetails=function(){var b=1*d.design.font.small.size.slice(0,-2),c=a.vs.getCurAttrDef(a.level.name),e="25px"!==m.parent().css("height");if(!$.isEmptyObject(a.level)&&!$.isEmptyObject(a.vs)&&!$.isEmptyObject(a.cps)){a.drawHierarchy&&a.drawHierarchyDetails();var f=n[0].getContext("2d");f.clearRect(0,0,f.canvas.width,f.canvas.height);var h,i,j;h=a.vs.getSampleDist(f.canvas.width);var k=f.canvas.height/f.canvas.offsetHeight;a.level.name===c?e?g.drawUndistortedTextTwoLines(f,a.level.name,"("+a.level.type+")",b,d.design.font.small.family,4,f.canvas.height/2-b*k,d.design.color.black,!0):(b-=2,g.drawUndistortedText(f,a.level.name,b,d.design.font.small.family,4,f.canvas.height/2-b*k/2,d.design.color.black,!0)):g.drawUndistortedTextTwoLines(f,a.level.name+":"+c,"("+a.level.type+")",b,d.design.font.small.family,4,f.canvas.height/2-b*k,d.design.color.black,!0);var l=-1,o=f.measureText("m").width*g.scaleX,p=f.measureText("0").width*g.scaleX;if("SEGMENT"===a.level.type)f.fillStyle=d.design.color.black,a.level.items.forEach(function(h){if(++l,h.sampleStart>=a.vs.curViewPort.sS&&h.sampleStart<=a.vs.curViewPort.eS||h.sampleStart+h.sampleDur>a.vs.curViewPort.sS&&h.sampleStart+h.sampleDur<a.vs.curViewPort.eS||h.sampleStart<a.vs.curViewPort.sS&&h.sampleStart+h.sampleDur>a.vs.curViewPort.eS){var k;if(h.labels.forEach(function(a){a.name===c&&(k=a.value)}),i=a.vs.getPos(f.canvas.width,h.sampleStart),j=a.vs.getPos(f.canvas.width,h.sampleStart+h.sampleDur+1),f.fillStyle=d.design.color.black,f.fillRect(i,0,2,f.canvas.height/2),f.fillStyle=d.design.color.grey,f.fillRect(j,f.canvas.height/2,2,f.canvas.height),f.font=b-2+"px "+d.design.font.small.family,void 0!==k&&j-i>o*k.length&&(e?g.drawUndistortedText(f,k,b-2,d.design.font.small.family,i+(j-i)/2,f.canvas.height/2-(b-2)+2,d.design.color.black,!1):g.drawUndistortedText(f,k,b-2,d.design.font.small.family,i+(j-i)/2,f.canvas.height/2-b+2,d.design.color.black,!1)),a.open&&void 0!==k&&0!==k.length){var m=i+(j-i)/2,n=f.canvas.height/4;f.strokeStyle=d.design.color.black,f.beginPath(),f.moveTo(i,n),f.lineTo(m,n),f.lineTo(m,n+5),f.stroke(),n=f.canvas.height/4*3,f.strokeStyle=d.design.color.grey,f.beginPath(),f.moveTo(j,n),f.lineTo(m,n),f.lineTo(m,n-5),f.stroke()}if(a.open){j-i>p*h.sampleStart.toString().length&&e&&g.drawUndistortedText(f,h.sampleStart,b-2,d.design.font.small.family,i+3,0,d.design.color.grey,!0);var q="dur: "+h.sampleDur+" ";j-i>p*q.length&&e&&g.drawUndistortedText(f,q,b-2,d.design.font.small.family,j-f.measureText(q).width*g.scaleX,f.canvas.height/4*3,d.design.color.grey,!0)}}});else if("EVENT"===a.level.type){f.fillStyle=d.design.color.black;var q;a.level.items.forEach(function(i){if(i.samplePoint>a.vs.curViewPort.sS&&i.samplePoint<a.vs.curViewPort.eS){q=Math.round(a.vs.getPos(f.canvas.width,i.samplePoint)+h/2);var j;i.labels.forEach(function(a){a.name===c&&(j=a.value)}),f.fillStyle=d.design.color.black,f.fillRect(q,0,1,f.canvas.height/2-f.canvas.height/5),f.fillRect(q,f.canvas.height/2+f.canvas.height/5,1,f.canvas.height/2-f.canvas.height/5),g.drawUndistortedText(f,j,b-2,d.design.font.small.family,q,f.canvas.height/2-(b-2)+2,d.design.color.black,!1),e&&g.drawUndistortedText(f,i.samplePoint,b-2,d.design.font.small.family,q+5,0,d.design.color.grey,!0)}})}}},a.drawLevelMarkup=function(){var b=n[1].getContext("2d");b.clearRect(0,0,b.canvas.width,b.canvas.height),a.level.name===a.vs.getcurClickLevelName()&&(b.fillStyle=d.design.color.transparent.grey,b.fillRect(0,0,b.canvas.width,b.canvas.height)),e.drawMovingBoundaryLine(b),e.drawCurViewPortSelected(b);var c,f,g,h,i;c=a.vs.getPos(b.canvas.width,a.vs.curViewPort.selectS),f=a.vs.getPos(b.canvas.width,a.vs.curViewPort.selectE),g=a.vs.getSampleDist(b.canvas.width);var j=a.vs.getcurMouseItem(),k=a.vs.getcurMouseisFirst(),l=a.vs.getcurMouseisLast(),m=a.vs.getcurClickItems(),o=a.vs.getcurClickLevelName();void 0!==m&&a.level.name===o&&m.length>0&&m.forEach(function(e){void 0!==e&&(void 0!==e.sampleStart?(c=Math.round(a.vs.getPos(b.canvas.width,e.sampleStart)),f=Math.round(a.vs.getPos(b.canvas.width,e.sampleStart+e.sampleDur+1))):(c=Math.round(a.vs.getPos(b.canvas.width,e.samplePoint)+g/2),c-=5,f=c+10),b.fillStyle=d.design.color.transparent.yellow,b.fillRect(c,0,f-c,b.canvas.height),b.fillStyle=d.design.color.black)}),i=a.vs.getcurMouseItem(),a.level.items.length>0&&void 0!==i&&void 0!==j&&a.level.name===a.vs.getcurMouseLevelName()&&(b.fillStyle=d.design.color.blue,k===!0?"SEGMENT"===a.vs.getcurMouseLevelType()&&(i=a.level.items[0],c=Math.round(a.vs.getPos(b.canvas.width,i.sampleStart)),b.fillRect(c,0,3,b.canvas.height)):l===!0?"SEGMENT"===a.vs.getcurMouseLevelType()&&(i=a.level.items[a.level.items.length-1],c=Math.round(a.vs.getPos(b.canvas.width,i.sampleStart+i.sampleDur+1)),b.fillRect(c,0,3,b.canvas.height)):"SEGMENT"===a.vs.getcurMouseLevelType()?(c=Math.round(a.vs.getPos(b.canvas.width,i.sampleStart)),b.fillRect(c,0,3,b.canvas.height)):(c=Math.round(a.vs.getPos(b.canvas.width,i.samplePoint)),h=g/2,b.fillRect(c+h,0,3,b.canvas.height)),b.fillStyle=d.design.color.black)},a.drawHierarchyDetails=function(){var b=1*d.design.font.small.size.slice(0,-2),c=a.hls.findPaths(a.level.name),e=c[1],f=n[0].getContext("2d");f.clearRect(0,0,f.canvas.width,f.canvas.height),f.strokeStyle=d.design.color.black,a.hls.findParents(e);for(var h=0;h<e.length;h++)for(var i=a.ls.getLevelDetails(e[h]),j=f.canvas.height/e.length,k=f.canvas.height-(h+1)*j,l=0;l<i.items.length;l++){var m=Math.round(a.vs.getPos(f.canvas.width,i.items[l]._derivedSampleStart)),o=Math.round(a.vs.getPos(f.canvas.width,i.items[l]._derivedSampleEnd));f.strokeRect(m,k,o-m,k+j),g.drawUndistortedText(f,i.items[l].labels[0].value,b-2,d.design.font.small.family,m+(o-m)/2-f.measureText(i.items[l].labels[0].value).width/2-2,k+j/2,d.design.color.black,!0)}}}}}]),angular.module("emuwebApp").directive("osci",["$timeout","viewState","Soundhandlerservice","ConfigProviderService","Drawhelperservice","loadedMetaDataService",function(a,b,c,d,e,f){return{templateUrl:"views/osci.html",replace:!0,restrict:"E",scope:{},controller:["$scope",function(a){a.changeAttrDef=function(){}}],link:function(g,h,i){var j=h.find("canvas").length,k=h.find("canvas")[0],l=h.find("canvas")[j-1];g.order=i.order,g.trackName=i.trackName,g.cps=d,g.viewState=b,g.lmds=f,g.$watch("viewState.osciSettings",function(){$.isEmptyObject(c)||$.isEmptyObject(c.audioBuffer)||(e.freshRedrawDrawOsciOnCanvas(k,b.curViewPort.sS,b.curViewPort.eS,!1),g.drawVpOsciMarkup(g,d,!0))},!0),g.$watch("viewState.lastUpdate",function(a,b){a!==b&&g.drawVpOsciMarkup(g,d,!0)}),g.$watch("viewState.timelineSize",function(){a(g.redraw,d.design.animation.duration)}),g.$watch("viewState.curPerspectiveIdx",function(){g.drawVpOsciMarkup(g,d,!0)},!0),g.$watch("viewState.playHeadAnimationInfos",function(){$.isEmptyObject(c)||$.isEmptyObject(c.audioBuffer)||g.drawPlayHead(g,d)},!0),g.$watch("viewState.movingBoundarySample",function(){$.isEmptyObject(c)||$.isEmptyObject(c.audioBuffer)||g.drawVpOsciMarkup(g,d,!0)},!0),g.$watch("viewState.curMouseX",function(){$.isEmptyObject(c)||$.isEmptyObject(c.audioBuffer)||b.curMouseTrackName!==g.trackName&&g.drawVpOsciMarkup(g,d,!0)},!0),g.$watch("viewState.movingBoundary",function(){$.isEmptyObject(c)||$.isEmptyObject(c.audioBuffer)||g.drawVpOsciMarkup(g,d,!0)},!0),g.$watch("viewState.curViewPort",function(a,f){$.isEmptyObject(c)||$.isEmptyObject(c.audioBuffer)||(f.sS===a.sS&&f.eS===a.eS||e.freshRedrawDrawOsciOnCanvas(k,b.curViewPort.sS,b.curViewPort.eS,!1),g.drawVpOsciMarkup(g,d,!0))},!0),g.$watch("lmds.getCurBndl()",function(a,c){a.name===c.name&&a.session===c.session||e.freshRedrawDrawOsciOnCanvas(k,b.curViewPort.sS,b.curViewPort.eS,!0)},!0),g.redraw=function(){g.drawVpOsciMarkup(g,d,!0)},g.drawPlayHead=function(a,c){var e=l.getContext("2d");e.clearRect(0,0,k.width,k.height);var f=b.getPos(l.width,b.playHeadAnimationInfos.sS),g=b.getPos(l.width,b.playHeadAnimationInfos.curS);e.fillStyle=d.design.color.transparent.grey,e.fillRect(f,0,g-f,k.height),a.drawVpOsciMarkup(a,c,!1)},g.drawVpOsciMarkup=function(a,c,d){var f=l.getContext("2d");d&&f.clearRect(0,0,l.width,l.height),e.drawMovingBoundaryLine(f),e.drawViewPortTimes(f,!0),e.drawCurViewPortSelected(f,!0),e.drawCrossHairX(f,b.curMouseX)}}}}]),angular.module("emuwebApp").directive("preview",["viewState","Soundhandlerservice","Drawhelperservice","ConfigProviderService",function(a,b,c,d){return{templateUrl:"views/preview.html",restrict:"E",scope:{currentBundleName:"@"},link:function(e,f){var g=f.find("canvas")[0],h=f.find("canvas")[1],i=!1;e.vs=a,e.shs=b,e.backgroundCanvas={background:"#eee",border:"1px solid gray",width:"100%",height:"100%"},e.$watch("vs.curViewPort",function(a,c){$.isEmptyObject(b.audioBuffer)||c.sS===a.sS&&c.eS===a.eS||e.drawPreview()},!0),e.$watch("vs.osciSettings",function(){$.isEmptyObject(b.audioBuffer)||(i=!1,e.drawPreview())},!0),e.$watch("currentBundleName",function(){if($.isEmptyObject(b.audioBuffer)||(i=!1,
e.backgroundCanvas={background:d.design.color.lightGrey,border:"1px solid gray",width:"100%",height:"100%"},e.drawPreview()),""===e.currentBundleName){var a=g.getContext("2d"),c=h.getContext("2d");a.clearRect(0,0,g.width,g.height),c.clearRect(0,0,g.width,g.height)}},!0),e.drawPreview=function(){i?e.drawVpOsciMarkup(a):(c.freshRedrawDrawOsciOnCanvas(g,0,e.shs.audioBuffer.length,!1),i=!0,e.drawVpOsciMarkup(a))},e.drawVpOsciMarkup=function(a){var c=h.getContext("2d"),e=h.width/b.audioBuffer.length*a.curViewPort.sS,f=h.width/b.audioBuffer.length*a.curViewPort.eS;c.clearRect(0,0,h.width,h.height),c.fillStyle=d.design.color.transparent.grey,c.fillRect(e,0,f-e,h.height),c.strokeStyle=d.design.color.transparent.black,c.beginPath(),c.moveTo(e,0),c.lineTo(e,h.height),c.moveTo(f,0),c.lineTo(f,h.height),c.closePath(),c.stroke()}}}}]),angular.module("emuwebApp").directive("bundleListSideBar",["HistoryService",function(a){return{templateUrl:"views/bundleListSideBar.html",restrict:"E",replace:!0,scope:{},link:function(b){b.comment="",b.finishedEditing=function(b,c,d){a.addObjToUndoStack({type:"WEBAPP",action:"FINISHED",finished:b,key:c,index:d})},b.updateHistory=function(c,d,e){b.comment!==c.comment&&a.updateCurChangeObj({type:"WEBAPP",action:"COMMENT",initial:b.comment,comment:c.comment,key:d,index:e})},b.endHistory=function(c){b.comment!==c.comment&&a.addCurChangeObjToUndoStack()},b.startHistory=function(a){b.comment=a.comment}}}}]),angular.module("emuwebApp").directive("spectro",["$timeout","viewState","ConfigProviderService","Drawhelperservice","fontScaleService","Soundhandlerservice","mathHelperService","loadedMetaDataService",function(a,b,c,d,e,f,g,h){return{templateUrl:"views/spectro.html",restrict:"E",replace:!0,scope:{},link:function(i,j,k){i.shs=f,i.order=k.order,i.vs=b,i.cps=c,i.dhs=d,i.lmds=h,i.trackName=k.trackName,i.canvas0=j.find("canvas")[0],i.canvas1=j.find("canvas")[j.find("canvas").length-1],i.context=i.canvas0.getContext("2d"),i.markupCtx=i.canvas1.getContext("2d"),i.alpha=.16,i.devicePixelRatio=window.devicePixelRatio||1,i.primeWorker=new SpectroDrawingWorker,i.$watch("vs.timelineSize",function(){$.isEmptyObject(i.shs)||$.isEmptyObject(i.shs.audioBuffer)||a(i.clearAndDrawSpectMarkup,c.design.animation.duration)}),i.$watch("viewState.lastUpdate",function(a,b){a===b||$.isEmptyObject(i.shs)||$.isEmptyObject(i.shs.audioBuffer)||i.clearAndDrawSpectMarkup()}),i.$watch("vs.submenuOpen",function(){$.isEmptyObject(i.shs)||$.isEmptyObject(i.shs.audioBuffer)||a(i.clearAndDrawSpectMarkup,c.design.animation.duration)}),i.$watch("vs.curViewPort",function(a,b){$.isEmptyObject(i.shs)||$.isEmptyObject(i.shs.audioBuffer)||(b.sS===a.sS&&b.eS===a.eS||i.redraw(),i.clearAndDrawSpectMarkup())},!0),i.$watch("vs.movingBoundarySample",function(){$.isEmptyObject(i.shs)||$.isEmptyObject(i.shs.audioBuffer)||i.clearAndDrawSpectMarkup()},!0),i.$watch("vs.movingBoundary",function(){$.isEmptyObject(i.shs)||$.isEmptyObject(i.shs.audioBuffer)||i.clearAndDrawSpectMarkup()},!0),i.$watch("vs.curMouseX",function(){$.isEmptyObject(i.shs)||$.isEmptyObject(i.shs.audioBuffer)||i.vs.curMouseTrackName!==i.trackName&&i.clearAndDrawSpectMarkup()},!0),i.$watch("vs.spectroSettings",function(){$.isEmptyObject(i.shs)||$.isEmptyObject(i.shs.audioBuffer)||(i.setupEvent(),i.redraw())},!0),i.$watch("vs.osciSettings",function(){$.isEmptyObject(i.shs)||$.isEmptyObject(i.shs.audioBuffer)||(i.setupEvent(),i.redraw())},!0),i.$watch("lmds.getCurBndl()",function(a,b){$.isEmptyObject(i.shs)||$.isEmptyObject(i.shs.audioBuffer)||a.name===b.name&&a.session===b.session||i.redraw()},!0),i.redraw=function(){i.markupCtx.clearRect(0,0,i.canvas1.width,i.canvas1.height),i.drawSpectro(i.shs.audioBuffer.getChannelData(i.vs.osciSettings.curChannel))},i.drawSpectro=function(a){i.killSpectroRenderingThread(),i.startSpectroRenderingThread(a)},i.calcSamplesPerPxl=function(){return(i.vs.curViewPort.eS+1-i.vs.curViewPort.sS)/i.canvas0.width},i.clearAndDrawSpectMarkup=function(){i.markupCtx.clearRect(0,0,i.canvas1.width,i.canvas1.height),i.drawSpectMarkup()},i.drawSpectMarkup=function(){i.dhs.drawMovingBoundaryLine(i.markupCtx),i.dhs.drawCurViewPortSelected(i.markupCtx,!1),i.dhs.drawMinMaxAndName(i.markupCtx,"",i.vs.spectroSettings.rangeFrom,i.vs.spectroSettings.rangeTo,2),d.drawCrossHairX(i.markupCtx,i.vs.curMouseX)},i.killSpectroRenderingThread=function(){i.context.fillStyle=c.design.color.lightGrey,i.context.fillRect(0,0,i.canvas0.width,i.canvas0.height),i.dhs.drawCurViewPortSelected(i.markupCtx,!1),e.drawUndistortedText(i.context,"rendering...",.75*c.design.font.small.size.slice(0,-2),c.design.font.small.family,10,50,c.design.color.black,!0),null!==i.primeWorker&&(i.primeWorker.kill(),i.primeWorker=null)},i.setupEvent=function(){var a=i.context.createImageData(i.canvas0.width,i.canvas0.height);i.primeWorker.says(function(b){if(void 0===b.status){if(i.calcSamplesPerPxl()===b.samplesPerPxl){var c=new Uint8ClampedArray(b.img);a.data.set(c),i.context.putImageData(a,0,0),i.drawSpectMarkup()}}else console.error("Error rendering spectrogram:",b.status.message)})},i.startSpectroRenderingThread=function(a){if(a.length>0){i.primeWorker=new SpectroDrawingWorker;var b=[],c=g.calcClosestPowerOf2Gt(i.shs.audioBuffer.sampleRate*i.vs.spectroSettings.windowSizeInSecs);c<512&&(c=512),b=a.subarray(i.vs.curViewPort.sS,i.vs.curViewPort.eS);var d=[],e=[],f=i.shs.audioBuffer.sampleRate*i.vs.spectroSettings.windowSizeInSecs;i.vs.curViewPort.sS<f/2||(d=a.subarray(i.vs.curViewPort.sS-f/2,i.vs.curViewPort.sS)),i.vs.curViewPort.eS+c/2-1>=i.shs.audioBuffer.length||(e=a.subarray(i.vs.curViewPort.eS,i.vs.curViewPort.eS+c/2-1));var h=new Float32Array(d.length+b.length+e.length);h.set(d),h.set(b,d.length),h.set(e,d.length+b.length),b=i.vs.curViewPort.sS>=c/2?a.subarray(i.vs.curViewPort.sS-c/2,i.vs.curViewPort.eS+c):a.subarray(i.vs.curViewPort.sS,i.vs.curViewPort.eS+c),i.setupEvent(),i.primeWorker.tell({windowSizeInSecs:i.vs.spectroSettings.windowSizeInSecs,fftN:c,alpha:i.alpha,upperFreq:i.vs.spectroSettings.rangeTo,lowerFreq:i.vs.spectroSettings.rangeFrom,samplesPerPxl:i.calcSamplesPerPxl(),window:i.vs.spectroSettings.window,imgWidth:i.canvas0.width,imgHeight:i.canvas0.height,dynRangeInDB:i.vs.spectroSettings.dynamicRange,pixelRatio:i.devicePixelRatio,sampleRate:i.shs.audioBuffer.sampleRate,transparency:i.cps.vals.spectrogramSettings.transparency,audioBuffer:h,audioBufferChannels:i.shs.audioBuffer.numberOfChannels,drawHeatMapColors:i.vs.spectroSettings.drawHeatMapColors,preEmphasisFilterFactor:i.vs.spectroSettings.preEmphasisFilterFactor,heatMapColorAnchors:i.vs.spectroSettings.heatMapColorAnchors},[h.buffer])}}}}}]),angular.module("emuwebApp").controller("ExportCtrl",["$scope","modalService","browserDetector","viewState","HistoryService",function(a,b,c,d,e){a.firefox=c.isBrowser.Firefox(),a.getBlob=function(){var c;try{c=new Blob([b.dataExport],{type:"text/plain"})}catch(b){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,c=new BlobBuilder,c.append(a.exportData),c=c.getBlob()}return c},a.updateHistoryService=function(){e.movesAwayFromLastSave=0},a.cursorInTextField=function(){d.setEditing(!0),d.setcursorInTextField(!0)},a.cursorOutOfTextField=function(){d.setEditing(!1),d.setcursorInTextField(!1)},a.export=function(){var c;c="object"!=typeof URL&&"undefined"!=typeof webkitURL?webkitURL.createObjectURL(a.getBlob()):URL.createObjectURL(a.getBlob()),a.SaveToDisk(c,b.dataIn),b.close()},a.SaveToDisk=function(b,c){var d=document.createElement("a");d.setAttribute("download",c),d.href=b,d.innerHTML="",d.style.display="none",document.body.appendChild(d),d.click(),a.updateHistoryService()}}]),angular.module("emuwebApp").factory("viewState",["$rootScope","$timeout","$window","Soundhandlerservice","DataService","StandardFuncsService",function(a,b,c,d,e,f){var g={},h={BARTLETT:1,BARTLETTHANN:2,BLACKMAN:3,COSINE:4,GAUSS:5,HAMMING:6,HANN:7,LANCZOS:8,RECTANGULAR:9,TRIANGULAR:10},i={DEMO:1,WS:2,EMBEDDED:3},j={absolute:1,relative:2},k={OSCI:1,SPEC:2},l={DOTS:1,EPG:2};return g.curLevelAttrDefs=[],g.initialize=function(){g.curViewPort={sS:0,eS:0,selectS:-1,selectE:-1,movingS:-1,movingE:-1,dragBarActive:!1,dragBarHeight:-1,windowWidth:void 0},g.spectroSettings={windowSizeInSecs:-1,rangeFrom:-1,rangeTo:-1,dynamicRange:-1,window:-1,drawHeatMapColors:-1,preEmphasisFilterFactor:-1},g.osciSettings={curChannel:0},g.playHeadAnimationInfos={sS:-1,eS:-1,curS:null,endFreezeSample:-1,autoscroll:!1},g.hierarchyState={hierarchyShown:!1,selectedItemID:void 0,selectedLinkFromID:void 0,selectedLinkToID:void 0,editValue:void 0,inputFocus:!1,collapseInfo:{},scaleFactor:1,translate:[0,0],contextMenuID:void 0,newLinkFromID:void 0,path:[],curPathIdx:0,curNrOfPaths:0,rotated:!1,playing:0,resize:0,closeContextMenu:function(){g.hierarchyState.contextMenuID=void 0},getContextMenuID:function(){return g.hierarchyState.contextMenuID},getInputFocus:function(){return g.hierarchyState.inputFocus},getEditValue:function(){return g.hierarchyState.editValue},setEditValue:function(a){g.hierarchyState.editValue=a},reset:function(){g.hierarchyState.selectedItemID=void 0,g.hierarchyState.selectedLinkFromID=void 0,g.hierarchyState.selectedLinkToID=void 0,g.hierarchyState.editValue=void 0,g.hierarchyState.inputFocus=!1,g.hierarchyState.collapseInfo={},g.hierarchyState.scaleFactor=1,g.hierarchyState.translate=[0,0],g.hierarchyState.contextMenuID=void 0,g.hierarchyState.newLinkFromID=void 0},isRotated:function(){return g.hierarchyState.rotated},toggleRotation:function(){g.hierarchyState.rotated=!g.hierarchyState.rotated},toggleHierarchy:function(){g.hierarchyState.hierarchyShown=!g.hierarchyState.hierarchyShown,g.hierarchyState.hierarchyShown===!1&&f.traverseAndClean(e.getData())},isShown:function(){return g.hierarchyState.hierarchyShown},getCollapsed:function(a){return"undefined"!=typeof g.hierarchyState.collapseInfo[a]&&("boolean"==typeof g.hierarchyState.collapseInfo[a].collapsed&&g.hierarchyState.collapseInfo[a].collapsed)},getCollapsePosition:function(a){return"undefined"==typeof g.hierarchyState.collapseInfo[a]?void 0:"object"==typeof g.hierarchyState.collapseInfo[a].collapsePosition?g.hierarchyState.collapseInfo[a].collapsePosition:void 0},getNumCollapsedParents:function(a){return"undefined"==typeof g.hierarchyState.collapseInfo[a]?0:"number"==typeof g.hierarchyState.collapseInfo[a].numCollapsedParents?g.hierarchyState.collapseInfo[a].numCollapsedParents:0},setCollapsed:function(a,b){"undefined"==typeof g.hierarchyState.collapseInfo[a]&&(g.hierarchyState.collapseInfo[a]={}),g.hierarchyState.collapseInfo[a].collapsed=b},setCollapsePosition:function(a,b){"undefined"==typeof g.hierarchyState.collapseInfo[a]&&(g.hierarchyState.collapseInfo[a]={}),g.hierarchyState.collapseInfo[a].collapsePosition=b},setNumCollapsedParents:function(a,b){"undefined"==typeof g.hierarchyState.collapseInfo[a]&&(g.hierarchyState.collapseInfo[a]={}),g.hierarchyState.collapseInfo[a].numCollapsedParents=b}},g.timelineSize=-1,g.somethingInProgress=!1,g.somethingInProgressTxt="",g.historyActionTxt="",g.editing=!1,g.cursorInTextField=!1,g.saving=!0,g.submenuOpen=!1,g.rightSubmenuOpen=!1,g.curClickItems=[],g.curMousePosSample=0,g.curMouseX=0,g.curMouseTrackName=void 0,g.curMouseLevelName=void 0,g.curMouseLevelType=void 0,g.curClickLevelName=void 0,g.curClickLevelType=void 0,g.lastPcm=void 0,g.curPreselColumnSample=2,g.curCorrectionToolNr=void 0,g.curClickLevelIndex=void 0,g.start=null,g.TransitionTime=void 0,g.showDropZone=!0,g.movingBoundary=!1,g.movingBoundarySample=void 0,g.focusInTextField=!1,g.curTaskPercCompl=0,g.curPerspectiveIdx=-1,g.mouseInEmuWebApp=!1,g.focusOnEmuWebApp=!0,g.lastKeyCode=void 0,g.lastUpdate=void 0,g.url=void 0,g.pageSize=500,g.currentPage=void 0,g.curTimeAnchorIdx=-1,g.largeTextFieldInputFieldVisable=!1,g.largeTextFieldInputFieldCurLabel="",g.states=[],g.states.noDBorFilesloaded={permittedActions:["connectBtnClick","openDemoBtnDBclick","aboutBtnClick"]},g.states.loadingSaving={permittedActions:[]},g.states.labeling={permittedActions:["zoom","playaudio","spectSettingsChange","addLevelSegBtnClick","addLevelPointBtnClick","renameSelLevelBtnClick","downloadTextGridBtnClick","downloadAnnotationBtnClick","spectSettingsChange","clearBtnClick","labelAction","toggleSideBars","saveBndlBtnClick","showHierarchyBtnClick","editDBconfigBtnClick","aboutBtnClick","searchBtnClick"]},g.states.modalShowing=g.states.loadingSaving,g.prevState=g.states.noDBorFilesloaded,g.curState=g.states.noDBorFilesloaded,g.curLevelAttrDefs=[]},g.initialize(),g.getPermission=function(a){return g.curState.permittedActions.indexOf(a)>-1},g.setWindowWidth=function(a){this.curViewPort.windowWidth=a},g.setState=function(a){g.prevState=g.curState,"string"==typeof a?g.curState=g.states[a]:g.curState=a},g.updatePlayHead=function(b){d.isPlaying&&c.requestAnimationFrame(g.updatePlayHead),null===g.start&&(g.start=b);var e=Math.floor(b-g.start)/1e3*d.audioBuffer.sampleRate;g.playHeadAnimationInfos.curS=Math.floor(g.playHeadAnimationInfos.sS+e),d.isPlaying&&g.playHeadAnimationInfos.curS<=g.playHeadAnimationInfos.eS?(g.playHeadAnimationInfos.curS!==-1&&(g.curMousePosSample=g.playHeadAnimationInfos.curS),g.playHeadAnimationInfos.autoscroll&&g.playHeadAnimationInfos.curS>=g.curViewPort.eS&&g.setViewPort(g.curViewPort.eS,g.curViewPort.eS+(g.curViewPort.eS-g.curViewPort.sS))):(g.curMousePosSample=g.playHeadAnimationInfos.endFreezeSample,g.playHeadAnimationInfos.sS=-1,g.playHeadAnimationInfos.eS=-1,g.playHeadAnimationInfos.curS=0,g.start=null),a.$apply()},g.animatePlayHead=function(a,b,d){g.playHeadAnimationInfos.sS=a,g.playHeadAnimationInfos.eS=b,g.playHeadAnimationInfos.endFreezeSample=b,g.playHeadAnimationInfos.curS=a,void 0!==d&&(g.playHeadAnimationInfos.autoscroll=d),c.requestAnimationFrame(g.updatePlayHead)},g.select=function(a,b){g.curViewPort.selectS=a,g.curViewPort.selectE=b},g.resetSelect=function(){g.curViewPort.selectS=-1,g.curViewPort.selectE=-1},g.getViewPort=function(){return g.curViewPort},g.setspectroSettings=function(a,b,c,d,e,f,h,i){g.spectroSettings.windowSizeInSecs=a,g.spectroSettings.rangeFrom=parseInt(b,10),g.spectroSettings.rangeTo=parseInt(c,10),g.spectroSettings.dynamicRange=parseInt(d,10),g.setWindowFunction(e),g.spectroSettings.drawHeatMapColors=f,g.spectroSettings.preEmphasisFilterFactor=h,g.spectroSettings.heatMapColorAnchors=i},g.setOsciSettings=function(a){g.osciSettings.curChannel=a},g.getSelect=function(){return[g.curViewPort.selectS,g.curViewPort.selectE]},g.selectDependent=function(a,b){a<this.curViewPort.selectS&&(this.curViewPort.selectS=a),b>this.curViewPort.selectE&&(this.curViewPort.selectE=b)},g.selectLevel=function(a,b,c){var d,e=g.getcurClickLevelName();if(void 0===e)return a?(d=c.getLevelDetails(b[b.length-1]),void g.setcurClickLevel(d.name,d.type,b.length-1)):(d=c.getLevelDetails(b[0]),void(null!==d&&g.setcurClickLevel(d.name,d.type,0)));var f=-1;b.forEach(function(a,b){a===e&&(f=b)}),void 0===f?(d=c.getLevelDetails(b[0]),g.setcurClickLevel(d.name,d.type,0),g.curClickItems=[],g.selectBoundary()):a?f+1<b.length&&(d=c.getLevelDetails(b[f+1]),g.setcurClickLevel(d.name,d.type,b.idxOfNow+1),g.curClickItems=[],g.selectBoundary()):f-1>=0&&(d=c.getLevelDetails(b[f-1]),g.setcurClickLevel(d.name,d.type,b.idxOfNow-1),g.curClickItems=[],g.selectBoundary())},g.setWindowFunction=function(a){switch(a){case"BARTLETT":g.spectroSettings.window=h.BARTLETT;break;case"BARTLETTHANN":g.spectroSettings.window=h.BARTLETTHANN;break;case"BLACKMAN":g.spectroSettings.window=h.BLACKMAN;break;case"COSINE":g.spectroSettings.window=h.COSINE;break;case"GAUSS":g.spectroSettings.window=h.GAUSS;break;case"HAMMING":g.spectroSettings.window=h.HAMMING;break;case"HANN":g.spectroSettings.window=h.HANN;break;case"LANCZOS":g.spectroSettings.window=h.LANCZOS;break;case"RECTANGULAR":g.spectroSettings.window=h.RECTANGULAR;break;case"TRIANGULAR":g.spectroSettings.window=h.TRIANGULAR;break;default:g.spectroSettings.window=h.BARTLETTHANN}},g.getWindowFunctions=function(){return h},g.getCommunicationModes=function(){return i},g.getTimeModes=function(){return j},g.getSignalTypes=function(){return k},g.getTwoDimTypes=function(){return l},g.getdragBarActive=function(){return this.curViewPort.dragBarActive},g.setdragBarActive=function(a){this.curViewPort.dragBarActive=a},g.getdragBarHeight=function(){return this.curViewPort.dragBarHeight},g.setdragBarHeight=function(a){this.curViewPort.dragBarHeight=a},g.getPos=function(a,b){return a*(b-this.curViewPort.sS)/(this.curViewPort.eS-this.curViewPort.sS+1)},g.getSampleDist=function(a){return this.getPos(a,this.curViewPort.sS+1)-this.getPos(a,this.curViewPort.sS)},g.toggleSubmenu=function(a){this.submenuOpen=!this.submenuOpen,b(function(){var a=new Date;g.lastUpdate=a.getTime()},a)},g.getsubmenuOpen=function(){return this.submenuOpen},g.setsubmenuOpen=function(a){this.submenuOpen=a},g.setenlarge=function(a){this.timelineSize=a},g.getenlarge=function(){return this.timelineSize},g.getTransitionTime=function(){return this.TransitionTime},g.setTransitionTime=function(a){this.TransitionTime=a},g.getRightsubmenuOpen=function(){return this.rightSubmenuOpen},g.setRightsubmenuOpen=function(a){this.rightSubmenuOpen=a},g.setcurClickLevel=function(a,b,c){g.setcurClickLevelName(a,c),g.setcurClickLevelType(b)},g.setcurClickLevelType=function(a){this.curClickLevelType=a},g.getcurClickLevelType=function(){return this.curClickLevelType},g.setcurClickLevelName=function(a,b){this.curClickLevelName=a,this.curClickLevelIndex=b},g.getcurClickLevelName=function(){return this.curClickLevelName},g.getcurClickLevelIndex=function(){return this.curClickLevelIndex},g.getcurClickNeighbours=function(){return this.curClickNeighbours},g.setcurMouseLevelName=function(a){this.curMouseLevelName=a},g.getcurMouseLevelName=function(){return this.curMouseLevelName},g.setcurMouseLevelType=function(a){this.curMouseLevelType=a},g.getcurMouseLevelType=function(){return this.curMouseLevelType},g.setcurMouseItem=function(a,b,c,d,e){this.curMouseItem=a,this.curMouseX=c,this.curMouseNeighbours=b,this.curMouseisFirst=d,this.curMouseisLast=e},g.getcurMouseItem=function(){return this.curMouseItem},g.getcurMouseisFirst=function(){return this.curMouseisFirst},g.getcurMouseisLast=function(){return this.curMouseisLast},g.getcurMouseNeighbours=function(){return this.curMouseNeighbours},g.getItemsInSelection=function(a){var b=[],c=g.curViewPort.selectS,d=g.curViewPort.selectE;return angular.forEach(a,function(a){a.name===g.getcurClickLevelName()&&angular.forEach(a.items,function(a){a.sampleStart>=c&&a.sampleStart+a.sampleDur<=d&&b.push(a),a.samplePoint>=c&&a.samplePoint<=d&&b.push(a)})}),b.sort(g.sortbystart)},g.setcurClickItem=function(a){null!==a&&void 0!==a?(g.curClickItems=[],g.curClickItems.push(a),g.selectBoundary()):g.curClickItems=[]},g.selectBoundary=function(){if(g.curClickItems.length>0){var a,b;a="undefined"==typeof g.curClickItems[0].samplePoint?g.curClickItems[0].sampleStart:g.curClickItems[0].samplePoint,b="undefined"==typeof g.curClickItems[0].samplePoint?g.curClickItems[g.curClickItems.length-1].sampleStart+g.curClickItems[g.curClickItems.length-1].sampleDur:g.curClickItems[0].samplePoint,g.curClickItems.forEach(function(c){c.sampleStart<=a&&(a=c.sampleStart),c.sampleStart+c.sampleDur>=b&&(b=c.sampleStart+c.sampleDur)}),g.select(a,b+1)}},g.setcurClickItemMultiple=function(a,b){0===g.curClickItems.length||void 0===g.curClickItems||null===g.curClickItems?(g.curClickItems=[],g.curClickItems.push(a)):g.curClickItems.indexOf(a)===-1?(g.curClickItems.indexOf(b)<0&&(g.curClickItems=[]),g.curClickItems.push(a),g.curClickItems.sort(g.sortbystart)):(g.curClickItems=[],g.curClickItems.push(a))},g.sortbystart=function(a,b){return a.sampleStart>b.sampleStart||a.samplePoint>b.samplePoint?1:a.sampleStart<b.sampleStart||a.samplePoint<b.samplePoint?-1:0},g.getselectedRange=function(){return this.curClickItems.length>1?{start:this.curClickItems[0].sampleStart,end:this.curClickItems[this.curClickItems.length-1].sampleStart+this.curClickItems[this.curClickItems.length-1].sampleDur}:1===this.curClickItems.length?void 0!==this.curClickItems[0].sampleStart?{start:this.curClickItems[0].sampleStart,end:this.curClickItems[0].sampleStart+this.curClickItems[0].sampleDur}:{start:this.curClickItems[0].samplePoint,end:this.curClickItems[0].samplePoint}:{start:-1,end:-1}},g.getcurClickItems=function(){return this.curClickItems},g.getselected=function(){return this.curClickItems},g.isEditing=function(){return this.editing},g.setEditing=function(a){this.editing=a},g.getLasPcm=function(){return this.lastPcm},g.setLastPcm=function(a){this.lastPcm=a},g.getcursorInTextField=function(){return this.cursorInTextField},g.setcursorInTextField=function(a){this.cursorInTextField=a},g.isSavingAllowed=function(){return this.saving},g.setSavingAllowed=function(a){this.saving=a},g.countSelected=function(){return this.curClickItems.length},g.getCurrentSample=function(a){return this.curViewPort.sS+(this.curViewPort.eS-this.curViewPort.sS)*a},g.getCurrentPercent=function(a){return a*(100/(this.curViewPort.eS-this.curViewPort.sS)/100)},g.getSamplesPerPixelVal=function(a){var b=parseFloat(this.curViewPort.sS),c=parseFloat(this.curViewPort.eS);return(c-b)/a.originalEvent.target.width},g.getViewPortStartTime=function(){return this.curViewPort.sS/d.audioBuffer.sampleRate-.5/d.audioBuffer.sampleRate},g.getViewPortEndTime=function(){return this.curViewPort.eS/d.audioBuffer.sampleRate+.5/d.audioBuffer.sampleRate},g.getSelectedStartTime=function(){return this.curViewPort.selectS/d.audioBuffer.sampleRate-.5/d.audioBuffer.sampleRate},g.getSelectedEndTime=function(){return this.curViewPort.selectE/d.audioBuffer.sampleRate+.5/d.audioBuffer.sampleRate},g.calcSampleTime=function(a){return a/d.audioBuffer.sampleRate+.5/d.audioBuffer.sampleRate},g.setViewPort=function(a,b){var c=this.curViewPort.sS,e=this.curViewPort.eS;void 0!==a&&(this.curViewPort.sS=Math.round(a)),void 0!==b&&(this.curViewPort.eS=Math.round(b)),c>this.curViewPort.sS&&e>this.curViewPort.eS&&this.curViewPort.sS<0&&(this.curViewPort.sS=0,this.curViewPort.eS=e+Math.abs(this.curViewPort.sS)),c<this.curViewPort.sS&&e<this.curViewPort.eS&&this.curViewPort.eS>d.audioBuffer.length&&(this.curViewPort.sS=c,this.curViewPort.eS=d.audioBuffer.length),this.curViewPort.sS<0&&(this.curViewPort.sS=0),this.curViewPort.eS>d.audioBuffer.length&&(this.curViewPort.eS=d.audioBuffer.length),this.curViewPort.eS-this.curViewPort.sS<4&&(this.curViewPort.sS=c,this.curViewPort.eS=e)},g.zoomViewPort=function(a,b){var c,d,e,f=this.getcurMouseItem(),h=this.curViewPort.eS-this.curViewPort.sS,i=!1;if(void 0!==f){this.getcurMouseisFirst()?f=b.getItemDetails(g.getcurMouseLevelName(),0):this.getcurMouseisLast()&&(f=b.getLastItem(g.getcurMouseLevelName()),i=!0),e="SEGMENT"===this.getcurMouseLevelType()?i?f.sampleStart+f.sampleDur:f.sampleStart:f.samplePoint;var j=e-this.curViewPort.sS,k=this.curViewPort.eS-e;a?(c=this.curViewPort.sS+.5*j,d=this.curViewPort.eS-.5*k):(c=this.curViewPort.sS-.5*j,d=this.curViewPort.eS+.5*k)}else a?(c=this.curViewPort.sS+~~(h/4),d=this.curViewPort.eS-~~(h/4)):(c=this.curViewPort.sS-~~(h/4),d=this.curViewPort.eS+~~(h/4));this.setViewPort(c,d)},g.shiftViewPort=function(a){var b,c;a?(b=this.curViewPort.sS+~~((this.curViewPort.eS-this.curViewPort.sS)/4),c=this.curViewPort.eS+~~((this.curViewPort.eS-this.curViewPort.sS)/4)):(b=this.curViewPort.sS-~~((this.curViewPort.eS-this.curViewPort.sS)/4),c=this.curViewPort.eS-~~((this.curViewPort.eS-this.curViewPort.sS)/4)),this.setViewPort(b,c)},g.setCurLevelAttrDefs=function(a){angular.forEach(a,function(a){g.curLevelAttrDefs.push({levelName:a.name,curAttrDefName:a.name})})},g.setCurAttrDef=function(a,b,c){angular.forEach(g.curLevelAttrDefs,function(d){d.levelName===a&&(d.curAttrDefName=b,d.curAttrDefIndex=c)})},g.getCurAttrDef=function(a){var b;return angular.forEach(g.curLevelAttrDefs,function(c){c.levelName===a&&(b=c.curAttrDefName)}),b},g.getCurAttrIndex=function(a){var b;return angular.forEach(g.curLevelAttrDefs,function(c){c.levelName===a&&(b=void 0===c.curAttrDefIndex?0:c.curAttrDefIndex)}),b},g.setlastKeyCode=function(a){this.lastKeyCode=a},g.getX=function(a){return(a.offsetX||a.originalEvent.layerX)*(a.originalEvent.target.width/a.originalEvent.target.clientWidth)},g.getY=function(a){return(a.offsetY||a.originalEvent.layerY)*(a.originalEvent.target.height/a.originalEvent.target.clientHeight)},g.resetToInitState=function(){g.initialize()},g.getColorOfAnchor=function(a,b){var c={"background-color":"rgb("+a[b][0]+","+a[b][1]+","+a[b][2]+")",width:"10px",height:"10px"};return c},g.numberOfPages=function(a){return Math.ceil(a/g.pageSize)},g}]),angular.module("emuwebApp").directive("trackMouseInLevel",["$document","viewState","LevelService","ConfigProviderService","HistoryService","Soundhandlerservice",function(a,b,c,d,e,f){return{restrict:"A",replace:!0,scope:{levelName:"=",levelType:"="},link:function(a,g,h){a.lastEventClick=void 0,a.lastEventMove=void 0,a.lastNeighboursMove=void 0,a.lastPCM=void 0,a.curMouseSampleNrInView=void 0,a.order=h.trackMouseInLevel,g.bind("click",function(b){b.preventDefault(),a.setLastMove(b,!0),a.setLastClick(b)}),g.bind("contextmenu",function(b){b.preventDefault(),a.setLastMove(b,!0),a.setLastRightClick(b)}),g.bind("dblclick",function(b){a.setLastMove(b,!0),d.vals.restrictions.editItemName?a.setLastDblClick(b):a.setLastClick(b)}),g.bind("mousemove",function(g){var h,i;if(b.focusOnEmuWebApp){if(!b.getdragBarActive()){h=!0;var j=b.getSamplesPerPixelVal(g);if(a.curMouseSampleNrInView=b.getX(g)*j,i=a.curMouseSampleNrInView-a.lastPCM,j<=1){var k=c.getClosestItem(a.curMouseSampleNrInView+b.curViewPort.sS,a.levelName,f.audioBuffer.length);if("SEGMENT"===a.levelType)if(k.isFirst===!0&&k.isLast===!1)i=Math.ceil(a.curMouseSampleNrInView+b.curViewPort.sS-c.getItemDetails(a.levelName,0).sampleStart);else if(k.isFirst===!1&&k.isLast===!0){var l=c.getLastItem(a.levelName);i=Math.ceil(a.curMouseSampleNrInView+b.curViewPort.sS-l.sampleStart-l.sampleDur)}else i=Math.ceil(a.curMouseSampleNrInView+b.curViewPort.sS-c.getItemFromLevelById(a.levelName,k.nearest.id).sampleStart);else i=Math.ceil(a.curMouseSampleNrInView+b.curViewPort.sS-c.getItemFromLevelById(a.levelName,k.nearest.id).samplePoint-.5)}else i=Math.round(a.curMouseSampleNrInView-a.lastPCM)}var m=0;switch(m=void 0===g.buttons?g.which:g.buttons){case 1:break;case 2:break;case 3:break;default:if(!b.getdragBarActive()){var n,o=b.getcurMouseItem();d.vals.restrictions.editItemSize&&g.shiftKey?(c.deleteEditArea(),void 0!==o&&(b.movingBoundary=!0,"SEGMENT"===a.levelType?(b.getcurMouseisFirst()||b.getcurMouseisLast()?b.getcurMouseisFirst()?(n=c.getItemDetails(a.levelName,0),b.movingBoundarySample=n.sampleStart+i):b.getcurMouseisLast()&&(n=c.getLastItem(a.levelName),b.movingBoundarySample=n.sampleStart+n.sampleDur+i):(b.movingBoundarySample=o.sampleStart+i,n=o),c.moveBoundary(a.levelName,n.id,i,b.getcurMouseisFirst(),b.getcurMouseisLast()),e.updateCurChangeObj({type:"ANNOT",action:"MOVEBOUNDARY",name:a.levelName,id:n.id,movedBy:i,isFirst:b.getcurMouseisFirst(),isLast:b.getcurMouseisLast()})):(n=o,b.movingBoundarySample=o.samplePoint+i,c.moveEvent(a.levelName,n.id,i),e.updateCurChangeObj({type:"ANNOT",action:"MOVEEVENT",name:a.levelName,id:n.id,movedBy:i})),a.lastPCM=a.curMouseSampleNrInView,b.setLastPcm(a.lastPCM),b.selectBoundary(),h=!1)):d.vals.restrictions.editItemSize&&g.altKey?(c.deleteEditArea(),"SEGMENT"===a.levelType?(n=b.getcurClickItems(),void 0!==n[0]&&(c.moveSegment(a.levelName,n[0].id,n.length,i),e.updateCurChangeObj({type:"ANNOT",action:"MOVESEGMENT",name:a.levelName,id:n[0].id,length:n.length,movedBy:i})),a.lastPCM=a.curMouseSampleNrInView,b.setLastPcm(a.lastPCM),b.selectBoundary()):"EVENT"===a.levelType&&(n=b.getcurClickItems(),void 0!==n[0]&&angular.forEach(n,function(b){c.moveEvent(a.levelName,b.id,i),e.updateCurChangeObj({type:"ANNOT",action:"MOVEEVENT",name:a.levelName,id:b.id,movedBy:i})}),a.lastPCM=a.curMouseSampleNrInView,b.setLastPcm(a.lastPCM),b.selectBoundary())):b.movingBoundary=!1}}b.getdragBarActive()||a.setLastMove(g,h)}}),g.bind("mousedown",function(c){b.movingBoundary=!0,a.setLastMove(c,!0)}),g.bind("mouseup",function(c){b.movingBoundary=!1,a.setLastMove(c,!0)}),g.bind("mouseout",function(c){b.movingBoundary=!1,a.setLastMove(c,!0)}),a.setLastClick=function(d){a.curMouseSampleNrInView=b.getX(d)*b.getSamplesPerPixelVal(d),c.deleteEditArea(),b.setEditing(!1),a.lastEventClick=c.getClosestItem(a.curMouseSampleNrInView+b.curViewPort.sS,a.levelName,f.audioBuffer.length),b.setcurClickLevel(a.levelName,a.levelType,a.order),void 0!==a.lastEventClick.current&&void 0!==a.lastEventClick.nearest&&(c.setlasteditArea("_"+a.lastEventClick.current.id),c.setlasteditAreaElem(g.parent()),b.setcurClickItem(a.lastEventClick.current),b.selectBoundary()),a.lastPCM=a.curMouseSampleNrInView,b.setLastPcm(a.lastPCM),a.$apply()},a.setLastRightClick=function(d){if(b.getcurClickLevelName()!==a.levelName&&a.setLastClick(d),a.curMouseSampleNrInView=b.getX(d)*b.getSamplesPerPixelVal(d),c.deleteEditArea(),a.lastEventClick=c.getClosestItem(a.curMouseSampleNrInView+b.curViewPort.sS,a.levelName,f.audioBuffer.length),void 0!==a.lastEventClick.current&&void 0!==a.lastEventClick.nearest){var e=c.getItemInTime(b.getcurClickLevelName(),a.lastEventClick.current.id,!0),g=c.getItemInTime(b.getcurClickLevelName(),a.lastEventClick.current.id,!1);b.setcurClickLevel(a.levelName,a.levelType,a.$index),b.setcurClickItemMultiple(a.lastEventClick.current,e,g),b.selectBoundary()}a.lastPCM=a.curMouseSampleNrInView,b.setLastPcm(a.lastPCM),a.$apply()},a.setLastDblClick=function(d){a.curMouseSampleNrInView=b.getX(d)*b.getSamplesPerPixelVal(d),a.lastEventClick=c.getClosestItem(a.curMouseSampleNrInView+b.curViewPort.sS,a.levelName,f.audioBuffer.length);var e="25px"!==g.parent().css("height");e||g.parent().parent().find("div")[3].click(),void 0!==a.lastEventClick.current&&void 0!==a.lastEventClick.nearest&&b.getPermission("labelAction")&&("SEGMENT"===a.levelType?a.lastEventClick.current.sampleStart>=b.curViewPort.sS&&a.lastEventClick.current.sampleStart+a.lastEventClick.current.sampleDur<=b.curViewPort.eS&&(b.setcurClickLevel(a.levelName,a.levelType,a.$index),b.setcurClickItem(a.lastEventClick.current),c.setlasteditArea("_"+a.lastEventClick.current.id),c.setlasteditAreaElem(g.parent()),b.setEditing(!0),c.openEditArea(a.lastEventClick.current,g.parent(),a.levelType)):(b.setcurClickLevel(a.levelName,a.levelType,a.$index),b.setcurClickItem(a.lastEventClick.current),c.setlasteditArea("_"+a.lastEventClick.current.id),c.setlasteditAreaElem(g.parent()),b.setEditing(!0),c.openEditArea(a.lastEventClick.current,g.parent(),a.levelType),b.setEditing(!0))),a.lastPCM=a.curMouseSampleNrInView,b.setLastPcm(a.lastPCM),a.$apply()},a.setLastMove=function(d,e){a.curMouseSampleNrInView=b.getX(d)*b.getSamplesPerPixelVal(d),a.lastEventMove=c.getClosestItem(a.curMouseSampleNrInView+b.curViewPort.sS,a.levelName,f.audioBuffer.length),e&&void 0!==a.lastEventMove.current&&void 0!==a.lastEventMove.nearest&&(a.lastNeighboursMove=c.getItemNeighboursFromLevel(a.levelName,a.lastEventMove.nearest.id,a.lastEventMove.nearest.id),b.setcurMouseItem(a.lastEventMove.nearest,a.lastNeighboursMove,a.lastPCM,a.lastEventMove.isFirst,a.lastEventMove.isLast)),b.setcurMouseLevelName(a.levelName),b.setcurMouseLevelType(a.levelType),a.lastPCM=a.curMouseSampleNrInView,b.setLastPcm(a.lastPCM),a.$apply()}}}}]),angular.module("emuwebApp").directive("handleglobalkeystrokes",["$timeout","viewState","modalService","HierarchyManipulationService","Soundhandlerservice","ConfigProviderService","HistoryService","LevelService","DataService","LinkService","AnagestService","dbObjLoadSaveService",function(a,b,c,d,e,f,g,h,i,j,k,l){return{restrict:"A",link:function(a){$(document).bind("keyup",function(c){var d=c.keyCode?c.keyCode:c.which;b.isEditing()&&!b.getcursorInTextField()&&a.applyKeyCodeUp(d,c)}),$(document).bind("keydown",function(b){if(!a.firefox){var c=b.keyCode?b.keyCode:b.which;
8!==c&&9!==c&&27!==c&&37!==c&&38!==c&&39!==c&&40!==c&&32!==c||a.applyKeyCode(c,b)}}),$(document).bind("keypress",function(b){var c=b.keyCode?b.keyCode:b.which;a.applyKeyCode(c,b)}),a.applyKeyCodeUp=function(c){a.$apply(function(){if(c!==f.vals.keyMappings.esc&&c!==f.vals.keyMappings.createNewItemAtSelection){var a=$("."+h.getlasteditArea()),d=a.val();b.setSavingAllowed(!0);var e=b.getCurAttrIndex(b.getcurClickLevelName()),g=f.getLevelDefinition(b.getcurClickLevelName()),i={};void 0!==g.attributeDefinitions&&g.attributeDefinitions.length>0&&(i=f.getLevelDefinition(b.getcurClickLevelName()).attributeDefinitions[e]),void 0!==i.legalLabels&&d.length>0&&i.legalLabels.indexOf(d)<0&&b.setSavingAllowed(!1),b.isSavingAllowed()?a.css({"background-color":"rgba(255,255,0,1)"}):a.css({"background-color":"rgba(255,0,0,1)"})}})},a.applyKeyCode=function(d,m){a.$apply(function(){if(!f.vals.main.catchMouseForKeyBinding||b.mouseInEmuWebApp){b.setlastKeyCode(d);var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;if(b.hierarchyState.isShown()&&void 0!==b.hierarchyState)if(b.hierarchyState.getInputFocus()){if(d===f.vals.keyMappings.hierarchyCommitEdit){var C=b.hierarchyState.getContextMenuID(),D=h.getItemByID(C);q=h.getLevelName(C),n=b.getCurAttrIndex(q);var E=f.getLevelDefinition(q).attributeDefinitions[n].legalLabels;o=b.hierarchyState.getEditValue(),p=void 0!==D.labels[n]?D.labels[n].value:"",void 0!==o&&o!==p?(void 0===E||o.length>0&&E.indexOf(o)>=0)&&(h.renameLabel(q,C,n,o),g.addObjToUndoStack({type:"ANNOT",action:"RENAMELABEL",name:q,id:C,attrIndex:n,oldValue:p,newValue:o}),b.hierarchyState.closeContextMenu()):b.hierarchyState.closeContextMenu()}d===f.vals.keyMappings.hierarchyCancelEdit&&b.hierarchyState.closeContextMenu()}else{if(d===f.vals.keyMappings.hierarchyDeleteLink&&m.preventDefault(),d===f.vals.keyMappings.hierarchyPlayback&&(m.preventDefault(),b.hierarchyState.playing+=1),d===f.vals.keyMappings.hierarchyRotate&&b.hierarchyState.toggleRotation(),d===f.vals.keyMappings.hierarchyDeleteLink){var F=j.deleteLink(b.hierarchyState.selectedLinkFromID,b.hierarchyState.selectedLinkToID);F!==-1&&g.addObjToUndoStack({type:"HIERARCHY",action:"DELETELINK",fromID:b.hierarchyState.selectedLinkFromID,toID:b.hierarchyState.selectedLinkToID,position:F})}if(d===f.vals.keyMappings.hierarchyDeleteItem){var G=h.deleteItemWithLinks(b.hierarchyState.selectedItemID);void 0!==G.item&&g.addObjToUndoStack({type:"HIERARCHY",action:"DELETEITEM",item:G.item,levelName:G.levelName,position:G.position,deletedLinks:G.deletedLinks})}var H;d===f.vals.keyMappings.hierarchyAddItemBefore&&(H=h.addItem(b.hierarchyState.selectedItemID,!0),H!==-1&&g.addObjToUndoStack({type:"HIERARCHY",action:"ADDITEM",newID:H,neighborID:b.hierarchyState.selectedItemID,before:!0})),d===f.vals.keyMappings.hierarchyAddItemAfter&&(H=h.addItem(b.hierarchyState.selectedItemID,!1),H!==-1&&g.addObjToUndoStack({type:"HIERARCHY",action:"ADDITEM",newID:H,neighborID:b.hierarchyState.selectedItemID,before:!1})),d===f.vals.keyMappings.levelUp&&b.hierarchyState.curPathIdx>=1&&(b.hierarchyState.curPathIdx=b.hierarchyState.curPathIdx-1),d===f.vals.keyMappings.levelDown&&b.hierarchyState.curPathIdx<b.hierarchyState.curNrOfPaths-1&&(b.hierarchyState.curPathIdx=b.hierarchyState.curPathIdx+1),d===f.vals.keyMappings.undo&&g.undo(),d===f.vals.keyMappings.redo&&g.redo(),m.shiftKey||d!==f.vals.keyMappings.esc&&d!==f.vals.keyMappings.showHierarchy||c.close()}else if(b.isEditing()){var I=$("."+h.getlasteditArea());if(!b.isSavingAllowed()&&d===f.vals.keyMappings.createNewItemAtSelection){var J=f.getLevelDefinition(b.getcurClickLevelName()).attributeDefinitions[b.getCurAttrIndex(b.getcurClickLevelName())].legalLabels;m.preventDefault(),m.stopPropagation(),h.deleteEditArea(),b.setEditing(!1),c.open("views/error.html",'Editing Error: Sorry, characters allowed on this Level are "'+JSON.stringify(J)+'"')}if(b.isSavingAllowed()&&d===f.vals.keyMappings.createNewItemAtSelection){var K=h.getItemFromLevelById(b.getcurClickLevelName(),h.getlastID());n=b.getCurAttrIndex(b.getcurClickLevelName()),p="",o="",void 0!==K.labels[n]&&(p=K.labels[n].value),o=f.vals.restrictions.useLargeTextInputField?b.largeTextFieldInputFieldCurLabel:I.val(),h.renameLabel(b.getcurClickLevelName(),h.getlastID(),b.getCurAttrIndex(b.getcurClickLevelName()),o),g.addObjToUndoStack({type:"ANNOT",action:"RENAMELABEL",name:b.getcurClickLevelName(),id:h.getlastID(),attrIndex:n,oldValue:p,newValue:o}),h.deleteEditArea(),b.setEditing(!1),b.setcurClickItem(h.getItemFromLevelById(b.getcurClickLevelName(),h.getlastID()))}d===f.vals.keyMappings.esc&&(h.deleteEditArea(),b.setEditing(!1)),d===f.vals.keyMappings.playAllInView&&m.altKey&&b.getPermission("playaudio")&&f.vals.restrictions.playback&&(e.playFromTo(b.curViewPort.sS,b.curViewPort.eS),b.animatePlayHead(b.curViewPort.sS,b.curViewPort.eS)),3===d&&m.altKey&&b.getPermission("playaudio")&&f.vals.restrictions.playback&&(e.playFromTo(b.curViewPort.selectS,b.curViewPort.selectE),b.animatePlayHead(b.curViewPort.selectS,b.curViewPort.selectE)),d===f.vals.keyMappings.playEntireFile&&m.altKey&&b.getPermission("playaudio")&&f.vals.restrictions.playback&&(e.playFromTo(0,e.audioBuffer.length),b.animatePlayHead(0,e.audioBuffer.length))}else if(b.getcursorInTextField()===!1){if(h.deleteEditArea(),0===b.curState.permittedActions.length&&d===f.vals.keyMappings.esc&&c.force===!1&&c.close(),d===f.vals.keyMappings.showHierarchy&&f.vals.activeButtons.showHierarchy&&b.curState!==b.states.noDBorFilesloaded&&(b.hierarchyState.isShown()?c.close():(b.hierarchyState.toggleHierarchy(),c.open("views/showHierarchyModal.html"))),d===f.vals.keyMappings.zoomAll&&b.getPermission("zoom")&&b.setViewPort(0,e.audioBuffer.length),d===f.vals.keyMappings.zoomIn&&b.getPermission("zoom")&&b.zoomViewPort(!0,h),d===f.vals.keyMappings.zoomOut&&b.getPermission("zoom")&&b.zoomViewPort(!1,h),d===f.vals.keyMappings.zoomSel&&b.getPermission("zoom")&&b.setViewPort(b.curViewPort.selectS,b.curViewPort.selectE),d===f.vals.keyMappings.shiftViewPortLeft&&b.getPermission("zoom")&&b.shiftViewPort(!1),d===f.vals.keyMappings.shiftViewPortRight&&b.getPermission("zoom")&&b.shiftViewPort(!0),d===f.vals.keyMappings.playEntireFile&&b.getPermission("playaudio")&&f.vals.restrictions.playback&&(e.playFromTo(0,e.audioBuffer.length),b.animatePlayHead(0,e.audioBuffer.length)),d===f.vals.keyMappings.playAllInView&&b.getPermission("playaudio")&&f.vals.restrictions.playback&&(m.shiftKey?(e.playFromTo(b.curViewPort.sS,e.audioBuffer.length),b.animatePlayHead(b.curViewPort.sS,e.audioBuffer.length,!0)):(e.playFromTo(b.curViewPort.sS,b.curViewPort.eS),b.animatePlayHead(b.curViewPort.sS,b.curViewPort.eS))),d===f.vals.keyMappings.playSelected&&b.getPermission("playaudio")&&f.vals.restrictions.playback&&(e.playFromTo(b.curViewPort.selectS,b.curViewPort.selectE),b.animatePlayHead(b.curViewPort.selectS,b.curViewPort.selectE)),d===f.vals.keyMappings.saveBndl&&b.getPermission("saveBndlBtnClick")&&l.saveBundle(),d===f.vals.keyMappings.selectFirstContourCorrectionTool&&b.getPermission("labelAction")&&f.vals.restrictions.correctionTool&&(b.curCorrectionToolNr=1),d===f.vals.keyMappings.selectSecondContourCorrectionTool&&b.getPermission("labelAction")&&f.vals.restrictions.correctionTool&&(b.curCorrectionToolNr=2),d===f.vals.keyMappings.selectThirdContourCorrectionTool&&b.getPermission("labelAction")&&f.vals.restrictions.correctionTool&&(b.curCorrectionToolNr=3),d===f.vals.keyMappings.selectFourthContourCorrectionTool&&b.getPermission("labelAction")&&f.vals.restrictions.correctionTool&&(b.curCorrectionToolNr=4),d===f.vals.keyMappings.selectNoContourCorrectionTool&&b.getPermission("labelAction")&&f.vals.restrictions.correctionTool&&(b.curCorrectionToolNr=void 0),d===f.vals.keyMappings.levelUp&&b.getPermission("labelAction")&&b.selectLevel(!1,f.vals.perspectives[b.curPerspectiveIdx].levelCanvases.order,h),d===f.vals.keyMappings.levelDown&&b.getPermission("labelAction")&&b.selectLevel(!0,f.vals.perspectives[b.curPerspectiveIdx].levelCanvases.order,h),d===f.vals.keyMappings.snapBoundaryToNearestTopBoundary&&b.getPermission("labelAction")&&f.vals.restrictions.editItemSize&&(u=b.getcurMouseItem(),q=b.getcurMouseLevelName(),r=b.getcurMouseLevelType(),s=b.getcurMouseNeighbours(),t=h.snapBoundary(!0,q,u,s,r),t===!1||("EVENT"===r?g.updateCurChangeObj({type:"ANNOT",action:"MOVEEVENT",name:q,id:u.id,movedBy:t}):"SEGMENT"===r&&g.updateCurChangeObj({type:"ANNOT",action:"MOVEBOUNDARY",name:q,id:u.id,movedBy:t,position:0}),g.addCurChangeObjToUndoStack())),d===f.vals.keyMappings.snapBoundaryToNearestBottomBoundary&&b.getPermission("labelAction")&&f.vals.restrictions.editItemSize&&(u=b.getcurMouseItem(),q=b.getcurMouseLevelName(),r=b.getcurMouseLevelType(),s=b.getcurMouseNeighbours(),t=h.snapBoundary(!1,q,u,s,r),t===!1||("EVENT"===r?g.updateCurChangeObj({type:"ANNOT",action:"MOVEEVENT",name:q,id:u.id,movedBy:t}):"SEGMENT"===r&&g.updateCurChangeObj({type:"ANNOT",action:"MOVEBOUNDARY",name:q,id:u.id,movedBy:t,position:0}),g.addCurChangeObjToUndoStack())),d===f.vals.keyMappings.snapBoundaryToNearestZeroCrossing&&b.getPermission("labelAction")&&f.vals.restrictions.editItemSize){var L;L="SEGMENT"===b.getcurMouseLevelType()?h.calcDistanceToNearestZeroCrossing(b.getcurMouseItem().sampleStart):h.calcDistanceToNearestZeroCrossing(b.getcurMouseItem().samplePoint),0!==L&&(x=b.getcurMouseItem(),q=b.getcurMouseLevelName(),h.moveBoundary(q,x.id,L,b.getcurMouseisFirst(),b.getcurMouseisLast()),g.updateCurChangeObj({type:"ANNOT",action:"MOVEBOUNDARY",name:q,id:x.id,movedBy:L,isFirst:b.getcurMouseisFirst(),isLast:b.getcurMouseisLast()}),g.addCurChangeObjToUndoStack())}var M;if(d===f.vals.keyMappings.expandSelSegmentsRight&&b.getPermission("labelAction")&&f.vals.restrictions.editItemSize&&(void 0===b.getcurClickLevelName()?c.open("views/error.html","Expand Segments Error: Please select a Level first"):0===b.getselected().length?c.open("views/error.html","Expand Segments Error: Please select one or more Segments first"):(M=parseInt(f.vals.labelCanvasConfig.addTimeValue,10),"relative"===f.vals.labelCanvasConfig.addTimeMode&&(M=f.vals.labelCanvasConfig.addTimeValue*(e.audioBuffer.length/100)),h.expandSegment(!0,b.getcurClickItems(),b.getcurClickLevelName(),M),g.addObjToUndoStack({type:"ANNOT",action:"EXPANDSEGMENTS",name:b.getcurClickLevelName(),item:b.getcurClickItems(),rightSide:!0,changeTime:M}),b.selectBoundary())),d===f.vals.keyMappings.expandSelSegmentsLeft&&b.getPermission("labelAction")&&f.vals.restrictions.editItemSize&&(void 0===b.getcurClickLevelName()?c.open("views/error.html","Expand Segments Error: Please select a Level first"):0===b.getselected().length?c.open("views/error.html","Expand Segments Error: Please select one or more Segments first"):("absolute"===f.vals.labelCanvasConfig.addTimeMode?M=parseInt(f.vals.labelCanvasConfig.addTimeValue,10):"relative"===f.vals.labelCanvasConfig.addTimeMode?M=f.vals.labelCanvasConfig.addTimeValue*(e.audioBuffer.length/100):c.open("views/error.html","Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)"),h.expandSegment(!1,b.getcurClickItems(),b.getcurClickLevelName(),M),g.addObjToUndoStack({type:"ANNOT",action:"EXPANDSEGMENTS",name:b.getcurClickLevelName(),item:b.getcurClickItems(),rightSide:!1,changeTime:M}),b.selectBoundary())),d===f.vals.keyMappings.shrinkSelSegmentsLeft&&b.getPermission("labelAction")&&f.vals.restrictions.editItemSize&&(void 0===b.getcurClickLevelName()?c.open("views/error.html","Expand Segments Error: Please select a Level first"):0===b.getselected().length?c.open("views/error.html","Expand Segments Error: Please select one or more Segments first"):("absolute"===f.vals.labelCanvasConfig.addTimeMode?M=parseInt(f.vals.labelCanvasConfig.addTimeValue,10):"relative"===f.vals.labelCanvasConfig.addTimeMode?M=f.vals.labelCanvasConfig.addTimeValue*(e.audioBuffer.length/100):c.open("views/error.html","Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)"),h.expandSegment(!0,b.getcurClickItems(),b.getcurClickLevelName(),-M),g.addObjToUndoStack({type:"ANNOT",action:"EXPANDSEGMENTS",name:b.getcurClickLevelName(),item:b.getcurClickItems(),rightSide:!0,changeTime:-M}),b.selectBoundary())),d===f.vals.keyMappings.shrinkSelSegmentsRight&&b.getPermission("labelAction")&&f.vals.restrictions.editItemSize&&(void 0===b.getcurClickLevelName()?c.open("views/error.html","Expand Segments Error: Please select a Level first"):0===b.getselected().length?c.open("views/error.html","Expand Segments Error: Please select one or more Segments first"):("absolute"===f.vals.labelCanvasConfig.addTimeMode?M=parseInt(f.vals.labelCanvasConfig.addTimeValue,10):"relative"===f.vals.labelCanvasConfig.addTimeMode?M=f.vals.labelCanvasConfig.addTimeValue*(e.audioBuffer.length/100):c.open("views/error.html","Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)"),h.expandSegment(!1,b.getcurClickItems(),b.getcurClickLevelName(),-M),g.addObjToUndoStack({type:"ANNOT",action:"EXPANDSEGMENTS",name:b.getcurClickLevelName(),item:b.getcurClickItems(),rightSide:!1,changeTime:-M}),b.selectBoundary())),d===f.vals.keyMappings.toggleSideBarLeft&&b.getPermission("toggleSideBars")&&f.vals.activeButtons.openMenu&&b.toggleSubmenu(f.design.animation.period),d===f.vals.keyMappings.toggleSideBarRight&&b.getPermission("toggleSideBars")&&f.vals.activeButtons.openMenu&&b.setRightsubmenuOpen(!b.getRightsubmenuOpen()),d===f.vals.keyMappings.selectItemsInSelection&&b.getPermission("labelAction"))if(void 0===b.getcurClickLevelName())c.open("views/error.html","Selection Error : Please select a Level first");else{b.curClickItems=[];var N=null;angular.forEach(b.getItemsInSelection(i.data.levels),function(a){null===N?b.setcurClickItem(a):b.setcurClickItemMultiple(a,N),N=a}),b.selectBoundary()}if(d===f.vals.keyMappings.selPrevItem&&b.getPermission("labelAction")&&b.getcurClickItems().length>0&&(v=h.getItemNeighboursFromLevel(b.getcurClickLevelName(),b.getcurClickItems()[0].id,b.getcurClickItems()[b.getcurClickItems().length-1].id),w=h.getItemNeighboursFromLevel(b.getcurClickLevelName(),v.left.id,v.left.id),void 0!==v.left&&(void 0!==v.left.sampleStart?v.left.sampleStart>b.curViewPort.sS&&(m.shiftKey?(b.setcurClickItemMultiple(v.left,w.right),h.setlasteditArea("_"+v.left.id)):(b.setcurClickItem(v.left),h.setlasteditArea("_"+v.left.id)),b.selectBoundary()):v.left.samplePoint>b.curViewPort.sS&&(m.shiftKey?(b.setcurClickItemMultiple(v.left,w.right),h.setlasteditArea("_"+v.left.id)):(b.setcurClickItem(v.left),h.setlasteditArea("_"+v.left.id)),b.selectBoundary()))),d===f.vals.keyMappings.selNextItem&&b.getPermission("labelAction")&&b.getcurClickItems().length>0&&(v=h.getItemNeighboursFromLevel(b.getcurClickLevelName(),b.getcurClickItems()[0].id,b.getcurClickItems()[b.getcurClickItems().length-1].id),w=h.getItemNeighboursFromLevel(b.getcurClickLevelName(),v.right.id,v.right.id),void 0!==v.right&&(void 0!==v.right.sampleStart?v.right.sampleStart+v.right.sampleDur<b.curViewPort.eS&&(m.shiftKey?(b.setcurClickItemMultiple(v.right,w.left),h.setlasteditArea("_"+v.right.id)):(b.setcurClickItem(v.right),h.setlasteditArea("_"+v.right.id)),b.selectBoundary()):v.right.samplePoint<b.curViewPort.eS&&(m.shiftKey?(b.setcurClickItemMultiple(v.right,w.left),h.setlasteditArea("_"+v.right.id)):(b.setcurClickItem(v.right),h.setlasteditArea("_"+v.right.id)),b.selectBoundary()))),d===f.vals.keyMappings.selNextPrevItem&&b.getPermission("labelAction")&&b.getcurClickItems().length>0){var O=b.getcurClickItems()[0].id,P=b.getcurClickItems()[b.getcurClickItems().length-1].id;v=h.getItemNeighboursFromLevel(b.getcurClickLevelName(),O,P),m.shiftKey?void 0!==v.left&&(void 0!==v.left.sampleStart?v.left.sampleStart>=b.curViewPort.sS&&(b.setcurClickItem(v.left),h.setlasteditArea("_"+v.left.id)):v.left.samplePoint>=b.curViewPort.sS&&(b.setcurClickItem(v.left,v.left.id),h.setlasteditArea("_"+v.left.id))):void 0!==v.right&&(void 0!==v.right.sampleStart?v.right.sampleStart+v.right.sampleDur<=b.curViewPort.eS&&(b.setcurClickItem(v.right),h.setlasteditArea("_"+v.right.id)):v.right.samplePoint<b.curViewPort.eS&&(b.setcurClickItem(v.right),h.setlasteditArea("_"+v.right.id)))}if(d===f.vals.keyMappings.createNewItemAtSelection)if(c.isOpen)c.confirmContent();else if(void 0===b.curClickLevelIndex)c.open("views/error.html","Modify Error: Please select a Segment or Event Level first.");else if(b.getPermission("labelAction")&&f.vals.restrictions.addItem)if(b.getselectedRange().start===b.curViewPort.selectS&&b.getselectedRange().end===b.curViewPort.selectE)1===b.getcurClickItems().length?b.getselectedRange().start>=b.curViewPort.sS&&b.getselectedRange().end<=b.curViewPort.eS&&(b.setEditing(!0),h.openEditArea(b.getcurClickItems()[0],h.getlasteditAreaElem(),b.getcurClickLevelType()),a.cursorInTextField()):c.open("views/error.html","Modify Error: Please select a single Segment.");else if(b.curViewPort.selectE===-1&&b.curViewPort.selectS===-1)c.open("views/error.html","Error : Please select a Segment or Point to modify it's name. Or select a level plus a range in the viewport in order to insert a new Segment.");else if(x=h.getClosestItem(b.curViewPort.selectS,b.getcurClickLevelName(),e.audioBuffer.length).current,"SEGMENT"===b.getcurClickLevelType())void 0===x?(y=h.insertSegment(b.getcurClickLevelName(),b.curViewPort.selectS,b.curViewPort.selectE,f.vals.labelCanvasConfig.newSegmentName),y.ret?g.addObjToUndoStack({type:"ANNOT",action:"INSERTSEGMENTS",name:b.getcurClickLevelName(),start:b.curViewPort.selectS,end:b.curViewPort.selectE,ids:y.ids,segName:f.vals.labelCanvasConfig.newSegmentName}):c.open("views/error.html","Error : You are not allowed to insert a Segment here.")):x.sampleStart===b.curViewPort.selectS&&x.sampleStart+x.sampleDur+1===b.curViewPort.selectE?(h.setlasteditArea("_"+x.id),h.openEditArea(x,h.getlasteditAreaElem(),b.getcurClickLevelType()),b.setEditing(!0)):(y=h.insertSegment(b.getcurClickLevelName(),b.curViewPort.selectS,b.curViewPort.selectE,f.vals.labelCanvasConfig.newSegmentName),y.ret?g.addObjToUndoStack({type:"ANNOT",action:"INSERTSEGMENTS",name:b.getcurClickLevelName(),start:b.curViewPort.selectS,end:b.curViewPort.selectE,ids:y.ids,segName:f.vals.labelCanvasConfig.newSegmentName}):c.open("views/error.html","Error : You are not allowed to insert a Segment here."));else{var Q=f.getLevelDefinition(b.getcurClickLevelName());if("undefined"==typeof Q.anagestConfig){var R=h.insertEvent(b.getcurClickLevelName(),b.curViewPort.selectS,f.vals.labelCanvasConfig.newEventName);R.alreadyExists?(h.setlasteditArea("_"+x.id),h.openEditArea(x,h.getlasteditAreaElem(),b.getcurClickLevelType()),b.setEditing(!0)):g.addObjToUndoStack({type:"ANNOT",action:"INSERTEVENT",name:b.getcurClickLevelName(),start:b.curViewPort.selectS,id:R.id,pointName:f.vals.labelCanvasConfig.newEventName})}else k.insertAnagestEvents()}if(d===f.vals.keyMappings.undo&&b.getPermission("labelAction")&&g.undo(),d===f.vals.keyMappings.redo&&b.getPermission("labelAction")&&g.redo(),d===f.vals.keyMappings.deletePreselBoundary&&b.getPermission("labelAction")){m.preventDefault(),x=b.getcurMouseItem();var S=b.getcurClickItems(),T=b.getcurMouseisFirst(),U=b.getcurMouseisLast();q=b.getcurMouseLevelName();var V=b.getcurMouseLevelType();if(m.shiftKey)f.vals.restrictions.deleteItem&&void 0!==S&&S.length>0&&("SEGMENT"===b.getcurClickLevelType()?(A=h.deleteSegments(q,S[0].id,S.length),g.updateCurChangeObj({type:"ANNOT",action:"DELETESEGMENTS",name:q,id:S[0].id,length:S.length,deletedSegment:A}),B=j.deleteLinkSegment(S),g.updateCurChangeObj({type:"ANNOT",action:"DELETELINKSEGMENT",name:q,segments:S,deletedLinks:B}),g.addCurChangeObjToUndoStack(),z=h.getClosestItem(b.getLasPcm()+b.curViewPort.sS,q,e.audioBuffer.length),void 0!==z.current&&void 0!==z.nearest&&(v=h.getItemNeighboursFromLevel(q,z.nearest.id,z.nearest.id),b.setcurMouseItem(z.nearest,v,b.getLasPcm(),z.isFirst,z.isLast)),b.setcurClickItem(A.clickSeg)):c.open("views/error.html","Delete Error: You can not delete Segments on Point Levels."));else if(f.vals.restrictions.deleteItemBoundary&&void 0!==x){var W=h.getItemNeighboursFromLevel(q,x.id,x.id);if("SEGMENT"===V)A=h.deleteBoundary(q,x.id,T,U),g.updateCurChangeObj({type:"ANNOT",action:"DELETEBOUNDARY",name:q,id:x.id,isFirst:T,isLast:U,deletedSegment:A}),void 0!==W.left?(B=j.deleteLinkBoundary(x.id,W.left.id,h),g.updateCurChangeObj({type:"ANNOT",action:"DELETELINKBOUNDARY",name:q,id:x.id,neighbourId:W.left.id,deletedLinks:B})):(B=j.deleteLinkBoundary(x.id,-1,h),g.updateCurChangeObj({type:"ANNOT",action:"DELETELINKBOUNDARY",name:q,id:x.id,neighbourId:-1,deletedLinks:B})),g.addCurChangeObjToUndoStack(),z=h.getClosestItem(b.getLasPcm()+b.curViewPort.sS,q,e.audioBuffer.length),void 0!==z.current&&void 0!==z.nearest&&(v=h.getItemNeighboursFromLevel(q,z.nearest.id,z.nearest.id),b.setcurMouseItem(z.nearest,v,b.getLasPcm(),z.isFirst,z.isLast)),b.setcurClickItem(A.clickSeg);else{var X=h.deleteEvent(q,x.id);X!==!1?(g.updateCurChangeObj({type:"ANNOT",action:"DELETEEVENT",name:q,start:X.samplePoint,id:X.id,pointName:X.labels[0].value}),g.addCurChangeObjToUndoStack(),z=h.getClosestItem(b.getLasPcm()+b.curViewPort.sS,q,e.audioBuffer.length),void 0!==z.current&&void 0!==z.nearest&&(v=h.getItemNeighboursFromLevel(q,z.nearest.id,z.nearest.id),b.setcurMouseItem(z.nearest,v,b.getLasPcm(),z.isFirst,z.isLast))):b.setcurMouseItem(void 0,void 0,void 0,void 0,void 0)}}}m.metaKey||m.ctrlKey||(m.preventDefault(),m.stopPropagation())}}})},a.safeApply=function(a){var b=this.$root.$$phase;"$apply"===b||"$digest"===b?a&&"function"==typeof a&&a():this.$apply(a)},a.$on("$destroy",function(){$(window).off("keydown")})}}}]),angular.module("emuwebApp").directive("delete",["modalService",function(a){return{restrict:"A",link:function(b,c,d){c.bind("click",function(){b.vs.setcurClickLevelName(b.level.name,d.delete),b.vs.setcurClickLevel(b.level.name,b.level.type,b.order),a.open("views/deleteLevel.html",b.level.name)})}}}]),angular.module("emuwebApp").directive("resize",["LevelService","viewState",function(a,b){return{restrict:"A",link:function(c,d){var e=d.parent().parent(),f=0,g=e.find(d.parent().children()[0]),h=e.find(d.parent().children()[2]);d.bind("click",function(){a.deleteEditArea(),b.setEditing(!1),c.open?(c.open=!1,f=e.css("height"),e.css({height:"25px"}),c.cps.vals.activeButtons.deleteSingleLevel&&g.hide(),c.cps.vals.activeButtons.saveSingleLevel&&h.hide()):(c.open=!0,e.css({height:f}),c.cps.vals.activeButtons.deleteSingleLevel&&g.show(),c.cps.vals.activeButtons.saveSingleLevel&&h.show()),c.updateView()})}}}]),angular.module("emuwebApp").directive("enlarge",["$rootScope","viewState","ConfigProviderService",function(a,b,c){return{restrict:"A",link:function(d,e,f){d.$watch("viewState.curPerspectiveIdx",function(){$.isEmptyObject(c.vals.perspectives)||$.isEmptyObject(b.curPerspectiveIdx)||(1===c.vals.perspectives[b.curPerspectiveIdx].signalCanvases.order.length?e.hide():e.show())},!0);var g=!1;e.bind("click",function(){g?(g=!1,b.setenlarge(-1)):(g=!0,b.setenlarge(parseInt(f.enlarge))),a.$apply()})}}}]),angular.module("emuwebApp").directive("save",["modalService","Espsparserservice",function(a,b){return{restrict:"A",link:function(c,d,e){d.bind("click",function(){c.vs.setcurClickLevelName(c.level.name,e.save),b.asyncParseJSO(c.level.name).then(function(b){a.open("views/export.html",name+"_esps.txt",b)})})}}}]),angular.module("emuwebApp").directive("previewtrack",["viewState","Soundhandlerservice",function(a,b){return{restrict:"A",scope:{},link:function(c,d){var e=-1;d.bind("click",function(d){if(!$.isEmptyObject(b.audioBuffer)){var f=a.curViewPort.eS-a.curViewPort.sS;e=a.getX(d)*(b.audioBuffer.length/d.originalEvent.target.width),e-f/2<0?e=Math.ceil(f/2):e+f/2>b.audioBuffer.length&&(e=Math.floor(b.audioBuffer.length-f/2)),a.isEditing()||c.$apply(function(){a.setViewPort(e-f/2,e+f/2)})}}),d.bind("mousedown",function(c){$.isEmptyObject(b.audioBuffer)||(e=a.getX(c)*(b.audioBuffer.length/c.originalEvent.target.width))}),d.bind("mousemove",function(d){var f=0;switch(f=void 0===d.buttons?d.which:d.buttons){case 1:if(e!==-1){var g=a.curViewPort.eS-a.curViewPort.sS;e=a.getX(d)*(b.audioBuffer.length/d.originalEvent.target.width),a.isEditing()||c.$apply(function(){a.setViewPort(e-g/2,e+g/2)})}}}),d.bind("mouseup",function(){e=-1}),d.bind("mouseout",function(){e=-1})}}}]),angular.module("emuwebApp").service("Iohandlerservice",["$rootScope","$http","$location","$q","HistoryService","viewState","Soundhandlerservice","Ssffparserservice","Wavparserservice","Textgridparserservice","ConfigProviderService","Espsparserservice","Ssffdataservice","Websockethandler","DragnDropDataService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p={};return p.wsH=n,p.httpGetDefaultConfig=function(){var a=b.get("configFiles/default_emuwebappConfig.json");return a},p.httpGetDefaultDesign=function(){var a=b.get("configFiles/default_emuwebappDesign.json");return a},p.httpGetPath=function(a,c){var d=b.get(a,{responseType:c});return d},p.getProtocol=function(){var a;return"CORS"===k.vals.main.comMode||"WS"===k.vals.main.comMode&&(a=n.getProtocol()),a},p.getDoUserManagement=function(){var a;return"CORS"===k.vals.main.comMode||"WS"===k.vals.main.comMode&&(a=n.getDoUserManagement()),a},p.logOnUser=function(a,b){var c;return"CORS"===k.vals.main.comMode||"WS"===k.vals.main.comMode&&(c=n.logOnUser(a,b)),c},p.getDBconfigFile=function(a){var c;return"CORS"===k.vals.main.comMode||("WS"===k.vals.main.comMode?c=n.getDBconfigFile():"DEMO"===k.vals.main.comMode&&(c=b.get("demoDBs/"+a+"/"+a+"_DBconfig.json"))),c},p.getBundleList=function(a){var c;return"CORS"===k.vals.main.comMode||("WS"===k.vals.main.comMode?c=n.getBundleList():"DEMO"===k.vals.main.comMode&&(c=b.get("demoDBs/"+a+"/"+a+"_bundleList.json"))),c},p.getBundle=function(a,c,d){var e;return"CORS"===k.vals.main.comMode||("EMBEDDED"===k.vals.main.comMode?e=o.getBundle(a,c):"WS"===k.vals.main.comMode?e=n.getBundle(a,c):"DEMO"===k.vals.main.comMode&&(e=b.get("demoDBs/"+d+"/"+a+"_bndl.json"))),e},p.saveBundle=function(a){var b;return"CORS"===k.vals.main.comMode||"WS"===k.vals.main.comMode&&(b=n.saveBundle(a)),b},p.saveConfiguration=function(a){var b;return"CORS"===k.vals.main.comMode?console.error("CORS version of saveBundle not implemented"):"WS"===k.vals.main.comMode&&(b=n.saveConfiguration(a)),b},p.parseLabelFile=function(a,b,c,e){var f;if("ESPS"===e)f=l.asyncParseEsps(a,k.embeddedVals.labelGetUrl,"embeddedESPS");else if("TEXTGRID"===e)f=j.asyncParseTextGrid(a,k.embeddedVals.labelGetUrl,"embeddedTEXTGRID");else if("annotJSON"===e){var g=d.defer();f=g.promise,g.resolve(angular.fromJson(a))}return f},p}]),angular.module("emuwebApp").service("Soundhandlerservice",function(){function a(){try{window.AudioContext=window.AudioContext||window.webkitAudioContext,b=new AudioContext}catch(a){alert("Error loading the AudioContext (could mean your browser does not support the HTML5 webaudio API):"+a)}}var b,c,d={};return d.audioBuffer={},d.isPlaying=!1,d.decodeAndPlay=function(e,f){"undefined"==typeof b&&a();var g=e/d.audioBuffer.sampleRate,h=f/d.audioBuffer.sampleRate,i=h-g;c=b.createBufferSource(),c.buffer=d.audioBuffer,c.connect(b.destination),c.start(0,g,i),c.onended=function(){d.isPlaying=!1}},d.playFromTo=function(a,b){d.isPlaying?(d.isPlaying=!1,c.stop(0)):(d.isPlaying=!0,d.audioBuffer.length>0&&d.decodeAndPlay(a,b))},d}),angular.module("emuwebApp").directive("drawssff",["$timeout","viewState","ConfigProviderService","Ssffdataservice","HistoryService","fontScaleService","loadedMetaDataService",function(a,b,c,d,e,f,g){return{restrict:"A",scope:{},link:function(h,i,j){h.trackName=j.ssffTrackname,h.assTrackName="",h.lastDraw=Date.now(),h.vs=b,h.hists=e,h.ssffds=d,h.cps=c,h.lmds=g,j.$observe("ssffTrackname",function(a){h.trackName=a}),h.$watch("vs.curViewPort",function(a,b){b.sS===a.sS&&b.eS===a.eS||h.handleUpdate(),b.windowWidth!==a.windowWidth&&h.handleUpdate(),b.dragBarHeight!==a.dragBarHeight&&h.handleUpdate()},!0),h.$watch("vs.curPerspectiveIdx",function(){h.handleUpdate()},!0),h.$watch("vs.curCorrectionToolNr",function(){h.handleUpdate()},!0),h.$watch("hists.movesAwayFromLastSave",function(){h.handleUpdate()},!0),h.$watch("ssffds.data.length",function(){h.handleUpdate()},!0),h.$watch("vs.spectroSettings",function(){h.handleUpdate()},!0),h.$watch("vs.submenuOpen",function(b,d){b!==d&&a(h.handleUpdate,c.design.animation.duration)}),h.$watch("vs.timelineSize",function(b,d){b!==d&&a(h.handleUpdate,c.design.animation.duration/10)}),h.$watch("lmds.getCurBndl()",function(a,b){a.name===b.name&&a.session===b.session||h.handleUpdate()},!0),h.handleUpdate=function(){var a=i[0].getContext("2d");if(a.clearRect(0,0,i[0].width,i[0].height),$.isEmptyObject(d.data))a.clearRect(0,0,i[0].width,i[0].height);else if(0!==d.data.length&&(h.assTrackName="",c.vals.perspectives[b.curPerspectiveIdx].signalCanvases.assign.forEach(function(a){if(a.signalCanvasName===h.trackName){h.assTrackName=a.ssffTrackName;var e=c.getSsffTrackConfig(a.ssffTrackName),f=d.getColumnOfTrack(e.name,e.columnName),g=d.getSampleRateAndStartTimeOfTrack(e.name),j=c.getContourLimsOfTrack(e.name),k=c.getValueLimsOfTrack(e.name);h.drawValues(b,i[0],c,f,g.sampleRate,g.startTime,j,k)}}),h.assTrackName="","OSCI"!==h.trackName&&"SPEC"!==h.trackName)){var e=c.getSsffTrackConfig(h.trackName),f=d.getColumnOfTrack(e.name,e.columnName),g=d.getSampleRateAndStartTimeOfTrack(e.name),j=c.getContourLimsOfTrack(e.name),k=c.getValueLimsOfTrack(e.name);h.drawValues(b,i[0],c,f,g.sampleRate,g.startTime,j,k)}},h.drawValues=function(a,b,d,e,g,i,j,k){var l,m,n=b.getContext("2d");"SPEC"===h.trackName&&"FORMANTS"===h.assTrackName?(l=a.spectroSettings.rangeFrom,m=a.spectroSettings.rangeTo):(l=e._minVal,m=e._maxVal),angular.equals(k,{})||(l=k.minVal,m=k.maxVal);var o=a.getViewPortStartTime(),p=a.getViewPortEndTime(),q=Math.round(o*g+i),r=Math.round(p*g+i),s=r-q,t=e.values.slice(q,q+s);if(s<b.width&&s>=2){var u,v,w,x;angular.forEach(t[0],function(d,f){if($.isEmptyObject(j)||f>=j.minContourIdx&&f<=j.maxContourIdx){if($.isEmptyObject(j))n.strokeStyle="hsl("+f*(360/t[0].length)+",80%, 50%)",n.fillStyle="hsl("+f*(360/t[0].length)+",80%, 50%)";else{var k=j.maxContourIdx-j.minContourIdx+1;n.strokeStyle="hsl("+f*(360/k)+",80%, 50%)",n.fillStyle="hsl("+f*(360/k)+",80%, 50%)"}var s=c.getContourColorsOfTrack(h.assTrackName);if(void 0!==s&&void 0!==s.colors[f]&&(n.strokeStyle=c.vals.perspectives[a.curPerspectiveIdx].signalCanvases.contourColors[0].colors[f],n.fillStyle=c.vals.perspectives[a.curPerspectiveIdx].signalCanvases.contourColors[0].colors[f]),a.curCorrectionToolNr-1===f&&"SPEC"===h.trackName&&"FORMANTS"===h.assTrackName&&(n.strokeStyle=c.design.color.green,n.fillStyle=c.design.color.green),n.beginPath(),q>=1){var y=e.values[q-1],z=y[f];w=q-1,x=1/g*w+i,u=(x-o)/(p-o)*b.width,v=b.height-(z-l)/(m-l)*b.height,n.moveTo(u,v)}if(angular.forEach(t,function(a,c){w=q+c,x=1/g*w+i,u=(x-o)/(p-o)*b.width,v=b.height-(a[f]-l)/(m-l)*b.height,n.arc(u,v-1,2,0,2*Math.PI,!1),n.lineTo(u,v)}),r<e.values.length-1){var A=e.values[r+1],B=A[f];w=r+1,x=1/g*w+i,u=(x-o)/(p-o)*b.width,v=b.height-(B-l)/(m-l)*b.height,n.lineTo(u,v)}n.stroke()}})}else n.strokeStyle="red",s<=2?f.drawUndistortedTextTwoLines(n,"Zoom out to","see contour(s)",c.design.font.small.size.slice(0,-2)/1.05,c.design.font.small.family,b.width/2-n.measureText("see contour(s)").width*n.canvas.width/n.canvas.offsetWidth/2,25,c.design.color.transparent.red):f.drawUndistortedTextTwoLines(n,"Zoom in to","see contour(s)",c.design.font.small.size.slice(0,-2)/1.05,c.design.font.small.family,b.width/2-n.measureText("see contour(s)").width*n.canvas.width/n.canvas.offsetWidth/2,25,c.design.color.transparent.red)}}}}]),angular.module("emuwebApp").service("Ssffparserservice",["$q",function(a){var b,c={},d=new SsffParserWorker;return d.says(function(a){"SUCCESS"===a.status.type?b.resolve(a):b.reject(a)},!1),c.asyncParseSsffArr=function(c){return b=a.defer(),d.tell({cmd:"parseArr",ssffArr:c}),b.promise},c.asyncJso2ssff=function(c){
return b=a.defer(),d.tell({cmd:"jso2ssff",jso:JSON.stringify(c)}),b.promise},c}]),angular.module("emuwebApp").directive("mouseTrackAndCorrectionTool",["viewState","ConfigProviderService","Ssffdataservice","Drawhelperservice","HistoryService","Soundhandlerservice",function(a,b,c,d,e,f){return{restrict:"A",scope:{},link:function(g,h,i){var j,k,l,m,n,o,p=h[0],q=p.getContext("2d");i.$observe("ssffTrackname",function(a){a&&(n=a)}),i.$observe("bundleName",function(a){a&&(o=a,$.isEmptyObject(c.data)||0!==c.data.length&&(k=b.getSsffTrackConfig("FORMANTS"),void 0!==k&&(l=c.getColumnOfTrack(k.name,k.columnName),m=c.getSampleRateAndStartTimeOfTrack(k.name))))}),h.bind("mousedown",function(b){b.shiftKey||(a.curViewPort.movingS=Math.round(a.getX(b)*a.getSamplesPerPixelVal(b)+a.curViewPort.sS),a.curViewPort.movingE=a.curViewPort.movingS,a.select(a.curViewPort.movingS,a.curViewPort.movingE),g.switchMarkupContext(b),g.$apply())}),h.bind("mouseup",function(b){if(b.shiftKey){var c=Math.round(a.getX(b)*a.getSamplesPerPixelVal(b)+a.curViewPort.sS),d=a.curViewPort.selectE-a.curViewPort.selectS;c<=a.curViewPort.selectS+d/2&&(a.curViewPort.selectS=c),c>=a.curViewPort.selectE-d/2&&(a.curViewPort.selectE=c),g.switchMarkupContext(b),g.$apply()}}),h.bind("mousemove",function(d){var f=0;f=void 0===d.buttons?d.which:d.buttons;var i=a.getX(d);switch(a.curMouseX=i,a.curMouseTrackName=n,a.curMousePosSample=Math.round(a.curViewPort.sS+i/h[0].width*(a.curViewPort.eS-a.curViewPort.sS)),f){case 0:if(a.getPermission("labelAction")&&(g.switchMarkupContext(d),!($.isEmptyObject(c.data)||0===c.data.length||a.getdragBarActive()||void 0===a.curCorrectionToolNr||a.getdragBarActive()||$.isEmptyObject(b.getAssignment(n))))){void 0===k&&(k=b.getSsffTrackConfig("FORMANTS")),l=c.getColumnOfTrack(k.name,k.columnName),m=c.getSampleRateAndStartTimeOfTrack(k.name);var j=a.getViewPortStartTime(),o=a.getViewPortEndTime(),r=Math.round(j*m.sampleRate+m.startTime),s=Math.round(o*m.sampleRate+m.startTime),t=s-r,u=l.values.slice(r,r+t),v=j+a.getX(d)/d.originalEvent.target.width*(o-j),w=Math.round((v+m.startTime)*m.sampleRate)-1,x=1/m.sampleRate*w+m.startTime;if(w-r<0||w-r>=u.length)return;a.curPreselColumnSample=w-r;var y=(x-j)/(o-j)*p.width,z=p.height-u[a.curPreselColumnSample][a.curCorrectionToolNr-1]/(a.spectroSettings.rangeTo-a.spectroSettings.rangeFrom)*p.height;if(q.strokeStyle="black",q.fillStyle="black",q.beginPath(),q.arc(y,z-1,2,0,2*Math.PI,!1),q.closePath(),q.stroke(),q.fill(),d.shiftKey){var A=angular.copy(u[a.curPreselColumnSample][a.curCorrectionToolNr-1]),B=a.spectroSettings.rangeTo-a.getY(d)/d.originalEvent.target.height*a.spectroSettings.rangeTo;u[a.curPreselColumnSample][a.curCorrectionToolNr-1]=a.spectroSettings.rangeTo-a.getY(d)/d.originalEvent.target.height*a.spectroSettings.rangeTo;var C=e.updateCurChangeObj({type:"SSFF",trackName:k.name,sampleBlockIdx:r+a.curPreselColumnSample,sampleIdx:a.curCorrectionToolNr-1,oldValue:A,newValue:B});for(var D in C)x=1/m.sampleRate*C[D].sampleBlockIdx+m.startTime,y=(x-j)/(o-j)*p.width,z=p.height-C[D].newValue/(a.spectroSettings.rangeTo-a.spectroSettings.rangeFrom)*p.height,q.strokeStyle="red",q.fillStyle="red",q.beginPath(),q.arc(y,z-1,2,0,2*Math.PI,!1),q.closePath(),q.stroke(),q.fill()}}break;case 1:a.getdragBarActive()||g.setSelectDrag(d)}g.$apply()}),h.bind("mouseleave",function(b){$.isEmptyObject(f)||$.isEmptyObject(f.audioBuffer)||a.getdragBarActive()||a.getPermission("labelAction")&&g.switchMarkupContext(b,!1)}),g.switchMarkupContext=function(e,f){if(q.clearRect(0,0,p.width,p.height),"OSCI"===i.ssffTrackname)d.drawViewPortTimes(q,!0),d.drawCurViewPortSelected(q,!0);else if("SPEC"===i.ssffTrackname)d.drawCurViewPortSelected(q,!1),d.drawMinMaxAndName(q,"",a.spectroSettings.rangeFrom,a.spectroSettings.rangeTo,2);else{var g=b.getSsffTrackConfig(i.ssffTrackname),h=c.getColumnOfTrack(g.name,g.columnName);d.drawCurViewPortSelected(q,!1),d.drawMinMaxAndName(q,i.ssffTrackname,h._minVal,h._maxVal,2)}f!==!1&&b.vals.restrictions.drawCrossHairs&&d.drawCrossHairs(q,e,a.spectroSettings.rangeFrom,a.spectroSettings.rangeTo,"Hz",i.ssffTrackname),d.drawMovingBoundaryLine(q)},g.setSelectDrag=function(b){j=Math.round(a.getX(b)*a.getSamplesPerPixelVal(b)+a.curViewPort.sS),j>a.curViewPort.movingS?a.curViewPort.movingE=j:a.curViewPort.movingS=j,a.select(a.curViewPort.movingS,a.curViewPort.movingE),g.$apply()}}}}]),angular.module("emuwebApp").service("Drawhelperservice",["viewState","ConfigProviderService","Soundhandlerservice","fontScaleService","Ssffdataservice","mathHelperService",function(a,b,c,d,e,f){function g(a,b,c){return a.measureText(b).width*c}function h(a,b,c,d){return void 0!==b&&b.toString().length>c.toString().length?g(a,b,d):g(a,c,d)}var i={};return i.osciPeaks={},i.calculateOsciPeaks=function(){var a=c.audioBuffer.sampleRate,b=c.audioBuffer.numberOfChannels,d=a/400,e=a/10,f=a/1;i.osciPeaks={numberOfChannels:b,sampleRate:a,winSizes:[d,e,f],channelOsciPeaks:[]};for(var g=0;g<b;g++){for(var h=c.audioBuffer.getChannelData(g),j=new Float32Array(c.audioBuffer.length/d),k=new Float32Array(c.audioBuffer.length/d),l=new Float32Array(c.audioBuffer.length/e),m=new Float32Array(c.audioBuffer.length/e),n=new Float32Array(c.audioBuffer.length/f),o=new Float32Array(c.audioBuffer.length/f),p=0,q=0,r=1/0,s=-(1/0),t=0,u=0,v=1/0,w=-(1/0),x=0,y=0,z=1/0,A=-(1/0),B=0;B<=h.length;B++)h[B]>s&&(s=h[B]),h[B]<r&&(r=h[B]),h[B]>w&&(w=h[B]),h[B]<v&&(v=h[B]),h[B]>A&&(A=h[B]),h[B]<z&&(z=h[B]),p===Math.round(d)&&(j[q]=s,k[q]=r,q+=1,p=0,r=1/0,s=-(1/0)),t===Math.round(e)&&(l[u]=w,m[u]=v,u+=1,t=0,v=1/0,w=-(1/0)),x===Math.round(f)&&(n[y]=A,o[y]=z,y+=1,x=0,z=1/0,A=-(1/0)),p+=1,t+=1,x+=1;i.osciPeaks.channelOsciPeaks[g]={maxPeaks:[j,l,n],minPeaks:[k,m,o]}}},i.calculatePeaks=function(a,b,c,d){var e,f,g,h,i,j=(d+1-c)/a.width,k=[],l=[],m=[],n=1/0,o=-(1/0),p=1/0,q=-(1/0);if(j<=1)i=0===c?b.subarray(c,d+2):b.subarray(c-1,d+2),e=Math.min.apply(Math,i),f=Math.max.apply(Math,i),k=Array.prototype.slice.call(i);else{i=b.subarray(c,d),l=new Float32Array(a.width),m=new Float32Array(a.width);for(var r=0;r<a.width;r++){g=r*j-j/2,h=r*j+j/2,g<0&&(g=0);var s=i.subarray(g,h);p=1/0,q=-(1/0);for(var t=0;t<s.length;t++)s[t]>q&&(q=s[t]),s[t]<p&&(p=s[t]);l[r]=q,m[r]=p,q>o&&(o=q),p<n&&(n=p)}}return{samples:k,minSample:e,maxSample:f,minPeaks:m,maxPeaks:l,minMinPeak:n,maxMaxPeak:o,samplePerPx:j}},i.findMinMaxPeaks=function(b,c,d){for(var e=a.calcSampleTime(b),f=a.calcSampleTime(c),g=i.osciPeaks.sampleRate/i.osciPeaks.winSizes[d],h=e*g,j=f*g,k=1/0,l=-(1/0),m=Math.round(h);m<Math.round(j);m++)i.osciPeaks.channelOsciPeaks[0].maxPeaks[d][m]>l&&(l=i.osciPeaks.channelOsciPeaks[0].maxPeaks[d][m]),i.osciPeaks.channelOsciPeaks[0].minPeaks[d][m]<k&&(k=i.osciPeaks.channelOsciPeaks[0].minPeaks[d][m]);return{minMinPeak:k,maxMaxPeak:l}},i.freshRedrawDrawOsciOnCanvas=function(d,e,f,g){var h=d.getContext("2d");h.clearRect(0,0,d.width,d.height),g&&(i.osciPeaks={}),angular.equals({},i.osciPeaks)&&i.calculateOsciPeaks();var j,k=(f+1-e)/d.width,l=-1;for(j=0;j<i.osciPeaks.winSizes.length;j++)k>i.osciPeaks.winSizes[j]&&(l=j);var m,n,o,p,q;if(l!==-1){m=i.findMinMaxPeaks(e,f,l);var r=a.calcSampleTime(e),s=i.osciPeaks.sampleRate/i.osciPeaks.winSizes[l],t=r*s;h.strokeStyle=b.design.color.black;var u=Math.round(t);h.beginPath(),n=(m.maxMaxPeak-i.osciPeaks.channelOsciPeaks[0].maxPeaks[l][u])/(m.maxMaxPeak-m.minMinPeak)*d.height,o=(m.maxMaxPeak-i.osciPeaks.channelOsciPeaks[0].minPeaks[l][u])/(m.maxMaxPeak-m.minMinPeak)*d.height,h.moveTo(0,n),p=n,q=o;for(var v,w,x,y=1;y<d.width;y++)w=y/d.width,x=a.getCurrentSample(w),v=a.calcSampleTime(x),u=Math.round(v*s),n=(m.maxMaxPeak-i.osciPeaks.channelOsciPeaks[0].maxPeaks[l][u])/(m.maxMaxPeak-m.minMinPeak)*d.height,o=(m.maxMaxPeak-i.osciPeaks.channelOsciPeaks[0].minPeaks[l][u])/(m.maxMaxPeak-m.minMinPeak)*d.height,h.moveTo(y-1,p),h.lineTo(y-1,n),h.moveTo(y-1,q),h.lineTo(y-1,o),h.moveTo(y,n),h.lineTo(y,o),p=n,q=o;h.stroke()}else if(m=i.calculatePeaks(d,c.audioBuffer.getChannelData(a.osciSettings.curChannel),e,f),m.minPeaks&&m.maxPeaks&&m.samplePerPx>=1){for(h.strokeStyle=b.design.color.black,h.beginPath(),n=(m.maxMaxPeak-m.maxPeaks[0])/(m.maxMaxPeak-m.minMinPeak)*d.height,o=(m.maxMaxPeak-m.minPeaks[0])/(m.maxMaxPeak-m.minMinPeak)*d.height,h.moveTo(0,n),h.lineTo(0,o),p=n,q=o,j=1;j<d.width;j++)n=(m.maxMaxPeak-m.maxPeaks[j])/(m.maxMaxPeak-m.minMinPeak)*d.height,o=(m.maxMaxPeak-m.minPeaks[j])/(m.maxMaxPeak-m.minMinPeak)*d.height,h.moveTo(j-1,p),h.lineTo(j-1,n),h.moveTo(j-1,q),h.lineTo(j-1,o),h.moveTo(j,n),h.lineTo(j,o),p=n,q=o;h.stroke()}else if(m.samplePerPx<1){var z=1/m.samplePerPx/2,A=a.curViewPort.sS;if(h.strokeStyle=b.design.color.black,h.fillStyle=b.design.color.black,0===a.curViewPort.sS){for(h.moveTo(z,(m.samples[0]-m.minSample)/(m.maxSample-m.minSample)*d.height),j=0;j<m.samples.length;j++)h.lineTo(j/m.samplePerPx+z,(m.samples[j]-m.minSample)/(m.maxSample-m.minSample)*d.height);for(h.stroke(),j=0;j<m.samples.length;j++)h.beginPath(),h.arc(j/m.samplePerPx+z,(m.samples[j]-m.minSample)/(m.maxSample-m.minSample)*d.height-3,4,0,2*Math.PI,!1),h.stroke(),h.fill(),b.vals.restrictions.drawSampleNrs&&(h.strokeText(A,j/m.samplePerPx+z,(m.samples[j]-m.minSample)/(m.maxSample-m.minSample)*d.height-10),A+=1)}else{for(h.beginPath(),h.moveTo(-z,d.height-(m.samples[0]-m.minSample)/(m.maxSample-m.minSample)*d.height),j=1;j<=m.samples.length;j++)h.lineTo(j/m.samplePerPx-z,d.height-((m.samples[j]-m.minSample)/(m.maxSample-m.minSample)*d.height+3));for(h.stroke(),j=1;j<=m.samples.length;j++)h.beginPath(),h.arc(j/m.samplePerPx-z,d.height-(m.samples[j]-m.minSample)/(m.maxSample-m.minSample)*d.height-3,4,0,2*Math.PI,!1),h.stroke(),h.fill(),b.vals.restrictions.drawSampleNrs&&(h.fillText(A,j/m.samplePerPx-z,d.height-(m.samples[j]-m.minSample)/(m.maxSample-m.minSample)*d.height-10),A+=1)}}if(b.vals.restrictions.drawZeroLine){h.strokeStyle=b.design.color.blue,h.fillStyle=b.design.color.blue;var B;k>=1||(B=d.height-(0-m.minSample)/(m.maxSample-m.minSample)*d.height,h.beginPath(),h.moveTo(0,B),h.lineTo(d.width,B),h.stroke(),h.fill(),h.fillText("0",5,d.height-(0-m.minSample)/(m.maxSample-m.minSample)*d.height-5,d.width))}},i.drawMovingBoundaryLine=function(c){var d,e;if(e=a.getSampleDist(c.canvas.width),d="SEGMENT"===a.getcurMouseLevelType()?0:e/2,a.movingBoundary){c.fillStyle=b.design.color.blue;var f=Math.round(a.getPos(c.canvas.width,a.movingBoundarySample));a.getcurMouseisLast()?c.fillRect(f+e,0,1,c.canvas.height):c.fillRect(f+d,0,1,c.canvas.height)}},i.drawCurViewPortSelected=function(e,i){var j,k,l,m,n=1*b.design.font.small.size.slice(0,-2);k=a.getSampleDist(e.canvas.width),j="seg"===a.getcurMouseLevelType()?0:k/2;var o=a.getPos(e.canvas.width,a.curViewPort.selectS),p=a.getPos(e.canvas.width,a.curViewPort.selectE);if(o===p)e.fillStyle=b.design.color.transparent.black,e.fillRect(o+j,0,2,e.canvas.height),i&&a.curViewPort.sS!==a.curViewPort.selectS&&a.curViewPort.selectS!==-1&&(m=e.canvas.width/e.canvas.offsetWidth,l=h(e,a.curViewPort.selectS,f.roundToNdigitsAfterDecPoint(a.curViewPort.selectS/c.audioBuffer.sampleRate,6),m),d.drawUndistortedTextTwoLines(e,a.curViewPort.selectS,f.roundToNdigitsAfterDecPoint(a.curViewPort.selectS/c.audioBuffer.sampleRate,6),n,b.design.font.small.family,p+5,0,b.design.color.black,!0));else if(e.fillStyle=b.design.color.transparent.grey,e.fillRect(o,0,p-o,e.canvas.height),e.strokeStyle=b.design.color.transparent.black,e.beginPath(),e.moveTo(o,0),e.lineTo(o,e.canvas.height),e.moveTo(p,0),e.lineTo(p,e.canvas.height),e.closePath(),e.stroke(),i&&(m=e.canvas.width/e.canvas.offsetWidth,l=h(e,a.curViewPort.selectS,f.roundToNdigitsAfterDecPoint(a.curViewPort.selectS/c.audioBuffer.sampleRate,6),m),d.drawUndistortedTextTwoLines(e,a.curViewPort.selectS,f.roundToNdigitsAfterDecPoint(a.curViewPort.selectS/c.audioBuffer.sampleRate,6),n,b.design.font.small.family,o-l-5,0,b.design.color.black,!1),d.drawUndistortedTextTwoLines(e,a.curViewPort.selectE,f.roundToNdigitsAfterDecPoint(a.curViewPort.selectE/c.audioBuffer.sampleRate,6),n,b.design.font.small.family,p+5,0,b.design.color.black,!0),l=g(e,f.roundToNdigitsAfterDecPoint((a.curViewPort.selectE-a.curViewPort.selectS)/c.audioBuffer.sampleRate,6),m),p-o>l)){var q=a.curViewPort.selectE-a.curViewPort.selectS-1,r=f.roundToNdigitsAfterDecPoint((a.curViewPort.selectE-a.curViewPort.selectS)/c.audioBuffer.sampleRate,6);l=h(e,q,r,m),d.drawUndistortedTextTwoLines(e,q,r,n,b.design.font.small.family,o+(p-o)/2-l/2,0,b.design.color.black,!1)}},i.drawCrossHairX=function(a,c){a.strokeStyle=b.design.color.transparent.red,a.fillStyle=b.design.color.transparent.red,a.beginPath(),a.moveTo(c,0),a.lineTo(c,a.canvas.height),a.stroke()},i.drawCrossHairs=function(c,g,h,i,j,k){if(b.vals.restrictions.drawCrossHairs){var l=1*b.design.font.small.size.slice(0,-2);c.strokeStyle=b.design.color.transparent.red,c.fillStyle=b.design.color.transparent.red;var m=a.getX(g),n=a.getY(g);c.font=b.design.font.small.size+"px "+b.design.font.small.family;var o,p=f.roundToNdigitsAfterDecPoint(i-n/c.canvas.height*i,2),q=c.measureText(p+j).width*d.scaleX,r=l*d.scaleY,s=Math.round(a.curViewPort.sS+m/c.canvas.width*(a.curViewPort.eS-a.curViewPort.sS)),t=f.roundToNdigitsAfterDecPoint(a.getViewPortStartTime()+m/c.canvas.width*(a.getViewPortEndTime()-a.getViewPortStartTime()),6);if(o=n+r<c.canvas.height?n+5:n-r-5,void 0!==i||void 0!==h)if("OSCI"===k)c.beginPath(),c.moveTo(m,0),c.lineTo(m,c.canvas.height),c.stroke();else if("SPEC"===k)d.drawUndistortedText(c,p+j,l,b.design.font.small.family,5,o,b.design.color.transparent.red,!0),d.drawUndistortedText(c,p+j,l,b.design.font.small.family,c.canvas.width-q,o,b.design.color.transparent.red,!0),c.beginPath(),c.moveTo(0,n),c.lineTo(5,n+5),c.moveTo(0,n),c.lineTo(c.canvas.width,n),c.lineTo(c.canvas.width-5,n+5),c.moveTo(m,0),c.lineTo(m,c.canvas.height),c.stroke();else{var u=b.getSsffTrackConfig(k),v=e.getColumnOfTrack(u.name,u.columnName);p=v._maxVal-n/c.canvas.height*(v._maxVal-v._minVal),p=f.roundToNdigitsAfterDecPoint(p,2),d.drawUndistortedText(c,p,l,b.design.font.small.family,5,o,b.design.color.transparent.red,!0),d.drawUndistortedText(c,p,l,b.design.font.small.family,c.canvas.width-5-q,o,b.design.color.transparent.red,!0),c.beginPath(),c.moveTo(0,n),c.lineTo(5,n+5),c.moveTo(0,n),c.lineTo(c.canvas.width,n),c.lineTo(c.canvas.width-5,n+5),c.moveTo(m,0),c.lineTo(m,c.canvas.height),c.stroke()}d.drawUndistortedTextTwoLines(c,s,t,l,b.design.font.small.family,m+5,0,b.design.color.transparent.red,!0)}},i.drawMinMaxAndName=function(a,c,e,g,h){a.strokeStyle=b.design.color.black,a.fillStyle=b.design.color.black;var i=1*b.design.font.small.size.slice(0,-2),j=a.canvas.height/a.canvas.offsetHeight,k=3*b.design.font.small.size.slice(0,-2)/4,l=k*j;a.beginPath(),a.moveTo(0,0),a.lineTo(5,5),a.moveTo(0,a.canvas.height),a.lineTo(5,a.canvas.height-5),a.stroke(),a.closePath(),""!==c&&d.drawUndistortedText(a,c,i,b.design.font.small.family,0,a.canvas.height/2-i*j/2,b.design.color.black,!0),void 0!==g&&d.drawUndistortedText(a,"max: "+f.roundToNdigitsAfterDecPoint(g,h),k,b.design.font.small.family,5,5,b.design.color.grey,!0),void 0!==e&&d.drawUndistortedText(a,"min: "+f.roundToNdigitsAfterDecPoint(e,h),k,b.design.font.small.family,5,a.canvas.height-l-5,b.design.color.grey,!0)},i.drawViewPortTimes=function(e){e.strokeStyle=b.design.color.black,e.fillStyle=b.design.color.black,e.font=b.design.font.small.size+" "+b.design.font.small.family;var g=1*b.design.font.small.size.slice(0,-2);e.beginPath(),e.moveTo(0,0),e.lineTo(5,5),e.moveTo(e.canvas.width,0),e.lineTo(e.canvas.width-5,5),e.closePath(),e.stroke();var i,j,k,l=e.canvas.width/e.canvas.offsetWidth;a.curViewPort&&(i=f.roundToNdigitsAfterDecPoint(a.curViewPort.sS/c.audioBuffer.sampleRate,6),j=f.roundToNdigitsAfterDecPoint(a.curViewPort.eS/c.audioBuffer.sampleRate,6),d.drawUndistortedTextTwoLines(e,a.curViewPort.sS,i,g,b.design.font.small.family,5,0,b.design.color.black,!0),k=h(e,a.curViewPort.eS,j,l),d.drawUndistortedTextTwoLines(e,a.curViewPort.eS,j,g,b.design.font.small.family,e.canvas.width-k-5,0,b.design.color.black,!1))},i}]),angular.module("emuwebApp").service("HistoryService",["$log","$compile","Ssffdataservice","LevelService","LinkService","ConfigProviderService","viewState","Soundhandlerservice","loadedMetaDataService",function(a,b,c,d,e,f,g,h,i){function j(a,b){Object.keys(a).forEach(function(g){var h,j,l,m=a[g];if("SSFF"===m.type)b?(k.setHistoryActionText(!0,"SSFF manipulation"),h=f.getSsffTrackConfig(m.trackName),j=c.getColumnOfTrack(h.name,h.columnName),j.values[m.sampleBlockIdx][m.sampleIdx]=m.oldValue):(k.setHistoryActionText(!1,"SSFF manipulation"),h=f.getSsffTrackConfig(m.trackName),j=c.getColumnOfTrack(h.name,h.columnName),j.values[m.sampleBlockIdx][m.sampleIdx]=m.newValue);else if("WEBAPP"===m.type){switch(l=!1,m.action){case"COMMENT":b?(l=!0,i.setBndlComment(m.initial,m.key,m.index)):i.setBndlComment(m.comment,m.key,m.index);break;case"FINISHED":b?(l=!0,i.setBndlFinished(!m.finished,m.key,m.index)):i.setBndlFinished(m.finished,m.key,m.index)}k.setHistoryActionText(l,m.action)}else if("ANNOT"===m.type){switch(l=!1,m.action){case"MOVEBOUNDARY":b?(l=!0,d.moveBoundary(m.name,m.id,-m.movedBy,m.isFirst,m.isLast)):d.moveBoundary(m.name,m.id,m.movedBy,m.isFirst,m.isLast);break;case"MOVESEGMENT":b?(l=!0,d.moveSegment(m.name,m.id,m.length,-m.movedBy)):d.moveSegment(m.name,m.id,m.length,m.movedBy);break;case"MOVEEVENT":b?(l=!0,d.moveEvent(m.name,m.id,-m.movedBy)):d.moveEvent(m.name,m.id,m.movedBy);break;case"RENAMELABEL":b?(l=!0,d.renameLabel(m.name,m.id,m.attrIndex,m.oldValue)):d.renameLabel(m.name,m.id,m.attrIndex,m.newValue);break;case"RENAMELEVEL":b?(l=!0,d.renameLevel(m.newname,m.name,m.curPerspectiveIdx)):d.renameLevel(m.name,m.newname,m.curPerspectiveIdx);break;case"DELETELEVEL":b?(l=!0,d.insertLevel(m.level,m.id,m.curPerspectiveIdx)):d.deleteLevel(m.id,m.curPerspectiveIdx);break;case"DELETEBOUNDARY":b?(l=!0,d.deleteBoundaryInvers(m.name,m.id,m.isFirst,m.isLast,m.deletedSegment)):d.deleteBoundary(m.name,m.id,m.isFirst,m.isLast);break;case"DELETESEGMENTS":b?(l=!0,d.deleteSegmentsInvers(m.name,m.id,m.length,m.deletedSegment)):d.deleteSegments(m.name,m.id,m.length);break;case"DELETEEVENT":b?(l=!0,d.insertEvent(m.name,m.start,m.pointName,m.id)):d.deleteEvent(m.name,m.id);break;case"DELETELINKSTO":b?(l=!0,e.insertLinksTo(m.deletedLinks)):e.deleteLinksTo(m.id);break;case"DELETELINKBOUNDARY":b?(l=!0,e.deleteLinkBoundaryInvers(m.deletedLinks)):e.deleteLinkBoundary(m.id,m.neighbourId,d);break;case"DELETELINKSEGMENT":b?(l=!0,e.deleteLinkSegmentInvers(m.deletedLinks)):e.deleteLinkSegment(m.segments);break;case"INSERTLEVEL":b?(l=!0,d.deleteLevel(m.id,m.curPerspectiveIdx)):d.insertLevel(m.level,m.id,m.curPerspectiveIdx);break;case"INSERTSEGMENTS":b?(l=!0,d.insertSegmentInvers(m.name,m.start,m.end,m.segName)):d.insertSegment(m.name,m.start,m.end,m.segName,m.ids);break;case"INSERTEVENT":b?(l=!0,d.deleteEvent(m.name,m.id)):d.insertEvent(m.name,m.start,m.pointName,m.id);break;case"INSERTLINKSTO":b?(l=!0,e.deleteLinksTo(m.parentID,m.childIDs)):e.insertLinksTo(m.parentID,m.childIDs);break;case"EXPANDSEGMENTS":b?(l=!0,d.expandSegment(m.rightSide,m.item,m.name,-m.changeTime)):d.expandSegment(m.rightSide,m.item,m.name,m.changeTime)}k.setHistoryActionText(l,m.action)}else if("HIERARCHY"===m.type){switch(l=!1,m.action){case"DELETELINK":b?(l=!0,e.insertLinkAt(m.fromID,m.toID,m.position)):e.deleteLink(m.fromID,m.toID);break;case"DELETEITEM":b?(l=!0,d.deleteItemWithLinksInvers(m.item,m.levelName,m.position,m.deletedLinks)):d.deleteItemWithLinks(m.item.id);break;case"ADDITEM":b?(l=!0,d.addItemInvers(m.newID)):d.addItem(m.neighborID,m.before,m.newID);break;case"ADDLINK":b?(l=!0,e.deleteLink(m.link.fromID,m.link.toID)):e.insertLink(m.link.fromID,m.link.toID);break;case"PUSHITEM":b?(l=!0,d.addItemInvers(m.newID)):d.pushNewItem(m.level,m.newID)}k.setHistoryActionText(l,m.action)}})}var k={};k.movesAwayFromLastSave=0;var l=[],m=[],n={};return k.updateCurChangeObj=function(a){var b;if("SSFF"===a.type)b=String(a.type+"#"+a.trackName)+"#"+String(a.sampleBlockIdx)+"#"+String(a.sampleIdx),n[b]?(a.oldValue=n[b].oldValue,n[b]=a):n[b]=a;else if("WEBAPP"===a.type)b=String(a.type+"#"+a.action+"#"+a.key+"#"+a.index),n[b]?(a.comment=n[b].comment,n[b]=a):n[b]=a;else if("ANNOT"===a.type)switch(a.action){case"MOVEBOUNDARY":case"MOVEEVENT":case"MOVESEGMENT":case"INSERTEVENT":case"DELETEEVENT":b=String(a.type+"#"+a.action+"#"+a.name+"#"+a.id),n[b]?(a.movedBy+=n[b].movedBy,n[b]=a):n[b]=a;break;case"INSERTLINKSTO":case"DELETELINKSTO":case"DELETELINKBOUNDARY":case"DELETELINKSEGMENT":case"DELETEBOUNDARY":case"DELETESEGMENTS":b=String(a.type+"#"+a.action+"#"+a.name),n[b]?(a.oldValue=n[b].oldValue,n[b]=a):n[b]=a}return n},k.addCurChangeObjToUndoStack=function(){m=[],$.isEmptyObject(n)||(l.push(n),k.movesAwayFromLastSave+=1),a.info(n),n={}},k.addObjToUndoStack=function(a){m=[];var b={},c=String(a.type+"#"+a.action+"#"+a.name+"#"+a.id);b[c]=angular.copy(a),$.isEmptyObject(b)||(l.push(b),k.movesAwayFromLastSave+=1),n={}},k.undo=function(){if(l.length>0){var a=angular.copy(l[l.length-1]);m.push(a),j(a,!0),l.pop(),k.movesAwayFromLastSave-=1}},k.redo=function(){if(m.length>0){var a=angular.copy(m[m.length-1]);l.push(a),j(a,!1),m.pop(),k.movesAwayFromLastSave+=1}},k.getNrOfPossibleUndos=function(){return l.length},k.getCurrentStack=function(){return{undo:l,redo:m}},k.setHistoryActionText=function(a,b){var c="<i>UNDO</i> &#8594; ";a||(c="<i>REDO</i> &#8592; "),g.historyActionTxt=c+b},k.resetToInitState=function(){l=[],m=[],n={},k.movesAwayFromLastSave=0},k}]),angular.module("emuwebApp").service("Wavparserservice",["$q",function(a){var b,c={};return c.ab2str=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return String.fromCharCode.apply(null,b)},c.parseWavHeader=function(a){var b,d,e,f={};if(b=0,d=a.subarray(b,4),e=new Uint8Array(d),f.ChunkID=c.ab2str(e),"RIFF"!==f.ChunkID)return{status:{type:"ERROR",message:"Wav read error: ChunkID not RIFF but "+f.ChunkID}};if(b=4,d=a.subarray(b,4),e=new Uint32Array(d),f.ChunkSize=e[0],b=8,d=a.subarray(b,4),e=new Uint8Array(d),f.Format=c.ab2str(e),"WAVE"!==f.Format)return{status:{type:"ERROR",message:"Wav read error: Format not WAVE but "+f.Format}};if(b=12,d=a.subarray(b,4),e=new Uint8Array(d),f.Subchunk1ID=c.ab2str(e),["fmt ","bext"].indexOf(f.Subchunk1ID)===-1)return{status:{type:"ERROR",message:"Wav read error: Subchunk1ID not fmt  but "+f.Subchunk1ID}};if(b=16,d=a.subarray(b,4),e=new Uint32Array(d),f.Subchunk1Size=e[0],[16,18,40].indexOf(f.Subchunk1Size)===-1)return{status:{type:"ERROR",message:"Wav read error: Subchunk1Size not 16, 18 or 40 but "+f.Subchunk1Size}};if(40!==f.Subchunk1Size&&(b=20,d=a.subarray(b,2),e=new Uint16Array(d),f.AudioFormat=e[0],[0,1].indexOf(f.AudioFormat)===-1))return{status:{type:"ERROR",message:"Wav read error: AudioFormat not 0 or 1 but "+f.AudioFormat}};if(b=22,d=a.subarray(b,2),e=new Uint16Array(d),f.NumChannels=e[0],f.NumChannels<1)return{status:{type:"ERROR",message:"Wav read error: NumChannels not greater than 1 but "+f.NumChannels}};b=24,d=a.subarray(b,4),e=new Uint32Array(d),f.SampleRate=e[0],b=28,d=a.subarray(b,4),e=new Uint32Array(d),f.ByteRate=e[0],b=32,d=a.subarray(b,2),e=new Uint16Array(d),f.BlockAlign=e[0],b=34,d=a.subarray(b,2),e=new Uint16Array(d),f.BitsPerSample=e[0];var g=!1;for(b=36;!g;){d=a.subarray(b,4),e=new Uint8Array(d);var h=c.ab2str(e);"data"===h?(g=!0,d=a.subarray(b+4,4),e=new Uint32Array(d),f.dataChunkSize=e[0]):b+=1}return f},c.parseWavAudioBuf=function(d){var e=c.parseWavHeader(d);if("undefined"!=typeof e.status&&"ERROR"===e.status.type)return b=a.defer(),b.reject(e),b.promise;var f=new OfflineAudioContext(e.NumChannels,e.dataChunkSize/e.NumChannels/(e.BitsPerSample/8),e.SampleRate);return f.decodeAudioData(d)},c}]),angular.module("emuwebApp").service("Textgridparserservice",["$q","DataService","viewState","Soundhandlerservice",function(a,b,c,d){var e,f={},g=new TextGridParserWorker;return g.says(function(a){"SUCCESS"===a.status.type?e.resolve(a.data):e.reject(a)},!1),f.asyncToTextGrid=function(){return e=a.defer(),g.tell({cmd:"toTextGrid",levels:b.getData().levels,sampleRate:d.audioBuffer.sampleRate,buffLength:d.audioBuffer.length}),e.promise},f.asyncParseTextGrid=function(b,c,f){return e=a.defer(),g.tell({cmd:"parseTG",textGrid:b,sampleRate:d.audioBuffer.sampleRate,annotates:c,name:f}),e.promise},f}]),angular.module("emuwebApp").factory("uuid",function(){function a(a){var b=(Math.random().toString(16)+"000000000").substr(2,8);return a?"-"+b.substr(0,4)+"-"+b.substr(4,4):b}var b={};return b.new=function(){return a()+a(!0)+a(!0)+a()},b.newHash=function(){return a()+a(!0)+a(!0)+a()},b.empty=function(){return"00000000-0000-0000-0000-000000000000"},b}),angular.module("emuwebApp").factory("browserDetector",function(){var a={};return a.isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return a.isMobile.Android()||a.isMobile.BlackBerry()||a.isMobile.iOS()||a.isMobile.Opera()||a.isMobile.Windows()}},a.isBrowser={Firefox:function(){return navigator.userAgent.match(/Firefox/i)},Chrome:function(){return navigator.userAgent.match(/Chrome/i)},InternetExplorer:function(){return navigator.userAgent.match(/MSIE/i)},Opera:function(){return navigator.userAgent.match(/Opera/i)},PhantomJS:function(){return navigator.userAgent.match(/PhantomJS/i)},Safari:function(){return Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0},any:function(){return a.isBrowser.Firefox()||a.isBrowser.Chrome()||a.isBrowser.InternetExplorer()||a.isBrowser.Opera()||a.isBrowser.Safari()||a.isBrowser.PhantomJS()}},a.isMobileDevice=function(){var b=a.isMobile.any();return null!==b&&b.length>0},a.isDesktopDevice=function(){var b=a.isBrowser.any();return null!==b&&b.length>0},a}),angular.module("emuwebApp").service("fontScaleService",function(){var a={};return a.lastTextWidth=null,a.spaceTop=0,a.scaleY=0,a.scaleX=0,a.drawUndistortedText=function(b,c,d,e,f,g,h,i){if(a.scaleY=b.canvas.height/b.canvas.offsetHeight,a.scaleX=b.canvas.width/b.canvas.offsetWidth,b.save(),b.font=d+"px "+e,b.scale(a.scaleX,a.scaleY),b.fillStyle=h,i)b.fillText(c,f/a.scaleX,(g+d+a.spaceTop)/a.scaleY);else{var j=f/a.scaleX-b.measureText(c).width/2;b.fillText(c,j,(g+d+a.spaceTop)/a.scaleY)}b.scale(1,1),b.restore()},a.drawUndistortedTextTwoLines=function(b,c,d,e,f,g,h,i,j){if(a.scaleY=b.canvas.height/b.canvas.offsetHeight,a.scaleX=b.canvas.width/b.canvas.offsetWidth,b.save(),b.font=e+"px "+f,b.scale(a.scaleX,a.scaleY),b.fillStyle=i,j)b.fillText(c,g/a.scaleX,h+e+a.spaceTop),b.fillText(d,g/a.scaleX,h+2*e+a.spaceTop);else{var k=b.measureText(c).width,l=b.measureText(d).width;k>l?(b.fillText(c,g/a.scaleX,h+e+a.spaceTop),b.fillText(d,(g+(k-l))/a.scaleX,h+2*e+a.spaceTop)):(b.fillText(c,(g+(l-k))/a.scaleX,h+e+a.spaceTop),b.fillText(d,g/a.scaleX,h+2*e+a.spaceTop))}b.scale(1,1),b.restore()},a}),angular.module("emuwebApp").service("Espsparserservice",["$q","LevelService","Soundhandlerservice",function(a,b,c){var d,e={},f=new EspsParserWorker;return f.says(function(a){"SUCCESS"===a.status.type?d.resolve(a.data):d.reject(a.data)},!1),e.asyncParseEsps=function(b,e,g){return d=a.defer(),f.tell({cmd:"parseESPS",esps:b,sampleRate:c.audioBuffer.sampleRate,annotates:e,name:g}),d.promise},e.asyncParseJSO=function(e){return d=a.defer(),f.tell({cmd:"parseJSO",level:b.getLevelDetails(e),sampleRate:c.audioBuffer.sampleRate}),d.promise},e}]),angular.module("emuwebApp").controller("LoginCtrl",["$scope","$rootScope","$http","ConfigProviderService","Iohandlerservice","viewState","modalService",function(a,b,c,d,e,f,g){a.loginData={username:"",password:"",errorMsg:""},a.tryLogin=function(){e.logOnUser(a.loginData.username,a.loginData.password).then(function(b){"LOGGEDON"===b?g.confirm():a.loginData.errorMsg="ERROR: "+b})},a.cursorInTextField=function(){f.setEditing(!0),f.setcursorInTextField(!0)},a.cursorOutOfTextField=function(){f.setEditing(!1),f.setcursorInTextField(!1)},a.cancel=function(){g.close()}}]),angular.module("emuwebApp").service("Ssffdataservice",["viewState","Soundhandlerservice","ConfigProviderService",function(a,b,c){var d={};return d.data=[],d.getFile=function(a){var b;return void 0!==c.curDbConfig.ssffTrackDefinitions&&c.curDbConfig.ssffTrackDefinitions.forEach(function(c){c.name===a&&d.data.forEach(function(a){a.fileExtension===c.fileExtension&&(b=a)})}),b},d.getColumnOfTrack=function(a,b){var c,e=d.getFile(a);if(void 0!==e)return e.Columns.forEach(function(a){a.name===b&&(c=a)}),c},d.getSampleRateAndStartTimeOfTrack=function(a){var b={},c=d.getFile(a);if(void 0!==c)return b.sampleRate=c.sampleRate,b.startTime=c.startTime,b},d.calculateSamplePosInVP=function(a,c,d){var e=a/c+d,f=Math.round(e*b.audioBuffer.sampleRate);return f},d}]),angular.module("emuwebApp").service("DataService",function(){var a={};return a.data={},a.maxItemID=0,a.getData=function(){return a.data},a.setLevelData=function(b){a.data.levels=b},a.getLevelData=function(){return a.data.levels},a.getLevelOrder=function(b){if(void 0!==a.data.levels)return a.data.levels.sort(function(a,c){return b.indexOf(a.name)-b.indexOf(c.name)})},a.getLevelDataAt=function(b){return a.data.levels[b]},a.insertLevelDataAt=function(b,c){a.data.levels.splice(b,0,c)},a.deleteLevelDataAt=function(b){a.data.levels.splice(b,1)},a.getLinkData=function(){return a.data.links},a.setLinkData=function(b){a.data.links=b},a.insertLinkData=function(b){a.data.links.push(b)},a.deleteLinkDataAt=function(b){a.data.links.splice(b,1)},a.insertLinkDataAt=function(b,c){a.data.links.splice(b,0,c)},a.changeLinkDataAt=function(b,c,d){a.data.links[b].fromID=c,a.data.links[b].toID=d},a.setData=function(b){angular.copy(b,a.data),angular.forEach(a.data.levels,function(b){b.items.forEach(function(b){b.id>a.maxItemID&&(a.maxItemID=b.id)})})},a.getNewId=function(){return a.maxItemID+=1,a.maxItemID},a.raiseId=function(b){a.maxItemID+=b},a.lowerId=function(b){a.maxItemID-=b},a}),angular.module("emuwebApp").service("LevelService",["$q","DataService","LinkService","ConfigProviderService","Soundhandlerservice","viewState",function(a,b,c,d,e,f){function g(a,b){var c;return angular.forEach(b,function(b,d){b.name===a&&(c=d)}),c}var h={};return h.lasteditArea=null,h.lasteditAreaElem=null,h.getLevelDetails=function(a){var c=null;return angular.forEach(b.getLevelData(),function(b){b.name===a&&(c=b)}),c},h.getLevelsByType=function(a){var c=[];return angular.forEach(b.getLevelData(),function(b){a.indexOf(b.type)>=0&&c.push(b)}),c},h.getOrderById=function(a,c){var d=null;return angular.forEach(b.getLevelData(),function(b){b.name===a&&b.items.forEach(function(a,b){a.id===c&&(d=b)})}),d},h.getIdByOrder=function(a,c){var d=null;return angular.forEach(b.getLevelData(),function(b){b.name===a&&b.items.forEach(function(a,b){b===c&&(d=a.id)})}),d},h.getItemDetails=function(a,c){var d=null;return angular.forEach(b.getLevelData(),function(b){b.name===a&&(d=b.items[c])}),d},h.getLastItem=function(a){var c=null;return angular.forEach(b.getLevelData(),function(b){b.name===a&&(c=b.items[b.items.length-1])}),c},h.getNextItem=function(a,c){var d=null;return angular.forEach(b.getLevelData(),function(b){b.name===a&&b.items.forEach(function(a,e){a.id===c&&(d=b.items[e+1])})}),d},h.getItemInTime=function(a,c,d){var e=null,f=1/0,g=h.getItemFromLevelById(a,c);if(null!==g){var i=g.sampleStart||g.samplePoint;angular.forEach(b.getLevelData(),function(b){b.name===a&&b.items.forEach(function(a){var b=a.sampleStart||a.samplePoint;d?b>i&&b-i<=f&&(f=b-i,e=a):b<i&&i-b<=f&&(f=i-b,e=a)})})}return e},h.getItemFromLevelById=function(a,c){var d=null;return angular.forEach(b.getLevelData(),function(b){b.name===a&&b.items.forEach(function(a){a.id===c&&(d=a)})}),d},h.getAllLabelsOfLevel=function(a){var b=f.getCurAttrDef(a.name),c=[];
return angular.forEach(a.items,function(a){var d=a.labels.map(function(a){return a.name}).indexOf(b);d>=0&&c.push(a.labels[d].value)}),c},h.getLevelName=function(a){var c=null;return angular.forEach(b.getLevelData(),function(b){var d=b.items.map(function(a){return a.id}).indexOf(a);d>=0&&(c=b.name)}),c},h.getLevelAndItem=function(a){var b=h.getLevelName(a);return null!==b?{level:h.getLevelDetails(b),item:h.getItemByID(a)}:null},h.getItemByID=function(a){var c;return angular.forEach(b.getLevelData(),function(b){var d=b.items.map(function(a){return a.id}).indexOf(a);d>=0&&(c=b.items[d])}),c},h.getItemsFromLevelByIdAndLength=function(a,b,c){for(var d=[],e=b,f=0;f<c;f++){var g=h.getItemFromLevelById(a,e);e=h.getNextItem(a,g.id),d.push(g)}return d},h.getlasteditAreaElem=function(){return h.lasteditAreaElem},h.setlasteditAreaElem=function(a){h.lasteditAreaElem=a},h.setlasteditArea=function(a){h.lasteditArea=a},h.getlasteditArea=function(){return h.lasteditArea},h.getlastID=function(){return parseInt(h.lasteditArea.substr(1))},h.deleteEditArea=function(){null!==h.getlasteditArea()&&$("."+h.getlasteditArea()).remove(),f.editing=!1,f.largeTextFieldInputFieldCurLabel="",f.largeTextFieldInputFieldVisable=!1},h.openEditArea=function(a,b,c){var e,i,j,k=f.getcurClickLevelName(),l=f.getCurAttrDef(k),m=g(l,a.labels),n=b.find("canvas")[0],o=n.clientWidth,p=n.offsetLeft,q=n.offsetTop,r=n.clientHeight-1,s=10;void 0!==m&&a.labels[m].value.length>0&&(s=7*a.labels[m].value.length);var t="";a.labels.length>0&&(t=void 0!==a.labels[m]?a.labels[m].value:""),d.vals.restrictions.useLargeTextInputField?(f.largeTextFieldInputFieldVisable=!0,f.largeTextFieldInputFieldCurLabel=t):("SEGMENT"===c?(e=Math.floor(f.getPos(o,a.sampleStart)+p),i=Math.ceil(f.getPos(o,a.sampleStart+a.sampleDur+1)+p),h.createEditAreaElement(b,e,q,i-e,r,a.labels[m].value,a.id)):(e=f.getPos(o,a.samplePoint)+p-s/2,i=f.getPos(o,a.samplePoint)+p+s/2,j=i-e,j<2*s&&(j=2*s),h.createEditAreaElement(b,e,q,j,r,t,a.id)),h.createSelection(b.find("textarea")[0],0,t.length))},h.createSelection=function(a,b,c){if(a.createTextRange){var d=a.createTextRange();d.collapse(!0),d.moveStart("character",b),d.moveEnd("character",c),d.select()}else a.setSelectionRange?a.setSelectionRange(b,c):a.selectionStart&&(a.selectionStart=b,a.selectionEnd=c);a.focus()},h.createEditAreaElement=function(a,b,c,d,e,f,g){var h="_"+g;a.prepend($("<textarea>").attr({id:h,class:h+" emuwebapp-label-edit","ng-model":"message",autofocus:"true"}).css({left:Math.round(b+2)+"px",top:Math.round(c+1)+"px",width:Math.round(d)-2+"px",height:Math.round(e)-20+"px","padding-top":Math.round(e/3+1)+"px"}).text(f))},h.insertItemDetails=function(a,c,e,g,h,i){var j,k=d.getLevelDefinition(c).attributeDefinitions,l=f.getCurAttrDef(c);void 0===k&&(k=[]),angular.forEach(b.getLevelData(),function(b){var d;if(b.name===c){if("SEGMENT"===b.type)if(j={id:a,sampleStart:h,sampleDur:i,labels:[]},k.length>0)for(d=0;d<k.length;d++)k[d].name===l?j.labels.push({name:k[d].name,value:g}):j.labels.push({name:k[d].name,value:g});else j.labels.push({name:c,value:g});else if("EVENT"===b.type)if(j=void 0!==h?{id:a,samplePoint:h,labels:[]}:{id:a,labels:[]},k.length>0)for(d=0;d<k.length;d++)k[d].name===l?j.labels.push({name:k[d].name,value:g}):j.labels.push({name:k[d].name,value:g});else j.labels.push({name:c,value:g});b.items.splice(e,0,j)}})},h.updateSegment=function(a,c,d,e,f,g){angular.forEach(b.getLevelData(),function(b){b.name===a&&b.items.forEach(function(a){a.id===c&&(void 0!==f&&(a.sampleStart=f),void 0!==g&&(a.sampleDur=g),void 0!==d&&(a.labels[e].value=d))})})},h.updatePoint=function(a,c,d,e,f){angular.forEach(b.getLevelData(),function(b){b.name===a&&b.items.forEach(function(a){a.id===c&&(a.samplePoint=f,void 0===e?a.labels[0].value=d:a.labels[e].value=d)})})},h.getItemNeighboursFromLevel=function(a,c,d){var e,f;return angular.forEach(b.getLevelData(),function(b){b.name===a&&b.items.forEach(function(a,g){a.id===c&&(e=b.items[g-1]),a.id===d&&(f=b.items[g+1])})}),{left:e,right:f}},h.getClosestItem=function(a,b,c){var d,e,f,g,i=h.getLevelDetails(b);if(void 0!==i&&null!==i&&i.items.length>0)if(d=e=i.items[0],f=!0,g=!1,"SEGMENT"===i.type){var j;angular.forEach(i.items,function(b,c){a>=b.sampleStart-.5&&(a<=b.sampleStart+b.sampleDur+.5&&(a-b.sampleStart>=b.sampleDur/2?(j=!1,void 0!==i.items[c+1]?(d=i.items[c],e=i.items[c+1],g=!1):(g=!0,d=e=i.items[i.items.length-1])):(j=!0,g=!1,d=e=i.items[c])),j||0!==c||(f=!1)),a>=b.sampleStart-.5&&(a<=b.sampleStart+b.sampleDur+.5?d=b:(g=!0,d=e=i.items[i.items.length-1]))})}else{var k=0,l=0;f=!1,g=!1,angular.forEach(i.items,function(b,f){l=f<i.items.length-1?b.samplePoint+(i.items[f+1].samplePoint-i.items[f].samplePoint)/2:c,k=f>0?b.samplePoint-(i.items[f].samplePoint-i.items[f-1].samplePoint)/2:0,a<=l&&a>=k&&(d=e=b)})}return{current:d,nearest:e,isFirst:f,isLast:g}},h.deleteLevel=function(a,c){var e=b.getLevelDataAt(a);return b.deleteLevelDataAt(a),d.vals.perspectives[c].levelCanvases.order.splice(a,1),e},h.insertLevel=function(a,c,e){void 0===b.getLevelData()&&b.setLevelData([]),b.insertLevelDataAt(c,a),d.vals.perspectives[e].levelCanvases.order.splice(c,0,a.name)},h.renameLabel=function(a,b,c,d){h.updateSegment(a,b,d,c)},h.renameLevel=function(a,c,e){angular.forEach(b.getLevelData(),function(b){b.name===a&&(b.name=c,angular.forEach(f.curLevelAttrDefs,function(b,c){b.curAttrDefName===a&&b.levelName===a&&f.curLevelAttrDefs.slice(c,1)}),f.curLevelAttrDefs.push({curAttrDefName:c,levelName:c}),angular.forEach(b.items,function(a){a.labels[0].name=c}))}),d.vals.perspectives[e].levelCanvases.order[d.vals.perspectives[e].levelCanvases.order.indexOf(a)]=c},h.deleteSegmentsInvers=function(a,c,d,e){var i,j,k,l=f.getCurAttrDef(a);k=0,angular.forEach(b.getLevelData(),function(b){if(b.name===a){k=e.order;for(j in e.segments)b.items.splice(k++,0,e.segments[j])}});var m=h.getItemNeighboursFromLevel(a,e.segments[0].id,e.segments[e.segments.length-1].id);void 0!==m.left&&void 0===m.right?(i=g(l,m.left.labels),h.updateSegment(a,m.left.id,m.left.labels[i].value,i,m.left.sampleStart,m.left.sampleDur-e.timeRight)):void 0===m.left&&void 0!==m.right?(i=g(l,m.right.labels),h.updateSegment(a,m.right.id,m.right.labels[i].value,i,m.right.sampleStart+e.timeLeft,m.right.sampleDur-e.timeLeft)):void 0===m.left&&void 0===m.right||(i=g(l,m.left.labels),h.updateSegment(a,m.left.id,m.left.labels[i].value,i,m.left.sampleStart,m.left.sampleDur-e.timeLeft),h.updateSegment(a,m.right.id,m.right.labels[i].value,i,m.right.sampleStart+e.timeRight,m.right.sampleDur-e.timeRight))},h.deleteSegments=function(a,c,d){for(var e=h.getItemFromLevelById(a,c),i=h.getOrderById(a,c),j=h.getItemDetails(a,i+d-1),k=h.getItemNeighboursFromLevel(a,e.id,j.id),l=0,m=0,n=null,o=null,p=null,q=f.getCurAttrDef(a),r=g(q,e.labels),s=i;s<i+d;s++)l+=h.getItemDetails(a,s).sampleDur+1;return l%2===0?(l/=2,m=l):(l=Math.ceil(l/2),m=l-1),angular.forEach(b.getLevelData(),function(b){b.name===a&&angular.forEach(b.items,function(a,e){a.id===c&&(n=e,o=b.items.splice(n,d))})}),void 0!==k.left&&void 0===k.right?(h.updateSegment(a,k.left.id,void 0,r,k.left.sampleStart,k.left.sampleDur+m),p=k.left):void 0===k.left&&void 0!==k.right?(h.updateSegment(a,k.right.id,void 0,r,k.right.sampleStart-l,k.right.sampleDur+l),p=k.right):void 0===k.left&&void 0===k.right?f.setcurMouseItem(void 0,void 0,void 0):(h.updateSegment(a,k.left.id,void 0,r,k.left.sampleStart,k.left.sampleDur+l),h.updateSegment(a,k.right.id,void 0,r,k.right.sampleStart-m,k.right.sampleDur+m),p=k.left),{order:n,segments:o,timeLeft:l,timeRight:m,clickSeg:p}},h.insertSegmentInvers=function(a,c,d){var e=!0;return angular.forEach(b.getLevelData(),function(b){var f,g,h;b.name===a&&(c===d?(h=-1,angular.forEach(b.items,function(a,b){c===a.sampleStart&&(h=b,e=!0)}),e&&(f=0,void 0!==b.items[h]&&(f=b.items[h].sampleDur+1),void 0!==b.items[h-1]&&(b.items[h-1].sampleDur+=f),b.items.splice(h,1))):(h=-1,angular.forEach(b.items,function(a,b){c===a.sampleStart&&(h=b,e=!0)}),e&&(void 0===b.items[h+1]?b.items.splice(h-1,2):void 0===b.items[h-1]?b.items.splice(h,2):(f=b.items[h].sampleDur+1,g=b.items[h+1].sampleDur+1,b.items[h-1].sampleDur+=f+g,b.items.splice(h,2)))))}),e},h.insertSegment=function(a,c,d,e,f){var g=!0;return angular.forEach(b.getLevelData(),function(i){var j,k,l,m;if(i.name===a)if(c===d){if(0===i.items.length)return{ret:!1,ids:f};if(void 0===f&&(f=[],f[0]=b.getNewId()),l=-1,c<i.items[0].sampleStart)j=i.items[0].sampleStart-c,h.insertItemDetails(f[0],a,0,e,c,j-1);else if(c>i.items[i.items.length-1].sampleStart+i.items[i.items.length-1].sampleDur){var n=i.items[i.items.length-1].sampleStart+i.items[i.items.length-1].sampleDur+1;h.insertItemDetails(f[0],a,i.items.length,e,n,c-n)}else angular.forEach(i.items,function(a,b){c>=a.sampleStart&&c<=a.sampleStart+a.sampleDur&&(l=b),a.sampleStart===c&&(g=!1),a.sampleStart+a.sampleDur+1===c&&(g=!1)}),g&&(j=c-i.items[l].sampleStart-1,h.insertItemDetails(f[0],a,l+1,e,c,i.items[l].sampleDur-j-1),i.items[l].sampleDur=j)}else if(void 0===f&&(f=[],f[0]=b.getNewId(),f[1]=b.getNewId()),0===i.items.length)h.insertItemDetails(f[0],a,0,e,c,d-c-1);else if(d<i.items[0].sampleStart)j=i.items[0].sampleStart-d-1,k=d-c-1,h.insertItemDetails(f[0],a,0,e,d,j),h.insertItemDetails(f[1],a,0,e,c,k);else if(c>i.items[i.items.length-1].sampleStart+i.items[i.items.length-1].sampleDur){j=c-(i.items[i.items.length-1].sampleStart+i.items[i.items.length-1].sampleDur)-1,k=d-c-1;var o=i.items.length;h.insertItemDetails(f[0],a,o,e,i.items[i.items.length-1].sampleStart+i.items[i.items.length-1].sampleDur,j),h.insertItemDetails(f[1],a,o+1,e,c,k)}else l=-1,m=-1,angular.forEach(i.items,function(a,b){c>=a.sampleStart&&c<=a.sampleStart+a.sampleDur&&(l=b),d>=a.sampleStart&&d<=a.sampleStart+a.sampleDur&&(m=b)}),g=l===m,g&&l!==-1&&(j=c-i.items[l].sampleStart-1,k=d-c-1,h.insertItemDetails(f[0],a,l+1,e,c,k),h.insertItemDetails(f[1],a,l+2,e,d,i.items[l].sampleDur-j-1-k-1),i.items[l].sampleDur=j)}),{ret:g,ids:f}},h.insertEvent=function(a,c,d,e){var f,g,i=!1;return angular.forEach(b.getLevelData(),function(b){b.name===a&&"EVENT"===b.type&&(g=b.items.length>0?b.items[0].samplePoint:0,angular.forEach(b.items,function(a,b){Math.floor(c)===Math.floor(a.samplePoint)&&(i=!0),c>a.samplePoint&&(f=b+1)}))}),i||(void 0===e&&(e=b.getNewId()),h.insertItemDetails(e,a,f,d,c)),{alreadyExists:i,id:e}},h.deleteEvent=function(a,c){var d=!1;return angular.forEach(b.getLevelData(),function(b){b.name===a&&"EVENT"===b.type&&angular.forEach(b.items,function(a,e){d||c===a.id&&(d=a,b.items.splice(e,1))})}),d},h.deleteBoundary=function(a,c,d,e){var f=h.getItemFromLevelById(a,c),g=null,i=null,j=null,k=null;return angular.forEach(b.getLevelData(),function(b){b.name===a&&(g=b.items[0],angular.forEach(b.items,function(a,c){if("SEGMENT"===b.type&&f.sampleStart===a.sampleStart&&f.sampleDur===a.sampleDur)if(0===c&&d)b.items.splice(c,1),i=c,j=a,k=b.items[0];else if(c===b.items.length-1&&e)b.items.splice(c,1),i=c,j=a,k=b.items[b.items.length-1];else{for(var h=0;h<g.labels.length;h++)g.labels[h].value+=a.labels[h].value;g.sampleDur+=a.sampleDur+1,b.items.splice(c,1),i=c,j=a,k=g}g=a}),null===k&&(k=b.items[0]))}),{order:i,event:j,clickSeg:k}},h.deleteBoundaryInvers=function(a,c,d,e,f){angular.forEach(b.getLevelData(),function(b){if(b.name===a){b.items.splice(f.order,0,f.event);var c=f.event.labels[0].value;d||e||(c=b.items[f.order-1].labels[0].value.slice(0,b.items[f.order-1].labels[0].value.length-f.event.labels[0].value.length),b.items[f.order-1].labels[0].value=c,b.items[f.order-1].sampleDur-=f.event.sampleDur+1)}})},h.snapBoundary=function(a,c,d,e,f){var g,h,i,j,k,l=1/0;return"SEGMENT"===f?j=d.sampleStart:"EVENT"===f&&(j=d.samplePoint),angular.forEach(b.getLevelData(),function(d,e){if(d.name===c){if(a){if(!(e>=1))return!1;g=b.getLevelData()[e-1]}else{if(!(e<b.getLevelData().length-1))return!1;g=b.getLevelData()[e+1]}g.items.forEach(function(a){"SEGMENT"===g.type?k=a.sampleStart:"EVENT"===g.type&&(k=a.samplePoint),h=Math.abs(j-k),h<l&&(l=h,i=k-j)})}}),void 0!==i&&("SEGMENT"===f?this.moveBoundary(c,d.id,i,0):"EVENT"===f&&this.moveEvent(c,d.id,i),i)},h.moveBoundary=function(a,b,c,d,i){var j,k=h.getItemFromLevelById(a,b),l=f.getCurAttrDef(a),m=g(l,k.labels),n=h.getItemNeighboursFromLevel(a,b,b);if(d)j=n.right,void 0!==j?k.sampleStart+c>=0&&k.sampleStart+c<j.sampleStart&&h.updateSegment(a,k.id,void 0,m,k.sampleStart+c,k.sampleDur-c):k.sampleStart+c>=0&&k.sampleDur-c>=0&&k.sampleStart+k.sampleDur+c<=e.audioBuffer.length&&h.updateSegment(a,k.id,void 0,m,k.sampleStart+c,k.sampleDur-c);else if(i)k.sampleDur+c>=0&&k.sampleDur+k.sampleStart+c<=e.audioBuffer.length&&h.updateSegment(a,k.id,void 0,m,k.sampleStart,k.sampleDur+c);else if(void 0===n.left)j=n.right,void 0!==j?k.sampleStart+c>=0&&k.sampleStart+c<j.sampleStart&&h.updateSegment(a,k.id,void 0,m,k.sampleStart+c,k.sampleDur-c):k.sampleStart+c>=0&&k.sampleStart+k.sampleDur+c<=e.audioBuffer.length&&h.updateSegment(a,k.id,void 0,m,k.sampleStart+c,k.sampleDur-c);else{var o=n.left;o.sampleDur+c>=0&&k.sampleStart+c>=0&&k.sampleDur-c>=0&&(h.updateSegment(a,n.left.id,void 0,m,o.sampleStart,o.sampleDur+c),h.updateSegment(a,k.id,void 0,m,k.sampleStart+c,k.sampleDur-c))}},h.moveEvent=function(a,d,i){var j=h.getItemFromLevelById(a,d),k=f.getCurAttrDef(a),l=g(k,j.labels);if(c.isLinked(d)){var m=h.getItemNeighboursFromLevel(a,d,d);j.samplePoint+i>0&&j.samplePoint+i<=e.audioBuffer.length&&(void 0!==m.left&&void 0!==m.right?j.samplePoint+i>m.left.samplePoint&&j.samplePoint+i<m.right.samplePoint&&h.updatePoint(a,j.id,j.labels[0].value,l,j.samplePoint+i):void 0===m.left&&void 0===m.right?h.updatePoint(a,j.id,j.labels[0].value,l,j.samplePoint+i):void 0===m.left&&void 0!==m.right?j.samplePoint+i>0&&j.samplePoint+i<m.right.samplePoint&&h.updatePoint(a,j.id,j.labels[0].value,l,j.samplePoint+i):void 0!==m.left&&void 0===m.right&&j.samplePoint+i>m.left.samplePoint&&j.samplePoint+i<=e.audioBuffer.length&&h.updatePoint(a,j.id,j.labels[0].value,l,j.samplePoint+i))}else j.samplePoint+i>0&&j.samplePoint+i<=e.audioBuffer.length&&h.updatePoint(a,j.id,j.labels[0].value,l,j.samplePoint+i),angular.forEach(b.getLevelData(),function(b){b.name===a&&b.items.sort(f.sortbystart)})},h.orderPoints=function(a,b){return a.samplePoint>b.samplePoint?1:a.samplePoint<b.samplePoint?-1:0},h.moveSegment=function(a,b,c,d){var i,j,k=h.getOrderById(a,b),l=h.getItemDetails(a,k),m=h.getItemDetails(a,k+c-1);if(null!==l&&null!==m){var n=h.getItemNeighboursFromLevel(a,l.id,m.id),o=f.getCurAttrDef(a),p=g(o,l.labels);if(void 0===n.left&&void 0!==n.right){var q=h.getItemFromLevelById(a,n.right.id);if(l.sampleStart+d>0&&n.right.sampleDur-d>=0)for(h.updateSegment(a,q.id,void 0,p,q.sampleStart+d,q.sampleDur-d),j=k;j<k+c;j++)i=h.getItemDetails(a,j),h.updateSegment(a,i.id,void 0,p,i.sampleStart+d,i.sampleDur)}else if(void 0===n.right&&void 0!==n.left){var r=h.getItemFromLevelById(a,n.left.id);if(n.left.sampleDur+d>=0&&m.sampleStart+m.sampleDur+d<e.audioBuffer.length)for(h.updateSegment(a,r.id,void 0,p,r.sampleStart,r.sampleDur+d),j=k;j<k+c;j++)i=h.getItemDetails(a,j),h.updateSegment(a,i.id,void 0,p,i.sampleStart+d,i.sampleDur)}else if(void 0!==n.right&&void 0!==n.left){var s=h.getItemFromLevelById(a,n.left.id),t=h.getItemFromLevelById(a,n.right.id);if(s.sampleDur+d>=0&&t.sampleDur-d>=0)for(h.updateSegment(a,s.id,void 0,p,s.sampleStart,s.sampleDur+d),h.updateSegment(a,t.id,void 0,p,t.sampleStart+d,t.sampleDur-d),j=k;j<k+c;j++)i=h.getItemDetails(a,j),h.updateSegment(a,i.id,void 0,p,i.sampleStart+d,i.sampleDur)}else if(void 0===n.right&&void 0===n.left){var u=h.getItemDetails(a,k),v=h.getItemDetails(a,k+c-1);if(u.sampleStart+d>0&&v.sampleDur+v.sampleStart+d<e.audioBuffer.length)for(j=k;j<k+c;j++)i=h.getItemDetails(a,j),h.updateSegment(a,i.id,void 0,p,i.sampleStart+d,i.sampleDur)}}},h.expandSegment=function(a,b,c,d){var i,j=0,k=h.getItemNeighboursFromLevel(c,b[0].id,b[b.length-1].id),l=f.getCurAttrDef(c),m=g(l,b[0].labels),n=!0;if(a)if(void 0===k.right){var o=b[b.length-1].sampleStart+b[b.length-1].sampleDur+d*b.length;o<=e.audioBuffer.length&&angular.forEach(b,function(a){i=h.getItemFromLevelById(c,a.id),h.updateSegment(c,i.id,void 0,m,i.sampleStart+j,i.sampleDur+d),j+=d})}else angular.forEach(b,function(a){a.sampleDur+1+d<0&&(n=!1)}),n&&k.right.sampleDur-d*b.length>0&&(angular.forEach(b,function(a){i=h.getItemFromLevelById(c,a.id),h.updateSegment(c,i.id,void 0,m,i.sampleStart+j,i.sampleDur+d),j+=d}),h.updateSegment(c,k.right.id,void 0,m,k.right.sampleStart+j,k.right.sampleDur-j));else if(void 0===k.left){var p=h.getItemDetails(c,0);p.sampleStart+d*(b.length+1)>0&&angular.forEach(b,function(a){i=h.getItemFromLevelById(c,a.id),h.updateSegment(c,i.id,void 0,i.sampleStart-d,m,i.sampleDur+d)})}else angular.forEach(b,function(a){a.sampleDur+1+d<0&&(n=!1)}),n&&k.left.sampleDur-d*b.length>0&&(j=0,angular.forEach(b,function(a,e){i=h.getItemFromLevelById(c,a.id),j=-(b.length-e)*d,h.updateSegment(c,i.id,void 0,m,i.sampleStart+j,i.sampleDur+d)}),h.updateSegment(c,k.left.id,void 0,m,k.left.sampleStart,k.left.sampleDur-b.length*d))},h.calcDistanceToNearestZeroCrossing=function(a){var b,c=1/0,d=1/0,g=e.audioBuffer.getChannelData(f.osciSettings.curChannel);for(b=a;b<e.audioBuffer.length-1;b++)if(g[b]>=0&&g[b+1]<0||g[b]<0&&g[b+1]>=0){c=b-a;break}for(b=a;b>1;b--)if(g[b]>=0&&g[b-1]<0||g[b]<0&&g[b-1]>=0){d=b-a;break}var h;return h=Math.abs(d)<Math.abs(c)?d:c+1},h.pushNewItem=function(a,c){var e=h.getLevelDetails(a);if(console.debug(a,e,c),"ITEM"===e.type){var f;f="number"==typeof c?{id:c,labels:[]}:{id:b.getNewId(),labels:[]};for(var g=d.getLevelDefinition(e.name).attributeDefinitions,i=0;i<g.length;++i)"STRING"===g[i].type?f.labels.push({name:g[i].name,value:""}):f.labels.push({name:g[i].name,value:null});return e.items.push(f),f.id}return-1},h.addItem=function(a,c,e){if(void 0===a)return-1;if("boolean"!=typeof c)return-1;var f=h.getLevelAndItem(a);if(null===f)return console.debug("Could not find item with id:",a),-1;var g=f.level,i=f.item;if("ITEM"===g.type){var j,k=g.items.indexOf(i);j=c===!0?k:k+1;var l;l=void 0===e?{id:b.getNewId(),labels:[]}:{id:e,labels:[]};for(var m=d.getLevelDefinition(g.name).attributeDefinitions,n=0;n<m.length;++n)"STRING"===m[n].type?l.labels.push({name:m[n].name,value:""}):l.labels.push({name:m[n].name,value:null});return g.items.splice(j,0,l),l.id}return-1},h.addItemInvers=function(a){for(var c=b.getLevelData(),d=0;d<c.length;++d)for(var e=0;e<c[d].items.length;++e)if(c[d].items[e].id===a)return void c[d].items.splice(e,1)},h.deleteItemWithLinks=function(a){var c={item:void 0,levelName:void 0,position:void 0,deletedLinks:[]},d=h.getLevelAndItem(a);if(null===d)return c;var e=d.level,f=d.item;if("ITEM"!==e.type)return c;c.item=f,c.levelName=e.name,c.position=e.items.indexOf(f),e.items.splice(e.items.indexOf(f),1);for(var g=b.getLinkData(),i=g.length-1;i>=0;--i)g[i].fromID!==a&&g[i].toID!==a||(c.deletedLinks.push(g[i]),g.splice(i,1));return c},h.deleteItemWithLinksInvers=function(a,c,d,e){h.getLevelDetails(c).items.splice(d,0,a);for(var f=0;f<e.length;++f)b.insertLinkData(e[f])},h}]),angular.module("emuwebApp").service("LinkService",["DataService","ConfigProviderService",function(a,b){var c={};return c.insertLink=function(b,c){a.insertLinkData({fromID:b,toID:c})},c.insertLinkAt=function(b,c,d){a.insertLinkDataAt(d,{fromID:b,toID:c})},c.deleteLink=function(b,c){var d=-1;return angular.forEach(a.getLinkData(),function(e,f){e.fromID===b&&e.toID===c&&(a.deleteLinkDataAt(f),d=f)}),d},c.linkExists=function(b,c){var d=!1;return angular.forEach(a.getLinkData(),function(a){a.fromID===b&&a.toID===c&&(d=!0)}),d},c.hasParents=function(b){var c=!1;return angular.forEach(a.getLinkData(),function(a){a.toID===b&&(c=!0)}),c},c.hasChildren=function(b){var c=!1;return angular.forEach(a.getLinkData(),function(a){a.fromID===b&&(c=!0)}),c},c.isLinked=function(a){return c.hasChildren(a)||c.hasParents(a)},c.insertLinksTo=function(a,b){angular.forEach(b,function(b){c.insertLink(a,b)})},c.deleteLinksTo=function(a,b){var d=[];return angular.forEach(b,function(b){c.deleteLink(a,b),d.push({fromID:a,toID:b})}),d},c.insertLinksFrom=function(a,b){angular.forEach(a,function(a){c.insertLink(a,b)})},c.deleteLinksFrom=function(a,b){var d=[];return angular.forEach(a,function(a){d.push({fromID:a,toID:b}),c.deleteLink(a,b)}),d},c.getLinksTo=function(b){var c=[];return angular.forEach(a.getLinkData(),function(a,d){a.toID===b&&c.push({link:a,order:d})}),c},c.getLinksFrom=function(b){var c=[];return angular.forEach(a.getLinkData(),function(a,d){a.fromID===b&&c.push({link:a,order:d})}),c},c.changeLinkTo=function(b,c,d){angular.forEach(a.getLinkData(),function(e,f){e.fromID===b&&e.toID===c&&a.changeLinkDataAt(f,b,d)})},c.changeLinkFrom=function(b,c,d){angular.forEach(a.getLinkData(),function(e,f){e.fromID===b&&e.toID===c&&a.changeLinkDataAt(f,d,c)})},c.deleteLinkSegment=function(a){var b=[],d=[];return angular.forEach(a,function(a){angular.forEach(c.getLinksTo(a.id),function(a){b.push({fromID:a.link.fromID,toID:a.link.toID}),c.deleteLink(a.link.fromID,a.link.toID)}),angular.forEach(c.getLinksFrom(a.id),function(a){d.push({fromID:a.link.fromID,toID:a.link.toID}),c.deleteLink(a.link.fromID,a.link.toID)})}),{linksTo:b,linksFrom:d}},c.deleteLinkSegmentInvers=function(a){angular.forEach(a.linksTo,function(a){c.insertLink(a.fromID,a.toID)}),angular.forEach(a.linksFrom,function(a){c.insertLink(a.fromID,a.toID)})},c.deleteLinkBoundary=function(a,d,e){var f=[],g=[],h=0,i=e.getLevelName(d),j=!0;return angular.forEach(b.curDbConfig.linkDefinitions,function(a){a.superlevelName!==i&&a.sublevelName!==i||"MANY_TO_MANY"!==a.type&&(j=!1)}),d>=0?(angular.forEach(c.getLinksTo(a),function(b){c.linkExists(b.link.fromID,d)?(h=c.deleteLink(b.link.fromID,a),f.push({fromID:b.link.fromID,toID:a,deleted:!0,order:h,neighbourID:0})):j&&(c.changeLinkTo(b.link.fromID,a,d),f.push({fromID:b.link.fromID,toID:a,deleted:!1,order:h,neighbourID:d}))}),angular.forEach(c.getLinksFrom(a),function(b){c.linkExists(d,b.link.toID)?(h=c.deleteLink(a,b.link.toID),g.push({fromID:a,toID:b.link.toID,deleted:!0,order:h,neighbourID:0})):(c.changeLinkFrom(a,b.link.toID,d),g.push({fromID:a,toID:b.link.toID,deleted:!1,order:h,neighbourID:d}))})):(angular.forEach(c.getLinksTo(a),function(b){h=c.deleteLink(b.link.fromID,a),f.push({fromID:b.link.fromID,toID:a,deleted:!0,order:h,neighbourID:0})}),angular.forEach(c.getLinksFrom(a),function(b){h=c.deleteLink(a,b.link.toID),g.push({fromID:a,toID:b.link.toID,deleted:!0,order:h,neighbourID:0})})),{linksTo:f,linksFrom:g}},c.deleteLinkBoundaryInvers=function(a){angular.forEach(a.linksTo,function(a){a.deleted?c.insertLinkAt(a.fromID,a.toID,a.order):c.changeLinkTo(a.fromID,a.neighbourID,a.toID)}),angular.forEach(a.linksFrom,function(a){a.deleted?c.insertLinkAt(a.fromID,a.toID,a.order):c.changeLinkFrom(a.neighbourID,a.toID,a.fromID)})},c}]),angular.module("emuwebApp").service("Websockethandler",["$q","$rootScope","$location","$timeout","HistoryService","Ssffparserservice","ConfigProviderService","viewState","Wavparserservice","Soundhandlerservice","Espsparserservice","uuid","Binarydatamaniphelper","Ssffdataservice","modalService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a){var c=a;if(x.hasOwnProperty(c.callbackID)){switch(c.type){case"getESPSfile":alert("espsfile");break;case"getSSFFfile":alert("ssfffile")}"SUCCESS"===c.status.type?b.$apply(x[c.callbackID].cb.resolve(c.data)):(w.closeConnect(),b.$broadcast("resetToInitState"),b.$apply(o.open("views/error.html","Communication error with server! Error message is: "+c.status.message))),delete x[c.callbackID]}else"undefined"==typeof c.status?o.open("views/error.html","Just got JSON message from server that the EMU-webApp does not know how to deal with! This is not allowed!"):"ERROR:TIMEOUT"===c.status.type||o.open("views/error.html","Received invalid messageObj.callbackID that could not be resolved to a request! This should not happen and indicates a bad server response! The invalid callbackID was: "+c.callbackID)}function q(){var a=l.new();return a}function r(a){z=!0,b.$apply(y.resolve(a))}function s(a){try{var c=angular.fromJson(a.data);p(c)}catch(c){o.open("views/error.html","Got non-JSON string as message from server! This is not allowed! The message was: "+a.data+" which caused the angular.fromJson error: "+c).then(function(){w.closeConnect(),b.$broadcast("resetToInitState")})}}function t(a){console.error("WEBSOCKET ERROR!!!!!"),b.$apply(y.resolve(a))}function u(a){!a.wasClean&&z&&o.open("views/error.html","A non clean disconnect to the server occurred! This probably means that the server is down. Please check the server and reconnect!").then(function(){b.$broadcast("connectionDisrupted")}),z=!1}function v(b){var c=a.defer(),e=q();return x[e]={time:new Date,cb:c},b.callbackID=e,w.ws.send(angular.toJson(b)),d(function(){var a={callbackID:e,status:{type:"ERROR:TIMEOUT",message:"Sent request of type: "+b.type+" timed out after "+g.vals.main.serverTimeoutInterval+"ms!  Please check the server..."}};p(a)},g.vals.main.serverTimeoutInterval),c.promise}var w={},x={};w.ws={};var y={},z=!1;return w.initConnect=function(b){var c=a.defer();try{w.ws=new WebSocket(b),w.ws.onopen=r,w.ws.onmessage=s,w.ws.onerror=t,w.ws.onclose=u}catch(b){return a.reject("A malformed websocket URL that does not start with ws:// or wss:// was provided.")}return y=c,c.promise},w.isConnected=function(){return z},w.closeConnect=function(){w.isConnected()&&(w.ws.onclose=function(){},w.ws.close())},w.getProtocol=function(){var a={type:"GETPROTOCOL"},b=v(a);return b},w.getDoUserManagement=function(){var a={type:"GETDOUSERMANAGEMENT"},b=v(a);return b},w.logOnUser=function(a,b){var c={type:"LOGONUSER",userName:a,pwd:b},d=v(c);return d},w.getDBconfigFile=function(){var a={type:"GETGLOBALDBCONFIG"},b=v(a);return b},w.getBundleList=function(){var a={type:"GETBUNDLELIST"},b=v(a);return b},w.getBundle=function(a,b){var c={type:"GETBUNDLE",name:a,session:b},d=v(c);return d},w.saveBundle=function(a){var b={type:"SAVEBUNDLE",data:a},c=v(b);return c},w.saveConfiguration=function(a){var b={type:"SAVEDBCONFIG",data:a},c=v(b);return c},w.disconnectWarning=function(){var a={type:"DISCONNECTWARNING"},b=v(a);return b},w.getDoEditDBConfig=function(){var a={type:"GETDOEDITDBCONFIG"},b=v(a);return b},w.editDBConfig=function(a,b){var c={type:"EDITDBCONFIG",subtype:a,data:b},d=v(c);return d},w}]),angular.module("emuwebApp").service("Binarydatamaniphelper",function(){var a={};return a.base64ToArrayBuffer=function(a){for(var b=window.atob(a),c=b.length,d=new Uint8Array(c),e=0;e<c;e++){var f=b.charCodeAt(e);d[e]=f}return d.buffer},a.arrayBufferToBase64=function(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;e<d;e++)b+=String.fromCharCode(c[e]);return window.btoa(b)},a}),angular.module("emuwebApp").service("Appcachehandler",["$http","modalService",function(a,b){var c={},d=window.applicationCache;return c.handleUpdatereadyEvent=function(){b.open("views/confirmModal.html","A new version of the EMU-WebApp is available and has already been downloaded and cached in your browser. Would you like to use it? CAUTION: A reload will delete all current changes... TIP: the next time you use the EMU-webApp you will automatically use the updated version)").then(function(a){a?(localStorage.removeItem("haveShownWelcomeModal"),d.swapCache(),window.location.reload()):localStorage.removeItem("haveShownWelcomeModal")})},d.addEventListener("updateready",c.handleUpdatereadyEvent,!1),c.checkForNewVersion=function(){0!==d.status&&3!==d.status&&(console.log("INFO: appCache.status: "+d.status),d.update())},c}]),angular.module("emuwebApp").controller("spectSettingsCtrl",["$scope","modalService","viewState","DataService","mathHelperService","Soundhandlerservice",function(a,b,c,d,e,f){a.vs=c,a.shs=f,a.windowOptions=Object.keys(a.vs.getWindowFunctions()),a.selWindowInfo={},a.selWindowInfo.name=Object.keys(a.vs.getWindowFunctions())[a.vs.spectroSettings.window-1],a.errorID=[],a.upperBoundary="",a.osciChannel=a.vs.osciSettings.curChannel,"number"==typeof a.shs.audioBuffer.numberOfChannels&&(a.osciAvailableChannels=Array.from(Array(a.shs.audioBuffer.numberOfChannels).keys())),a.modalVals={rangeFrom:a.vs.spectroSettings.rangeFrom,rangeTo:a.vs.spectroSettings.rangeTo,dynamicRange:a.vs.spectroSettings.dynamicRange,windowSizeInSecs:a.vs.spectroSettings.windowSizeInSecs,window:a.vs.spectroSettings.window,drawHeatMapColors:a.vs.spectroSettings.drawHeatMapColors,preEmphasisFilterFactor:a.vs.spectroSettings.preEmphasisFilterFactor,heatMapColorAnchors:a.vs.spectroSettings.heatMapColorAnchors,_fftN:512,_windowSizeInSamples:a.shs.audioBuffer.sampleRate*a.vs.spectroSettings.windowSizeInSecs},a.cursorInTextField=function(){a.vs.setEditing(!0),a.vs.setcursorInTextField(!0)},a.cursorOutOfTextField=function(){a.vs.setEditing(!1),a.vs.setcursorInTextField(!1)},a.calcWindowSizeInSamples=function(){a.modalVals._windowSizeInSamples=a.shs.audioBuffer.sampleRate*a.modalVals.windowSizeInSecs},a.calcFftN=function(){var b=e.calcClosestPowerOf2Gt(a.modalVals._windowSizeInSamples);b<512&&(b=512),a.modalVals._fftN=b},a.calcWindowSizeVals=function(){a.calcWindowSizeInSamples(),a.calcFftN()},a.reset=function(){a.errorID=[],a.modalVals={rangeFrom:a.vs.spectroSettings.rangeFrom,rangeTo:a.vs.spectroSettings.rangeTo,dynamicRange:a.vs.spectroSettings.dynamicRange,windowSizeInSecs:a.vs.spectroSettings.windowSizeInSecs,window:a.vs.spectroSettings.window,drawHeatMapColors:a.vs.spectroSettings.drawHeatMapColors,preEmphasisFilterFactor:a.vs.spectroSettings.preEmphasisFilterFactor,heatMapColorAnchors:a.vs.spectroSettings.heatMapColorAnchors,_fftN:512,_windowSizeInSamples:a.shs.audioBuffer.sampleRate*a.vs.spectroSettings.windowSizeInSecs},b.close()},a.cssError=function(b,c){return a.errorID[b]?{background:"#f00"}:void 0!==c&&a.errorID[c]?{background:"#f00"}:void 0},a.htmlError=function(b){return a.errorID[b]},a.saveSettings=function(){var b=!1;a.errorID.forEach(function(a){a===!0&&(b=!0)}),b||(a.vs.setspectroSettings(a.modalVals.windowSizeInSecs,a.modalVals.rangeFrom,a.modalVals.rangeTo,a.modalVals.dynamicRange,a.selWindowInfo.name,a.modalVals.drawHeatMapColors,a.modalVals.preEmphasisFilterFactor,a.modalVals.heatMapColorAnchors),a.vs.setOsciSettings(a.osciChannel),a.reset())},a.checkSpectroSettings=function(){a.modalVals.heatMapColorAnchors[0][0]%1!==0||a.modalVals.heatMapColorAnchors[0][1]%1!==0||a.modalVals.heatMapColorAnchors[0][2]%1!==0||a.modalVals.heatMapColorAnchors[1][0]%1!==0||a.modalVals.heatMapColorAnchors[1][1]%1!==0||a.modalVals.heatMapColorAnchors[1][2]%1!==0||a.modalVals.heatMapColorAnchors[2][0]%1!==0||a.modalVals.heatMapColorAnchors[2][1]%1!==0||a.modalVals.heatMapColorAnchors[2][2]%1!==0?a.errorID[8]=!0:a.errorID[8]=!1,isNaN(a.modalVals.preEmphasisFilterFactor*f.audioBuffer.sampleRate)?a.errorID[7]=!0:a.errorID[7]=!1,isNaN(f.audioBuffer.sampleRate*a.modalVals.windowSizeInSecs)?a.errorID[6]=!0:a.errorID[6]=!1,a.modalVals.dynamicRange%1!==0?a.errorID[5]=!0:a.errorID[5]=!1,a.modalVals.rangeFrom%1!==0?a.errorID[4]=!0:a.errorID[4]=!1,a.modalVals.rangeTo%1!==0?a.errorID[3]=!0:a.errorID[3]=!1,a.modalVals.rangeFrom<0?a.errorID[2]=!0:a.errorID[2]=!1,a.upperBoundary=d.data.sampleRate/2,a.modalVals.rangeTo>a.upperBoundary?a.errorID[1]=!0:a.errorID[1]=!1}}]),angular.module("emuwebApp").controller("searchAnnotCtrl",["$scope","modalService","viewState","HierarchyLayoutService","LevelService","loadedMetaDataService","ConfigProviderService","StandardFuncsService","DataService",function(a,b,c,d,e,f,g,h,i){a.vs=c,a.hierPaths=d.findAllNonPartialPaths(),a.curHierPathIdx=0,a.curLevels=a.hierPaths.possible[a.curHierPathIdx],a.curLevel=a.curLevels[a.curHierPathIdx],a.curAttrIdx=0,a.curAttrDefs=g.getAttrDefsNames(a.curLevel),a.curAttrDef=a.curAttrDefs[0],a.searchString="",a.useRegExSearch=!1,a.resultTimeAnchors=[],a.changedHierPath=function(){a.curLevels=a.hierPaths.possible[a.curHierPathIdx],a.curLevel=a.curLevels[0],a.curAttrDefs=g.getAttrDefsNames(a.curLevel),a.curAttrDef=a.curAttrDefs[0]},a.changedLevel=function(){
a.curAttrDefs=g.getAttrDefsNames(a.curLevel),a.curAttrDef=a.curAttrDefs[0],a.curAttrIdx=a.curAttrDefs.indexOf(a.curAttrDef)},a.changedAttrDef=function(){a.curAttrIdx=a.curAttrDefs.indexOf(a.curAttrDef)},a.cursorInTextField=function(){c.setEditing(!0),c.setcursorInTextField(!0)},a.cursorOutOfTextField=function(){c.setEditing(!1),c.setcursorInTextField(!1)},a.search=function(){d.findParents(a.hierPaths.possible[a.curHierPathIdx]);var b=e.getLevelDetails(a.curLevel);a.resultTimeAnchors=[];for(var c=0;c<b.items.length;c++)a.useRegExSearch?b.items[c].labels[a.curAttrIdx].value.match(a.searchString)&&a.resultTimeAnchors.push({label:b.items[c].labels[a.curAttrIdx].value,sample_start:b.items[c]._derivedSampleStart,sample_end:b.items[c]._derivedSampleEnd}):b.items[c].labels[a.curAttrIdx].value===a.searchString&&a.resultTimeAnchors.push({label:b.items[c].labels[a.curAttrIdx].value,sample_start:b.items[c]._derivedSampleStart,sample_end:b.items[c]._derivedSampleEnd})},a.saveTimeAnchors=function(){f.setTimeAnchors(a.resultTimeAnchors),h.traverseAndClean(i.getData()),b.close()}}]),angular.module("emuwebApp").filter("regex",function(){return function(a,b){for(var c=new RegExp(b.toLowerCase()),d=[],e=0;e<a.length;e++)c.test(a[e].name.toLowerCase())&&d.push(a[e]);return d}}),angular.module("emuwebApp").filter("levelsFilter",["ConfigProviderService","viewState",function(a,b){return function(c){if(c){for(var d,e=new RegExp("SEGMENT|EVENT"),f=[],g=0;g<c.length;g++)e.test(c[g].type)&&void 0!==a.vals.perspectives[b.curPerspectiveIdx].levelCanvases&&(d=a.vals.perspectives[b.curPerspectiveIdx].levelCanvases.order.indexOf(c[g].name),d!==-1&&f.push(c[g]));return f}}}]),angular.module("emuwebApp").controller("ModalCtrl",["$scope","ArrayHelperService","browserDetector","modalService","viewState","LevelService","HistoryService","ConfigProviderService",function(a,b,c,d,e,f,g,h){a.cps=h,a.vs=e,a.data=void 0,a.mySelect=null,a.cursorInTextField=function(){e.setEditing(!0),e.setcursorInTextField(!0)},a.cursorOutOfTextField=function(){e.setEditing(!1),e.setcursorInTextField(!1)},a.saveChanges=function(){d.close()},a.discardChanges=function(){d.close()},a.saveURL=function(){var b=a.getURLs();b.indexOf(d.dataOut)===-1&&b.push(d.dataOut),localStorage.setItem("urls",JSON.stringify(b)),a.myUrls=b,a.mySelect=a.myUrls[0]},a.getURLs=function(){var a=localStorage.getItem("urls"),b=[];return c.isBrowser.PhantomJS()||null===a||(b=JSON.parse(a)),b},a.setCurrentURL=function(a){d.dataOut=a},a.deleteURL=function(b){var c=a.getURLs();c.indexOf(b)!==-1&&c.splice(c.indexOf(b),1),localStorage.setItem("urls",JSON.stringify(c)),a.myUrls=c,a.mySelect=a.myUrls[0]},a.renameLevel=function(){f.renameLevel(d.dataIn,a.data,e.curPerspectiveIdx),g.addObjToUndoStack({type:"ANNOT",action:"RENAMELEVEL",newname:a.data,name:d.dataIn,curPerspectiveIdx:e.curPerspectiveIdx}),d.close()},a.deleteLevel=function(){var a=f.getLevelDetails(e.getcurClickLevelName());f.deleteLevel(e.getcurClickLevelIndex(),e.curPerspectiveIdx),g.addObjToUndoStack({type:"ANNOT",action:"DELETELEVEL",level:a,id:e.getcurClickLevelIndex(),curPerspectiveIdx:e.curPerspectiveIdx}),d.close()}}]),angular.module("emuwebApp").directive("showMenu",["$animate",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.showMenu,function(b){b?(a.addClass(c,"emuwebapp-expandWidthTo200px"),a.removeClass(c,"emuwebapp-shrinkWidthTo0px")):(a.removeClass(c,"emuwebapp-expandWidthTo200px"),a.addClass(c,"emuwebapp-shrinkWidthTo0px"))})}}}]),angular.module("emuwebApp").directive("bgSplitter",["$rootScope","viewState",function(a,b){return{restrict:"E",replace:!0,transclude:!0,scope:{showTwoDimCans:"@"},template:'<div class="emuwebapp-split-panes vertical" ng-transclude></div>',controller:["$scope",function(a){a.panes=[],a.bottomRightResizePane=void 0,this.addPane=function(b){if(a.panes.length>1)throw"splitters can only have two panes";return a.panes.push(b),a.panes.length},this.setBottomRightResizePane=function(b){a.bottomRightResizePane=b}}],link:function(c,d,e){var f=!1,g=!1,h=!1,i=angular.element('<div id="emuwebapp-split-handler" class="emuwebapp-split-handler"><span></span></div>'),j=c.panes[0],k=c.panes[1],l=c.bottomRightResizePane,m=angular.element('<div class="topBorder"></div>'),n=angular.element('<div class="leftBorder"></div>'),o=angular.element('<div class="corner"></div>');l.elem.prepend(n),l.elem.prepend(m),l.elem.prepend(o);var p=j.minSize||0,q=k.minSize||0,r=!1,s=!1;j.elem.after(i),e.$observe("showTwoDimCans",function(a){"false"===a?c.bottomRightResizePane.elem.hide():c.bottomRightResizePane.elem.show()}),d.bind("mousemove",function(c){if(s){k.elem[0].scrollHeight>k.elem[0].clientHeight+1?j.elem.css("overflow-y","scroll"):j.elem.css("overflow-y","hidden");var e,m,n,o=d[0].getBoundingClientRect(),t=0;if(r){if(e=o.bottom-o.top,t=c.clientY-o.top,t<p)return;if(e-t<q)return;i.css("top",t+"px"),j.elem.css("height",t+"px"),k.elem.css("top",t+"px"),b.setdragBarHeight(t),a.$digest()}if(f){if(e=o.bottom-o.top,t=c.clientY-o.top,t<=10||e-t<=10)return;l.elem.css("top",t+"px"),n=e-t,l.elem.css("height",n+"px")}if(g){if(m=o.right-o.left,t=c.clientX-o.left,t<=10||m-t<=10)return;n=m-t,l.elem.css("width",n+"px")}if(h){if(e=o.bottom-o.top,t=c.clientY-o.top,t<=10||e-t<=10)return;if(l.elem.css("top",t+"px"),n=e-t,l.elem.css("height",n+"px"),m=o.right-o.left,t=c.clientX-o.left,t<=10||m-t<=10)return;n=m-t,l.elem.css("width",n+"px")}}}),i.bind("mousedown",function(c){c.preventDefault(),s=!0,r=!0,b.setdragBarActive(!0),a.$digest()}),m.bind("mousedown",function(c){c.preventDefault(),s=!0,f=!0,b.setdragBarActive(!0),a.$digest()}),n.bind("mousedown",function(c){c.preventDefault(),s=!0,g=!0,b.setdragBarActive(!0),a.$digest()}),o.bind("mousedown",function(c){c.preventDefault(),s=!0,h=!0,b.setdragBarActive(!0),a.$digest()}),angular.element(document).bind("mouseup",function(){s=!1,r=!1,f=!1,g=!1,h=!1,b.setdragBarActive(!1),a.$digest()})}}}]).directive("bgPane",function(){return{restrict:"E",require:"^bgSplitter",replace:!0,transclude:!0,scope:{minSize:"=",type:"@",showTwoDimCans:"@"},template:'<div class="{{typeclass}}" ng-transclude></div>',link:function(a,b,c,d){"emuwebapp-2d-map"!==a.type?(a.elem=b,a.index=d.addPane(a),a.typeclass="split-pane"+a.index):(a.elem=b,a.index=3,a.typeclass="emuwebapp-2d-map",d.setBottomRightResizePane(a))}}}),angular.module("emuwebApp").directive("ssffTrack",["$timeout","viewState","ConfigProviderService","loadedMetaDataService","Drawhelperservice",function(a,b,c,d,e){return{templateUrl:"views/ssffTrack.html",restrict:"E",link:function(f,g,h){var i,j=g.find("canvas").length,k=g.find("canvas")[j-1],l=k.getContext("2d");f.lmds=d,h.$observe("trackName",function(a){a&&(i=a)}),f.order=h.order,f.$watch("vs.lastUpdate",function(a,b){a!==b&&f.drawSsffTrackMarkup()}),f.$watch("vs.timelineSize",function(){a(f.drawSsffTrackMarkup,c.design.animation.duration)}),f.$watch("vs.curViewPort",function(){$.isEmptyObject(f.shs)||$.isEmptyObject(f.shs.audioBuffer)||f.drawSsffTrackMarkup()},!0),f.$watch("ssffds.data.length",function(){$.isEmptyObject(f.shs)||$.isEmptyObject(f.shs.audioBuffer)||f.drawSsffTrackMarkup()},!0),f.$watch("vs.movingBoundary",function(){$.isEmptyObject(f.shs)||$.isEmptyObject(f.shs.audioBuffer)||f.drawSsffTrackMarkup()},!0),f.$watch("vs.movingBoundarySample",function(){$.isEmptyObject(f.shs)||$.isEmptyObject(f.shs.audioBuffer)||f.drawSsffTrackMarkup()},!0),f.$watch("vs.curMouseX",function(){$.isEmptyObject(f.shs)||$.isEmptyObject(f.shs.audioBuffer)||b.curMouseTrackName!==i&&f.drawSsffTrackMarkup()},!0),f.$watch("lmds.getCurBndl()",function(a,b){$.isEmptyObject(f.shs)||$.isEmptyObject(f.shs.audioBuffer)||a.name===b.name&&a.session===b.session||f.drawSsffTrackMarkup()},!0),f.drawSsffTrackMarkup=function(){if(!$.isEmptyObject(f.ssffds.data)&&0!==f.ssffds.data.length){l.clearRect(0,0,l.canvas.width,l.canvas.height),f.dhs.drawMovingBoundaryLine(l),f.dhs.drawCurViewPortSelected(l,!1);var a,c,d=f.cps.getSsffTrackConfig(i),g=f.ssffds.getColumnOfTrack(d.name,d.columnName),h=f.cps.getValueLimsOfTrack(d.name);angular.equals(h,{})?(a=g._minVal,c=g._maxVal):(a=h.minVal,c=h.maxVal),f.dhs.drawMinMaxAndName(l,i,a,c,2),e.drawCrossHairX(l,b.curMouseX)}}}}}]),angular.module("emuwebApp").directive("progressThing",["$animate",function(a){return{template:'<div class="emuwebapp-progressThing">{{vs.somethingInProgressTxt}}</div>',restrict:"E",replace:!0,link:function(b,c,d){d.$observe("showThing",function(b){"true"===b?(a.removeClass(c,"emuwebapp-shrinkHeightTo0px"),a.removeClass(c,"emuwebapp-animationStopped"),a.addClass(c,"emuwebapp-expandHeightTo20px"),a.addClass(c,"emuwebapp-animationRunning")):(a.removeClass(c,"emuwebapp-expandHeightTo20px"),a.removeClass(c,"emuwebapp-animationRunning"),a.addClass(c,"emuwebapp-shrinkHeightTo0px"),a.addClass(c,"emuwebapp-animationStopped"))})}}}]),angular.module("emuwebApp").directive("historyActionPopup",["$animate","$timeout","ConfigProviderService",function(a,b,c){return{template:'<div class="emuwebapp-history"><div ng-bind-html="vs.historyActionTxt"></div></div>',restrict:"E",replace:!0,link:function(d,e){d.cps=c,d.$watch("vs.historyActionTxt",function(){""!==d.vs.historyActionTxt&&a.addClass(e,"emuwebapp-history-fade").then(function(){b(function(){a.removeClass(e,"emuwebapp-history-fade").then(function(){b(function(){d.vs.historyActionTxt=""},d.cps.design.animation.period)})},d.cps.design.animation.period)})},!0)}}}]),angular.module("emuwebApp").directive("dragout",["DataService","loadedMetaDataService","browserDetector","ConfigProviderService",function(a,b,c,d){return{restrict:"A",replace:!0,scope:{name:"@"},link:function(e,f,g){e.cps=d;var h=f[0];e.generateURL=function(){return e.getURL(angular.toJson(a.getData(),!0))},e.isActive=function(){return g.name===b.getCurBndl().name},e.getURL=function(a){var b;return b="object"!=typeof URL&&"undefined"!=typeof webkitURL?webkitURL.createObjectURL(e.getBlob(a)):URL.createObjectURL(e.getBlob(a))},e.getBlob=function(a){var b;try{b=new Blob([a],{type:"text/plain"})}catch(c){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,b=new BlobBuilder,b.append(a),b=b.getBlob()}return b},h.addEventListener("dragstart",function(a){if(e.isActive()){this.classList.add("drag");var b=e.generateURL();(c.isBrowser.Firefox()||c.isBrowser.Chrome())&&void 0!==a.dataTransfer&&a.dataTransfer.setData("DownloadURL","application/json:"+g.name+"_annot.json:"+b)}else a.preventDefault();return!1},!1),h.addEventListener("dragend",function(a){return e.isActive()&&(this.classList.remove("drag"),a.preventDefault()),!1},!1)}}}]),angular.module("emuwebApp").directive("emuhierarchy",["viewState","HistoryService","DataService","LevelService","HierarchyManipulationService","HierarchyLayoutService","Soundhandlerservice","ConfigProviderService","$timeout",function(a,b,c,d,e,f,g,h,i){return{template:'<div class="emuwebapp-hierarchy-container" ng-mousemove="checkLink($event)"></div>',restrict:"E",scope:{vertical:"=",playing:"="},replace:!0,link:function(j,k){j.offsetX=25,j.offsetY=30,j.vertOffsetX=150,j.vertOffsetY=25,j.transition={duration:750,links:!1,nodes:!1,rotation:!1,contextMenu:!1},j.scaleExtent=[.5,10],j.panningLimit=.95,j.allowCrossAxisZoom=!1,j.allowCrossAxisPan=!1,j.timeAxisStartPosition=void 0,j.timeAxisEndPosition=void 0,j.crossAxisStartPosition=void 0,j.crossAxisEndPosition=void 0,j.northernBoundary=void 0,j.southernBoundary=void 0,j.westernBoundary=void 0,j.easternBoundary=void 0,j.zoomTimeoutPromise=null,j.lastScaleFactor=1,j.viewState=a,j.hierarchyState=a.hierarchyState,j.historyService=b,j.cps=h,j.$watch("hierarchyState.path",function(a,b){a!==b&&(console.debug("Rendering due to path change: ",a),j.hierarchyState.newLinkFromID=void 0,j.render())},!1),j.$watch("vertical",function(a,b){a!==b&&(console.debug("Rendering due to rotation: ",a),j.rotate())},!1),j.$watch("viewState.curLevelAttrDefs",function(a,b){a!==b&&(console.debug("Rendering due to attribute change: ",a),j.render())},!0),j.$watch("playing",function(a,b){a!==b&&(console.debug("Play() triggered",a,j.selectedItem),"undefined"!=typeof j.selectedItem&&0!==a&&j.play(j.selectedItem))},!0),j.$watch("historyService.movesAwayFromLastSave",function(a,b){a!==b&&(console.debug("history service is active, rendering"),j.render())},!1),j.$watch("hierarchyState.newLinkFromID",function(a,b){a!==b&&(j.newLinkSrc=d.getItemByID(a),j.render())},!1),j.$watch("viewState.hierarchyState.isShown()",function(a){a===!0&&(console.debug("Hierarchy modal activated, rendering"),j.render())},!1),j.$watch("hierarchyState.contextMenuID",function(a,b){a!==b&&j.render()},!1),j.$watch("hierarchyState.resize",function(a,b){console.debug("Rendering due to window resize"),a!==b&&j.render()},!1),j.selectItem=function(b){j.selectedItem=b,a.hierarchyState.selectedItemID=b.id},j.selectLink=function(b){j.selectedLink=b,a.hierarchyState.selectedLinkFromID=b.fromID,a.hierarchyState.selectedLinkToID=b.toID},j.zoom=function(){j.limitPanning(),a.hierarchyState.translate=j.zoomListener.translate(),a.hierarchyState.scaleFactor=j.zoomListener.scale(),j.svg.attr("transform",j.getOrientatedTransform(!0)),j.captionLayer.attr("transform",j.getOrientatedLevelCaptionLayerTransform),j.captionLayer.selectAll("g.emuhierarchy-levelcaption").attr("transform",j.getOrientatedLevelCaptionTransform),null!==j.zoomTimeoutPromise&&(i.cancel(j.zoomTimeoutPromise),j.zoomTimeoutPromise=null),j.zoomTimeoutPromise=i(j.render,200)},j.limitPanning=function(){var a=j.zoomListener.translate()[0],b=j.zoomListener.translate()[1];j.vertical?(j.allowCrossAxisPan?(b>j.southernBoundary-j.crossAxisStartPosition&&(b=j.southernBoundary-j.crossAxisStartPosition),b<j.northernBoundary-j.crossAxisEndPosition&&(b=j.northernBoundary-j.crossAxisEndPosition)):b=0,a>j.easternBoundary-j.timeAxisStartPosition&&(a=j.easternBoundary-j.timeAxisStartPosition),a<j.westernBoundary-j.timeAxisEndPosition&&(a=j.westernBoundary-j.timeAxisEndPosition)):(j.allowCrossAxisPan?(a>j.easternBoundary-j.crossAxisStartPosition&&(a=j.easternBoundary-j.crossAxisStartPosition),a<j.westernBoundary-j.crossAxisEndPosition&&(a=j.westernBoundary-j.crossAxisEndPosition)):a=0,b>j.southernBoundary-j.timeAxisStartPosition&&(b=j.southernBoundary-j.timeAxisStartPosition),b<j.northernBoundary-j.timeAxisEndPosition&&(b=j.northernBoundary-j.timeAxisEndPosition)),j.zoomListener.translate([a,b])},j.rotate=function(){var a,b,c=j.zoomListener.translate();j.vertical===!0?(a=c[1]/j.timeAxisEndPosition,b=c[0]/j.crossAxisEndPosition):(a=c[0]/j.timeAxisEndPosition,b=c[1]/j.crossAxisEndPosition),j.render(),a*=j.timeAxisEndPosition,b*=j.crossAxisEndPosition,j.vertical===!0?j.zoomListener.translate([a,b]):j.zoomListener.translate([b,a]),j.limitPanning(),j.zoomListener.event(j.svg)},j.getOrientatedTransform=function(a){var b="";if(j.vertical?(b+="translate("+j.zoomListener.translate()[0]+","+j.zoomListener.translate()[1]+")",b+="scale(-1,1),rotate(90)"):(b+="translate("+j.zoomListener.translate()[0]+","+j.zoomListener.translate()[1]+")",b+="rotate(0)"),a===!0){var c=j.zoomListener.scale()/j.lastScaleFactor;b+=j.allowCrossAxisZoom?"scale("+c+")":"scale(1,"+c+")"}return b},j.getOrientatedNodeTransform=function(){return j.vertical?"scale(-1,1)rotate(90)":"rotate(0)"},j.getOrientatedLinkStrokeWidth=function(){return"2px"},j.getOrientatedGhostLinkStrokeWidth=function(){return"15px"},j.getNodeText=function(b){for(var c=a.getCurAttrDef(d.getLevelName(b.id)),e=0;e<b.labels.length;++e)if(b.labels[e].name===c)return b.labels[e].value;return console.debug("Likely a bug: Did not find the label selected for display","Selected level:",c,"Node: ",b),"NO VALUE"},j.getLevelCaptionText=function(b){var c=a.getCurAttrDef(b);return b===c?b:b+":"+c},j.getOrientatedNodeCollapseText=function(b){return j.vertical?a.hierarchyState.getCollapsed(b.id)?"↓":"↑":a.hierarchyState.getCollapsed(b.id)?"→":"←"},j.getOrientatedTextTransform=function(){},j.getOrientatedTextAnchor=function(){return j.vertical?"middle":"begin"},j.getOrientatedTextX=function(){return j.vertical?0:10},j.getOrientatedTextY=function(){return j.vertical?"1.45em":"0.35em"},j.getOrientatedLevelCaptionLayerTransform=function(){return j.vertical?"translate(0, "+j.zoomListener.translate()[1]+")":"translate("+j.zoomListener.translate()[0]+", 0)"},j.getOrientatedLevelCaptionTransform=function(b){var c=angular.copy(a.hierarchyState.path).reverse();return j.vertical?"translate(25, "+j.depthToX(c.indexOf(b))+")":"translate("+j.depthToX(c.indexOf(b))+", 20)"},j.getOrientatedAddItemButtonTransform=function(){return j.vertical,"translate(-12, -5)"},j.getOrientatedTimeLevelBackgroundTransform=function(){return j.vertical?"translate("+(j.vertOffsetX-25)+",-8)":"translate(-8,"+(j.offsetY-20)+")"},j.getOrientatedTimeLevelBackgroundWidth=function(){return j.vertical?"100%":"15px"},j.getOrientatedTimeLevelBackgroundHeight=function(){return j.vertical?"15px":"100%"},j.getOrientatedMousePosition=function(a){return j.vertical?[a[1]-j.zoomListener.translate()[1],a[0]-j.zoomListener.translate()[0]]:[a[0]-j.zoomListener.translate()[0],a[1]-j.zoomListener.translate()[1]]},j.getPath=function(a){return"M"+a._fromX+" "+a._fromY+"Q"+a._fromX+" "+a._toY+" "+a._toX+" "+a._toY},j.getPreviewPath=function(){var a={x:j.newLinkSrc._x,y:j.newLinkSrc._y},b={x:j.selectedItem._x,y:j.selectedItem._y};return"M"+a.x+" "+a.y+"Q"+a.x+" "+b.y+" "+b.x+" "+b.y},j.getPreviewColor=function(){var b=e.checkLinkValidity(a.hierarchyState.path,j.newLinkSrc.id,j.selectedItem.id);return b.valid?"green":3===b.reason&&(b=e.checkLinkValidity(a.hierarchyState.path,j.selectedItem.id,j.newLinkSrc.id),b.valid)?"green":"red"},j.getLabelLegalnessColor=function(b){var c=j.svg.select(".emuhierarchy-contextmenu input")[0][0],e=d.getLevelName(b.id),f=a.getCurAttrIndex(e),g=j.cps.getLevelDefinition(e).attributeDefinitions[f].legalLabels;return void 0===g||c.value.length>0&&g.indexOf(c.value)>=0?"lightgreen":"red"},j.svgOnMouseMove=function(){if(void 0!==j.newLinkSrc){var a=j.getOrientatedMousePosition(d3.mouse(this)),b=a[0],c=a[1];j.svg.select("path.emuhierarchy-newlink").attr("d","M"+j.newLinkSrc._x+","+j.newLinkSrc._y+" L"+b+","+c)}},j.svgOnClick=function(){void 0!==a.hierarchyState.contextMenuID&&j.$apply(function(){a.hierarchyState.contextMenuID=void 0})},j.nodeOnClick=function(b){console.debug("Clicked node",b),void 0===a.hierarchyState.contextMenuID&&(d3.event.stopPropagation(),a.hierarchyState.contextMenuID=b.id,a.hierarchyState.setEditValue(j.getNodeText(b)),j.$apply(function(){j.render()})),a.hierarchyState.contextMenuID===b.id&&d3.event.stopPropagation()},j.nodeOnPlayClick=function(a){j.play(a)},j.nodeOnCollapseClick=function(b){console.debug("collapsing",b),f.toggleCollapse(b,a.hierarchyState.path),j.render()},j.nodeOnMouseOver=function(a){j.selectItem(a),j.renderSelectionOnly()},j.nodeOnInput=function(b){var c=j.svg.select(".emuhierarchy-contextmenu input")[0][0];a.hierarchyState.setEditValue(c.value),c.style.backgroundColor=j.getLabelLegalnessColor(b)},j.nodeOnFocusIn=function(){a.hierarchyState.inputFocus=!0},j.nodeOnFocusOut=function(){a.hierarchyState.inputFocus=!1},j.linkOnMouseOver=function(a){j.selectLink(a),j.renderSelectionOnly()},j.addButtonOnClick=function(a){var b=d.pushNewItem(a);b!==-1&&j.historyService.addObjToUndoStack({type:"HIERARCHY",action:"PUSHITEM",newID:b,level:a}),j.$apply()},j.play=function(b){var c=a.hierarchyState.path[0];if("undefined"==typeof c)return void console.debug("Likely a bug: There is no path selection. Not executing play():",b);for(var e,h=d.getLevelDetails(c).type,i=null,j=null,k=[b];k.length>0;){if(e=k.pop(),e.labels[0].name===c)if("EVENT"===h)(e.samplePoint<i||null===i)&&(i=e.samplePoint),(e.samplePoint>j||null===j)&&(j=e.samplePoint);else if("SEGMENT"===h){(e.sampleStart<i||null===i)&&(i=e.sampleStart);var l=e.sampleStart+e.sampleDur;(l>j||null===j)&&(j=l)}k=k.concat(f.findChildren(e,a.hierarchyState.path))}return console.debug("Node info for playback: ",h,b,i,j),null===i||null===j?void console.debug("No time information found for node, aborting playback",b):void g.playFromTo(i,j)},j.depthToX=function(b){var c,d;j.vertical?(c=j.height,d=j.vertOffsetY):(c=j.width,d=j.offsetX);var e=b/a.hierarchyState.path.length*c;return j.allowCrossAxisZoom&&(e*=j.zoomListener.scale()),e+=d},j.posInLevelToY=function(a){var b,c;j.vertical?(b=j.vertOffsetX,c=j.width-b):(b=j.offsetY,c=j.height-b);var d=a*c*j.zoomListener.scale();return d+=b},j.element=k,j.width=0,j.height=0,j.background="",void 0!==j.cps.design.color&&(j.background=j.cps.design.color.lightGrey),j.zoomListener=d3.behavior.zoom().scaleExtent(j.scaleExtent).on("zoom",j.zoom),j.svg=d3.select(k[0]).append("svg").attr("width","100%").attr("height","100%").style("background-color",j.background).call(j.zoomListener).on("dblclick.zoom",null).on("mousemove",j.svgOnMouseMove).on("click",j.svgOnClick).append("g"),j.shiftMode=!1,j.checkLink=function(c){if(c.shiftKey&&!j.shiftMode&&void 0===a.hierarchyState.newLinkFromID&&(a.hierarchyState.newLinkFromID=a.hierarchyState.selectedItemID,j.shiftMode=!0),!c.shiftKey&&j.shiftMode){j.shiftMode=!1;var d=e.addLink(a.hierarchyState.path,a.hierarchyState.newLinkFromID,a.hierarchyState.selectedItemID);a.hierarchyState.newLinkFromID=void 0,null!==d&&b.addObjToUndoStack({type:"HIERARCHY",action:"ADDLINK",link:d})}},j.captionLayer=j.svg.append("g").style("z-index",5),j.timeArrow=j.svg.append("g").append("text").text("time →"),j.scaleFactorDisplay=j.svg.append("g"),j.scaleFactorDisplay.append("text"),j.svg=j.svg.append("g").style("z-index",1),j.zoomListener.translate(a.hierarchyState.translate),j.zoomListener.scale(a.hierarchyState.scaleFactor),j.renderSelectionOnly=function(){j.svg.selectAll("circle.emuhierarchy-nodeCircle").style("fill",function(a){var b=h.design.color.white;return"undefined"!=typeof j.selectedItem&&a.id===j.selectedItem.id&&(b=h.design.color.blue),b}),j.svg.selectAll("path.emuhierarchy-link").style("stroke",function(a){return j.selectedLink===a?h.design.color.yellow:h.design.color.grey}),j.svg.select(".emuhierarchy-newlinkpreview").attr("d",j.getPreviewPath).style("stroke",j.getPreviewColor)},j.render=function(){j.lastScaleFactor=j.zoomListener.scale();var b;j.width=parseInt(d3.select(j.element[0]).style("width"),10),j.height=parseInt(d3.select(j.element[0]).style("height"),10),j.transition.rotation?j.svg.transition().duration(j.transition.duration).attr("transform",j.getOrientatedTransform()):j.svg.attr("transform",j.getOrientatedTransform()),j.vertical?j.timeArrow.attr("transform","translate("+j.width/2+","+(j.height-10)+")"):j.timeArrow.attr("transform","translate("+(j.width-20)+","+j.height/2+")rotate(90)"),j.vertical?(j.scaleFactorDisplay.attr("transform","translate("+j.width+", 20)"),j.scaleFactorDisplay.select("text").attr("text-anchor","end").text("Zoom: "+Math.round(100*j.zoomListener.scale())+" %")):(j.scaleFactorDisplay.attr("transform","translate(0, "+j.height+")"),j.scaleFactorDisplay.select("text").attr("text-anchor","start").text("Zoom: "+Math.round(100*j.zoomListener.scale())+" %")),j.captionLayer.attr("transform",j.getOrientatedLevelCaptionLayerTransform);var e=j.captionLayer.selectAll("g.emuhierarchy-levelcaption").data(a.hierarchyState.path,function(a){return a}),g=e.enter(),h=e.exit();g=g.append("g").attr("class","emuhierarchy-levelcaption"),g.append("text");var i=g.filter(function(a){var b=d.getLevelDetails(a).type;return"ITEM"===b}).append("g").attr("class","emuhierarchy-addbutton").attr("transform",j.getOrientatedAddItemButtonTransform).on("click",j.addButtonOnClick);i.append("circle").style("fill",j.cps.design.color.blue).attr("r",8),i.append("path").style("stroke",j.cps.design.color.white).attr("d","M0,-6 V6 M-6,0 H6"),g.filter(function(a){var b=d.getLevelDetails(a).type;return"SEGMENT"===b||"EVENT"===b}).append("rect").attr("class","emuhierarchy-timelevelbackground").style("fill",j.cps.design.color.transparent.grey),e.attr("transform",j.getOrientatedLevelCaptionTransform),e.select("text").text(j.getLevelCaptionText),e.select(".emuhierarchy-timelevelbackground").attr("transform",j.getOrientatedTimeLevelBackgroundTransform).style("width",j.getOrientatedTimeLevelBackgroundWidth).style("height",j.getOrientatedTimeLevelBackgroundHeight),j.transition.rotation?h=h.transition().duration(j.transition.duration).remove():h.remove(),h.select("text").style("fill-opacity",0);var k=[];for(f.calculateWeightsBottomUp(a.hierarchyState.path),b=0;b<a.hierarchyState.path.length;++b)for(var l=d.getLevelDetails(a.hierarchyState.path[b]).items,m=0;m<l.length;++m)l[m]._visible&&k.push(l[m]);var n=d.getItemByID(a.hierarchyState.selectedItemID),o=d.getItemByID(a.hierarchyState.contextMenuID),p=d.getItemByID(a.hierarchyState.selectedLinkFromID),q=d.getItemByID(a.hierarchyState.selectedLinkToID);void 0===n||n._visible||(console.debug("Unselecting node"),a.hierarchyState.selectedItemID=void 0),void 0===p||p._visible||(console.debug("Unselecting link"),a.hierarchyState.selectedLinkFromID=void 0,a.hierarchyState.selectedLinkToID=void 0),void 0===q||q._visible||(console.debug("Unselecting link"),a.hierarchyState.selectedLinkFromID=void 0,a.hierarchyState.selectedLinkToID=void 0),void 0===o||o._visible||(console.debug("Closing context menu (node became invisible)"),a.hierarchyState.contextMenuID=void 0);for(var r=[],s=c.getData().links,t=0;t<s.length;++t)for(b=0;b<a.hierarchyState.path.length-1;++b){var u=d.getItemFromLevelById(a.hierarchyState.path[b],s[t].toID),v=d.getItemFromLevelById(a.hierarchyState.path[b+1],s[t].fromID);null!==u&&null!==v&&u._visible&&!a.hierarchyState.getCollapsed(v.id)&&v._visible&&r.push(s[t])}k.forEach(function(a){a._x=j.depthToX(a._depth),a._y=j.posInLevelToY(a._posInLevel)}),r.forEach(function(a){a._fromX=j.depthToX(a._fromDepth),a._fromY=j.posInLevelToY(a._fromPosInLevel),a._toX=j.depthToX(a._toDepth),a._toY=j.posInLevelToY(a._toPosInLevel)});var w=j.svg.selectAll("g.emuhierarchy-node").data(k,function(a){return a.id}),x=w.enter(),y=w.exit();x=x.append("g").attr("class","emuhierarchy-node").attr("pointer-events","mouseover").on("click",j.nodeOnClick).on("mouseover",j.nodeOnMouseOver);var z=x.append("circle").attr("class","emuhierarchy-nodeCircle").style("stroke",j.cps.design.color.grey);j.transition.nodes?z.attr("r",0).transition().duration(j.transition.duration).attr("r",4.5):z.attr("r",4.5),x.append("text").attr("class","emuhierarchy-nodeText"),x.attr("transform",function(b){var c=a.hierarchyState.getCollapsePosition(b.id);if("undefined"!=typeof c){var d=c[0],e=c[1];return a.hierarchyState.setCollapsePosition(b.id,void 0),"translate("+d+","+e+")"+j.getOrientatedNodeTransform()}}),y=j.transition.nodes?y.transition().duration(j.transition.duration).attr("transform",function(b){var c=a.hierarchyState.getCollapsePosition(b.id);if("undefined"!=typeof c){var d=c[0],e=c[1];return a.hierarchyState.setCollapsePosition(b.id,void 0),"translate("+d+","+e+")"}return"translate(0,0)"}).remove():y.attr("transform",function(b){var c=a.hierarchyState.getCollapsePosition(b.id);if("undefined"!=typeof c){var d=c[0],e=c[1];return a.hierarchyState.setCollapsePosition(b.id,void 0),"translate("+d+","+e+")"}return"translate(0,0)"}).remove(),y.select("text").style("fill-opacity",0),w.select("text").attr("x",j.getOrientatedTextX).attr("y",j.getOrientatedTextY).attr("text-anchor",j.getOrientatedTextAnchor).attr("transform",j.getOrientatedTextTransform).text(j.getNodeText),w.select("circle.emuhierarchy-nodeCircle").style("fill",function(a){var b=j.cps.design.color.white;return"undefined"!=typeof j.selectedItem&&a.id===j.selectedItem.id&&(b=j.cps.design.color.blue),b}).style("stroke",function(b){return a.hierarchyState.getCollapsed(b.id)?j.cps.design.color.red:j.cps.design.color.grey}),j.transition.nodes?w.transition().duration(j.transition.duration).attr("transform",function(a){return"translate("+a._x+","+a._y+")"+j.getOrientatedNodeTransform()}):w.attr("transform",function(a){return"translate("+a._x+","+a._y+")"+j.getOrientatedNodeTransform()}),void 0===a.hierarchyState.contextMenuID&&j.svg.selectAll(".emuhierarchy-contextmenu").remove();var A=j.svg.select(".emuhierarchy-contextmenu");if(null===A[0][0]){A=w.filter(function(b){return b.id===a.hierarchyState.contextMenuID}).append("g").attr("class","emuhierarchy-contextmenu"),A.append("circle").style("fill","darkgrey").attr("r",50).style("cursor","default"),j.transition.contextMenu&&A.style("opacity",0).transition().duration(j.transition.duration).style("opacity",.5),A.append("text").text(j.getOrientatedNodeCollapseText).attr("x",-25).attr("y",-25).attr("text-anchor","middle").on("click",j.nodeOnCollapseClick),j.transition.contextMenu&&A.style("opacity",0).transition().duration(j.transition.duration).style("opacity",1),A.append("text").text("play").attr("x",-25).attr("y",25).attr("text-anchor","middle").on("click",j.nodeOnPlayClick),j.transition.contextMenu&&A.style("opacity",0).transition().duration(j.transition.duration).style("opacity",1);var B=A.append("foreignObject").attr("height",30).attr("x",10).attr("y",-15).attr("width",0);j.transition.contextMenu?B.transition().duration(j.transition.duration).attr("width",100):B.attr("width",100),B.append("xhtml:body").append("input").attr("value",j.getNodeText).style("width","100%").style("height","100%").style("outline","none").style("border","0").style("background-color",j.getLabelLegalnessColor).on("input",j.nodeOnInput).on("focus",j.nodeOnFocusIn).on("blur",j.nodeOnFocusOut),0!==B[0].length&&(B.select("input")[0][0].focus(),B.select("input")[0][0].select())}else j.svg.select(".emuhierarchy-contextmenu text").text(j.getOrientatedNodeCollapseText);j.svg.selectAll(".emuhierarchy-node").sort(function(b,c){return b.id===a.hierarchyState.contextMenuID?1:c.id===a.hierarchyState.contextMenuID?-1:0});var C=j.svg.selectAll(".emuhierarchy-linkgroup").data(r,function(a){return"s"+a.fromID+"t"+a.toID}),D=C.enter(),E=C.exit();D=D.insert("g",":first-child").attr("class","emuhierarchy-linkgroup"),D.append("path").attr("class","emuhierarchy-ghostlink").style("stroke-width",j.getOrientatedGhostLinkStrokeWidth).on("mouseover",j.linkOnMouseOver),D.append("path").attr("class","emuhierarchy-link").style("stroke-width",j.getOrientatedLinkStrokeWidth),j.transition.links&&D.style("opacity",0).transition().duration(j.transition.duration).style("opacity",1),j.transition.links?E.transition().duration(j.transition.duration).style("opacity",0).remove():E.remove(),C.selectAll(".emuhierarchy-link").style("stroke",function(a){return j.selectedLink===a?j.cps.design.color.yellow:j.cps.design.color.grey}),j.transition.links?C.selectAll(".emuhierarchy-link").transition().duration(j.transition.duration).attr("d",j.getPath).style("stroke-width",j.getOrientatedLinkStrokeWidth).style("opacity",1):C.selectAll(".emuhierarchy-link").attr("d",j.getPath).style("stroke-width",j.getOrientatedLinkStrokeWidth),C.selectAll(".emuhierarchy-ghostlink").attr("d",j.getPath),j.svg.selectAll(".emuhierarchy-newlink").remove(),j.svg.selectAll(".emuhierarchy-newlinkpreview").remove(),void 0!==j.newLinkSrc&&j.svg.append("path").attr("class","emuhierarchy-newlink").style("stroke","black").style("stroke-width",j.getOrientatedLinkStrokeWidth),j.vertical?(j.northernBoundary=j.vertOffsetY+j.height*(1-j.panningLimit),j.southernBoundary=j.height*j.panningLimit,j.westernBoundary=j.vertOffsetX+j.width*(1-j.panningLimit),j.easternBoundary=j.width*j.panningLimit):(j.northernBoundary=j.offsetY+j.height*(1-j.panningLimit),j.southernBoundary=j.height*j.panningLimit,j.westernBoundary=j.offsetX+j.width*(1-j.panningLimit),j.easternBoundary=j.width*j.panningLimit),j.timeAxisStartPosition=j.svg.node().getBBox().y,j.timeAxisEndPosition=j.timeAxisStartPosition+j.svg.node().getBBox().height,j.crossAxisStartPosition=j.svg.node().getBBox().x,j.crossAxisEndPosition=j.crossAxisStartPosition+j.svg.node().getBBox().width}}}}]),angular.module("emuwebApp").directive("epg",function(){return{template:'<div class="emuwebapp-twoDimCanvasContainer"><canvas width="512" height="512"></canvas></div>',
restrict:"E",replace:!0,link:function(a,b){var c,d,e,f=b.find("canvas")[0];a.$watch("vs.curViewPort",function(b,c){$.isEmptyObject(a.cps.vals)||$.isEmptyObject(a.ssffds.data)||0!==a.ssffds.data.length&&(c.sS===b.sS&&c.eS===b.eS||a.drawEpgGrid(a))},!0),a.$watch("vs.curMousePosSample",function(){$.isEmptyObject(a.cps.vals)||$.isEmptyObject(a.ssffds.data)||0!==a.ssffds.data.length&&a.drawEpgGrid(a)},!0),a.drawEpgGrid=function(a){var b=f.getContext("2d");c=a.cps.getSsffTrackConfig("EPG"),d=a.ssffds.getColumnOfTrack(c.name,c.columnName),e=a.ssffds.getSampleRateAndStartTimeOfTrack(c.name),b.clearRect(0,0,f.width,f.height),b.fillStyle="green",b.strokeStyle=a.cps.design.color.black,b.font=a.cps.design.font.input.size.slice(0,-2)+"px "+a.cps.design.font.input.family;var g,h=f.width/8,i=f.height/8,j=1/e.sampleRate-e.startTime,k=Math.round(a.vs.curMousePosSample/a.shs.audioBuffer.sampleRate/j),l=angular.copy(d.values[k]);l.reverse(),angular.forEach(l,function(a,c){for(g=a.toString(2).split("").reverse();g.length<8;)g.push("0");g.forEach(function(a,d){"1"===a?(b.fillStyle="grey",b.fillRect(d*h+5,i*c+5,h-10,i-10)):(b.fillStyle="white",b.fillRect(d*h+5,i*c+5,h-10,i-10))})}),a.fontImage.drawUndistortedTextTwoLines(b,"EPG","Frame:"+k,3*a.cps.design.font.input.size.slice(0,-2)/4,a.cps.design.font.input.family,5,0,a.cps.design.color.black,!0)}}}}),angular.module("emuwebApp").directive("dots",["viewState","ConfigProviderService","Ssffdataservice","fontScaleService","Soundhandlerservice","loadedMetaDataService","mathHelperService",function(a,b,c,d,e,f,g){return{template:'<div class="emuwebapp-twoDimCanvasContainer"><canvas class="emuwebapp-twoDimCanvasStatic" width="512" height="512"></canvas><canvas class="emuwebapp-twoDimCanvasDots" width="512" height="512"></canvas></div>',restrict:"E",replace:!0,scope:{},link:function(h,i){h.cps=b,h.ssffds=c,h.vs=a,h.fontImage=d,h.shs=e,h.lmds=f,h.mhs=g;var j=i.find("canvas")[0],k=i.find("canvas")[1],l=1/0,m=-(1/0),n=1/0,o=-(1/0),p=0,q=Math.PI/180*360;h.$watch("ssffds.data.length",function(){$.isEmptyObject(h.cps.vals)||$.isEmptyObject(h.ssffds.data)||0!==h.ssffds.data.length&&h.drawDots()},!0),h.$watch("vs.curViewPort",function(a,b){$.isEmptyObject(h.cps.vals)||$.isEmptyObject(h.ssffds.data)||0!==h.ssffds.data.length&&(b.sS===a.sS&&b.eS===a.eS||h.drawDots())},!0),h.$watch("vs.curMousePosSample",function(){$.isEmptyObject(h.cps.vals)||$.isEmptyObject(h.ssffds.data)||0!==h.ssffds.data.length&&h.drawDots()},!0),h.$watch("vs.curPerspectiveIdx",function(){l=1/0,m=-(1/0),n=1/0,o=-(1/0)},!0),h.$watch("lmds.getCurBndl()",function(){l=1/0,m=-(1/0),n=1/0,o=-(1/0)},!0),h.setGlobalMinMaxVals=function(){for(var a=h.cps.vals.perspectives[h.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0],b=0;b<a.dots.length;b++){var c=h.cps.getSsffTrackConfig(a.dots[b].xSsffTrack),d=h.ssffds.getColumnOfTrack(c.name,c.columnName);d._minVal<l&&(l=d._minVal),d._maxVal>m&&(m=d._maxVal),c=h.cps.getSsffTrackConfig(a.dots[b].ySsffTrack);var e=h.ssffds.getColumnOfTrack(c.name,c.columnName);e._minVal<n&&(n=e._minVal),e._maxVal>o&&(o=e._maxVal)}a.staticDots.forEach(function(a){a.xCoordinates.forEach(function(b,c){b<l&&(l=b),b>m&&(m=b),a.yCoordinates[c]<n&&(n=a.yCoordinates[c]),a.yCoordinates[c]>o&&(o=a.yCoordinates[c])})}),angular.forEach(a.staticContours,function(a){var b=h.cps.getSsffTrackConfig(a.xSsffTrack),c=h.ssffds.getColumnOfTrack(b.name,b.columnName);c._minVal<l&&(l=c._minVal),c._maxVal>m&&(m=c._maxVal),b=h.cps.getSsffTrackConfig(a.ySsffTrack);var d=h.ssffds.getColumnOfTrack(b.name,b.columnName);d._minVal<n&&(n=d._minVal),d._maxVal>o&&(o=d._maxVal)})},h.drawStaticContour=function(){var a=j.getContext("2d");a.clearRect(0,0,j.width,j.height);for(var b=h.cps.vals.perspectives[h.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0],c=0;c<b.staticContours.length;c++){var d=h.cps.getSsffTrackConfig(b.staticContours[c].xSsffTrack),e=h.ssffds.getColumnOfTrack(d.name,d.columnName);d=h.cps.getSsffTrackConfig(b.staticContours[c].ySsffTrack);for(var f=h.ssffds.getColumnOfTrack(d.name,d.columnName),g=void 0,i=void 0,k=0;k<e.values.length;k++){var r=h.ssffds.getSampleRateAndStartTimeOfTrack(b.staticContours[c].xSsffTrack),s=h.ssffds.getSampleRateAndStartTimeOfTrack(b.staticContours[c].ySsffTrack);if(r.sampleRate!==s.sampleRate||r.startSample!==s.startSample)return void alert("xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample");var t=(e.values[k][b.staticContours[c].xContourNr]-l)/(m-l)*j.width,u=j.height-(f.values[k][b.staticContours[c].yContourNr]-n)/(o-n)*j.height;a.strokeStyle=b.staticContours[c].color,a.fillStyle=b.staticContours[c].color,a.beginPath(),a.arc(t,u,2,p,q,!0),a.fill(),k>=1&&b.staticContours[c].connect&&(a.beginPath(),a.moveTo(g,i),a.lineTo(t,u),a.stroke()),g=t,i=u}}},h.drawDots=function(){l===1/0&&(h.setGlobalMinMaxVals(),void 0!==h.cps.vals.perspectives[h.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0].staticContours&&h.drawStaticContour());var a=k.getContext("2d");a.clearRect(0,0,k.width,k.height);var b=a.canvas.width/a.canvas.offsetWidth,c=a.canvas.height/a.canvas.offsetHeight;a.beginPath(),a.moveTo(0,0),a.lineTo(5,5),a.moveTo(0,k.height),a.lineTo(5,k.height-5),a.moveTo(k.width,k.height),a.lineTo(k.width-5,k.height-5),a.stroke(),a.closePath();var d=3*h.cps.design.font.input.size.slice(0,-2)/4;h.fontImage.drawUndistortedText(a,"yMax: "+h.mhs.roundToNdigitsAfterDecPoint(o,2),d,h.cps.design.font.input.family,5,5,h.cps.design.color.black,!0),h.fontImage.drawUndistortedTextTwoLines(a,"yMin: "+h.mhs.roundToNdigitsAfterDecPoint(n,2),"xMin: "+h.mhs.roundToNdigitsAfterDecPoint(l,2),d,h.cps.design.font.input.family,5,k.height-d*c*2-5,h.cps.design.color.black,!0);var e=a.measureText("xMax: "+h.mhs.roundToNdigitsAfterDecPoint(m,5)).width*b;h.fontImage.drawUndistortedText(a,"xMax: "+h.mhs.roundToNdigitsAfterDecPoint(m,2),d,h.cps.design.font.input.family,k.width-e-5,k.height-d*c-5,h.cps.design.color.black,!0);var f,g=h.cps.vals.perspectives[h.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0],i=h.ssffds.getSampleRateAndStartTimeOfTrack(g.dots[0].xSsffTrack),j=h.ssffds.getSampleRateAndStartTimeOfTrack(g.dots[0].ySsffTrack),p=h.vs.curMousePosSample/h.shs.audioBuffer.sampleRate;f=i.startTime===1/i.sampleRate/2?Math.round(p*i.sampleRate):Math.round(p*i.sampleRate+(i.startTime-1/i.sampleRate/2)*i.sampleRate);var q=h.cps.getSsffTrackConfig(g.dots[0].xSsffTrack),r=h.ssffds.getColumnOfTrack(q.name,q.columnName);f>r.values.length-1&&(f=r.values.length-1),e=a.measureText("frame: "+f).width*b;var s=90;a.save(),a.rotate(s*Math.PI/180),h.fontImage.drawUndistortedText(a,"frame: "+f,h.cps.design.font.input.size.slice(0,-2)-4,h.cps.design.font.input.family,k.width/2-e/2,-k.height,h.cps.design.color.black,!0),a.restore();for(var t=0,u=Math.PI/180*360,v=[],w=0;w<g.dots.length;w++){q=h.cps.getSsffTrackConfig(g.dots[w].xSsffTrack),r=h.ssffds.getColumnOfTrack(q.name,q.columnName),q=h.cps.getSsffTrackConfig(g.dots[w].ySsffTrack);var x=h.ssffds.getColumnOfTrack(q.name,q.columnName);if(r.values.length!==x.values.length)return void alert("columns do not have same length or length of one not 1");if(i=h.ssffds.getSampleRateAndStartTimeOfTrack(g.dots[w].xSsffTrack),j=h.ssffds.getSampleRateAndStartTimeOfTrack(g.dots[w].ySsffTrack),i.sampleRate!==j.sampleRate||i.startSample!==j.startSample)return void alert("xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample");var y=(r.values[f][g.dots[w].xContourNr]-l)/(m-l)*k.width,z=k.height-(x.values[f][g.dots[w].yContourNr]-n)/(o-n)*k.height;a.strokeStyle=g.dots[w].color,a.beginPath(),a.arc(y,z,20,t,u,!0),a.stroke(),a.closePath(),a.beginPath(),a.arc(y,z,2,t,u,!0),a.fill(),a.closePath(),h.fontImage.drawUndistortedText(a,g.dots[w].name,h.cps.design.font.input.size.slice(0,-2)-4,h.cps.design.font.input.family,y,z-5,h.cps.design.color.black,!0),v.push({name:g.dots[w].name,x:y,y:z})}var A,B;g.connectLines.forEach(function(b){v.forEach(function(a){a.name===b.fromDot&&(A=a),a.name===b.toDot&&(B=a)}),a.strokeStyle=b.color,a.beginPath(),a.moveTo(A.x,A.y),a.lineTo(B.x,B.y),a.stroke(),a.closePath()}),t=0,u=Math.PI/180*360,g.staticDots.forEach(function(b){a.strokeStyle=b.color,a.fillStyle=b.color;var c=(b.xNameCoordinate-l)/(m-l)*k.width,d=k.height-(b.yNameCoordinate-n)/(o-n)*k.height;h.fontImage.drawUndistortedText(a,b.name,h.cps.design.font.input.size.slice(0,-2)-4,h.cps.design.font.input.family,c,d,b.color,!0),b.xCoordinates.forEach(function(c,d){var e=(c-l)/(m-l)*k.width,f=k.height-(b.yCoordinates[d]-n)/(o-n)*k.height;if(a.beginPath(),a.arc(e,f,2,t,u,!0),a.fill(),a.closePath(),b.connect&&d>=1){var g=(b.xCoordinates[d-1]-l)/(m-l)*k.width,h=k.height-(b.yCoordinates[d-1]-n)/(o-n)*k.height;a.beginPath(),a.moveTo(g,h),a.lineTo(e,f),a.stroke(),a.closePath()}})})}}}}]),angular.module("emuwebApp").directive("myDropZone",["$animate","$compile","DragnDropService","browserDetector","appStateService","modalService",function(a,b,c,d,e,f){return{templateUrl:"views/myDropZone.html",restrict:"E",replace:!0,scope:{},link:function(a,b){a.dropTextDefault="Drop your files here (.wav files; .wav & annotJSON file pairs; .wav & TextGrid file pairs) or click here to do the same with a file dialog",a.dropTextErrorFileType="Error: Could not parse file. The following file types are supported: .WAV .TEXTGRID _annot.json",a.dropTextErrorAPI="Sorry ! The File APIs are not supported in your browser.",a.dropAllowed="Drop file(s) to start loading !",a.dropParsingWaiting=".TextGrid loaded! Please load .WAV file in order to start!",a.dropParsingWAV=".WAV loaded! Proceeding without annotation data.",a.dropParsingWaitingAnnot="Annotation file loaded! Please load .WAV file in order to start!",a.dropFirefoxWarning="Sorry ! Firefox does not support dropping folders ! please drop single or multiple files !",a.dropText=a.dropTextDefault,a.dropClass="",a.dropClassDefault="",a.dropClassOver="over",a.dropClassError="error",a.count=0,a.handles=[],a.bundles=[],a.bundleNames=[],a.updateQueueLength=function(b){a.count+=b},a.enqueueFileAddition=function(b){var c=b.name.substring(b.name.lastIndexOf("_")+1,b.name.lastIndexOf(".")).toUpperCase(),e=b.name.substr(b.name.lastIndexOf(".")+1).toUpperCase(),f="";f="ANNOT"===c?b.name.substr(0,b.name.lastIndexOf("_")):b.name.substr(0,b.name.lastIndexOf("."));var g=a.bundleNames.indexOf(f);g===-1&&(a.bundleNames.push(f),g=a.bundleNames.indexOf(f),a.bundles[g]=[],a.bundles[g][0]=f),"WAV"===e?(a.bundles[g][1]=b,a.handles.push(b),a.dropClass=a.dropClassDefault,a.dropText=a.dropParsingWAV):"TEXTGRID"===e?(a.bundles[g][2]={},a.bundles[g][2].file=b,a.bundles[g][2].type="textgrid",a.handles.push(b),a.dropClass=a.dropClassDefault,a.dropText=a.dropParsingWaiting):"JSON"===e&&"ANNOT"===c?(a.bundles[g][2]={},a.bundles[g][2].file=b,a.bundles[g][2].type="annotation",a.handles.push(b),a.dropClass=a.dropClassDefault,a.dropText=a.dropParsingWaitingAnnot):(d.isBrowser.Firefox()&&0===b.size?(a.dropClass=a.dropClassError,a.dropText=a.dropFirefoxWarning):(a.dropClass=a.dropClassError,a.dropText=a.dropTextErrorFileType),a.handles=[],a.bundles=[],a.bundleNames=[],a.count=0),d.isBrowser.Firefox()||d.isBrowser.Safari()||a.$digest(),void 0!==a.bundles[g]&&a.startRendering()},a.startRendering=function(){a.count===a.handles.length&&(c.setData(a.bundles)===!1&&f.open("views/error.html","Sorry you dropped too many bundles ("+a.handles.length+"). The maximum currently allowed is: "+c.maxDroppedBundles).then(function(){e.resetToInitState()}),a.handles=[],a.bundles=[],a.bundleNames=[],a.count=0,a.dropText=a.dropTextDefault,a.dropClass=a.dropClassDefault)},a.loadFiles=function(b){a.updateQueueLength(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(".DS_Store"===d.name)a.updateQueueLength(-1);else{var e,f;if(d.isFile||d.isDirectory)e=d;else if(d.getAsEntry)e=d.getAsEntry();else{if(!d.webkitGetAsEntry){if("function"==typeof d.getAsFile){a.enqueueFileAddition(d.getAsFile());continue}if(File&&d instanceof File){a.enqueueFileAddition(d);continue}a.updateQueueLength(-1);continue}e=d.webkitGetAsEntry()}e?e.isFile?e.file(function(b){a.enqueueFileAddition(b)},function(a){console.warn(a)}):e.isDirectory&&(f=e.createReader(),f.readEntries(function(b){a.loadFiles(b),a.updateQueueLength(-1)},function(a){console.warn(a)})):a.updateQueueLength(-1)}}},a.dropFiles=function(b){b.stopPropagation(),b.preventDefault(),a.$apply(function(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){if(void 0!==b.originalEvent){var c;c=d.isBrowser.Firefox()?b.originalEvent.dataTransfer.files:d.isBrowser.Safari()?b.originalEvent.dataTransfer.files:b.originalEvent.dataTransfer.items,a.loadFiles(c)}}else f.open("views/error.html",a.dropTextErrorAPI).then(function(){a.dropText=a.dropTextDefault,a.dropClass=a.dropClassDefault,e.resetToInitState()})})},a.dragEnterLeave=function(b){b.preventDefault(),a.$apply(function(){a.dropText=a.dropTextDefault,a.dropClass=a.dropClassDefault})},a.handleDragOver=function(b){b.preventDefault(),a.$apply(function(){a.dropText=a.dropAllowed,a.dropClass=a.dropClassOver})},b.bind("drop",function(b){a.dropFiles(b)}),b.bind("dragover",function(b){a.handleDragOver(b)}),b.bind("dragenter",function(b){a.dragEnterLeave(b)}),b.bind("dragleave",function(b){a.dragEnterLeave(b)}),b.bind("click",function(){var a=b.find("input");a[0].click()})}}}]),angular.module("emuwebApp").directive("myDropZoneInput",function(){return{templateUrl:"views/myDropZoneInput.html",restrict:"E",scope:{},link:function(a,b){a.acceptGrid=".TextGrid",a.acceptWav="audio/wav, audio/x-wav, audio/wave, audio/x-pn-wav",a.acceptJson="application/json",a.acceptBoth=a.acceptWav+","+a.acceptGrid+","+a.acceptJson,a.acceptFile=a.acceptBoth,a.handleFilesonChange=function(){var c=b[0].firstChild.files;a.$parent.loadFiles(c)},b.bind("change",function(b){a.handleFilesonChange(b)}),b.bind("click",function(){var a=angular.element("input");void 0!==a[1]&&a[1].click()})}}}),angular.module("emuwebApp").directive("emuwebapp",["viewState","Iohandlerservice","ConfigProviderService",function(a,b,c){return{templateUrl:"views/emuwebapp.html",restrict:"E",scope:{audioGetUrl:"@",labelGetUrl:"@",labelType:"@"},link:function(b,d,e){d.bind("mouseenter",function(){a.mouseInEmuWebApp=!0}),d.bind("mouseleave",function(){a.mouseInEmuWebApp=!1}),e.$observe("audioGetUrl",function(a){void 0!==a&&""!==a&&(c.embeddedVals.audioGetUrl=a)}),e.$observe("labelGetUrl",function(a){void 0!==a&&""!==a&&(c.embeddedVals.labelGetUrl=a)}),e.$observe("labelType",function(a){void 0!==a&&""!==a&&(c.embeddedVals.labelType=a)})}}}]),angular.module("emuwebApp").service("Validationservice",["$http","$q","ConfigProviderService",function(a,b,c){function d(a,b){var c=!0;return b.levelDefinitions.forEach(function(b){for(var c=a.indexOf(b.name);c!==-1;)a.splice(c,1),c=a.indexOf(b.name)}),0!==a.length&&(c="Following levels are not defined: "+a),c}function e(a,b){var c=!0,d=a.indexOf("OSCI");return d!==-1&&a.splice(d,1),d=a.indexOf("SPEC"),d!==-1&&a.splice(d,1),b.ssffTrackDefinitions.forEach(function(b){for(var c=a.indexOf(b.name);c!==-1;)a.splice(c,1),c=a.indexOf(b.name)}),0!==a.length&&(c="Following ssffTracks are not defined: "+a),c}var f={},g=[],h=["annotationFileSchema","emuwebappConfigSchema","DBconfigFileSchema","bundleListSchema","bundleSchema","designSchema"];return f.semCheckLoadedConfigs=function(a,b){var f=!0,g=!0;b.levelDefinitions.forEach(function(a,b){a.attributeDefinitions.forEach(function(c,d){var e=0;a.attributeDefinitions.forEach(function(a){c.name===a.name&&(e+=1)}),e>1&&(f="Error in DBconfig /levelDefinitions["+b+"]/attributeDefinitions["+d+"] duplicate attribute definitions found for this entry!",g=!1)})}),a.perspectives.forEach(function(a){if(g){var h=e(angular.copy(a.signalCanvases.order),b);h!==!0&&(f="Error in EMUwebAppConfig/perspectives/signalCanvases/order! References to undefined ssffTracks are present. "+h,g=!1);var i=[];a.signalCanvases.assign.forEach(function(c){if(g){i.push(c.ssffTrackName),c.signalCanvasName===c.ssffTrackName&&(f="Error in EMUwebAppConfig/perspectives/signalCanvases/assign! Assignment to self is not possible! signalCanvasesName: "+c.signalCanvasName,g=!1),"OSCI"!==c.ssffTrackName&&"SPEC"!==c.ssffTrackName||(f="Error in EMUwebAppConfig/perspectives/signalCanvases/assign! Assignment of OSCI or SPEC is not possible!",g=!1),h=e([c.signalCanvasName,c.ssffTrackName],b),h!==!0&&(f="Error in EMUwebAppConfig/perspectives/signalCanvases/assign! References to undefined ssffTracks are present. "+h,g=!1);var d=a.signalCanvases.order.indexOf(c.signalCanvasName);d===-1&&(f="Error in EMUwebAppConfig/perspectives/signalCanvases/assign! References to ssffTracks that are not displayed (not in order array of that perspective) are: "+c.signalCanvasName,g=!1)}}),a.signalCanvases.contourLims.forEach(function(c){if(g){h=e([c.ssffTrackName],b),h!==!0&&(f="Error in EMUwebAppConfig/perspectives/signalCanvases/contourLims! References to undefined ssffTracks are present. "+h,g=!1);var d=a.signalCanvases.order.concat(i).indexOf(c.ssffTrackName);d===-1&&(f="Error in EMUwebAppConfig/perspectives/signalCanvases/contourLims! References to ssffTracks that are not displayed (not in order array of that perspective) are: "+c.ssffTrackName,g=!1)}});var j=d(angular.copy(a.levelCanvases.order),b);j!==!0&&(f="Error in EMUwebAppConfig/perspectives/levelCanvases/order! References to undefined levels are present. "+j,g=!1),a.levelCanvases.order.forEach(function(a){if(g){var b=c.getLevelDefinition(a);"SEGMENT"!==b.type&&"EVENT"!==b.type&&(f="Error in EMUwebAppConfig/perspectives/levelCanvases/order! Configured to display levels of type ITEM as levels containing time information (ITEM level in order array). LevelName: "+a,g=!1)}}),void 0!==a.twoDimCanvases&&void 0!==a.twoDimCanvases.twoDimDrawingDefinitions&&a.twoDimCanvases.twoDimDrawingDefinitions.forEach(function(a){if(g){var c=[];a.dots.forEach(function(a){g&&(c.push(a.name),h=e([a.xSsffTrack,a.ySsffTrack],b),h!==!0&&(f="Error in EMUwebAppConfig/perspectives/twoDimCanvases/twoDimDrawingDefinitions/dots! References to undefined ssffTracks are present. "+h,g=!1))}),a.connectLines.forEach(function(a){if(g){var b=c.indexOf(a.fromDot);b===-1&&(f="Error in EMUwebAppConfig/perspectives/twoDimCanvases/twoDimDrawingDefinitions/connectLines! References dots in fromDot that are not defined. dots.name: "+a.fromDot,g=!1),b=c.indexOf(a.toDot),b===-1&&(f="Error in EMUwebAppConfig/perspectives/twoDimCanvases/twoDimDrawingDefinitions/connectLines! References dots in toDot that are not defined. dots.name: "+a.toDot,g=!1)}}),a.staticDots.forEach(function(a){g&&a.xCoordinates.length!==a.yCoordinates.length&&(f="Error in EMUwebAppConfig/perspectives/twoDimCanvases/twoDimDrawingDefinitions/staticDots! xCoordinates and yCoordinates are not of the same length!",g=!1)})}})}});var h=[],i=[];b.levelDefinitions.forEach(function(a){void 0!==a.anagestConfig&&(h.push(a.anagestConfig.verticalPosSsffTrackName),h.push(a.anagestConfig.velocitySsffTrackName),i.push(a.anagestConfig.autoLinkLevelName))});var j=d(i,b);j!==!0&&(f="Error in DBconfig/levelDefinitions/anagestConfig/autoLinkLevelName! References to undefined levels are present. "+j);var k=e(h,b);return k!==!0&&(f="Error in DBconfig/levelDefinitions/anagestConfig/verticalPosSsffTrackName || velocitySsffTrackName! References to undefined ssffTracks are present. "+k),f},f.loadSchemas=function(){var c,d=[];return angular.forEach(h,function(b){c="schemaFiles/"+b+".json",d.push(a.get(c))}),b.all(d)},f.setSchemas=function(a){angular.forEach(a,function(a){g.push({name:a.config.url,data:a.data}),"schemaFiles/annotationFileSchema.json"===a.config.url&&tv4.addSchema(a.config.url,a.data)})},f.getSchema=function(a){var b;return angular.forEach(g,function(c){c.name==="schemaFiles/"+a+".json"&&(b=c)}),b},f.validateJSO=function(a,b){var d,e=f.getSchema(a);if(void 0!==e&&tv4.validate(b,e.data))if("DBconfigFileSchema"===a){var g=f.semCheckLoadedConfigs(c.vals,c.curDbConfig);d=g===!0||g}else d=!0;else d=void 0===e?"Schema: "+a+" is currently undefined! This is probably due to a misnamed schema file on the server...":tv4.error;return d},f}]),angular.module("emuwebApp").controller("ShowhierarchyCtrl",["$scope","viewState","modalService","ConfigProviderService","LevelService","HierarchyLayoutService","StandardFuncsService",function(a,b,c,d,e,f,g){a.paths={possible:[],possibleAsStr:[],selected:""},a.vs=b,a.standardFuncServ=g,angular.forEach(d.curDbConfig.levelDefinitions,function(b){a.paths.possible=a.paths.possible.concat(f.findPaths(b.name))}),angular.forEach(a.paths.possible,function(b){var c=g.reverseCopy(b),d=c.join(" → ");a.paths.possibleAsStr.push(d)});var h=[];angular.forEach(a.paths.possibleAsStr,function(b,c){angular.forEach(a.paths.possibleAsStr,function(a){b!==a&&a.startsWith(b)&&h.indexOf(c)===-1&&h.push(c)})}),angular.forEach(h.reverse(),function(b){a.paths.possibleAsStr.splice(b,1),a.paths.possible.splice(b,1)}),a.paths.selected=a.paths.possibleAsStr[b.hierarchyState.curPathIdx],a.vs.hierarchyState.curNrOfPaths=a.paths.possibleAsStr.length,a.$watch("paths.selected",function(){b.hierarchyState.path=a.paths.possible[a.getSelIdx()]},!1),a.$watch("vs.hierarchyState.curPathIdx",function(){b.hierarchyState.path=a.paths.possible[a.vs.hierarchyState.curPathIdx],a.paths.selected=a.paths.possibleAsStr[b.hierarchyState.curPathIdx]},!1),a.getSelIdx=function(){var b=a.paths.possibleAsStr.indexOf(a.paths.selected);return b},a.rotateHierarchy=function(){b.hierarchyState.toggleRotation()},a.getRotation=function(){return b.hierarchyState.isRotated()},a.playSelection=function(){++b.hierarchyState.playing},a.getPlaying=function(){return b.hierarchyState.playing},a.isCurrentAttrDef=function(a,c){return b.getCurAttrDef(a)===c},a.setCurrentAttrDef=function(a,c,d){b.setCurAttrDef(a,c,d)},a.getAllAttrDefs=function(a){var b=d.getLevelDefinition(a);return b.attributeDefinitions},a.cancel=function(){c.close()}}]),angular.module("emuwebApp").service("HierarchyLayoutService",["viewState","ConfigProviderService","LevelService","DataService","StandardFuncsService",function(a,b,c,d,e){var f={};return f.findAllNonPartialPaths=function(){var a={possible:[],possibleAsStr:[]};angular.forEach(b.curDbConfig.levelDefinitions,function(b){a.possible=a.possible.concat(f.findPaths(b.name))}),angular.forEach(a.possible,function(b){var c=e.reverseCopy(b),d=c.join(" → ");a.possibleAsStr.push(d)});var c=[];return angular.forEach(a.possibleAsStr,function(b,d){angular.forEach(a.possibleAsStr,function(a){b!==a&&a.startsWith(b)&&c.indexOf(d)===-1&&c.push(d)})}),angular.forEach(c.reverse(),function(b){a.possibleAsStr.splice(b,1),a.possible.splice(b,1)}),a},f.findPaths=function(a,b){b="undefined"==typeof b?[a]:b.concat([a]);var c=this.findParentLevels(a);if(0===c.length)return[b];for(var d=[],e=0;e<c.length;++e)d=d.concat(f.findPaths(c[e],b));return d},f.findParentLevels=function(a){for(var c=[],d=0;d<b.curDbConfig.linkDefinitions.length;++d)b.curDbConfig.linkDefinitions[d].sublevelName===a&&c.push(b.curDbConfig.linkDefinitions[d].superlevelName);return c},f.calculateWeightsBottomUp=function(a){var b,e;for(f.findParents(a),f.findVisibility(a),b=0;b<a.length;++b){var g=c.getLevelDetails(a[b]);for(g._weight=0,e=0;e<g.items.length;++e)g.items[e]._visible===!1?g.items[e]._weight=.35:g.items[e]._weight=1,g._weight+=g.items[e]._weight;var h=0;for(e=0;e<g.items.length;++e){g.items[e]._posInLevel=(h+g.items[e]._weight/2)/g._weight,h+=g.items[e]._weight,g.items[e]._depth=a.length-b-1;for(var i=d.getData().links,j=0;j<i.length;++j)i[j].toID===g.items[e].id&&(i[j]._toPosInLevel=g.items[e]._posInLevel,i[j]._toDepth=g.items[e]._depth),i[j].fromID===g.items[e].id&&(i[j]._fromPosInLevel=g.items[e]._posInLevel,i[j]._fromDepth=g.items[e]._depth)}}},f.findChildren=function(a,b){var e=[],f=c.getLevelName(a.id);if(null===f)return console.log("Likely a bug: failed to find a node's level",a),[];for(var g=null,h=0;h<b.length-1;++h)if(b[h+1]===f){g=b[h];break}if(null===g)return[];for(var i=0;i<d.getData().links.length;++i)if(d.getData().links[i].fromID===a.id)for(var j=0;j<d.getData().levels.length;++j)if(d.getData().levels[j].name===g)for(var k=0;k<d.getData().levels[j].items.length;++k)d.getData().levels[j].items[k].id===d.getData().links[i].toID&&e.push(d.getData().levels[j].items[k]);return e},f.findParents=function(a){var b,d,e,g,h;for(b=0;b<a.length;++b)for(h=c.getLevelDetails(a[b]),d=0;d<h.items.length;++d)h.items[d]._parents=[];for(b=0;b<a.length;++b){for(h=c.getLevelDetails(a[b]),g=0;g<h.items.length;++g)"SEGMENT"===h.type?(h.items[g]._derivedSampleStart=h.items[g].sampleStart,h.items[g]._derivedSampleEnd=h.items[g].sampleStart+h.items[g].sampleDur):(h.items[g]._derivedSampleStart=1/0,h.items[g]._derivedSampleEnd=-(1/0));for(d=0;d<h.items.length;++d){var i=f.findChildren(h.items[d],a);for(e=0;e<i.length;++e)i[e]._parents.push(h.items[d]),i[e]._derivedSampleStart<h.items[d]._derivedSampleStart&&(h.items[d]._derivedSampleStart=i[e]._derivedSampleStart),i[e]._derivedSampleEnd>h.items[d]._derivedSampleEnd&&(h.items[d]._derivedSampleEnd=i[e]._derivedSampleEnd)}}},f.findVisibility=function(b){if(void 0!==b&&b.length>0){for(var d,e=[],g=0;g<b.length;++g){d=c.getLevelDetails(b[g]);for(var h=0;h<d.items.length;++h)0===d.items[h]._parents.length&&e.push(d.items[h])}var i,j=[];for(j=j.concat(e);j.length>0;)i=j.pop(),j=j.concat(f.findChildren(i,b)),i._visible=!1;for(j=[],j=j.concat(e);j.length>0;)i=j.pop(),a.hierarchyState.getCollapsed(i.id)||(j=j.concat(f.findChildren(i,b))),i._visible=!0}},f.toggleCollapse=function(b,c){var d=!a.hierarchyState.getCollapsed(b.id);a.hierarchyState.setCollapsed(b.id,d);for(var e,g=f.findChildren(b,c);g.length>0;){e=g.pop(),g=g.concat(f.findChildren(e,c));var h=a.hierarchyState.getNumCollapsedParents(e.id);d?a.hierarchyState.setNumCollapsedParents(e.id,h+1):a.hierarchyState.setNumCollapsedParents(e.id,h-1),a.hierarchyState.setCollapsePosition(e.id,[b._x,b._y])}},f}]),angular.module("emuwebApp").service("ArrayHelperService",function(){var a={};return a.convertToAbsValues=function(a){for(var b=0;b<a.length;b++)a[b]=Math.abs(a[b]);return a},a.multiplyEachElement=function(a,b){for(var c=0;c<a.length;c++)a[c]=a[c]*b;return a},a.interp2points=function(a,b,c,d,e){return b+(d-b)*((e-a)/(c-a))},a.findMinMax=function(a,b){var c,d,e;if("min"===b)for(c=1/0,e=0;e<a.length;e++)a[e]<c&&(c=a[e],d=e);else if("max"===b)for(c=-(1/0),e=0;e<a.length;e++)a[e]>c&&(c=a[e],d=e);return{val:c,idx:d}},a.flattenArrayOfArray=function(a){var b=[];return b=b.concat.apply(b,a)},a.convertArrayToXYjsoArray=function(a){for(var b=[],c=0;c<a.length;c++)b.push({x:c,y:a[c]});return b},a}),angular.module("emuwebApp").service("AnagestService",["$q","$log","viewState","LevelService","LinkService","ConfigProviderService","Ssffdataservice","ArrayHelperService","modalService","HistoryService","DataService",function(a,b,c,d,e,f,g,h,i,j,k){var l,m={};return m.insertAnagestEvents=function(){var l=a.defer(),n=c.getItemsInSelection(k.data.levels);if(0!==n.length)return i.open("views/error.html","There are already events in the selected area! This is not permitted...").then(function(){l.reject()}),l;var o=f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.verticalPosSsffTrackName,p=f.getSsffTrackConfig(o),q=g.getColumnOfTrack(p.name,p.columnName),r=g.getSampleRateAndStartTimeOfTrack(p.name),s=f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.velocitySsffTrackName,t=f.getSsffTrackConfig(s),u=g.getColumnOfTrack(t.name,t.columnName);if(1!==q.length||1!==u.length)return i.open("views/error.html","UPS... the column length of of one of the tracks is != 1 this means something is badly configured in the DB!!!").then(function(){l.reject()}),l;var v=h.flattenArrayOfArray(q.values),w=h.flattenArrayOfArray(u.values),x=[NaN,NaN],y=[NaN,NaN],z=[NaN,NaN],A=[NaN,NaN];w=h.convertToAbsValues(w);var B=c.getSelectedStartTime(),C=c.getSelectedEndTime(),D=Math.round(B*r.sampleRate+r.startTime),E=Math.round(C*r.sampleRate+r.startTime),F=E-D,G=v.slice(D,D+F),H=w.slice(D,D+F),I=h.findMinMax(G,"max");A[0]=I.idx;var J=h.findMinMax(H.slice(0,A[0]+1),"max");y[0]=J.idx;var K=h.findMinMax(H.slice(0,y[0]+1),"min");return b.info("Looking for gesture onset"),m.interactiveFindThresholds(H.slice(0,y[0]+1),K.val,J.val,f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.threshold,1,"Looking for gesture onset").then(function(a){var k=a;x[0]=k;var n=h.findMinMax(H.slice(y[0],A[0]+1),"min"),o=n.idx+y[0];b.info("Looking for nucleus onset"),m.interactiveFindThresholds(H.slice(y[0],o+1),n.val,J.val,f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.threshold,-1,"Looking for nucleus onset").then(function(a){var k=a;z[0]=k+y[0];var n=h.findMinMax(H.slice(A[0]),"max");y[1]=n.idx+A[0];var p=h.findMinMax(H.slice(A[0],y[1]+1),"min");o=p.idx+A[0],b.info("Looking for nucleus offset"),m.interactiveFindThresholds(H.slice(o,y[1]+1),p.val,n.val,f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.threshold,1,"Looking for nucleus offset").then(function(a){var k=a;z[1]=k+o;var p=h.findMinMax(H.slice(y[1]),"min");o=p.idx+y[1],b.info("Looking for gesture offset"),m.interactiveFindThresholds(H.slice(y[1],o+1),p.val,n.val,f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.threshold,-1,"Looking for gesture offset").then(function(a){var b=a;x[1]=b+y[1];var h;x[0]=g.calculateSamplePosInVP(D+x[0],r.sampleRate,r.startTime),x[1]=g.calculateSamplePosInVP(D+x[1],r.sampleRate,r.startTime),h=f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.gestureOnOffsetLabels[0];var k=d.insertEvent(c.getcurClickLevelName(),x[0],h);j.updateCurChangeObj({type:"ANNOT",action:"INSERTEVENT",name:c.getcurClickLevelName(),start:x[0],id:k.id,pointName:h}),h=f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.gestureOnOffsetLabels[1];var m=d.insertEvent(c.getcurClickLevelName(),x[1],h);j.updateCurChangeObj({type:"ANNOT",action:"INSERTEVENT",name:c.getcurClickLevelName(),start:x[1],id:m.id,pointName:h}),y[0]=g.calculateSamplePosInVP(D+y[0],r.sampleRate,r.startTime),y[1]=g.calculateSamplePosInVP(D+y[1],r.sampleRate,r.startTime),h=f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.maxVelocityOnOffsetLabels[0];var n=d.insertEvent(c.getcurClickLevelName(),y[0],h);j.updateCurChangeObj({type:"ANNOT",action:"INSERTEVENT",name:c.getcurClickLevelName(),start:y[0],id:n.id,pointName:h}),h=f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.maxVelocityOnOffsetLabels[1];var o=d.insertEvent(c.getcurClickLevelName(),y[1],h);j.updateCurChangeObj({type:"ANNOT",action:"INSERTEVENT",name:c.getcurClickLevelName(),start:y[1],id:o.id,pointName:h}),z[0]=g.calculateSamplePosInVP(D+z[0],r.sampleRate,r.startTime),z[1]=g.calculateSamplePosInVP(D+z[1],r.sampleRate,r.startTime),h=f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.constrictionPlateauBeginEndLabels[0];var p=d.insertEvent(c.getcurClickLevelName(),z[0],h);j.updateCurChangeObj({type:"ANNOT",action:"INSERTEVENT",name:c.getcurClickLevelName(),start:z[0],id:p.id,pointName:h}),h=f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.constrictionPlateauBeginEndLabels[1];var q=d.insertEvent(c.getcurClickLevelName(),z[1],h);j.updateCurChangeObj({type:"ANNOT",action:"INSERTEVENT",name:c.getcurClickLevelName(),start:z[1],id:q.id,pointName:h}),A[0]=g.calculateSamplePosInVP(D+A[0],r.sampleRate,r.startTime),h=f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.maxConstrictionLabel;var s=d.insertEvent(c.getcurClickLevelName(),A[0],h);j.updateCurChangeObj({type:"ANNOT",action:"INSERTEVENT",name:c.getcurClickLevelName(),start:A[0],id:s.id,pointName:h});var t=f.getLevelDefinition(c.getcurClickLevelName()).anagestConfig.autoLinkLevelName,u=d.getLevelDetails(t),v=d.getAllLabelsOfLevel(u);i.open("views/SelectLabelModal.html",v,void 0,!0).then(function(a){if(a!==!1){var b=[k.id,m.id,n.id,o.id,p.id,q.id,s.id];e.insertLinksTo(u.items[a].id,b),j.updateCurChangeObj({type:"ANNOT",action:"INSERTLINKSTO",
name:u.name,parentID:u.items[a].id,childIDs:b}),j.addCurChangeObjToUndoStack()}}),l.resolve()})})})},function(){}),l.promise},m.interactiveFindThresholds=function(b,c,d,e,f,g){var j,k=c+(d-c)*e,m=f;k*=m;var n=h.multiplyEachElement(b,m),o=n.length,p=n.slice(1,o),q=0,r=o-1,s=[];for(j=0;j<n.length;j++)p[j]>=k&&n[j]<k&&s.push(j);var t=[];for(j=0;j<s.length;j++)s[j]>=q&&s[j]<=r&&t.push(j);if(t.length>1){l=a.defer();var u={};for(u.description=g,u.options=[],u.y=n,u.minVal=c,u.maxVal=d,u.threshold=e,j=0;j<s.length;j++)u.options.push({thresholdIdx:s[j],thresholdValue:n[j]});return i.open("views/SelectThresholdModal.html",u,void 0,!0).then(function(a){var b=s[t[a]];b=h.interp2points(n[b],b,n[b+1],b+1,k),l.resolve(b)}),l.promise}if(0===t.length)return l=a.defer(),i.open("views/error.html","Could not find any values that step over the threshold!!").then(function(){l.reject("Could not find any values that step over the threshold!!")}),l.promise;l=a.defer();var v=s[t[0]];return v=h.interp2points(n[v],v,n[v+1],v+1,k),l.resolve(v),l.promise},m}]),angular.module("emuwebApp").service("DragnDropDataService",["$q",function(a){var b={};return b.convertedBundles=[],b.sessionDefault="",b.getBundle=function(c){var d=a.defer();return angular.forEach(b.convertedBundles,function(a){if(a.name===c){var b=angular.copy(a);delete b.name,d.resolve({status:200,data:b})}}),d.promise},b.resetToInitState=function(){b.convertedBundles=[],b.sessionDefault=""},b.setDefaultSession=function(a){b.sessionDefault=a},b.getDefaultSession=function(){return b.sessionDefault},b}]),angular.module("emuwebApp").service("DragnDropService",["$q","$rootScope","modalService","DataService","Validationservice","ConfigProviderService","DragnDropDataService","Iohandlerservice","viewState","Soundhandlerservice","Binarydatamaniphelper","browserDetector","Wavparserservice","Textgridparserservice","loadedMetaDataService","LevelService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q={};return q.drandropBundles=[],q.bundleList=[],q.sessionName="File(s)",q.maxDroppedBundles=10,q.setData=function(a){var b=0;return angular.forEach(a,function(a,c){q.setDragnDropData(a[0],c,"wav",a[1]),void 0!==a[2]&&q.setDragnDropData(a[0],c,"annotation",a[2]),b=c}),b<=q.maxDroppedBundles&&void q.convertDragnDropData(q.drandropBundles,0).then(function(){return o.setBundleList(q.bundleList),o.setCurBndlName(q.bundleList[g.sessionDefault]),o.setDemoDbName(q.bundleList[g.sessionDefault]),q.handleLocalFiles(),!0})},q.resetToInitState=function(){delete q.drandropBundles,q.drandropBundles=[],delete q.bundleList,q.bundleList=[],q.sessionName="File(s)",q.maxDroppedBundles=10,g.resetToInitState(),o.resetToInitState()},q.setDragnDropData=function(a,b,c,d){g.setDefaultSession(b),void 0===q.drandropBundles[b]&&(q.drandropBundles[b]={},g.convertedBundles[b]={},g.convertedBundles[b].name=a,q.bundleList.push({name:a,session:q.sessionName})),"wav"===c?q.drandropBundles[b].wav=d:"annotation"===c&&(q.drandropBundles[b].annotation=d)},q.getDragnDropData=function(a,b){return"wav"===b?q.drandropBundles[a].wav:"annotation"===b&&q.drandropBundles[a].annotation},q.generateDrop=function(a){var b;return b="object"!=typeof URL&&"undefined"!=typeof webkitURL?webkitURL.createObjectURL(q.getBlob(a)):URL.createObjectURL(q.getBlob(a))},q.getBlob=function(a){var b;try{b=new Blob([a],{type:"text/plain"})}catch(c){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,b=new BlobBuilder,b.append(a),b=b.getBlob()}return b},q.convertDragnDropData=function(b,d){var e,f=a.defer(),h=q.drandropBundles[d],i=new FileReader,k=new FileReader;return b.length>d?(void 0!==h.wav&&(i.readAsArrayBuffer(h.wav),i.onloadend=function(a){a.target.readyState===FileReader.DONE&&(e=l.isBrowser.Firefox()?a.target.result:a.currentTarget.result,m.parseWavAudioBuf(e).then(function(a){void 0===g.convertedBundles[d]&&(g.convertedBundles[d]={}),j.audioBuffer=a,g.convertedBundles[d].ssffFiles=[];var e=h.wav.name.substr(0,h.wav.name.lastIndexOf("."));void 0===h.annotation?(g.convertedBundles[d].annotation={levels:[],links:[],sampleRate:a.sampleRate,annotates:e,name:e},q.convertDragnDropData(b,d+1).then(function(){delete q.drandropBundles,q.drandropBundles=[],f.resolve()})):"textgrid"===h.annotation.type?(k.readAsText(h.annotation.file),k.onloadend=function(a){a.target.readyState===FileReader.DONE&&n.asyncParseTextGrid(a.currentTarget.result,h.wav.name,e).then(function(a){g.convertedBundles[d].annotation=a,q.convertDragnDropData(b,d+1).then(function(){f.resolve()})},function(a){c.open("views/error.html","Error parsing TextGrid file: "+a.status.message).then(function(){f.reject()})})}):"annotation"===h.annotation.type&&(k.readAsText(h.annotation.file),k.onloadend=function(a){a.target.readyState===FileReader.DONE&&(g.convertedBundles[d].annotation=angular.fromJson(a.currentTarget.result),q.convertDragnDropData(b,d+1).then(function(){f.resolve()}))})},function(a){c.open("views/error.html","Error parsing wav file: "+a.status.message).then(function(){f.reject()})}))}),f.promise):(f.resolve(),f.promise)},q.handleLocalFiles=function(){var a;a=void 0!==g.convertedBundles[g.sessionDefault].annotation?g.convertedBundles[g.sessionDefault].annotation:{levels:[],links:[]},i.showDropZone=!1,i.setState("loadingSaving"),i.somethingInProgress=!0,i.somethingInProgressTxt="Loading local File: "+g.convertedBundles[g.sessionDefault].name,h.httpGetPath("configFiles/standalone_emuwebappConfig.json").then(function(b){i.curPerspectiveIdx=0,f.setVals(b.data.EMUwebAppConfig),delete b.data.EMUwebAppConfig;var h;if(h=e.validateJSO("emuwebappConfigSchema",f.vals),h===!0){f.curDbConfig=b.data,i.somethingInProgressTxt="Parsing WAV file...",i.curViewPort.sS=0,i.curViewPort.eS=j.audioBuffer.length,i.curViewPort.selectS=-1,i.curViewPort.selectE=-1,i.curClickSegments=[],i.curClickLevelName=void 0,i.curClickLevelType=void 0,o.setCurBndl(g.convertedBundles[g.sessionDefault]),i.resetSelect(),i.curPerspectiveIdx=0,d.setData(a);var k=[],m=[];a.levels.forEach(function(a){"SEGMENT"!==a.type&&"EVENT"!==a.type||(k.push(a.name),m.push({name:a.name,type:a.type,attributeDefinitions:{name:a.name,type:"string"}}))}),f.curDbConfig.levelDefinitions=m,i.setCurLevelAttrDefs(f.curDbConfig.levelDefinitions),f.setPerspectivesOrder(i.curPerspectiveIdx,k),i.somethingInProgressTxt="Parsing SSFF files...",h=e.validateJSO("annotationFileSchema",a),h===!0?(d.setLinkData(a.links),i.setState("labeling"),i.somethingInProgress=!1,i.somethingInProgressTxt="Done!"):c.open("views/error.html","Error validating annotation file: "+JSON.stringify(h,null,4)).then(function(){q.resetToInitState()}),l.isBrowser.PhantomJS()||i.selectLevel(!1,f.vals.perspectives[i.curPerspectiveIdx].levelCanvases.order,p)}}),i.somethingInProgress=!1},q}]),angular.module("emuwebApp").directive("lineChart",function(){return{restrict:"E",scope:{data:"=",threshold:"="},link:function(a,b){a.$watch("data",function(){a.render(a.data)},!0);var c={top:20,right:20,bottom:20,left:40},d=400-c.left-c.right,e=200-c.top-c.bottom,f=d3.select(b[0]).append("svg").attr("width",d+c.left+c.right).attr("height",e+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")"),g=d3.scale.linear().range([0,d]),h=d3.scale.linear().range([e,0]),i=d3.svg.axis().scale(g).tickSize(5).tickSubdivide(!0),j=d3.svg.axis().scale(h).orient("left"),k=d3.svg.line().x(function(a){return g(a.x)}).y(function(a){return h(a.y)}).interpolate("linear");a.render=function(b){g.domain([d3.min(b,function(a){return a.x}),d3.max(b,function(a){return a.x})]),h.domain([d3.min(b,function(a){return a.y}),d3.max(b,function(a){return a.y})]),f.selectAll("g.axis").remove(),f.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")").call(i),f.append("g").attr("class","y axis").call(j),f.append("svg:path").attr("d",k(b)).attr("stroke","red").attr("stroke-width",1).attr("fill","none"),f.append("svg:line").attr("x1",5).attr("y1",5).attr("x2",200).attr("y2",200).attr("class","label-line"),f.append("line").attr({x1:g(a.threshold),y1:0,x2:g(a.threshold),y2:e}).attr("stroke","steelblue").attr("class","verticalLine")}}}}),angular.module("emuwebApp").directive("hint",function(){return{templateUrl:"views/hint.html",replace:!0,restrict:"E",link:function(a){a.hideMe=function(){a.internalVars.showAboutHint=!a.internalVars.showAboutHint,a.aboutBtnClick()}}}}),angular.module("emuwebApp").directive("perspectives",function(){return{templateUrl:"views/perspectives.html",replace:!0,restrict:"E"}}),angular.module("emuwebApp").service("loadedMetaDataService",["Validationservice",function(a){function b(a){var b,c=[];return a.forEach(function(a,d){c[a.session]={collapsed:!0},0===d&&(b=a.session)}),c[b].collapsed=!1,c}function c(a){return a.forEach(function(a){void 0===i[a.session]&&(i[a.session]=[]),i[a.session].push(a)}),i}var d={},e=[],f=[],g={},h="",i={};return d.setBundleList=function(d){var g=a.validateJSO("bundleListSchema",d);return g===!0&&(f=d,e=b(f),i=c(f)),g},d.getBundleList=function(){return f},d.getRendOptBndlList=function(){return i},d.getCurBndl=function(){return g},d.setCurBndl=function(a){g=a},d.setBndlComment=function(a,b,c){i[b][c].comment=a},d.setBndlFinished=function(a,b,c){i[b][c].finishedEditing=a},d.getCurBndlName=function(){return g.name},d.setCurBndlName=function(a){g.name=a},d.setTimeAnchors=function(a){g.timeAnchors=a},d.setDemoDbName=function(a){h=a},d.getDemoDbName=function(){return h},d.toggleCollapseSession=function(a){void 0===e[a]&&(e[a]={}),e[a].collapsed=!e[a].collapsed,Object.keys(e).forEach(function(b){b!==a&&(e[b].collapsed=!0)})},d.openCollapseSession=function(a){e[a]={},e[a].collapsed=!1,Object.keys(e).forEach(function(b){b!==a&&(e[b].collapsed=!0)})},d.getSessionCollapseState=function(a){return void 0===e[a]?void 0:e[a].collapsed},d.resetToInitState=function(){e=[],f=[],g={},i={}},d}]),angular.module("emuwebApp").controller("bundleListSideBarCtrl",["$scope","viewState","HistoryService","loadedMetaDataService","dbObjLoadSaveService","ConfigProviderService","LevelService",function(a,b,c,d,e,f,g){a.vs=b,a.lmds=d,a.dolss=e,a.cps=f,a.ls=g,a.filterText="",a.vs.pageSize=500,a.vs.currentPage=0,a.turn=function(b){b?a.vs.currentPage++:a.vs.currentPage--},a.getBndlColor=function(a){var b;b=0!==c.movesAwayFromLastSave?{"background-color":"#f00",color:"white"}:{"background-color":"#999",color:"black"};var e=d.getCurBndl();if(a.name===e.name&&a.session===e.session)return b},a.isSessionDefined=function(a){return"undefined"!==a},a.nextPrevAnchor=function(b){var c=d.getCurBndl();b?a.vs.curTimeAnchorIdx<c.timeAnchors.length-1&&(a.vs.curTimeAnchorIdx=a.vs.curTimeAnchorIdx+1,a.vs.select(c.timeAnchors[a.vs.curTimeAnchorIdx].sample_start,c.timeAnchors[a.vs.curTimeAnchorIdx].sample_end),a.vs.setViewPort(c.timeAnchors[a.vs.curTimeAnchorIdx].sample_start,c.timeAnchors[a.vs.curTimeAnchorIdx].sample_end),a.vs.zoomViewPort(!1,a.ls)):a.vs.curTimeAnchorIdx>0&&(a.vs.curTimeAnchorIdx=a.vs.curTimeAnchorIdx-1,a.vs.select(c.timeAnchors[a.vs.curTimeAnchorIdx].sample_start,c.timeAnchors[a.vs.curTimeAnchorIdx].sample_end),a.vs.setViewPort(c.timeAnchors[a.vs.curTimeAnchorIdx].sample_start,c.timeAnchors[a.vs.curTimeAnchorIdx].sample_end),a.vs.zoomViewPort(!1,a.ls))},a.getTimeAnchorIdxMax=function(){var a,b=d.getCurBndl();return a=angular.equals({},b)?-1:b.timeAnchors.length-1},a.isCurBndl=function(a){var b=d.getCurBndl();return a.name===b.name&&a.session===b.session}}]),angular.module("emuwebApp").service("dbObjLoadSaveService",["$log","$q","DataService","viewState","HistoryService","loadedMetaDataService","Ssffdataservice","Iohandlerservice","Binarydatamaniphelper","Wavparserservice","Soundhandlerservice","Ssffparserservice","Validationservice","LevelService","modalService","ConfigProviderService","appStateService","StandardFuncsService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s={};return s.loadBundle=function(a){var r=b.defer();if(d.setcurClickItem(null),0!==e.movesAwayFromLastSave&&"DEMO"!==p.vals.main.comMode&&p.vals.activeButtons.saveBundle){var t=f.getCurBndl();a!==t&&o.open("views/saveChanges.html",t.session+":"+t.name).then(function(b){"saveChanges"===b?s.saveBundle().then(function(){s.loadBundle(a)}):"discardChanges"===b&&(e.resetToInitState(),s.loadBundle(a))})}else a!==f.getCurBndl()&&(e.resetToInitState(),d.hierarchyState.reset(),n.deleteEditArea(),d.setEditing(!1),d.setState("loadingSaving"),d.somethingInProgress=!0,d.somethingInProgressTxt="Loading bundle: "+a.name,g.data=[],h.getBundle(a.name,a.session,f.getDemoDbName()).then(function(b){200===b.status&&(b=b.data);var e=m.validateJSO("bundleSchema",b);if(e===!0){var h;h=i.base64ToArrayBuffer(b.mediaFile.data),d.somethingInProgressTxt="Parsing WAV file...",j.parseWavAudioBuf(h).then(function(e){var h=e;d.curViewPort.sS=0,d.curViewPort.eS=h.length,void 0!==a.timeAnchors&&a.timeAnchors.length>0?(d.curViewPort.selectS=a.timeAnchors[0].sample_start,d.curViewPort.selectE=a.timeAnchors[0].sample_end):d.resetSelect(),d.curTimeAnchorIdx=-1,d.curClickSegments=[],d.curClickLevelName=void 0,d.curClickLevelType=void 0,k.audioBuffer=h,d.somethingInProgressTxt="Parsing SSFF files...",l.asyncParseSsffArr(b.ssffFiles).then(function(e){g.data=e.data,c.setData(b.annotation),f.setCurBndl(a),d.selectLevel(!1,p.vals.perspectives[d.curPerspectiveIdx].levelCanvases.order,n),d.setState("labeling"),d.somethingInProgress=!1,d.somethingInProgressTxt="Done!",r.resolve()},function(a){o.open("views/error.html","Error parsing SSFF file: "+a.status.message).then(function(){q.resetToInitState()})})},function(a){o.open("views/error.html","Error parsing wav file: "+a.status.message).then(function(){q.resetToInitState()})})}else o.open("views/error.html","Error validating annotation file: "+JSON.stringify(e,null,4)).then(function(){q.resetToInitState()})},function(a){a.data?o.open("views/error.html","Error loading bundle: "+a.data).then(function(){q.resetToInitState()}):o.open("views/error.html","Error loading bundle: "+a.status.message).then(function(){q.resetToInitState()})}));return r.promise},s.saveBundle=function(){if(d.getPermission("saveBndlBtnClick")){var c=b.defer();d.somethingInProgress=!0,d.setState("loadingSaving");var e={};d.somethingInProgressTxt="Creating bundle json...",e.ssffFiles=[];var f=g.getFile("FORMANTS");return void 0!==f?l.asyncJso2ssff(f).then(function(a){e.ssffFiles.push({fileExtension:f.fileExtension,encoding:"BASE64",data:i.arrayBufferToBase64(a.data)}),s.getAnnotationAndSaveBndl(e,c)},function(a){o.open("views/error.html","Error converting javascript object to SSFF file: "+a.status.message),c.reject()}):s.getAnnotationAndSaveBndl(e,c),c.promise}a.info("Action: menuBundleSaveBtnClick not allowed!")},s.getAnnotationAndSaveBndl=function(b,g){d.somethingInProgressTxt="Validating annotJSON ...";var i=m.validateJSO("annotationFileSchema",c.getData());i!==!0&&(a.warn("PROBLEM: trying to save bundle but bundle is invalid. traverseAndClean() will be called."),a.error(i)),r.traverseAndClean(c.getData()),b.annotation=c.getData(),b.mediaFile={encoding:"BASE64",data:""};var j=f.getCurBndl();"undefined"!=typeof j.session&&(b.session=j.session),"undefined"!=typeof j.finishedEditing&&(b.finishedEditing=j.finishedEditing),"undefined"!=typeof j.comment&&(b.comment=j.comment),d.somethingInProgressTxt="Validating bundle ...",i=m.validateJSO("bundleSchema",b),i!==!0?(a.error("GRAVE PROBLEM: trying to save bundle but bundle is invalid. traverseAndClean() HAS ALREADY BEEN CALLED."),a.error(i),o.open("views/error.html","Somehow the data for this bundle has been corrupted. This is most likely a nasty and diffucult to spot bug. If you are at the IPS right now, please contact an EMU developer immediately. The Validation error is: "+JSON.stringify(i,null,4)).then(function(){d.somethingInProgressTxt="",d.somethingInProgress=!1,d.setState("labeling"),g.reject()})):(d.somethingInProgressTxt="Saving bundle...",h.saveBundle(b).then(function(){d.somethingInProgressTxt="Done!",d.somethingInProgress=!1,e.movesAwayFromLastSave=0,g.resolve(),d.setState("labeling")},function(a){o.open("views/error.html","Error saving bundle: "+a.status.message).then(function(){q.resetToInitState()}),g.reject()}))},s}]),angular.module("emuwebApp").service("appStateService",["$log","$rootScope","$location","DragnDropService","DragnDropDataService","viewState","Iohandlerservice","loadedMetaDataService","Soundhandlerservice","DataService","Ssffdataservice","HistoryService",function(a,b,c,d,e,f,g,h,i,j,k,l){var m={};return m.resetToInitState=function(){g.wsH.isConnected()&&g.wsH.disconnectWarning().then(function(){a.info("Closing websocket connection to server"),g.wsH.closeConnect()}),h.resetToInitState(),i.audioBuffer={},j.setData({}),e.resetToInitState(),d.resetToInitState(),k.data=[],l.resetToInitState(),f.setState("noDBorFilesloaded"),f.somethingInProgress=!1,f.resetToInitState(),l.resetToInitState(),f.showDropZone=!0,c.url(c.path()),b.$broadcast("resetToInitState")},m.reloadToInitState=function(a){g.wsH.closeConnect();var c=f.url;h.resetToInitState(),i.audioBuffer={},j.setData({}),e.resetToInitState(),d.resetToInitState(),k.data=[],l.resetToInitState(),f.setState("noDBorFilesloaded"),f.somethingInProgress=!1,l.resetToInitState(),f.resetToInitState(),b.$broadcast("reloadToInitState",{url:c,session:a,reload:!0})},m}]),EspsParserWorker.prototype={getWorkerScript:function(){var a="";return a+="("+this.workerInit+")(this);"},workerInit:function(a){a.toJSO=function(a,b,c,d){var e={};e.name=c,e.annotates=b,e.sampleRate=d,e.levels=[],a=a.replace(/([ \t]*\r?\n)+/g,"\n"),a=a.replace(/[ \t]+/g," ");for(var f,g=a.split("\n"),h=0;h<g.length;h++)if("#"===g[h]){f=h;break}e.levels[0]={},e.levels[0].name=c,e.levels[0].items=[];var i,j=1,k=g[f+1].split(/\s+/);if("H#"!==k[k.length-1]?e.levels[0].type="EVENT":e.levels[0].type="SEGMENT","EVENT"===e.levels[0].type)for(h=f+1;h<g.length-1;h++)k=g[h].split(/\s+/),e.levels[0].items.push({id:j,labels:[{name:c,value:k[k.length-1]}],samplePoint:Math.floor(k[1]*d)}),j+=1;else for(j+=1,h=f+2;h<g.length-1;h++)k=g[h].split(/\s+/),i=g[h-1].split(/\s+/),e.levels[0].items.push({id:j,labels:[{name:c,value:k[k.length-1]}],sampleStart:Math.floor(i[1]*d),sampleDur:Math.floor(k[1]*d)-Math.floor(i[1]*d)-1}),j+=1;return e},a.toESPS=function(a,b,c){var d="";d+="signal "+b+"\n",d+="nfields 1\n",d+="#\n";for(var e,f=0;f<a.length;f++)e=""===a[f].labels[0].value&&0===f?"H#":a[f].labels[0].value,d+="\t"+String((a[f].sampleStart+a[f].sampleDur)/c)+"\t125\t"+e+"\n";return d},a.onmessage=function(b){if(void 0!==b.data){var c;switch(b.data.cmd){case"parseESPS":c=a.toJSO(b.data.esps,b.data.annotates,b.data.name,b.data.sampleRate),void 0===c.type?a.postMessage({status:{type:"SUCCESS",message:""},data:c}):a.postMessage(c);break;case"parseJSO":c=a.toESPS(b.data.level.items,b.data.level.name,b.data.sampleRate),void 0===c.type?a.postMessage({status:{type:"SUCCESS",message:""},data:c}):a.postMessage(c);break;default:a.postMessage({status:{type:"ERROR",message:"Unknown command sent to espsParserWorker"}})}}else a.postMessage({status:{type:"ERROR",message:"Undefined message was sent to espsParserWorker"}})}},getWorkerURL:function(){var a,b;try{a=new Blob([this.getWorkerScript()],{type:"application/javascript"})}catch(b){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,a=new BlobBuilder,a.append(EspsParserWorker),a=a.getBlob()}return b="object"!=typeof URL&&"undefined"!=typeof webkitURL?webkitURL.createObjectURL(a):URL.createObjectURL(a)},kill:function(){this.worker&&this.worker.terminate(),this.url&&URL.revokeObjectURL(this.url)},tell:function(a){this.worker&&this.worker.postMessage(a)},says:function(a){this.worker&&this.worker.addEventListener("message",function(b){a(b.data)})}},TextGridParserWorker.prototype={getWorkerScript:function(){var a="";return a+="("+this.workerInit+")(this);"},workerInit:function(a){a.l1='File type = "ooTextFile"',a.l2='Object class = "TextGrid"',a.localID=0,a.testForGapsInLabelJSO=function(a){for(var b=0,c=0;c<a.levels.length;c++)if("SEGMENT"===a.levels[c].type)for(var d=0;d<a.levels[c].items.length-1;d++)a.levels[c].items[d].sampleStart+a.levels[c].items[d].sampleDur+1!==a.levels[c].items[d+1].sampleStart&&(b+=1)},a.findTimeOfMinSample=function(){return 0},a.findTimeOfMaxSample=function(a,b){return a/b},a.toJSO=function(b,c,d,e){var f="123abcABCCBAcba321";b=b.replace(/([ \t]*\r?\n)+/g,"\n"),b=b.replace(/("[^\n]*")/g,function(a,b){var c=b.replace(/\s+/g,f);return c}),b=b.replace(/[\t ]+/g,"");var g=new RegExp(f,"g");b=b.replace(g," ");var h,i,j,k,l=b.split("\n"),m=!0,n=[],o={name:d,annotates:c,sampleRate:e,levels:[],links:[]};if(l[0].replace(/\s+/g,"")===a.l1.replace(/\s+/g,"")&&l[1].replace(/\s+/g,"")===a.l2.replace(/\s+/g,"")){for(var p=2;p<l.length;p++){var q=l[p];if("item[]:"!==q){if(!m)if(0===q.indexOf("item[")&&(i=l[p+2].split(/=/)[1].replace(/"/g,""),'"IntervalTier"'===l[p+1].split(/=/)[1]?(h="SEGMENT",o.levels.push({name:i,type:h,items:[]})):'"TextTier"'===l[p+1].split(/=/)[1]&&(h="EVENT",o.levels.push({name:i,type:h,items:[]}))),o.levels.length>0&&"SEGMENT"===o.levels[o.levels.length-1].type&&0===q.indexOf("intervals")&&0!==q.indexOf("intervals:")){var r=Math.floor(l[p+1].split(/=/)[1]*e),s=Math.floor(l[p+2].split(/=/)[1]*e);k=l[p+3].split(/=/)[1].replace(/"/g,""),n=[],n.push({name:o.levels[o.levels.length-1].name,value:k}),o.levels[o.levels.length-1].items.push({id:a.localID,sampleStart:r,sampleDur:s-r-1,labels:n}),++a.localID}else o.levels.length>0&&"EVENT"===o.levels[o.levels.length-1].type&&0===q.indexOf("points")&&0!==q.indexOf("points:")&&(j=l[p+1].split(/=/)[1]*e,k=l[p+2].split(/=/)[1].replace(/"/g,""),n=[],n.push({name:o.levels[o.levels.length-1].name,value:k}),o.levels[o.levels.length-1].items.push({id:a.localID,samplePoint:Math.round(j),labels:n}),++a.localID)}else m=!1}return a.testForGapsInLabelJSO(o),o}return{status:{type:"ERROR",message:"bad header in TextGrid file!!! The header has to be: "+a.l1+"\n"+a.l2+"; Note: Currently only long-form text TextGrids are supported!"}}},a.toTextGrid=function(b,c,d){var e="",f="\n",g="\t";e=e+a.l1+f+a.l2+f+f,e=e+"xmin = "+a.findTimeOfMinSample()+f,e=e+"xmax = "+a.findTimeOfMaxSample(c,d)+f,e=e+"levels? <exists>"+f,e=e+"size = "+b.length+f,e=e+"item []:"+f;for(var h=0;h<b.length;h++){var i=b[h];e=e+g+"item ["+h+"]:"+f,"SEGMENT"===i.type?e=e+g+g+'class = "IntervalTier"'+f:"EVENT"===i.type&&(e=e+g+g+'class = "TextTier"'+f),e=e+g+g+'name = "'+i.name+'"'+f,e=e+g+g+"xmin = "+a.findTimeOfMinSample()+f,e=e+g+g+"xmax = "+a.findTimeOfMaxSample(c,d)+f,"SEGMENT"===i.type?e=e+g+g+"intervals: size = "+i.items.length+f:"EVENT"===i.type&&(e=e+g+g+"points: size = "+i.items.length+f);for(var j,k=0;k<i.items.length;k++){var l=k+1;"SEGMENT"===i.type?(e=e+g+g+g+"intervals ["+l+"]:"+f,0!==i.items[k].sampleStart?(j=i.items[k].sampleStart/d+1/d/2,e=e+g+g+g+g+"xmin = "+j+f):e=e+g+g+g+g+"xmin = 0"+f,k<i.items.length-1?(j=(i.items[k].sampleStart+i.items[k].sampleDur)/d+1/d/2,e=e+g+g+g+g+"xmax = "+j+f):e=e+g+g+g+g+"xmax = "+a.findTimeOfMaxSample(c,d)+f,e=e+g+g+g+g+'text = "'+i.items[k].labels[0].value+'"'+f):"EVENT"===i.type&&(e=e+g+g+g+"points["+l+"]:"+f,e=e+g+g+g+g+"time = "+i.items[k].samplePoint/d+f,e=e+g+g+g+g+'mark = "'+i.items[k].labels[0].value+'"'+f)}}return e},a.onmessage=function(b){if(void 0!==b.data){var c;switch(b.data.cmd){case"parseTG":c=a.toJSO(b.data.textGrid,b.data.annotates,b.data.name,b.data.sampleRate),void 0===c.status?a.postMessage({status:{type:"SUCCESS",message:""},data:c}):a.postMessage(c);break;case"toTextGrid":c=a.toTextGrid(b.data.levels,b.data.buffLength,b.data.sampleRate),void 0===c.status?a.postMessage({status:{type:"SUCCESS",message:""},data:c}):a.postMessage(c);break;default:a.postMessage({status:{type:"ERROR",message:"Unknown command sent to TextGridParserWorker"}})}}else a.postMessage({status:{type:"ERROR",message:"Undefined message was sent to TextGridParserWorker"}})}},getWorkerURL:function(){var a,b;try{a=new Blob([this.getWorkerScript()],{type:"application/javascript"})}catch(b){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,a=new BlobBuilder,a.append(TextGridParserWorker),a=a.getBlob()}return b="object"!=typeof URL&&"undefined"!=typeof webkitURL?webkitURL.createObjectURL(a):URL.createObjectURL(a)},kill:function(){this.worker&&this.worker.terminate(),this.url&&URL.revokeObjectURL(this.url)},tell:function(a){this.worker&&this.worker.postMessage(a)},says:function(a){this.worker&&this.worker.addEventListener("message",function(b){a(b.data)})}},SpectroDrawingWorker.prototype={getWorkerScript:function(){var a="";return a+="("+this.workerInit+")(this);"},workerInit:function(a){a.executed=!1,a.PI=3.141592653589793,a.TWO_PI=6.283185307179586,a.totalMax=0,a.dynRangeInDB=50,a.myWindow={BARTLETT:1,BARTLETTHANN:2,BLACKMAN:3,COSINE:4,GAUSS:5,HAMMING:6,HANN:7,LANCZOS:8,RECTANGULAR:9,TRIANGULAR:10},a.imgWidth=0,a.imgHeight=0,a.upperFreq=0,a.lowerFreq=0,a.pixelRatio=1,a.heatMapColorAnchors=[[255,0,0],[0,255,0],[0,0,0]],a.samplesPerPxl=0,a.sampleRate=0,a.preEmphasisFilterFactor=.97,a.transparency=0,a.drawHeatMapColors=!1,a.N=0,a.windowSizeInSecs=.01,a.audioBuffer=void 0,a.audioBufferChannels=0,a.wFunction=0,a.myFFT=void 0,a.pixelHeight=1,a.internalalpha=1,a.maxPsd=0,a.HzStep=0,a.paint=[],a.sin=void 0,a.cos=void 0,a.ceilingFreqFftIdx=0,a.floorFreqFftIdx=0,a.resultImgArr=void 0,a.toLinearLevel=function(a){return Math.pow(10,a/10)},a.log10=function(a){return Math.log(a)/2.302585092994046},a.magnitude=function(a,b){return Math.sqrt(a*a+b*b)},a.FFT=function(){var b,c,d,e=a.N;if(b=parseInt(Math.log(e)/.6931471805599453,10),void 0===a.cos||e!==a.N)for(a.cos=new Float32Array(e/2),d=0;d<e/2;d++)a.cos[d]=Math.cos(-2*a.PI*d/e);if(void 0===a.sin||e!==a.N)for(a.sin=new Float32Array(e/2),d=0;d<e/2;d++)a.sin[d]=Math.sin(-2*a.PI*d/e);this.applyWindowFuncAndPreemph=function(b,d,e,f){switch(this.alpha=d,b){case a.myWindow.BARTLETT:for(c=0;c<f;c++)c>0&&(e[c]=this.applyPreEmph(e[c],e[c-1])),e[c]*=this.wFunctionBartlett(f,c);break;case a.myWindow.BARTLETTHANN:for(c=0;c<f;c++)c>0&&(e[c]=this.applyPreEmph(e[c],e[c-1])),e[c]*=this.wFunctionBartlettHann(f,c);break;case a.myWindow.BLACKMAN:for(this.alpha=this.alpha||.16,c=0;c<f;c++)c>0&&(e[c]=this.applyPreEmph(e[c],e[c-1])),e[c]*=this.wFunctionBlackman(f,c,d);break;case a.myWindow.COSINE:for(c=0;c<f;c++)c>0&&(e[c]=this.applyPreEmph(e[c],e[c-1])),e[c]*=this.wFunctionCosine(f,c);break;case a.myWindow.GAUSS:for(this.alpha=this.alpha||.25,c=0;c<f;c++)c>0&&(e[c]=this.applyPreEmph(e[c],e[c-1])),e[c]*=this.wFunctionGauss(f,c,d);break;case a.myWindow.HAMMING:for(c=0;c<f;c++)c>0&&(e[c]=this.applyPreEmph(e[c],e[c-1])),e[c]*=this.wFunctionHamming(f,c);break;case a.myWindow.HANN:for(c=0;c<f;c++)c>0&&(e[c]=this.applyPreEmph(e[c],e[c-1])),e[c]*=this.wFunctionHann(f,c);break;case a.myWindow.LANCZOS:for(c=0;c<f;c++)c>0&&(e[c]=this.applyPreEmph(e[c],e[c-1])),e[c]*=this.wFunctionLanczos(f,c);break;case a.myWindow.RECTANGULAR:for(c=0;c<f;c++)c>0&&(e[c]=this.applyPreEmph(e[c],e[c-1])),e[c]*=this.wFunctionRectangular(f,c);break;case a.myWindow.TRIANGULAR:for(c=0;c<f;c++)c>0&&(e[c]=this.applyPreEmph(e[c],e[c-1])),e[c]*=this.wFunctionTriangular(f,c)}return e},this.wFunctionBartlett=function(a,b){return 2/(a-1)*((a-1)/2-Math.abs(b-(a-1)/2))},this.wFunctionBartlettHann=function(b,c){return.62-.48*Math.abs(c/(b-1)-.5)-.38*Math.cos(a.TWO_PI*c/(b-1))},this.wFunctionBlackman=function(b,c,d){var e=(1-d)/2,f=.5,g=d/2;return e-f*Math.cos(a.TWO_PI*c/(b-1))+g*Math.cos(4*a.PI*c/(b-1))},this.wFunctionCosine=function(b,c){return Math.cos(a.PI*c/(b-1)-a.PI/2)},this.wFunctionGauss=function(a,b,c){return Math.pow(Math.E,-.5*Math.pow((b-(a-1)/2)/(c*(a-1)/2),2))},this.wFunctionHamming=function(b,c){return.54-.46*Math.cos(a.TWO_PI*c/(b-1))},this.wFunctionHann=function(b,c){return.5*(1-Math.cos(a.TWO_PI*c/(b-1)))},this.wFunctionLanczos=function(b,c){var d=2*c/(b-1)-1;return Math.sin(a.PI*d)/(a.PI*d)},this.wFunctionRectangular=function(){return 1},this.wFunctionTriangular=function(a,b){return 2/a*(a/2-Math.abs(b-(a-1)/2))},this.applyPreEmph=function(b,c){return b-a.preEmphasisFilterFactor*c},this.fft=function(c,d){var f,g,h,i,j,k,l,m,n,o;for(g=0,j=e/2,f=1;f<e-1;f++){for(i=j;g>=i;)g-=i,i/=2;g+=i,f<g&&(n=c[f],c[f]=c[g],c[g]=n,n=d[f],d[f]=d[g],d[g]=n)}for(i=0,j=1,f=0;f<b;f++)for(i=j,j+=j,k=0,g=0;g<i;g++)for(l=a.cos[k],m=a.sin[k],k+=1<<b-f-1,h=g;h<e;h+=j)n=l*c[h+i]-m*d[h+i],o=m*c[h+i]+l*d[h+i],c[h+i]=c[h]-n,d[h+i]=d[h]-o,c[h]=c[h]+n,d[h]=d[h]+o}},a.convertToHeatmap=function(a,b,c,d){var e=d.length-1,f=(c-a)/(b-a)*e,g=Math.floor(f),h=Math.min.apply(null,[Math.floor(f)+1,e]),i=d[g],j=d[h],k=f-g;return{r:Math.floor(i[0]+k*(j[0]-i[0])),g:Math.floor(i[1]+k*(j[1]-i[1])),b:Math.floor(i[2]+k*(j[2]-i[2]))}},a.drawVerticalLineOfSpectogram=function(b){var c,d,e,f,g=a.pixelHeight,h=2*Math.pow(a.paint[b][1],2)/a.N,i=10*a.log10(h/a.maxPsd),j=(i+a.dynRangeInDB)/a.dynRangeInDB;j>1?j=1:j<0&&(j=0);for(var k=0;k<a.paint[b].length;k++){var l=j;h=2*Math.pow(a.paint[b][k],2)/a.N,i=10*a.log10(h/a.maxPsd),j=(i+a.dynRangeInDB)/a.dynRangeInDB,j>1&&(j=1),j<0&&(j=0);var m=j;if(a.pixelHeight>=1)for(var n=0;n<a.pixelHeight;n++){var o=l+(m-l)/g*n;if(c=255-Math.round(255*o),e=Math.floor(b),f=Math.floor(a.imgHeight-(a.pixelHeight*(k-2)+n)),d=4*(e+f*a.imgWidth),a.drawHeatMapColors)if(isNaN(c))a.resultImgArr[d+0]=c,a.resultImgArr[d+1]=c,a.resultImgArr[d+2]=c,a.resultImgArr[d+3]=a.transparency;else{var p=a.convertToHeatmap(0,255,c,a.heatMapColorAnchors);a.resultImgArr[d+0]=p.r,a.resultImgArr[d+1]=p.g,a.resultImgArr[d+2]=p.b,a.resultImgArr[d+3]=a.transparency}else a.resultImgArr[d+0]=c,a.resultImgArr[d+1]=c,a.resultImgArr[d+2]=c,a.resultImgArr[d+3]=a.transparency}else c=255-Math.round(255*m),e=Math.floor(b),f=Math.floor(a.imgHeight-a.pixelHeight*(k-2)),d=4*(e+f*a.imgWidth),a.resultImgArr[d+0]=c,a.resultImgArr[d+1]=c,a.resultImgArr[d+2]=c,a.resultImgArr[d+3]=a.transparency}},a.calcMagnitudeSpectrum=function(b,c){for(var d=new Float32Array(a.N),e=new Float32Array(a.N),f=new Float32Array(a.ceilingFreqFftIdx-a.floorFreqFftIdx),g=0;g<c;g++)e[g]=a.audioBuffer[b+g];a.myFFT.applyWindowFuncAndPreemph(a.wFunction,a.internalalpha,e,c),a.myFFT.fft(e,d);for(var h=0;h<=a.ceilingFreqFftIdx-a.floorFreqFftIdx;h++)f[h]=a.magnitude(e[h+a.floorFreqFftIdx],d[h+a.floorFreqFftIdx]),a.totalMax<f[h]&&(a.totalMax=f[h]);return f},a.renderSpectrogram=function(){if(!a.executed){a.executed=!0;var b=a.sampleRate*a.windowSizeInSecs;a.myFFT=new a.FFT,a.paint=new Array(a.imgWidth),a.HzStep=a.sampleRate/2/(a.N/2),a.ceilingFreqFftIdx=Math.ceil(a.upperFreq/a.HzStep),a.floorFreqFftIdx=Math.floor(a.lowerFreq/a.HzStep),a.pixelHeight=a.imgHeight/(a.ceilingFreqFftIdx-a.floorFreqFftIdx-2),"undefined"==typeof Uint8ClampedArray&&(Uint8ClampedArray=Uint8Array),a.resultImgArr=new Uint8ClampedArray(Math.ceil(a.imgWidth*a.imgHeight*4));for(var c=0;c<a.imgWidth;c++)a.paint[c]=a.calcMagnitudeSpectrum(Math.round(c*a.samplesPerPxl),b),a.maxPsd=2*Math.pow(a.totalMax,2)/a.N;for(var d=0;d<a.imgWidth;d++)a.drawVerticalLineOfSpectogram(d);a.postMessage({window:a.wFunction,samplesPerPxl:a.samplesPerPxl,pixelHeight:a.pixelHeight,pixelRatio:a.pixelRatio,width:a.imgWidth,height:a.imgHeight,img:a.resultImgArr.buffer},[a.resultImgArr.buffer]),a.myFFT=null,a.executed=!1}},a.onmessage=function(b){if(void 0!==b.data){var c=!0,d="",e=b.data;if(void 0!==e.windowSizeInSecs?a.windowSizeInSecs=e.windowSizeInSecs:(d="windowSizeInSecs",c=!1),void 0!==e.fftN?a.N=e.fftN:(d="fftN",c=!1),void 0!==e.alpha?a.internalalpha=e.alpha:(d="alpha",c=!1),void 0!==e.upperFreq?a.upperFreq=e.upperFreq:(d="upperFreq",c=!1),void 0!==e.lowerFreq?a.lowerFreq=e.lowerFreq:(d="lowerFreq",c=!1),void 0!==e.samplesPerPxl?a.samplesPerPxl=e.samplesPerPxl:(d="samplesPerPxl",c=!1),void 0!==e.window)switch(e.window){case 1:a.wFunction=a.myWindow.BARTLETT;break;case 2:a.wFunction=a.myWindow.BARTLETTHANN;break;case 3:a.wFunction=a.myWindow.BLACKMAN;break;case 4:a.wFunction=a.myWindow.COSINE;break;case 5:a.wFunction=a.myWindow.GAUSS;break;case 6:a.wFunction=a.myWindow.HAMMING;
break;case 7:a.wFunction=a.myWindow.HANN;break;case 8:a.wFunction=a.myWindow.LANCZOS;break;case 9:a.wFunction=a.myWindow.RECTANGULAR;break;case 10:a.wFunction=a.myWindow.TRIANGULAR}else d="window",c=!1;void 0!==e.imgWidth?a.imgWidth=e.imgWidth:(d="imgWidth",c=!1),void 0!==e.imgHeight?a.imgHeight=e.imgHeight:(d="imgHeight",c=!1),void 0!==e.dynRangeInDB?a.dynRangeInDB=e.dynRangeInDB:(d="dynRangeInDB",c=!1),void 0!==e.pixelRatio?a.pixelRatio=e.pixelRatio:(d="pixelRatio",c=!1),void 0!==e.sampleRate?a.sampleRate=e.sampleRate:(d="sampleRate",c=!1),void 0!==e.audioBufferChannels?a.audioBufferChannels=e.audioBufferChannels:(d="audioBufferChannels",c=!1),void 0!==e.transparency?a.transparency=e.transparency:(d="transparency",c=!1),void 0!==e.audioBuffer?a.audioBuffer=e.audioBuffer:(d="audioBuffer",c=!1),void 0!==e.drawHeatMapColors?a.drawHeatMapColors=e.drawHeatMapColors:(d="drawHeatMapColors",c=!1),void 0!==e.preEmphasisFilterFactor?a.preEmphasisFilterFactor=e.preEmphasisFilterFactor:(d="preEmphasisFilterFactor",c=!1),void 0!==e.heatMapColorAnchors?a.heatMapColorAnchors=e.heatMapColorAnchors:(d="heatMapColorAnchors",c=!1),c?a.renderSpectrogram():a.postMessage({status:{type:"ERROR",message:d+" is undefined"}})}else a.postMessage({status:{type:"ERROR",message:"Undefined message was sent to spectroDrawingWorker"}})}},getWorkerURL:function(){var a,b;try{a=new Blob([this.getWorkerScript()],{type:"application/javascript"})}catch(b){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,a=new BlobBuilder,a.append(SpectroDrawingWorker),a=a.getBlob()}return b="object"!=typeof URL&&"undefined"!=typeof webkitURL?webkitURL.createObjectURL(a):URL.createObjectURL(a)},kill:function(){this.worker&&this.worker.terminate(),this.url&&("object"!=typeof URL&&"undefined"!=typeof webkitURL?webkitURL.revokeObjectURL(this.url):URL.revokeObjectURL(this.url))},tell:function(a){this.worker&&this.worker.postMessage(a)},says:function(a){this.worker&&this.worker.addEventListener("message",function(b){a(b.data)})}},SsffParserWorker.prototype={getWorkerScript:function(){var a="";return a+="("+this.workerInit+")(this);"},workerInit:function(a){var b={},c="SSFF -- (c) SHLRC\n",d="Machine IBM-PC\n",e="-----------------\n";b.fileExtension="",b.sampleRate=-1,b.startTime=-1,b.origFreq=-1,b.Columns=[],function(){function b(a){var b,c,e,f,g,h;for(e=a.length,c=0,b="";c<e;){if(f=255&a.charCodeAt(c++),c===e){b+=d.charAt(f>>2),b+=d.charAt((3&f)<<4),b+="==";break}if(g=a.charCodeAt(c++),c===e){b+=d.charAt(f>>2),b+=d.charAt((3&f)<<4|(240&g)>>4),b+=d.charAt((15&g)<<2),b+="=";break}h=a.charCodeAt(c++),b+=d.charAt(f>>2),b+=d.charAt((3&f)<<4|(240&g)>>4),b+=d.charAt((15&g)<<2|(192&h)>>6),b+=d.charAt(63&h)}return b}function c(a){var b,c,d,f,g,h,i;for(h=a.length,g=0,i="";g<h;){do b=e[255&a.charCodeAt(g++)];while(g<h&&b===-1);if(b===-1)break;do c=e[255&a.charCodeAt(g++)];while(g<h&&c===-1);if(c===-1)break;i+=String.fromCharCode(b<<2|(48&c)>>4);do{if(d=255&a.charCodeAt(g++),61===d)return i;d=e[d]}while(g<h&&d===-1);if(d===-1)break;i+=String.fromCharCode((15&c)<<4|(60&d)>>2);do{if(f=255&a.charCodeAt(g++),61===f)return i;f=e[f]}while(g<h&&f===-1);if(f===-1)break;i+=String.fromCharCode((3&d)<<6|f)}return i}var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);a.btoa||(a.btoa=b),a.atob||(a.atob=c)}(),a.base64ToArrayBuffer=function(b){for(var c=a.atob(b),d=c.length,e=new Uint8Array(d),f=0;f<d;f++){var g=c.charCodeAt(f);e[f]=g}return e.buffer},a.round=function(a,b){if(b<1||b>14)return!1;var c=Math.pow(10,b),d=(Math.round(a*c)/c).toString();return d.indexOf(".")===-1&&(d+="."),d+=c.toString().substring(1),d.substring(0,d.indexOf(".")+b+1)},a.stringToUint=function(a){for(var b=a.split(""),c=[],d=0;d<b.length;d++)c.push(b[d].charCodeAt(0));return new Uint8Array(c)},a.Uint8Concat=function(a,b){var c=a.length,d=new Uint8Array(c+b.length);return d.set(a),d.set(b,c),d},a.ssff2jso=function(a,f){b.fileExtension=f,b.Columns=[];var g=new Uint8Array(a),h=new DataView(a),i="";if("TextDecoder"in this){var j=new TextDecoder("ASCII");i=j.decode(h)}else for(var k=0;k<g.length;k++)i+=String.fromCharCode(g[k]);var l=i.split(/^/m);if(l[0]!==c)return{status:{type:"ERROR",message:"SSFF parse error: first line != SSFF -- (c) SHLRC in file with fileExtension "+f}};if(l[1]!==d)return{status:{type:"ERROR",message:"SSFF parse error: machineID != Machine IBM-PC in file with fileExtension "+f}};b.sampleRate=void 0,b.startTime=void 0;for(var m=0;l[m]!==e;)"Record_Freq"===l[m].split(/[ ,]+/)[0]&&(b.sampleRate=parseFloat(l[m].split(/[ ,]+/)[1].replace(/(\r\n|\n|\r)/gm,""))),"Start_Time"===l[m].split(/[ ,]+/)[0]&&(b.startTime=parseFloat(l[m].split(/[ ,]+/)[1].replace(/(\r\n|\n|\r)/gm,""))),m+=1;if(void 0===b.sampleRate||void 0===b.startTime)return{status:{type:"ERROR",message:"SSFF parse error: Required fields Record_Freq or Start_Time not set in file with fileExtension "+f}};for(var n=4;n<l.length&&("Original_Freq"===l[n].split(/[ ,]+/)[0]&&(b.origFreq=parseFloat(l[n].split(/[ ,]+/)[2].replace(/(\r\n|\n|\r)/gm,""))),l[n]!==e);n++){var o=l[n].split(/[ ]+/);"Column"===o[0]&&b.Columns.push({name:o[1],ssffdatatype:o[2],length:parseInt(o[3].replace(/(\r\n|\n|\r)/gm,""),10),values:[],_minVal:1/0,_maxVal:-(1/0)})}for(var p,q,r,s,t,u=l.slice(0,n+1).join("").length;u<g.length;)for(n=0;n<b.Columns.length;n++)if("DOUBLE"===b.Columns[n].ssffdatatype)r=8*b.Columns[n].length,q=a.subarray(u,r),"undefined"==typeof Float64Array&&(Float64Array=Float32Array),p=new Float64Array(q),b.Columns[n].values.push(Array.prototype.slice.call(p)),u+=r,s=Math.min.apply(null,Array.prototype.slice.call(p)),t=Math.max.apply(null,Array.prototype.slice.call(p)),s<b.Columns[n]._minVal&&(b.Columns[n]._minVal=s),t>b.Columns[n]._maxVal&&(b.Columns[n]._maxVal=t);else if("FLOAT"===b.Columns[n].ssffdatatype)r=4*b.Columns[n].length,q=a.subarray(u,r),p=new Float32Array(q),b.Columns[n].values.push(Array.prototype.slice.call(p)),u+=r,s=Math.min.apply(null,Array.prototype.slice.call(p)),t=Math.max.apply(null,Array.prototype.slice.call(p)),s<b.Columns[n]._minVal&&(b.Columns[n]._minVal=s),t>b.Columns[n]._maxVal&&(b.Columns[n]._maxVal=t);else if("SHORT"===b.Columns[n].ssffdatatype)r=2*b.Columns[n].length,q=a.subarray(u,r),p=new Uint16Array(q),b.Columns[n].values.push(Array.prototype.slice.call(p)),u+=r,s=Math.min.apply(null,Array.prototype.slice.call(p)),t=Math.max.apply(null,Array.prototype.slice.call(p)),s<b.Columns[n]._minVal&&(b.Columns[n]._minVal=s),t>b.Columns[n]._maxVal&&(b.Columns[n]._maxVal=t);else{if("BYTE"!==b.Columns[n].ssffdatatype)return{status:{type:"ERROR",message:"Unsupported column type! Only DOUBLE, FLOAT, SHORT, BYTE column types are currently supported in file with fileExtension "+f}};r=1*b.Columns[n].length,q=a.subarray(u,r),p=new Uint8Array(q),b.Columns[n].values.push(Array.prototype.slice.call(p)),u+=r}return b},a.jso2ssff=function(b){var f=c+d;f+="Record_Freq "+a.round(b.sampleRate,1)+"\n",f+="Start_Time "+b.startTime+"\n",b.Columns.forEach(function(a){f+="Column "+a.name+" "+a.ssffdatatype+" "+a.length+"\n"}),f+="Original_Freq DOUBLE "+a.round(b.origFreq,1)+"\n",f+=e;var g=0,h=!1;if(b.Columns.forEach(function(a){"SHORT"===a.ssffdatatype?g+=2*a.length:h=!0}),h)return{status:{type:"ERROR",message:"Unsupported column type! Only SHORT columns supported for now!"}};var i=g*b.Columns[0].values.length,j=new ArrayBuffer(i),k=new DataView(j),l=new Uint8Array(a.stringToUint(f)),m=0;if(b.Columns[0].values.forEach(function(a,c){b.Columns.forEach(function(a){"SHORT"===a.ssffdatatype?a.values[c].forEach(function(a){k.setInt16(m,a,!0),m+=2}):h=!0})}),h)return{status:{type:"ERROR",message:"Unsupported column type! Only SHORT columns supported for now!"}};var n=new Uint8Array(k.buffer);return l=new a.Uint8Concat(l,n),{status:{type:"SUCCESS",message:""},data:l.buffer}},a.parseArr=function(b){for(var c,d=!0,e=[],f=0;f<b.length;f++){c={};var g;if(g=a.base64ToArrayBuffer(b[f].data),c=a.ssff2jso(g,b[f].fileExtension),void 0!==c.status)return d=!1,c;e.push(JSON.parse(JSON.stringify(c)))}return d?{status:{type:"SUCCESS",message:""},data:e}:{status:{type:"ERROR",message:"Error in parseArr() with: "+JSON.stringify(b)}}},ArrayBuffer.prototype.subarray=function(a,b){for(var c=new ArrayBuffer(b),d=new Int8Array(c),e=new Int8Array(this),f=0;f<b;f++)d[f]=e[a+f];return c},a.onmessage=function(b){if(void 0!==b.data)switch(b.data.cmd){case"parseArr":a.postMessage(a.parseArr(b.data.ssffArr));break;case"jso2ssff":a.postMessage(a.jso2ssff(JSON.parse(b.data.jso)));break;default:a.postMessage({status:{type:"ERROR",message:"Unknown command sent to SsffParserWorker"}})}else a.postMessage({status:{type:"ERROR",message:"Undefined message was sent to SsffParserWorker"}})}},getWorkerURL:function(){var a,b;try{a=new Blob([this.getWorkerScript()],{type:"application/javascript"})}catch(b){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,a=new BlobBuilder,a.append(SsffParserWorker),a=a.getBlob()}return b="object"!=typeof URL&&"undefined"!=typeof webkitURL?webkitURL.createObjectURL(a):URL.createObjectURL(a)},kill:function(){this.worker&&(this.worker.terminate(),this.worker=void 0),this.url&&("object"!=typeof URL&&"undefined"!=typeof webkitURL?webkitURL.revokeObjectURL(this.url):URL.revokeObjectURL(this.url),this.url=void 0)},tell:function(a){this.worker&&this.worker.postMessage(a)},says:function(a){this.worker&&this.worker.addEventListener("message",function(b){a(b.data)})}},angular.module("emuwebApp").service("mathHelperService",function(){var a={};return a.calcClosestPowerOf2Gt=function(a){for(var b=0;Math.pow(2,b)<a;)b+=1;return Math.pow(2,b)},a.roundToNdigitsAfterDecPoint=function(a,b){(b<1||b>14)&&console.error("error in call of round function!!");var c=Math.pow(10,b),d=(Math.round(a*c)/c).toString();return d.indexOf(".")===-1&&(d+="."),d+=c.toString().substring(1),parseFloat(d.substring(0,d.indexOf(".")+b+1))},a}),angular.module("emuwebApp").directive("modal",["$animate","modalService",function(a,b){return{restrict:"E",templateUrl:"views/modal.html",replace:!0,scope:{},link:function(a,c){a.templateUrl="",a.modal=b,a.isOpen=!1,a.force=!1,a.dataIn="",a.$watch("modal.isOpen",function(d){void 0!==d&&(a.templateUrl=b.getTemplateUrl(),a.dataIn=b.dataIn,a.force=b.force,d?c[0].classList.add("emuwebapp-modal-open"):c[0].classList.remove("emuwebapp-modal-open"))}),a.$watch("modal.templateUrl",function(c){void 0!==c&&(a.templateUrl=c,a.dataIn=b.dataIn,a.force=b.force)})}}}]),angular.module("emuwebApp").service("modalService",["$q","ArrayHelperService","viewState",function(a,b,c){var d={};return d.isOpen=!1,d.templateUrl="",d.defer=void 0,d.deferChange=void 0,d.force=!1,d.dataOut=void 0,d.dataIn=void 0,d.dataExport=void 0,d.open=function(e,f,g,h){return void 0!==f&&(d.dataIn=f,void 0!==f.y&&(d.dataIn.chartData=b.convertArrayToXYjsoArray(f.y))),void 0!==g&&(d.dataExport=g),void 0!==h&&(d.force=h),d.defer=a.defer(),d.templateUrl=e,c.setState("modalShowing"),d.isOpen=!0,d.defer.promise},d.changeModal=function(b,c,e,f){return void 0!==c&&(d.dataIn=c),void 0!==e&&(d.dataExport=e),void 0!==f&&(d.force=f),d.deferChange=a.defer(),d.templateUrl=b,d.deferChange.promise},d.error=function(a){d.dataIn=a,d.templateUrl="views/error.html",c.setState("modalShowing")},d.close=function(){c.setEditing(!1),c.setState(c.prevState),d.isOpen=!1,c.hierarchyState.isShown()&&c.hierarchyState.toggleHierarchy(),d.defer.resolve(!1)},d.closeAndResolve=function(a){c.setEditing(!1),c.setState(c.prevState),d.isOpen=!1,d.defer.resolve(a)},d.confirm=function(){c.setEditing(!1),c.setState(c.prevState),d.isOpen=!1,d.defer.resolve(!0)},d.select=function(a){d.closeAndResolve(a)},d.confirmContent=function(){c.setEditing(!1),c.setState(c.prevState),d.isOpen=!1,d.defer.resolve(d.dataOut)},d.getTemplateUrl=function(){return d.templateUrl},d}]),angular.module("emuwebApp").controller("TabbedCtrl",["$scope","$timeout","ConfigProviderService","Validationservice","viewState","modalService",function(a,b,c,d,e,f){a.cps=c,a.vs=e,a.tree=[{title:"Perspectives Configuration",url:"views/config/perspectives.html"},{title:"Spectrogram Settings",url:"views/config/spectro.html"},{title:"Expert Settings",url:"views/config/expert.html"}],a.cps=c,a.modal=f,a.schema=d.getSchema("emuwebappConfigSchema").data.properties,a.modal.dataOut=angular.copy(c.vals),a.warning="",a.init=function(){a.options=Object.keys(e.getWindowFunctions()),a.timeMode=Object.keys(e.getTimeModes()),a.comMode=Object.keys(e.getCommunicationModes()),a.signalTypes=Object.keys(e.getSignalTypes()),a.levelTypes=[],angular.forEach(c.curDbConfig.ssffTrackDefinitions,function(b){a.signalTypes.push(b.name)}),angular.forEach(c.curDbConfig.levelDefinitions,function(b){"SEGMENT"!==b.type&&"EVENT"!==b.type||a.levelTypes.push(b.name)}),a.currentSignal=a.signalTypes[0],a.levelTypes.length>0&&(a.currentLevel=a.levelTypes[0])},a.onClickTab=function(b){b.url!==!1&&(a.currentTabUrl=b.url)},a.getType=function(b,c){var d;return angular.forEach(a.schema,function(a,e){e===b&&angular.forEach(a.properties,function(a,b){b===c&&(d=a.type)})}),d},a.up=function(b,c,d){var e=a.modal.dataOut.perspectives[b];if(c>0){var f;0===d?(f=e.signalCanvases.order[c-1],e.signalCanvases.order[c-1]=e.signalCanvases.order[c],e.signalCanvases.order[c]=f):1===d&&(f=e.levelCanvases.order[c-1],e.levelCanvases.order[c-1]=e.levelCanvases.order[c],e.levelCanvases.order[c]=f)}},a.down=function(b,c,d){var e,f=a.modal.dataOut.perspectives[b];0===d?void 0!==f.signalCanvases.order[c+1]&&(e=f.signalCanvases.order[c+1],f.signalCanvases.order[c+1]=f.signalCanvases.order[c],f.signalCanvases.order[c]=e):1===d&&void 0!==f.levelCanvases.order[c+1]&&(e=f.levelCanvases.order[c+1],f.levelCanvases.order[c+1]=f.levelCanvases.order[c],f.levelCanvases.order[c]=e)},a.del=function(b,c){var d=a.modal.dataOut.perspectives[b],e=!1,f="";if(void 0!==d.signalCanvases.assign)for(var g=0;g<d.signalCanvases.assign.length;g++)d.signalCanvases.assign[g].signalCanvasName===d.signalCanvases.order[c]&&(e=!0,f=d.signalCanvases.assign[g].signalCanvasName),d.signalCanvases.assign[g].ssffTrackName===d.signalCanvases.order[c]&&(e=!0,f=d.signalCanvases.assign[g].ssffTrackName);e?a.showWarning('Could not delete "'+f+'" because of internal dependencies !'):d.signalCanvases.order.splice(c,1)},a.showWarning=function(c){a.warningSignal=!0,a.warning=c,b(function(){a.warningSignal=!1},2e3)},a.perspDelete=function(b){a.modal.dataOut.perspectives.splice(b,1)},a.signalAdd=function(b,c){var d=a.modal.dataOut.perspectives[b];void 0===d.signalCanvases.order&&(d.signalCanvases.order=[]),d.signalCanvases.order.indexOf(c)===-1?d.signalCanvases.order.push(c):a.showWarning('Signal "'+c+'" already exists')},a.levelAdd=function(b,c){var d=a.modal.dataOut.perspectives[b];void 0===d.levelCanvases.order&&(d.levelCanvases.order=[]),d.levelCanvases.order.indexOf(c)===-1?d.levelCanvases.order.push(c):a.showWarning('Level "'+c+'" already exists')},a.perspAdd=function(){var b={name:"new Perspective",signalCanvases:[],levelCanvases:{order:[]},twoDimCanvases:[]};a.modal.dataOut.perspectives.splice(a.modal.dataOut.perspectives.length,0,b)},a.cursorInTextField=function(){e.setEditing(!0),e.setcursorInTextField(!0)},a.cursorOutOfTextField=function(){e.setEditing(!1),e.setcursorInTextField(!1)},a.onClickTab(a.tree[0]),a.init()}]),angular.module("emuwebApp").controller("TabbedHelpCtrl",["$scope","ConfigProviderService","Iohandlerservice",function(a,b,c){a.cps=b,a.tree=[],c.httpGetPath("manual/index.json").then(function(b){a.tree=b.data,a.onClickTab(a.tree[0]),a.tree[0].expanded=!0}),a.onClickTab=function(b){b.expanded=!b.expanded,b.url!==!1&&("md"===b.url.substr(b.url.lastIndexOf(".")+1).toLowerCase()?(a.isMDFile=!0,a.currentTabUrl=b.url):(a.isMDFile=!1,a.currentTabUrl=b.url))},a.hasChildren=function(a){return void 0!==a.nodes&&a.nodes.length>0}}]),angular.module("emuwebApp").service("HierarchyManipulationService",["$q","HierarchyLayoutService","DataService","LevelService","ConfigProviderService",function(a,b,c,d,e){var f={};return f.addLink=function(a,b,d){var e,g=f.checkLinkValidity(a,b,d);return g.valid?(e={fromID:b,toID:d},c.insertLinkData(e),e):(console.debug("Not adding invalid link:",b,"->",d," (Error code:",g.reason,")"),3===g.reason?(g=f.checkLinkValidity(a,d,b),g.valid?(console.debug("Adding reverse link instead"),e={fromID:d,toID:b},c.insertLinkData(e),e):null):null)},f.checkLinkValidity=function(a,f,g){var h,i,j,k={valid:!0,reason:0},l=c.getLinkData();if(f===g)return k.valid=!1,k.reason=1,k;for(h=0;h<l.length;++h)if(l[h].fromID===f&&l[h].toID===g)return k.valid=!1,k.reason=2,k;var m=d.getLevelName(f),n=d.getLevelName(g),o=a.indexOf(m);if(a[o-1]!==n)return k.valid=!1,k.reason=3,k;var p;for(h=0;h<e.curDbConfig.linkDefinitions.length;++h)e.curDbConfig.linkDefinitions[h].sublevelName===n&&e.curDbConfig.linkDefinitions[h].superlevelName===m&&(p=e.curDbConfig.linkDefinitions[h].type);if(void 0===p)return console.debug("LIKELY A BUG: link to be added (",f,"->",g,") has been found to be a part of the currently selected path but the link between the respective levels could not be found."),k.valid=!1,k.reason=3,k;if("ONE_TO_MANY"===p||"ONE_TO_ONE"===p){var q=d.getItemByID(g);if(q._parents.length>0)return k.valid=!1,k.reason=4,k}if("ONE_TO_ONE"===p){var r=d.getItemByID(f);if(i=b.findChildren(r,a),i.length>0)return k.valid=!1,k.reason=4,k}for(var s,t,u,v=d.getLevelAndItem(f).level,w=d.getLevelAndItem(g).level,x=d.getOrderById(m,f),y=d.getOrderById(n,g),z=0;void 0===s;){if(z-=1,u=v.items[x+z],void 0===u){s=0;break}for(console.debug("found preceding sibling",u.id,u.labels[0]),i=b.findChildren(u,a),h=0;h<i.length;++h)j=d.getOrderById(n,i[h].id),(void 0===s||j>s)&&(s=j)}for(z=0;void 0===t;){if(z+=1,u=v.items[x+z],void 0===u){t=w.items.length-1;break}if(console.debug("found successive sibling",u.id,u.labels[0]),i=b.findChildren(u,a),0!==i.length)for(h=0;h<i.length;++h)j=d.getOrderById(n,i[h].id),(void 0===t||j<t)&&(t=j)}return console.debug("child must be within",s,t),y<s||y>t?(k.valid=!1,k.reason=5,k):k},f}]),angular.module("emuwebApp").service("StandardFuncsService",function(){var a={};return a.traverseAndClean=function(b){for(var c in b)"_"===c.substr(0,1)&&delete b[c],null!==b[c]&&"object"==typeof b[c]&&a.traverseAndClean(b[c])},a.reverseCopy=function(a){var b=angular.copy(a);return b.reverse(),b},a}),angular.module("emuwebApp").filter("startFrom",function(){return function(a,b){return b=+b,a.slice(b)}}),angular.module("emuwebApp").controller("ManualCtrl",["$scope","ConfigProviderService",function(a,b){a.listOfMarkdownFiles=[{title:"Introduction",url:"manual/Introduction.md"},{title:"EMU-webApp-websocket-protocol",url:"manual/EMU-webApp-websocket-protocol.md"},{title:"Labeling articulatory data",url:"manual/Labeling-articulatory-data.md"}],a.curMdFile=a.listOfMarkdownFiles[0],a.setCurrentMdFile=function(b){a.curMdFile=b},a.isCurrentMdFile=function(c){return c===a.curMdFile.url?{"background-color":b.design.color.white,color:b.design.color.black,"font-weight":"500"}:{"background-color":b.design.color.blue,color:b.design.color.white,"font-weight":"400"}}}]),angular.module("emuwebApp").directive("largeTextFieldInput",function(){return{template:'<div class="emuwebapp-largetextinputfield" ng-show="vs.largeTextFieldInputFieldVisable" ng-focus="vs.largeTextFieldInputFieldVisable"><textarea ng-model="vs.largeTextFieldInputFieldCurLabel"></textarea></div>',restrict:"E",replace:!0}}),angular.module("emuwebApp").run(["$templateCache",function(a){a.put("views/bundleListSideBar.html",'<div class="emuwebapp-bundle-outer"> {{filterText}} <div ng-controller="bundleListSideBarCtrl"> <h3> <div> <input type="text" ng-model="filterText" placeholder="Bundle Filter" ng-focus="vs.setcursorInTextField(true)" ng-blur="vs.setcursorInTextField(false)" class="emuwebapp-filter"> </div> </h3> <my-drop-zone ng-if="vs.showDropZone"></my-drop-zone> <div id="emuwebapp-bundleListContainer" class="emuwebapp-bundle-container" ng-if="!vs.showDropZone"> <ul ng-repeat="(key, value) in lmds.getRendOptBndlList()" ng-class="{\'emuwebapp-bundle-last\':$last}"> <div class="emuwebapp-bundle-session" ng-if="isSessionDefined(key)" ng-click="lmds.toggleCollapseSession(key)"> <div ng-if="lmds.getSessionCollapseState(key)"> ▷{{key}} </div> <div ng-if="!lmds.getSessionCollapseState(key)"> ▽{{key}} </div> </div> <div class="emuwebapp-bundleListSessionBndlsContainer" ng-if="!lmds.getSessionCollapseState(key)"> <div class="emuwebapp-bundleListSessionPager" ng-if="value.length > vs.pageSize"> <button ng-disabled="vs.currentPage == 0" ng-click="turn(false);"> ← </button> {{vs.currentPage+1}}/{{vs.numberOfPages(value.length)}} <button ng-disabled="vs.currentPage >= value.length/vs.pageSize - 1" ng-click="turn(true);"> → </button> </div> <div ng-repeat="bundle in value | startFrom:vs.currentPage*vs.pageSize | limitTo:vs.pageSize | regex:filterText track by $index"> <div class="emuwebapp-bundle-item" id="uttListItem" ng-style="getBndlColor(bundle);" ng-click="dolss.loadBundle(bundle);" dragout draggable="true" name="{{bundle.name}}"> <b>{{bundle.name}}</b> <button ng-if="cps.vals.activeButtons.saveBundle && isCurBndl(bundle)" class="emuwebapp-saveBundleButton" ng-click="dolss.saveBundle();"><img class="emuwebapp-saveBundleButton-img" src="img/save.svg"></button> <!----> <!--regulate finished editing display--> <!--display checkbox if current--> <div ng-if="cps.vals.restrictions.bundleFinishedEditing && isCurBndl(bundle)"> finished editing: <input type="checkbox" ng-model="bundle.finishedEditing" ng-change="finishedEditing(bundle.finishedEditing, key, $index)"> <br> </div> <!--display text "true" or "false" depending on model if not current--> <div ng-if="cps.vals.restrictions.bundleFinishedEditing && !isCurBndl(bundle)"> finished editing: <strong ng-if="bundle.finishedEditing" style="color:green">true</strong> <strong ng-if="!bundle.finishedEditing" style="color:red">false</strong> <br> <br> </div> <!----> <!--regulate comment editing display--> <!--display text input if current--> <div ng-if="cps.vals.restrictions.bundleComments && isCurBndl(bundle)"> comment: <input type="text" ng-focus="vs.setcursorInTextField(true); startHistory(bundle);" ng-blur="vs.setcursorInTextField(false); updateHistory(bundle, key, $index); endHistory(bundle);" ng-model="bundle.comment"> </div> <div ng-if="cps.vals.restrictions.bundleComments && !isCurBndl(bundle)"> comment: <strong style="font-style: italic;max-height: 20px; overflow-y: auto">{{bundle.comment}}</strong> </div> <!----> <!--timeAnchors controlls--> <div class="emuwebapp-bundleListSessionPager" ng-if="bundle.timeAnchors.length > 0 && isCurBndl(bundle)"> <button ng-disabled="vs.curTimeAnchorIdx == 0" ng-click="nextPrevAnchor(false);"> ← </button> time anchor idx: {{vs.curTimeAnchorIdx}} <button ng-disabled="vs.curTimeAnchorIdx == getTimeAnchorIdxMax()" ng-click="nextPrevAnchor(true);"> → </button> </div> </div> </div> <div class="emuwebapp-bundleListSessionPager" ng-if="value.length > vs.pageSize"> <button ng-disabled="vs.currentPage == 0" ng-click="turn(false);"> ← </button> {{vs.currentPage+1}}/{{vs.numberOfPages(value.length)}} <button ng-disabled="vs.currentPage >= value.length/vs.pageSize - 1" ng-click="turn(true);"> → </button> </div> </div> </ul> </div> </div> </div> '),a.put("views/config/expert.html",'<!-- main default configuration --> <div class="emuwebapp-text"> <h1>Expert Settings</h1> <div> <p> <table> <tr ng-repeat="(key, value) in modal.dataOut.main"> <td>{{key}}</td> <td ng-switch="getType(\'main\', key)"> <span ng-switch-when="boolean"> <input type="checkbox" ng-model="modal.dataOut.main[key]" ng-checked="modal.dataOut.main[key]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </span> <span ng-switch-when="string"> <input type="text" ng-model="modal.dataOut.main[key]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </span> <span ng-switch-when="integer"> <input type="number" ng-pattern="/^\\d+$/" ng-model="modal.dataOut.main[key]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </span> <span ng-switch-default> <span ng-switch="key"> <span ng-switch-when="comMode"> <select ng-model="modal.dataOut.main[key]" ng-options="mode for mode in comMode"> </select></span> </span> </span> </td> </tr> </table> </p><p>&nbsp;</p> <h1>Restrictions</h1> <table> <tr ng-repeat="(key, value) in modal.dataOut.restrictions"> <td>{{key}}</td> <td> <div> <span> <input type="checkbox" ng-model="modal.dataOut.restrictions[key]" ng-checked="modal.dataOut.restrictions[key]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </span>  </div></td> </tr> </table> <p>&nbsp;</p> <h1>Buttons</h1> <table> <tr ng-repeat="(key, value) in modal.dataOut.activeButtons"> <td>{{key}}</td> <td> <div> <span> <input type="checkbox" ng-model="modal.dataOut.activeButtons[key]" ng-checked="modal.dataOut.activeButtons[key]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </span>  </div></td> </tr> </table> <p>&nbsp;</p> <h1>Label Settings</h1> <div> <p> <table> <tr ng-repeat="(key, value) in modal.dataOut.labelCanvasConfig"> <td>{{key}}</td> <td> <div ng-switch="getType(\'labelCanvasConfig\', key)"> <span ng-switch-when="boolean"> <input type="checkbox" ng-model="modal.dataOut.labelCanvasConfig[key]" ng-checked="modal.dataOut.labelCanvasConfig[key]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </span> <span ng-switch-when="string"> <input type="text" ng-model="modal.dataOut.labelCanvasConfig[key]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </span> <span ng-switch-when="integer"> <input type="number" pattern="\\d*" ng-model="modal.dataOut.labelCanvasConfig[key]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </span> <span ng-switch-default> <span ng-switch="key"> <span ng-switch-when="addTimeMode"> <select ng-model="modal.dataOut.labelCanvasConfig[key]" ng-options="opt for opt in timeMode"> </select></span> </span> </span> </div> </td> </tr> </table> </p> </div> <br> </div></div>'),a.put("views/config/perspectives.html",'<!-- perspectives configuration --> <div class="emuwebapp-text"> <h1>Perspectives Settings</h1> <div> <p> <table style="width: 500px !important"> <tr ng-repeat="(key, value) in modal.dataOut.perspectives"> <td> <a href="#" title="delete" id="modal-delete" ng-click="perspDelete(key)" ng-if="value.name != \'default\'"> <img src="img/delete.svg" width="30" height="30" class="emuwebapp-delete"> </a> <div> <input type="text" size="20" ng-model="value.name" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </div> <div> <u>Signal Canvases</u> <ul class="emuwebapp-signalcanvas" ng-model="value.signalCanvases.order"> <li ng-repeat="item in value.signalCanvases.order track by $index"> <a href="#" ng-click="up(key, $index, 0)">&uarr;</a> <a href="#" ng-click="down(key, $index, 0)">&darr;</a> {{ $index + 1 }} : {{ item }} <a href="#" ng-click="del(key, $index, 0)"><img src="img/delete.svg" width="18" height="18" class="emuwebapp-delete-signal" style="margin-right: 10px"></a> </li> </ul> add a new <select ng-model="currentSignal" ng-options="signal for signal in signalTypes"> <a style="cursor: pointer" href="#" ng-click="signalAdd(key, currentSignal)"><img src="img/add.svg" width="18" height="18" class="emuwebapp-add-signal" style="margin-right: 10px"></a> <br> <span ng-if="warningSignal" style="font-size: 12px"> &nbsp;<br> <b style="color: #e33">Error :</b> {{ warning }} </span> <hr class="emuwebapp-sort-line"> <u>Level Canvases</u> <ul class="emuwebapp-signalcanvas" ng-model="value.levelCanvases.order"> <li ng-repeat="item in value.levelCanvases.order track by $index"> <a href="#" ng-click="up(key, $index, 1)">&uarr;</a> <a href="#" ng-click="down(key, $index, 1)">&darr;</a> {{ $index + 1 }} : {{ item }} <a href="#" ng-click="del(key, $index, 1)"><img src="img/delete.svg" width="18" height="18" class="emuwebapp-delete-signal" style="margin-right: 10px"></a> </li> </ul> <span ng-if="levelTypes.length > 0"> add a new <select ng-model="currentLevel" ng-options="level for level in levelTypes"> <a style="cursor: pointer" href="#" ng-click="levelAdd(key, currentLevel)"><img src="img/add.svg" width="18" height="18" class="emuwebapp-add-signal" style="margin-right: 10px"></a> <br> <span ng-if="warningLevel" style="font-size: 12px"> &nbsp;<br> <b style="color: #e33">Error :</b> {{ warning }} </span> </span> <hr class="emuwebapp-sort-line"> &nbsp;<br> </div> </td> </tr> </table> <a href="#" ng-click="perspAdd()">add new perspective</a> </p> </div> </div> <br> '),a.put("views/config/spectro.html",'<!-- Spectrogram default configuration --> <div class="emuwebapp-text"> <h1>Spectrogram Settings</h1> <div> <p> <table novalidate style="width: 500px !important" name="spectroForm"> <tr ng-repeat="(key, value) in modal.dataOut.spectrogramSettings"> <td>{{key}}</td> <td> </td><td ng-switch="getType(\'spectrogramSettings\', key)"> <span ng-switch-when="boolean"> <input required name="{{key}}" type="checkbox" ng-model="modal.dataOut.spectrogramSettings[key]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </span> <span ng-switch-when="string"> <input required name="{{key}}" type="text" ng-model="modal.dataOut.spectrogramSettings[key]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </span> <span ng-switch-when="number"> <input required name="{{key}}" type="number" ng-pattern="/^\\-?\\d+((\\.|\\,)\\d+)?$/" ng-model="modal.dataOut.spectrogramSettings[key]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </span> <span ng-switch-when="integer"> <input required name="{{key}}" type="number" ng-pattern="/^\\d+$/" ng-model="modal.dataOut.spectrogramSettings[key]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> </span> <span ng-switch-when="array"> <span style="width:100%">first<br> r: <input required type="number" min="0" max="255" size="3" ng-model="modal.dataOut.spectrogramSettings.heatMapColorAnchors[0][0]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> g: <input required type="number" min="0" max="255" size="3" ng-model="modal.dataOut.spectrogramSettings.heatMapColorAnchors[0][1]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> b: <input required type="number" min="0" max="255" size="3" ng-model="modal.dataOut.spectrogramSettings.heatMapColorAnchors[0][2]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> <div style="display: inline-block" ng-style="vs.getColorOfAnchor(modal.dataOut.spectrogramSettings.heatMapColorAnchors, 0);"></div> </span> <span style="width:100%">second<br> r: <input required type="number" min="0" max="255" size="3" ng-model="modal.dataOut.spectrogramSettings.heatMapColorAnchors[1][0]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> g: <input required type="number" min="0" max="255" size="3" ng-model="modal.dataOut.spectrogramSettings.heatMapColorAnchors[1][1]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> b: <input required type="number" min="0" max="255" size="3" ng-model="modal.dataOut.spectrogramSettings.heatMapColorAnchors[1][2]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> <div style="display: inline-block" ng-style="vs.getColorOfAnchor(modal.dataOut.spectrogramSettings.heatMapColorAnchors, 1);"></div> </span> <span style="width:100%">third<br> r: <input required type="number" min="0" max="255" size="3" ng-model="modal.dataOut.spectrogramSettings.heatMapColorAnchors[2][0]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> g: <input required type="number" min="0" max="255" size="3" ng-model="modal.dataOut.spectrogramSettings.heatMapColorAnchors[2][1]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> b: <input required type="number" min="0" max="255" size="3" ng-model="modal.dataOut.spectrogramSettings.heatMapColorAnchors[2][2]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> <div style="display: inline-block" ng-style="vs.getColorOfAnchor(modal.dataOut.spectrogramSettings.heatMapColorAnchors, 2);"></div> </span> </span> <span ng-switch-default> <span ng-switch="key"> <span ng-switch-when="window"> <select ng-model="modal.dataOut.spectrogramSettings[key]" ng-options="opt for opt in options"> </select></span> </span> </span>  </td> </tr> </table> <br> </p></div></div>'),
a.put("views/confirmModal.html",'<div class="emuwebapp-modal-wrap" ng-controller="ModalCtrl"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading"> Confirm </h3> </div> <div class="emuwebapp-modal-body" ng-controller="ModalCtrl"> <div class="emuwebapp-text"> <div>{{dataIn}}</div> </div> </div> <div class="emuwebapp-modal-footer"> <button id="emuwebapp-modal-cancel" ng-click="modal.close();" class="emuwebapp-mini-btn">Cancel</button> <button id="emuwebapp-modal-confirm" ng-click="modal.confirm();" class="emuwebapp-mini-btn">Confirm</button> </div> </div> '),a.put("views/connectModal.html",'<div class="emuwebapp-modal-wrap"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading"> Connect to Server </h3> </div> <div class="emuwebapp-modal-body" ng-controller="ModalCtrl"> <div class="emuwebapp-text"> <div> Please enter URL: <br> &nbsp;<br> <input class="emuwebapp-modal-URL-input" type="text" ng-model="modal.dataOut" ng-init="modal.dataOut=cps.vals.main.serverUrl" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> <button id="emuwebapp-modal-save" ng-click="saveURL();" class="emuwebapp-mini-btn-save">(+)</button> <button id="emuwebapp-modal-save" ng-click="deleteURL(mySelect);" class="emuwebapp-mini-btn-save">(-)</button><br> &nbsp;<br> <select size="10" name="url" class="emuwebapp-modal-list" ng-init="myUrls = getURLs(); mySelect=myUrls[0]" ng-model="mySelect" ng-change="setCurrentURL(mySelect)" ng-dblclick="modal.confirmContent();"> <option ng-repeat="url in myUrls track by $index" ng-click="setCurrentURL(url)">{{url}}</option> </select> <br> {{connectionError}} </div> </div> </div> <div class="emuwebapp-modal-footer"> <button id="emuwebapp-modal-cancel" ng-click="modal.close();" class="emuwebapp-mini-btn">Cancel</button> <button id="emuwebapp-modal-confirm" ng-click="modal.confirmContent();" class="emuwebapp-mini-btn">Connect</button> </div> </div> '),a.put("views/deleteLevel.html",'<div class="emuwebapp-modal-wrap" ng-controller="ModalCtrl"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading"> Delete Level </h3> </div> <div class="emuwebapp-modal-body"> <div> <p> Really <i>delete</i> level "{{dataIn}}" ?</p> </div> </div> <div class="emuwebapp-modal-footer"> <button ng-click="modal.close();" id="modalCancelBtn" class="emuwebapp-mini-btn">Cancel</button> <button ng-click="deleteLevel(dataIn);" class="emuwebapp-mini-btn">Delete</button> </div> </div> '),a.put("views/emuwebapp.html",'<!-- container EMU-webApp start --> <div ng-controller="MainController" class="emuwebapp-main" id="MainCtrl" handleglobalkeystrokes> <!-- start: modal --> <modal></modal> <!-- end: modal --> <!-- start: hint --> <hint ng-show="internalVars.showAboutHint"></hint> <!-- end: hint --> <!-- start: left side menu bar --> <bundle-list-side-bar ng-show="vs.submenuOpen"></bundle-list-side-bar> <!-- end: left side menu bar --> <!-- start: main window --> <div class="emuwebapp-window" id="mainWindow"> <progress-thing show-thing="{{vs.somethingInProgress}}"></progress-thing> <div class="printTitle">EMU-webApp : {{lmds.getCurBndlName()}}</div> <!-- start: top menu bar --> <div class="emuwebapp-top-menu"> <button ng-show="cps.vals.activeButtons.openMenu" id="submenuOpen" ng-click="vs.toggleSubmenu(cps.design.animation.period);" class="emuwebapp-button-icon" style="float:left"><img src="img/menu.svg" class="_20px"></button> <button ng-show="cps.vals.activeButtons.addLevelSeg" ng-disabled="!vs.getPermission(\'addLevelSegBtnClick\')" class="emuwebapp-mini-btn left" ng-click="addLevelSegBtnClick();">add level (SEG.)</button> <button ng-show="cps.vals.activeButtons.addLevelEvent" ng-disabled="!vs.getPermission(\'addLevelPointBtnClick\')" class="emuwebapp-mini-btn left" ng-click="addLevelPointBtnClick();">add level (EVENT)</button> <button ng-show="cps.vals.activeButtons.renameSelLevel" ng-disabled="!vs.getPermission(\'renameSelLevelBtnClick\')" class="emuwebapp-mini-btn left" ng-click="renameSelLevelBtnClick();">rename sel. level</button> <button id="downloadTextgrid" ng-show="cps.vals.activeButtons.downloadTextGrid" ng-disabled="!vs.getPermission(\'downloadTextGridBtnClick\')" class="emuwebapp-mini-btn left" ng-click="downloadTextGridBtnClick();">download TextGrid</button> <button id="downloadAnnotation" ng-show="cps.vals.activeButtons.downloadAnnotation" ng-disabled="!vs.getPermission(\'downloadAnnotationBtnClick\')" class="emuwebapp-mini-btn left" ng-click="downloadAnnotationBtnClick();">download annotJSON</button> <button id="spectSettingsBtn" ng-show="cps.vals.activeButtons.specSettings" ng-disabled="!vs.getPermission(\'spectSettingsChange\')" class="emuwebapp-mini-btn left" ng-click="spectSettingsBtnClick();">OSCI/SPEC settings</button> <div class="emuwebapp-nav-wrap" ng-show="cps.vals.activeButtons.openDemoDB"> <ul class="emuwebapp-dropdown-container"> <li class="left"> <button id="demoDB" type="button" ng-mouseover="dropdown = true" ng-mouseleave="dropdown = false" ng-click="dropdown = !dropdown" class="emuwebapp-mini-btn full" ng-disabled="!vs.getPermission(\'openDemoBtnDBclick\')">open demo <span id="emuwebapp-dropdown-arrow"></span></button> <ul class="emuwebapp-dropdown-menu" ng-mouseover="dropdown = true" ng-mouseleave="dropdown = false" ng-init="dropdown = false" ng-show="dropdown"> <li class="divider"></li> <li ng-repeat="curDB in cps.vals.demoDBs" ng-click="openDemoDBbtnClick(curDB);" id="demo{{$index}}">{{curDB}}</li> </ul> </li> </ul> </div> <button ng-show="cps.vals.activeButtons.connect" ng-disabled="!vs.getPermission(\'connectBtnClick\')" class="emuwebapp-mini-btn left" ng-click="connectBtnClick();">{{connectBtnLabel}}</button> <button id="showHierarchy" class="emuwebapp-mini-btn left" ng-click="showHierarchyBtnClick();" ng-disabled="!vs.getPermission(\'showHierarchyBtnClick\')" ng-show="cps.vals.activeButtons.showHierarchy">show hierarchy</button> <button id="showeditDB" class="emuwebapp-mini-btn left" ng-click="showEditDBconfigBtnClick();" ng-disabled="!vs.getPermission(\'editDBconfigBtnClick\')" ng-show="cps.vals.activeButtons.editEMUwebAppConfig">edit config</button> <button ng-show="cps.vals.activeButtons.search" ng-disabled="!vs.getPermission(\'searchBtnClick\')" class="emuwebapp-mini-btn left" ng-click="searchBtnClick();">search</button> <button ng-show="cps.vals.activeButtons.clear" id="clear" ng-disabled="!vs.getPermission(\'clearBtnClick\')" class="emuwebapp-mini-btn left" ng-click="clearBtnClick();">clear</button> <button id="aboutBtn" class="emuwebapp-button-icon" style="float: right" ng-click="aboutBtnClick();"><img src="assets/EMU-webAppEmu.svg" class="_35px"></button> </div> <!-- top menu bar end --> <!-- vertical split layout that contains top and bottom pane --> <div class="emuwebapp-canvas"> <bg-splitter show-two-dim-cans="{{cps.vals.perspectives[vs.curPerspectiveIdx].twoDimCanvases.order.length > 0}}"> <bg-pane type="topPane" min-size="80" max-size="500"> <ul class="emuwebapp-timeline-flexcontainer"> <li class="emuwebapp-timeline-flexitem" ng-style="{\'height\': getEnlarge($index)}" ng-repeat="curTrack in cps.vals.perspectives[vs.curPerspectiveIdx].signalCanvases.order track by $index" ng-switch on="curTrack"> <osci ng-switch-when="OSCI" order="{{$index}}" track-name="{{curTrack}}"></osci> <spectro ng-switch-when="SPEC" order="{{$index}}" track-name="{{curTrack}}"></spectro> <ssff-track ng-switch-default order="{{$index}}" track-name="{{curTrack}}"></ssff-track> </li> </ul> </bg-pane> <bg-pane type="bottomPane" min-size="80"> <div style="margin-top: 25px"> <ul> <li ng-repeat="level in dataServ.getLevelOrder(cps.vals.perspectives[vs.curPerspectiveIdx].levelCanvases.order) | levelsFilter track by $index"> <level open level="level" idx="$index" order="{{$index}}" id="{{level.name}}"></level> </li> </ul> </div> <!--                 <div class="allLevelCanvasesGrid">\n                    <div class="levelCanvasGrid">\n                        <div class="levelCanvasArea">1</div>\n                        <div class="levelCanvasButtonGrid">\n                            <div>b1</div><div>b2</div><div>b3</div>\n                        </div>\n                    </div>\n                    <div class="levelCanvasGrid">Two</div>\n                    <div class="levelCanvasGrid">Three</div>\n                    <div class="levelCanvasGrid">Four</div>\n                    <div class="levelCanvasGrid">Five</div>\n                </div>\n --> </bg-pane> <bg-pane type="emuwebapp-2d-map"> <ul> <li ng-repeat="cur2dTrack in cps.vals.perspectives[vs.curPerspectiveIdx].twoDimCanvases.order" ng-switch on="cur2dTrack"> <epg ng-switch-when="EPG"></epg> <dots ng-switch-when="DOTS"></dots> </li> </ul> </bg-pane> </bg-splitter> <history-action-popup></history-action-popup> </div> <!-- end: vertical split layout --> <!-- start: bottom menu bar --> <div class="emuwebapp-bottom-menu"> <div> <preview id="preview" class="preview" current-bundle-name="{{getCurBndlName()}}"></preview> </div> <button id="zoomAllBtn" ng-click="cmdZoomAll();" ng-disabled="!vs.getPermission(\'zoom\')" class="emuwebapp-mini-btn left">all</button> <button id="zoomInBtn" ng-click="cmdZoomIn();" ng-disabled="!vs.getPermission(\'zoom\')" class="emuwebapp-mini-btn left">in</button> <button id="zoomOutBtn" ng-click="cmdZoomOut();" ng-disabled="!vs.getPermission(\'zoom\')" class="emuwebapp-mini-btn left">out</button> <button id="zoomLeftBtn" ng-click="cmdZoomLeft();" ng-disabled="!vs.getPermission(\'zoom\')" class="emuwebapp-mini-btn left">left</button> <button id="zoomRightBtn" ng-click="cmdZoomRight();" ng-disabled="!vs.getPermission(\'zoom\')" class="emuwebapp-mini-btn left">right</button> <button id="zoomSelBtn" ng-click="cmdZoomSel();" ng-disabled="!vs.getPermission(\'zoom\')" class="emuwebapp-mini-btn left">selection</button> <button id="playViewBtn" ng-show="cps.vals.restrictions.playback" ng-click="cmdPlayView();" ng-disabled="!vs.getPermission(\'playaudio\')" class="emuwebapp-mini-btn left">play in view</button> <button id="playSelBtn" ng-show="cps.vals.restrictions.playback" ng-click="cmdPlaySel();" ng-disabled="!vs.getPermission(\'playaudio\')" class="emuwebapp-mini-btn left">play selected</button> <button id="playAllBtn" ng-show="cps.vals.restrictions.playback" ng-click="cmdPlayAll();" ng-disabled="!vs.getPermission(\'playaudio\')" class="emuwebapp-mini-btn left">play entire file</button> </div> <!-- end: bottom menu bar --> <!-- start: large text input field --> <!--<large-text-field-input></large-text-field-input>--> <!-- start: perspectives menu bar (right) --> <perspectives></perspectives> <!-- end: perspectives menu bar (right) --> </div> <!-- end: main window --> </div> <!-- end: container EMU-webApp -->'),a.put("views/EMUwebAppConfig/label.html",'<!-- label configuration --> <div class="emuwebapp-text"> <div ng-repeat="(key, value) in currentConfig" class="emuwebapp-tabbed-table"> <span class="emuwebapp-tabbed-row"> <span class="emuwebapp-tabbed-cell">{{key}}</span> <span ng-switch="value.type"> <span class="emuwebapp-tabbed-cell" ng-switch-when="boolean"> <input type="checkbox" name="{{key}}" ng-value="getConfigValue(\'main\', \'{{key}}\')" id="{{key}}"> </span> <span class="emuwebapp-tabbed-cell" ng-switch-when="string"> <input type="text" name="{{key}}" ng-model="value" id="{{key}}"> </span> <span class="emuwebapp-tabbed-cell" ng-switch-when="integer"> <input type="text" pattern="\\d*" ng-model="value" id="{{key}}"> </span> </span> </span> </div> </div> <br> '),a.put("views/EMUwebAppConfig/main.html",'<!-- main configuration --> <div class="emuwebapp-text"> <h1>Main Settings</h1> <div> <!-- ///////////////////////////////////////////// --> <h2>Main Navigation Shortcuts</h2> <p> <table> <tr ng-repeat="(key, value) in mainConfig" class="emuwebapp-tabbed-table">> <td>{{key}}</td> <td> <span ng-switch="value.type"> <span class="emuwebapp-tabbed-cell" ng-switch-when="boolean"> <input type="checkbox" name="{{key}}" ng-value="getConfigValue(\'main\', \'{{key}}\')" id="{{key}}"> </span> <span class="emuwebapp-tabbed-cell" ng-switch-when="string"> <input type="text" name="{{key}}" ng-model="value" id="{{key}}"> </span> <span class="emuwebapp-tabbed-cell" ng-switch-when="integer"> <input type="text" pattern="\\d*" ng-model="value" id="{{key}}"> </span> </span> </td> </tr> </table> </p> <br> </div></div>'),a.put("views/error.html",'<div class="emuwebapp-modal-wrap"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading"> Error </h3> </div> <div class="emuwebapp-modal-body" ng-controller="ModalCtrl"> <div class="emuwebapp-text"> <div id="emuwebapp-error-text">{{dataIn}}</div> </div> </div> <div class="emuwebapp-modal-footer"> <button id="emuwebapp-modal-cancel" ng-click="modal.close();" class="emuwebapp-mini-btn">Cancel</button> </div> </div>'),a.put("views/export.html",'<div class="emuwebapp-modal-wrap" ng-controller="ExportCtrl"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading"> Download {{dataIn}} </h3> </div> <div class="emuwebapp-modal-body"> <div class="emuwebapp-text"> <div> Do you wish to download "{{dataIn}}" ? </div> <pre class="emuwebapp-exportdata">{{modal.dataExport}}</pre> </div> </div> <div class="emuwebapp-modal-footer"> <button ng-click="modal.close();" id="modalCancelBtn" class="emuwebapp-mini-btn">Cancel</button> <button ng-click="export();" class="emuwebapp-mini-btn">Download</button> </div> </div> '),a.put("views/help.html",'<script type="text/ng-template" id="node_template.html"> <div ng-if="node.expanded"><a class="emuwebapp-tabbed-link" href="#" ng-click="onClickTab(node)">{{hasChildren(node) ? \'&#9662;\' : \'&nbsp;&nbsp;\'}} &nbsp;{{node.title}}</a><ul><li data-ng-repeat="node in node.nodes" data-ng-include="\'node_template.html\'" ></li></ul></div>\n<div ng-if="!node.expanded"><a class="emuwebapp-tabbed-link" href="#" ng-click="onClickTab(node)">{{hasChildren(node) ? \'&#9656;\' : \'&nbsp;&nbsp;\'}} &nbsp;{{node.title}}</a></div> </script> <div class="emuwebapp-modal-wrap"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading">EMU-webApp Help</h3> </div> <div class="emuwebapp-modal-body"> <!-- tabbed header --> <div id="tabs" class="emuwebapp-tabbed" data-ng-controller="TabbedHelpCtrl"> <ul class="emuwebapp-tabbed-menu"> <li data-ng-repeat="node in tree" data-ng-include="\'node_template.html\'"></li> </ul> <div class="emuwebapp-tabbed-view"> <div btf-markdown ng-include src="currentTabUrl" class="emuwebapp-text" ng-show="isMDFile"></div> <div ng-include src="currentTabUrl" ng-hide="isMDFile"></div> </div> </div> </div> <div class="emuwebapp-modal-footer"> <button id="modalCancelBtn" ng-click="modal.close();" class="emuwebapp-mini-btn">Cancel</button> </div> </div> '),a.put("views/helpTabs/intro.html",'<img src="assets/EMU-webAppIcon-roundCorners.svg" alt="EMU-webApp" style="width: 60px; height:60px; margin: 12px"> <div class="emuwebapp-text"> <span> EMU-webApp <br> Version: 0.1.8 <br> &nbsp; <br> <small> Build time stamp: Mon Jul 03 2017 14:52:51 <br> Build GIT SHA-1: 7a025c04f8d38de9bdd41a52f4771b11d83adc87 - master <br> EMU-webApp-websocket-protocol version: 0.0.2 <br> </small> </span> <alert> <b>Warning!</b> This webApp is still in ALPHA and is not meant to be used in production. <br> So please use with caution! If you have any issues or you find a bug please create an issue on the GitHub project page. </alert> <!-- ///////////////////////////////////////////// --> <div> <h4>About</h4> <p> The EMU-webApp is an online and offline web application for labeling, visualizing and correcting speech and derived speech data. </p> <div> <div style="height: 100px">&nbsp;</div> </div> </div></div>'),a.put("views/helpTabs/keys.html",'<div class="emuwebapp-text"> <h1>Keyboard Shortcuts</h1> <div> <!-- ///////////////////////////////////////////// --> <h2>Main Navigation Shortcuts</h2> <p> <table> <tr> <th>Keyboard Shortcut</th> <th>Function</th> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.toggleSideBarLeft)}}</b></td> <td>open bundleList sidebar (left)</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.shift)}}</b> plus <b>{{cps.getStrRep(cps.vals.keyMappings.toggleSideBarLeft)}}</b></td> <td>open perspective sidebar (right)</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.showHierarchy)}}</b></td> <td>open hierarchy View</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.zoomIn)}}</b></td> <td>zoom in <sup>1</sup></td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.zoomOut)}}</b></td> <td>zoom out <sup>1</sup></td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.shiftViewPortLeft)}}</b></td> <td>move viewport left</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.shiftViewPortRight)}}</b></td> <td>move viewport right</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.zoomAll)}}</b></td> <td>view all</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.zoomSel)}}</b></td> <td>zoom in to selected area</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.selNextPrevItem)}}</b></td> <td>preselect next item</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.shift)}} + {{cps.getStrRep(cps.vals.keyMappings.selNextPrevItem)}}</b></td> <td>preselect previous item</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.selNextItem)}}</b></td> <td>preselect next item</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.selPrevItem)}}</b></td> <td>preselect previous item</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.shift)}}</b> plus <b>{{cps.getStrRep(cps.vals.keyMappings.selNextItem)}}</b></td> <td>add next item to preselection</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.shift)}}</b> plus <b>{{cps.getStrRep(cps.vals.keyMappings.selPrevItem)}}</b></td> <td>add previous item to preselection</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.selectItemsInSelection)}}</b></td> <td>select all items in marked area</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.shift)}}</b> plus <b>{{cps.getStrRep(cps.vals.keyMappings.saveBndl)}}</b></td> <td>save current bundle</td> </tr> </table> <small>1.) Zooming while a boundary is preselected will keep the position of that boundary fixed</small> </p> <!-- ///////////////////////////////////////////// --> <h2>Labeling shortcuts</h2> <p> <table> <tr> <th>Keyboard Shortcut</th> <th>Function</th> </tr> <tr> <td ng-show="cps.vals.restrictions.editItemSize || cps.vals.restrictions.correctionTool"><b>{{cps.getStrRep(cps.vals.keyMappings.undo)}}</b></td> <td ng-show="cps.vals.restrictions.editItemSize || cps.vals.restrictions.correctionTool">undo last action</td> </tr> <tr> <td ng-show="cps.vals.restrictions.editItemSize || cps.vals.restrictions.correctionTool"><b>{{cps.getStrRep(cps.vals.keyMappings.shift)}}</b> plus <b>{{cps.getStrRep(cps.vals.keyMappings.undo)}}</b></td> <td ng-show="cps.vals.restrictions.editItemSize || cps.vals.restrictions.correctionTool">redo last action</td> </tr> <tr> <td ng-show="cps.vals.restrictions.addItem"><b>{{cps.getStrRep(cps.vals.keyMappings.createNewItemAtSelection)}}</b></td> <td ng-show="cps.vals.restrictions.addItem">add boundary / event marker at marked position</td> </tr> <tr> <td ng-show="cps.vals.restrictions.addItem"><b>{{cps.getStrRep(cps.vals.keyMappings.createNewItemAtSelection)}}</b> (when single item is preselected)</td> <td ng-show="cps.vals.restrictions.addItem">change label of item</td> </tr> <tr> <td ng-show="cps.vals.restrictions.deleteItemBoundary"><b>{{cps.getStrRep(cps.vals.keyMappings.deletePreselBoundary)}}</b></td> <td ng-show="cps.vals.restrictions.deleteItemBoundary">delete preselected boundary / event marker</td> </tr> <tr> <td ng-show="cps.vals.restrictions.deleteItem"><b>{{cps.getStrRep(cps.vals.keyMappings.shift)}}</b> plus <b>{{cps.getStrRep(cps.vals.keyMappings.deletePreselBoundary)}}</b></td> <td ng-show="cps.vals.restrictions.deleteItem">delete selected event(s) or segment(s)</td> </tr> <tr> <td ng-show="cps.vals.restrictions.editItemSize"><b>{{cps.getStrRep(cps.vals.keyMappings.snapBoundaryToNearestTopBoundary)}}</b></td> <td ng-show="cps.vals.restrictions.editItemSize">snap preselected boundary / event marker to nearest boundary / event marker in level above</td> </tr> <tr> <td ng-show="cps.vals.restrictions.editItemSize"><b>{{cps.getStrRep(cps.vals.keyMappings.snapBoundaryToNearestBottomBoundary)}}</b></td> <td ng-show="cps.vals.restrictions.editItemSize">snap preselected boundary / event marker to nearest boundary / event marker in level below</td> </tr> <tr> <td ng-show="cps.vals.restrictions.editItemSize"><b>{{cps.getStrRep(cps.vals.keyMappings.snapBoundaryToNearestZeroCrossing)}}</b></td> <td ng-show="cps.vals.restrictions.editItemSize">snap preselected boundary / event marker to nearest zero crossing</td> </tr> <tr> <td ng-show="cps.vals.restrictions.editItemSize"><b>{{cps.getStrRep(cps.vals.keyMappings.expandSelSegmentsRight)}}</b></td> <td ng-show="cps.vals.restrictions.editItemSize">add time to preselected items (expand to right)</td> </tr> <tr> <td ng-show="cps.vals.restrictions.editItemSize"><b>{{cps.getStrRep(cps.vals.keyMappings.shrinkSelSegmentsRight)}}</b></td> <td ng-show="cps.vals.restrictions.editItemSize">remove time from preselected items (shrink from right)</td> </tr> <tr> <td ng-show="cps.vals.restrictions.editItemSize"><b>{{cps.getStrRep(cps.vals.keyMappings.shift)}}</b> plus <b>{{cps.getStrRep(cps.vals.keyMappings.expandSelSegmentsLeft)}}</b></td> <td ng-show="cps.vals.restrictions.editItemSize">add time to preselected items (expand to left)</td> </tr> <tr> <td ng-show="cps.vals.restrictions.editItemSize"><b>{{cps.getStrRep(cps.vals.keyMappings.shift)}}</b> plus <b>{{cps.getStrRep(cps.vals.keyMappings.shrinkSelSegmentsLeft)}}</b></td> <td ng-show="cps.vals.restrictions.editItemSize">remove time from preselected items (shrink from left)</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.levelUp)}}</b></td> <td>select level above</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.levelDown)}}</b></td> <td>select level below</td> </tr> </table> </p> <!-- ///////////////////////////////////////////// --> <h2 ng-show="cps.vals.restrictions.playback">Playback shortcuts</h2> <p ng-show="cps.vals.restrictions.playback"> <table> <tr> <th>Keyboard Shortcut</th> <th>Function</th> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.playEntireFile)}}</b></td> <td>play entire file</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.playSelected)}}</b></td> <td>play selected</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.playAllInView)}}</b></td> <td>play/pause in view (also use as general stop for playback)</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.shift)}}</b> plus <b>{{cps.getStrRep(cps.vals.keyMappings.playAllInView)}}</b></td> <td>play/pause in view to end of file with autoscrolling</td> </tr> </table> </p> <!-- ///////////////////////////////////////////// --> <h2 ng-show="cps.vals.restrictions.correctionTool">Correction Tool shortcuts</h2> <p ng-show="cps.vals.restrictions.correctionTool"> <table> <tr> <th>Keyboard Shortcut</th> <th>Function</th> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.selectFirstContourCorrectionTool)}}</b></td> <td>choose correction tool for first contour</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.selectSecondContourCorrectionTool)}}</b></td> <td>choose correction tool for second contour</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.selectThirdContourCorrectionTool)}}</b></td> <td>choose correction tool for third contour</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.selectFourthContourCorrectionTool)}}</b></td> <td>choose correction tool for fourth contour</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.selectNoContourCorrectionTool)}}</b></td> <td>disable correction tool</td> </tr> </table> </p> <!-- ///////////////////////////////////////////// --> <h2>Hierarchy Tool shortcuts</h2> <p> <table> <tr> <th>Keyboard Shortcut</th> <th>Function</th> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.hierarchyRotate)}}</b></td> <td>rotate hierarchy by 90&deg;</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.hierarchyAddItemBefore)}}</b></td> <td>add item before the currently preselected one</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.hierarchyAddItemAfter)}}</b></td> <td>add item after the currently preselected one</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.shift)}}</b></td> <td>draw a new link (press and hold)</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.hierarchyDeleteItem)}}</b></td> <td>delete the currently preselected item</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.hierarchyDeleteLink)}}</b></td> <td>delete the currently preselected link</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.hierarchyPlayback)}}</b></td> <td>play back the portion defined by the currently preselected item</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.levelDown)}}</b></td> <td>select next hierarchy path</td> </tr> <tr> <td><b>{{cps.getStrRep(cps.vals.keyMappings.levelUp)}}</b></td> <td>select previous hierarchy path</td> </tr> </table> </p> <div style="height: 100px">&nbsp;</div> </div> </div>'),a.put("views/helpTabs/manual.html",'<div ng-controller="ManualCtrl" class="emuwebapp-text"> <div> <h2>Table of contents:</h2> <p> <toc> <ul> <li ng-repeat="mdFile in listOfMarkdownFiles"><a href ng-click="setCurrentMdFile(mdFile)">{{mdFile.title}}</a></li> <li><a href="/intro.html" target="_blank">EMU-webApp Tutorial</a></li> </ul> </toc> </p> <hr class="emuwebapp-aboutHr"> <btf-markdown class="emuwebapp-markdown" ng-include="curMdFile.url"></btf-markdown> </div> </div>'),a.put("views/hint.html",'<div class="emuwebapp-aboutHint"> <div class="emuwebapp-aboutHint-arrow">⇧</div> <div class="emuwebapp-aboutHint-content"> <h1>Welcome to the EMU-webApp Version 0.1.8</h1> <p> an online and offline web application for labeling, visualizing and correcting speech and derived speech data. </p> <div> <img src="assets/EMU-webAppEmu.svg"> <div class="emuwebapp-aboutHint-overlay"> click on this icon in the top menu bar for more information (incl. manual) </div> </div> <div class="news" btf-markdown ng-include="\'NEWS.md\'"></div> <p> <button class="emuwebapp-aboutHint-hidden" ng-click="hideMe()"></button> <button class="" ng-click="internalVars.showAboutHint = !internalVars.showAboutHint">Close message</button> </p> </div> </div> '),a.put("views/level.html",' <div class="emuwebapp-level"> <!--   <div class="emuwebapp-hierarchy-container" ng-show="drawHierarchy && level.type === \'SEGMENT\'">\n    <canvas class="emuwebapp-hierarchy-canvas" id="levelCanvas" width="2048"></canvas>\n    <canvas class="emuwebapp-hierarchy-markup" id="levelMarkupCanvas" width="2048"></canvas>\n  </div>\n --> <div class="emuwebapp-level-container"> <canvas class="emuwebapp-level-canvas" id="levelCanvas" width="2048" height="64" ng-style="backgroundCanvas"></canvas> <canvas class="emuwebapp-level-markup" id="levelMarkupCanvas" width="2048" height="64" track-mouse-in-level="{{idx}}" level-name="level.name" level-type="level.type"></canvas> </div> <div class="emuwebapp-level-buttons"> <div class="emuwebapp-level-button" id="emuwebapp-level-button-delete" ng-show="cps.vals.activeButtons.deleteSingleLevel" delete> <img style="cursor: pointer" src="img/delete.svg"> </div> <div class="emuwebapp-level-button" id="emuwebapp-level-button-resize" ng-show="cps.vals.activeButtons.resizeSingleLevel" resize> <img style="cursor: pointer" src="img/resize.svg" width="100" height="100"> </div> <div class="emuwebapp-level-button" id="emuwebapp-level-button-save" ng-show="cps.vals.activeButtons.saveSingleLevel" save> <img style="cursor: pointer" src="img/save.svg"> </div> </div> </div> <div ng-if="levelDef.attributeDefinitions.length > 1" class="emuwebapp-selectAttrDef"> <div> <ul> <li ng-repeat="attrDef in levelDef.attributeDefinitions"> <button ng-click="changeCurAttrDef(attrDef.name, $index);" ng-style="getAttrDefBtnColor(attrDef.name)"></button> </li> </ul> </div> </div> '),a.put("views/loadFiles.html",' <div class="modal-header"> <h3>Load Files</h3> </div> <div class="modal-body"> <div> <p> Load files</p> </div> <div> <p><input type="text" ng-model="passedOutTxt.var" placeholder="{{passedInTxt}}" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></p> </div> </div> <div class="modal-footer"> <button ng-click="cancel();" class="emuwebapp-mini-btn">Cancel</button> <button ng-click="renameFile();" class="emuwebapp-mini-btn">Rename</button> </div> '),a.put("views/loginModal.html",'<div class="emuwebapp-modal-wrap" ng-controller="LoginCtrl"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading"> User Login </h3> </div> <div class="emuwebapp-modal-body"> Please enter: <hr> <table style="width: 100%; text-align:center"> <tr> <td>User name:</td> <td><input type="text" ng-model="loginData.username" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></td> </tr> <tr> <td>Password:</td> <td><input type="password" ng-model="loginData.password" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></td> </tr> </table> <hr> <p style="color:red">{{loginData.errorMsg}}</p> </div> <div class="emuwebapp-modal-footer"> <button ng-click="modal.close();" id="modalCancelBtn" class="emuwebapp-mini-btn">Cancel</button> <button ng-click="tryLogin();" class="emuwebapp-mini-btn">Login</button> </div> </div> '),a.put("views/modal.html",'<div id="modalDialog" class="emuwebapp-modal"> <div ng-if="modal.isOpen"> <a href title="Close" id="modal-close" class="emuwebapp-close" ng-click="modal.close()" ng-hide="force"> <img src="img/delete.svg" width="30" height="30"> </a> <p class="emuwebapp-modal-inner" ng-include="templateUrl"></p> </div> </div> '),a.put("views/myDropZone.html",'<div id="dropzone" class="emuwebapp-dropzone" ng-class="dropClass"> <span><br>{{dropText}}</span> <my-drop-zone-input></my-drop-zone-input> </div>'),a.put("views/myDropZoneInput.html",'<input style="display:none" id="fileDialog" ng-model="files" type="file" multiple accept="{{acceptFile}}">'),a.put("views/osci.html",'<div class="emuwebapp-timeline"> <div class="emuwebapp-timelineCanvasContainer"> <canvas class="emuwebapp-timelineCanvasMain" width="2048"></canvas> <canvas class="emuwebapp-timelineCanvasSSFF" width="2048" drawssff ssff-trackname="{{trackName}}"></canvas> <canvas class="emuwebapp-timelineCanvasMarkup" width="2048" mouse-track-and-correction-tool ssff-trackname="{{trackName}}"></canvas> </div> <div class="emuwebapp-timelineCanvasButtons"> <div ng-show="cps.vals.activeButtons.resizePerspectives" class="emuwebapp-level-button" enlarge="{{order}}"> <img style="cursor: pointer" src="img/resize.svg"> </div> </div> </div> '),a.put("views/perspectives.html",'<nav class="emuwebapp-right-menu" ng-show="cps.vals.restrictions.showPerspectivesSidebar" show-menu="vs.getRightsubmenuOpen()"> <button ng-click="vs.setRightsubmenuOpen(!vs.getRightsubmenuOpen());"> <img src="img/menu.svg" class="_20px _inverted"> </button> <h3>Perspectives</h3> <ul> <li ng-repeat="persp in cps.vals.perspectives" ng-click="changePerspective(persp);" ng-class="getPerspectiveColor(persp);"> {{persp.name}} </li> </ul> </nav> '),a.put("views/preview.html",'<div class="emuwebapp-preview"> <canvas width="2048" height="128" class="emuwebapp-preview-canvas" ng-style="backgroundCanvas" id="PreviewCanvas"></canvas> <canvas width="2048" height="128" class="emuwebapp-preview-canvas-markup" id="PreviewCanvas" previewtrack></canvas> </div> '),a.put("views/renameLevel.html",'<div class="emuwebapp-modal-wrap" ng-controller="ModalCtrl"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading"> Rename Level </h3> </div> <div class="emuwebapp-modal-body"> <div> <p> Do you really wish to <i>rename</i> the level "{{dataIn}}" ?</p> </div> <div> <p><input type="text" ng-model="data" placeholder="{{dataIn}}" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></p> </div> </div> <div class="emuwebapp-modal-footer"> <button ng-click="modal.close();" id="modalCancelBtn" class="emuwebapp-mini-btn">Cancel</button> <button ng-click="renameLevel();" class="emuwebapp-mini-btn">Rename</button> </div> </div> '),
a.put("views/saveChanges.html",'<div class="emuwebapp-modal-wrap" ng-controller="ModalCtrl"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading"> Save changes </h3> </div> <div class="emuwebapp-modal-body"> <div> <p>Changes made to: "{{dataIn}}". Do you wish to save them ?</p> </div> </div> <div class="emuwebapp-modal-footer"> <button ng-click="modal.closeAndResolve(\'saveChanges\');" class="emuwebapp-mini-btn">Save Changes</button> <button ng-click="modal.closeAndResolve(\'discardChanges\');" class="emuwebapp-mini-btn">Discard Changes</button> <button ng-click="modal.close();" id="modalCancelBtn" class="emuwebapp-mini-btn">Cancel</button> </div> </div> '),a.put("views/searchAnnot.html",'<div class="emuwebapp-modal-wrap" ng-controller="searchAnnotCtrl"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading">Search Current Bundle Annotation</h3> </div> <div class="emuwebapp-modal-body"> <div class="emuwebapp-text"> <div> <h2>Select hierarchy path to search in</h2> <select ng-model="curHierPathIdx" ng-options="hierPaths.possibleAsStr.indexOf(selectedPath) as selectedPath for selectedPath in hierPaths.possibleAsStr" ng-change="changedHierPath()"></select> </div> <div> <h2>Select level in path</h2> <select ng-model="curLevel" ng-options="opt for opt in curLevels" ng-change="changedLevel()"></select> </div> <div> <h2>Select attribute definition</h2> <select ng-model="curAttrDef" ng-options="opt for opt in curAttrDefs" ng-change="changedAttrDef()"></select> </div> <div> <h2>Search string</h2> <input type="text" ng-model="searchString" ng-change="calcWindowSizeVals()" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> <br> Use RegEx Search: <input type="checkbox" ng-model="useRegExSearch"> <br> <button ng-click="search()">Search</button> </div> <div> <h2>Search result</h2> <table class="emuwebapp-modalTable" ng-if="resultTimeAnchors.length > 0"> <tr> <td>search string</td> <td>sample_start</td> <td>sample_end</td> </tr> <tr ng-repeat="ta in resultTimeAnchors"> <td>{{ta.label}}</td> <td>{{ta.sample_start}}</td> <td>{{ta.sample_end}}</td> </tr> </table> </div> </div> </div> <div class="emuwebapp-modal-footer"> <button ng-click="modalService.close()" class="emuwebapp-mini-btn">Cancel</button> <button id="emuwebapp-modal-save" ng-click="saveTimeAnchors()" class="emuwebapp-mini-btn">Save search result as time anchors</button> </div> </div> '),a.put("views/SelectLabelModal.html",'<div class="emuwebapp-modal-wrap" ng-controller="ModalCtrl"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading"> Select label to link to </h3> </div> <div class="emuwebapp-modal-body"> <b>Please select one of the following options:</b> <ul class="emuwebapp-modalUl"> <li ng-repeat="(key, curOpt) in dataIn track by $index"> <div class="emuwebapp-card" ng-click="modal.dataOut = $index; modal.confirmContent()"> {{curOpt}} </div> </li> </ul> </div> <div class="emuwebapp-modal-footer"> <!--<button ng-click="modal.close();" id="modalCancelBtn" class="emuwebapp-mini-btn">Cancel</button>--> </div> </div>'),a.put("views/SelectThresholdModal.html",'<div class="emuwebapp-modal-wrap" ng-controller="ModalCtrl"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading"> Please select a threshold </h3> </div> <div class="emuwebapp-modal-body"> <b>{{dataIn.description}}</b><br>&nbsp;<br> <p>find threshold options are: <ul class="emuwebapp-modalUl"> <li>minimum value: {{dataIn.minVal}}</li> <li>maximum value: {{dataIn.maxVal}}</li> <li>threshold value: {{dataIn.threshold}}</li> </ul> </p> <b>Please select one of the following options:</b> <ul class="emuwebapp-modalUl"> <li ng-repeat="(key, curOpt) in dataIn.options"> <div class="emuwebapp-card" ng-click="modal.select($index)"> <div class="row"> <div class="col-md-6"> <line-chart data="dataIn.chartData" threshold="curOpt.thresholdIdx"></line-chart> </div> <div class="col-md-6"> <ul class="emuwebapp-modalUl"> <li>Threshold index: {{curOpt.thresholdIdx}}</li> <li>Threshold value: {{curOpt.thresholdValue}}</li> </ul> </div> </div> </div> </li> </ul> </div> <div class="emuwebapp-modal-footer"> <!-- <button ng-click="modal.close();" id="modalCancelBtn" class="emuwebapp-mini-btn">Cancel</button> --> </div> </div> '),a.put("views/showHierarchyModal.html",'<div class="emuwebapp-modal-wrap" ng-controller="ShowhierarchyCtrl"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <div class="emuwebapp-nav-wrap" ng-repeat="(key, levelName) in standardFuncServ.reverseCopy(paths.possible[getSelIdx()])"> <div class="emuwebapp-nav-wrap" style="margin-left: 5px"> <ul class="emuwebapp-dropdown-container"> <li class="left"> <button class="emuwebapp-mini-btn full" ng-mouseover="dropdown[key] = true" ng-mouseleave="dropdown[key] = false" ng-click="dropdown = !dropdown"> {{levelName}} <span id="emuwebapp-dropdown-arrow"></span> </button> <ul class="emuwebapp-dropdown-menu" ng-mouseover="dropdown[key] = true" ng-mouseleave="dropdown[key] = false" ng-init="dropdown[key] = false" ng-show="dropdown[key]"> <li class="divider"></li> <li ng-repeat="(key2, attrDef) in getAllAttrDefs(levelName)" ng-click="setCurrentAttrDef(levelName, attrDef.name, $index);"> &rarr; {{attrDef.name}} </li> </ul> </li> </ul> </div> </div> </div> <div class="emuwebapp-modal-body emuwebapp-modal-hierarchy"> <div class="emuwebapp-modal-select"> <select id="emuwebapp-selection" name="emuwebapp-selection" ng-model="paths.selected" ng-options="value for value in paths.possibleAsStr"></select> </div> <history-action-popup ng-show="vs.historyActionTxt !=\'\'"></history-action-popup> <emuhierarchy playing="getPlaying();" vertical="getRotation();"></emuhierarchy> </div> <div class="emuwebapp-modal-footer"> <button class="emuwebapp-mini-btn" id="modalPlayBtn" ng-click="playSelection()">play selected</button> <button class="emuwebapp-mini-btn" id="modalRotateBtn" ng-click="rotateHierarchy()">&orarr; rotate by 90&deg;</button> <button class="emuwebapp-mini-btn" id="modalCancelBtn" ng-click="modal.close();">close hierarchy</button> </div> </div> '),a.put("views/spectro.html",'<div class="emuwebapp-timeline"> <div class="emuwebapp-timelineCanvasContainer"> <canvas class="emuwebapp-timelineCanvasMain" width="2048"></canvas> <canvas class="emuwebapp-timelineCanvasSSFF" width="2048" drawssff ssff-trackname="{{trackName}}"></canvas> <canvas class="emuwebapp-timelineCanvasMarkup" width="2048" mouse-track-and-correction-tool ssff-trackname="{{trackName}}" bundle-name="{{curBndl.name}}"></canvas> </div> <div class="emuwebapp-timelineCanvasButtons"> <div ng-show="cps.vals.activeButtons.resizePerspectives" class="emuwebapp-level-button" enlarge="{{order}}"> <img style="cursor: pointer" src="img/resize.svg"> </div> </div> </div> '),a.put("views/spectSettings.html",'<div class="emuwebapp-modal-wrap" ng-controller="spectSettingsCtrl"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading">OSCI/SPEC Settings</h3> </div> <div class="emuwebapp-modal-body"> <div class="emuwebapp-text"> <h1>OSCI Settings</h1> <div> <h2>Current channel</h2> <select ng-model="osciChannel" ng-options="channel for channel in osciAvailableChannels"></select> </div> <h1>SPEC Settings</h1> <div> <h2>View Range (Hz)</h2> From: <input type="text" ng-keyup="checkSpectroSettings()" ng-style="cssError(2,4)" ng-model="modalVals.rangeFrom" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> To: <input type="text" ng-keyup="checkSpectroSettings()" ng-style="cssError(1,3)" ng-model="modalVals.rangeTo" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"><br> <div ng-show="htmlError(1)"><b style="color: #f00">Error:</b> Upper Range is bigger then {{upperBoundary}}</div> <div ng-show="htmlError(2)"><b style="color: #f00">Error:</b> Only positive Integers are allowed.</div> <div ng-show="htmlError(3)"><b style="color: #f00">Error:</b> Only Integers allowed inside \'To\'.</div> <div ng-show="htmlError(4)"><b style="color: #f00">Error:</b> Only Integers allowed inside \'From\'.</div> </div> <div> <h2>Window Size (seconds)</h2> <span>resulting number of samples <em>{{modalVals._windowSizeInSamples}}</em> zero-padded to <em>{{modalVals._fftN}} (min. = 512)</em></span> <input type="text" ng-keyup="checkSpectroSettings()" ng-style="cssError(6)" ng-model="modalVals.windowSizeInSecs" ng-change="calcWindowSizeVals()" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> <br> <div ng-show="htmlError(6)"><b style="color: #f00">Error:</b> Only Floats are allowed.</div> </div> <div> <h2>Dynamic Range for Maximum (dB)</h2> <input type="text" ng-keyup="checkSpectroSettings()" ng-style="cssError(5)" ng-model="modalVals.dynamicRange" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> <br> <div ng-show="htmlError(5)"><b style="color: #f00">Error:</b> Only Integers are allowed.</div> </div> <div> <h2>Pre-emphasis filter factor</h2> <span>resulting high pass filter function: <em>ŝ(k) = s(k)-{{modalVals.preEmphasisFilterFactor}}*s(k-1)</em></span> <input type="text" ng-keyup="checkSpectroSettings()" ng-style="cssError(7)" ng-model="modalVals.preEmphasisFilterFactor" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"> <br> <div ng-show="htmlError(7)"><b style="color: #f00">Error:</b> Only Floats are allowed.</div> </div> <div> <h2>Window Function</h2> <select id="selWindowInfo" ng-model="selWindowInfo.name" ng-options="opt for opt in windowOptions"></select> </div> <div> <h2>Color Options</h2> <span>Draw spectrogram in heat map colors: <input type="checkbox" ng-model="modalVals.drawHeatMapColors"></span> <table class="emuwebapp-modalTable" ng-style="cssError(8)"> <tr> <th></th> <th>red</th> <th>green</th> <th>blue</th> <th>resulting color</th> </tr> <tr> <td>First spectrogram color anchor:</td> <td>r: <input ng-keyup="checkSpectroSettings()" class="emuwebapp-rgbTextInput" type="text" ng-model="modalVals.heatMapColorAnchors[0][0]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></td> <td>g: <input ng-keyup="checkSpectroSettings()" class="emuwebapp-rgbTextInput" type="text" ng-model="modalVals.heatMapColorAnchors[0][1]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></td> <td>b: <input ng-keyup="checkSpectroSettings()" class="emuwebapp-rgbTextInput" type="text" ng-model="modalVals.heatMapColorAnchors[0][2]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></td> <td><div ng-style="vs.getColorOfAnchor(modalVals.heatMapColorAnchors, 0);"></div></td> </tr> <tr> <td>Second spectrogram color anchor: </td> <td>r: <input ng-keyup="checkSpectroSettings()" class="emuwebapp-rgbTextInput" type="text" ng-model="modalVals.heatMapColorAnchors[1][0]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></td> <td>g: <input ng-keyup="checkSpectroSettings()" class="emuwebapp-rgbTextInput" type="text" ng-model="modalVals.heatMapColorAnchors[1][1]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></td> <td>b: <input ng-keyup="checkSpectroSettings()" class="emuwebapp-rgbTextInput" type="text" ng-model="modalVals.heatMapColorAnchors[1][2]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></td> <td><div ng-style="vs.getColorOfAnchor(modalVals.heatMapColorAnchors, 1);"></div></td> </tr> <tr> <td>Third spectrogram color anchor: </td> <td>r: <input ng-keyup="checkSpectroSettings()" class="emuwebapp-rgbTextInput" type="text" ng-model="modalVals.heatMapColorAnchors[2][0]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></td> <td>g: <input ng-keyup="checkSpectroSettings()" class="emuwebapp-rgbTextInput" type="text" ng-model="modalVals.heatMapColorAnchors[2][1]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></td> <td>b: <input ng-keyup="checkSpectroSettings()" class="emuwebapp-rgbTextInput" type="text" ng-model="modalVals.heatMapColorAnchors[2][2]" ng-focus="cursorInTextField();" ng-blur="cursorOutOfTextField();"></td> <td><div ng-style="vs.getColorOfAnchor(modalVals.heatMapColorAnchors, 2);"></div></td> </tr> </table> <div ng-show="htmlError(8)"><b style="color: #f00">Error:</b> Only Integers allowed.</div> </div> </div> <div style="height: 100px">&nbsp;</div> </div> <div class="emuwebapp-modal-footer"> <button ng-click="reset()" class="emuwebapp-mini-btn">Cancel</button> <button id="emuwebapp-modal-save" ng-click="saveSettings()" class="emuwebapp-mini-btn">Save</button> </div> </div> '),a.put("views/ssffTrack.html",'<div class="emuwebapp-timeline"> <div class="emuwebapp-timelineCanvasContainer"> <canvas class="emuwebapp-timelineCanvasMain" width="2048"></canvas> <canvas class="emuwebapp-timelineCanvasSSFF" width="2048" drawssff ssff-trackname="{{curTrack}}"></canvas> <canvas class="emuwebapp-timelineCanvasMarkup" width="2048" mouse-track-and-correction-tool ssff-trackname="{{curTrack}}"></canvas> </div> <div class="emuwebapp-timelineCanvasButtons"> <div ng-show="cps.vals.activeButtons.resizePerspectives" class="emuwebapp-level-button" enlarge="{{order}}"> <img style="cursor: pointer" src="img/resize.svg"> </div> </div> </div> '),a.put("views/tabbed.html",'<script type="text/ng-template" id="node_template.html"> <a class="emuwebapp-tabbed-link" href="#" ng-click="onClickTab(node)">&nbsp;&nbsp;&nbsp;{{node.title}}</a></div> </script> <div class="emuwebapp-modal-wrap"> <div class="emuwebapp-modal-header-large emuwebapp-modal-header"> <h3 id="modalHeading">EMU-webApp Configuration</h3> </div> <div class="emuwebapp-modal-body"> <!-- tabbed header --> <div id="tabs" class="emuwebapp-tabbed" data-ng-controller="TabbedCtrl"> <ul class="emuwebapp-tabbed-menu"> <li data-ng-repeat="node in tree" data-ng-include="\'node_template.html\'"></li> </ul> <div class="emuwebapp-tabbed-view"> <form name="configForm"> <div ng-include src="currentTabUrl"></div> </form> </div> </div> </div> <div class="emuwebapp-modal-footer"> <button id="modalCancelBtn" ng-click="modal.close();" class="emuwebapp-mini-btn">Cancel</button> <button id="modalSaveBtn" ng-click="modal.confirmContent();" class="emuwebapp-mini-btn">Save</button> </div> </div> '),a.put("views/tutorial.html",'<h1>welcome to the <br>EMU-webApp Tutorial</h1> <div> In this tutorial you will learn how to label with the EMU-webApp. It consists of several parts: <ul> <li>Keyboard Shortcuts</li> <li>Editing Labels</li> <li>Loading and Saving local Data</li> <li>Connecting to a remote Server</li> </ul> Lets\'s beginn with <h1>Keyboard Shortcuts</h1> In order to navigate inside the currently loaded wav file please press <ul> <li ng-init="que[0] = cps.vals.keyMappings.zoomIn" ng-style="getClass(0);"><b>{{getStrRep(0, cps.vals.keyMappings.zoomIn)}}</b> in order to zoom In</li> <li ng-init="que[1] = cps.vals.keyMappings.zoomOut" ng-style="getClass(1);"><b>{{getStrRep(1, cps.vals.keyMappings.zoomOut)}}</b> in order to zoom Out</li> <li ng-style="getClass(2);"><b>{{getStrRep(2, cps.vals.keyMappings.shiftViewPortLeft)}}</b> in order to move left</li> <li ng-style="getClass(3);"><b>{{getStrRep(3, cps.vals.keyMappings.shiftViewPortRight)}}</b> in order to move right</li> </ul> </div> '),a.put("views/twoDcanvases.html",'<div class="twoDcanvases" show-twod="!is2dCancasesHidden" ng-show="cps.vals.perspectives[vs.curPerspectiveIdx].twoDcanvases.order.length > 0" ng-transclude> </div>'),a.put("views/waitDial.html",'<h2>Please wait...</h2> <div ng-controller="WaitCtrl"> <h3> </h3> <div>&nbsp;</div> {{vs.curTaskPercCompl}} <progress percent="vs.curTaskPercCompl"></progress> <div> </div> </div>')}]);